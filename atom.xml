<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>loveofpeach&#39;s</title>
  
  <subtitle>tree hole</subtitle>
  <link href="https://loveofpeach.github.io/atom.xml" rel="self"/>
  
  <link href="https://loveofpeach.github.io/"/>
  <updated>2024-02-06T13:47:01.209Z</updated>
  <id>https://loveofpeach.github.io/</id>
  
  <author>
    <name>love of peach</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redis Note</title>
    <link href="https://loveofpeach.github.io/posts/ac87c2.html"/>
    <id>https://loveofpeach.github.io/posts/ac87c2.html</id>
    <published>2024-01-30T09:10:47.000Z</published>
    <updated>2024-02-06T13:47:01.209Z</updated>
    
    <content type="html"><![CDATA[<h2 id="NoSQL-和-Redis-概述"><a href="#NoSQL-和-Redis-概述" class="headerlink" title="NoSQL 和 Redis 概述"></a>NoSQL 和 Redis 概述</h2><p>在日常的开发中，无不都是使用数据库来进行数据的存储，由于一般的系统任务中通常不会存在<strong>高并发</strong>的情况，所以这样看起来并没有什么问题，可是一旦涉及大数据量的需求，比如一些商品抢购的情景，或者是主页访问量瞬间较大的时候，单一使用数据库来保存数据的系统会因为面向磁盘，<strong>磁盘读/写速度比较慢</strong>的问题而存在严重的性能弊端，一瞬间成千上万的请求到来，需要系统在极短的时间内完成<strong>成千上万次的读/写操作</strong>，这个时候往往不是数据库能够承受的，极其容易造成数据库系统瘫痪，最终导致服务宕机的严重生产问题。</p><p>为了克服上述的问题，项目通常会引入 NoSQL 技术，这是一种<strong>基于内存</strong>的数据库，并且提供一定的持久化功能。</p><p>NoSQL，指的是<strong>非关系型数据库</strong>。NoSQL（<strong>Not Only SQL</strong>），是对不同于传统的关系型数据库的数据库管理系统的统称。对 NoSQL 最普遍的解释是”非关联型的”，强调 Key-Value Stores 和文档数据库的优点，而不是单纯的反对 RDBMS。</p><p><strong>NoSQL 用于超大规模数据的存储。</strong>（例如谷歌或 Facebook 每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。</p><p>NoSQL 数据库主要有以下四类：</p><ul><li>基于键值对 key-value 类型：Redis，memcached</li><li>列存储数据库 Column-oriented Graph：HBase</li><li>图形数据库 Graphs based：Neo4j</li><li>文档型数据库： MongoDB<ul><li>MongoDB是一个基于分布式文件存储的数据库，主要用来处理大量的文档。    </li></ul></li></ul><p>Redis 是什么？<br><strong>Re</strong>mote <strong>Di</strong>ctionary <strong>S</strong>ervice（远程字典服务器）<br>Redis 是一个开源（BSD许可）的，C语言编写的，高性能的数据结构存储系统，它可以用作<strong>数据库</strong>、<strong>缓存</strong>和<strong>消息中间件</strong>。它<strong>基于内存</strong>运行并支持<strong>持久化</strong>的 NoSQL 数据库，是当前最热门的 NoSQL 数据库之一。    </p><p>相关网站：</p><ul><li>redis中文官网：<a href="http://www.redis.cn/">http://www.redis.cn/</a></li><li>redis英文官网：<a href="https://redis.io/">https://redis.io/</a></li></ul><p>Redis 的特性：持久化、丰富的数据类型、数据备份（主从复制）。</p><p>Redis 的优点：</p><ul><li>性能极高</li><li>丰富的数据类型<ul><li>Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作</li></ul></li><li>原子性</li><li>丰富的特性<ul><li>Redis 支持 publish / subscribe 、通知、key 过期等特性</li></ul></li></ul><p>安装按官网走即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><p>Redis 是一个字典结构的存储服务器，而实际上一个 Redis 实例提供了多个用来存储数据的字典，客户端可以指定将数据存储在哪个字典中。这与我们熟知的在一个关系数据库实例中可以创建多个数据库类似，所以可以将其中的每个字典都理解成一个独立的数据库。</p><p>每个数据库对外都是一个从 0 开始的递增数字命名，Redis <strong>默认支持 16 个数据库</strong>（可以通过配置文件支持更多，无上限），可以通过配置 databases 来修改这一数字。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; select 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[10]&gt; select 15</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[15]&gt; select 16</span><br><span class="line">(error) ERR DB index is out of range</span><br><span class="line">127.0.0.1:6379[15]&gt; select 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>进入 redis ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br></pre></td></tr></table></figure><p>数据库的切换：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; select 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[10]&gt; select 15</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[15]&gt; select 16</span><br><span class="line">(error) ERR DB index is out of range</span><br><span class="line">127.0.0.1:6379[15]&gt; select 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure><p>不言之教：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k2 200</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; dbsize</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br><span class="line">127.0.0.1:6379&gt; keys k?</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br><span class="line">127.0.0.1:6379&gt; set k12 12</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys k?</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br></pre></td></tr></table></figure><p>删除 key ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k12&quot;</span><br><span class="line">3) &quot;k2&quot;</span><br><span class="line">127.0.0.1:6379&gt; del k12</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; del k12</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><p>清除当前数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; set k1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; dbsize</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure><p>清空所有数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure><p>判断某个 key 是否存在：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br><span class="line">127.0.0.1:6379&gt; Exists k1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; Exists k12</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><p>把 key 从当前库移动到目标库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; move k1 15</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">127.0.0.1:6379&gt; select 15</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[15]&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br></pre></td></tr></table></figure><p>查看 key 的类型：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; type k2</span><br><span class="line">string</span><br></pre></td></tr></table></figure><p>为给定的key设置过期的时间：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">127.0.0.1:6379&gt; Expire k2 10</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) -2</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; ttl k2</span><br><span class="line">(integer) -2</span><br><span class="line">127.0.0.1:6379&gt; set k1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) -1</span><br></pre></td></tr></table></figure><p>在上面的命令中，-2 表示数据已经消失，-1 表示该数据不会过期。</p><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><p><img src="https://s2.loli.net/2024/01/31/fuDdGLaOZI1xyRs.png" alt="65-1.png"></p><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>string 是 redis 最基本的类型，可以理解成一个 key 对应一个 value . 一个 string 类型的值最大能存储512MB .</p><p>string 类型是<strong>二进制安全</strong>的。意思是 redis 的 string <strong>可以包含任何数据</strong>。如 jpg 图片或序列化的对象。</p><p>设定指定key的值、获取指定key的值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k1 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k2 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k3 hello</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;10&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;hello&quot;</span><br></pre></td></tr></table></figure><p>设置、获取多个给定的 key 值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset k11 11 k12 12 k13 world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget k11 k12 k13</span><br><span class="line">1) &quot;11&quot;</span><br><span class="line">2) &quot;12&quot;</span><br><span class="line">3) &quot;world&quot;</span><br></pre></td></tr></table></figure><p>二进制安全的体现（设置的是什么，获取的就是什么）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k22 hello\0world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k22</span><br><span class="line">&quot;hello\\0world&quot;</span><br></pre></td></tr></table></figure><p>返回字符串的子串：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; GETRANGE k3 0 1</span><br><span class="line">&quot;he&quot;</span><br><span class="line">127.0.0.1:6379&gt; GETRANGE k3 0 3</span><br><span class="line">&quot;hell&quot;</span><br><span class="line">127.0.0.1:6379&gt; set k4 askgalfja;fegrga</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k4</span><br><span class="line">&quot;askgalfja;fegrga&quot;</span><br><span class="line">127.0.0.1:6379&gt; GETRANGE k4 0 -1</span><br><span class="line">&quot;askgalfja;fegrga&quot;</span><br></pre></td></tr></table></figure><p>覆盖字符串的值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; SETRANGE k3 0 wor</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;worlo&quot;</span><br><span class="line">127.0.0.1:6379&gt; SETRANGE k3 waipoqiaoyaoayao</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;setrange&#x27; command</span><br><span class="line">127.0.0.1:6379&gt; SETRANGE k3 0 waipoqiaoyaoayao</span><br><span class="line">(integer) 16</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;waipoqiaoyaoayao&quot;</span><br></pre></td></tr></table></figure><p>设新值，返回旧值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;10&quot;</span><br><span class="line">127.0.0.1:6379&gt; GETSET k1 hello</span><br><span class="line">&quot;10&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;hello&quot;</span><br></pre></td></tr></table></figure><p>set 值，并设置过期时间（以秒为单位）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SETEX k1 10 200</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;200&quot;</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) -2</span><br></pre></td></tr></table></figure><p>加一 / 加很多（被加的必须是数值）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; INCR k1</span><br><span class="line">(integer) 101</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; INCR k1</span><br><span class="line">(integer) 102</span><br><span class="line">127.0.0.1:6379&gt; INCR k1</span><br><span class="line">(integer) 103</span><br><span class="line">127.0.0.1:6379&gt; INCR k1</span><br><span class="line">(integer) 104</span><br><span class="line">127.0.0.1:6379&gt; INCR k1</span><br><span class="line">(integer) 105</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;105&quot;</span><br><span class="line">127.0.0.1:6379&gt; INCRBY k1 95</span><br><span class="line">(integer) 200</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;200&quot;</span><br></pre></td></tr></table></figure><h3 id="list（双向链表）"><a href="#list（双向链表）" class="headerlink" title="list（双向链表）"></a>list（双向链表）</h3><p>插入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush list1 1 2 3 4 5 6</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; rpush list1 7 8 9 10</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt; lrange list1 0 -1</span><br><span class="line"> 1) &quot;6&quot;</span><br><span class="line"> 2) &quot;5&quot;</span><br><span class="line"> 3) &quot;4&quot;</span><br><span class="line"> 4) &quot;3&quot;</span><br><span class="line"> 5) &quot;2&quot;</span><br><span class="line"> 6) &quot;1&quot;</span><br><span class="line"> 7) &quot;7&quot;</span><br><span class="line"> 8) &quot;8&quot;</span><br><span class="line"> 9) &quot;9&quot;</span><br><span class="line">10) &quot;10&quot;</span><br></pre></td></tr></table></figure><p>出队：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpop list1</span><br><span class="line">&quot;6&quot;</span><br><span class="line">127.0.0.1:6379&gt; rpop list1</span><br><span class="line">&quot;10&quot;</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list1 0 -1</span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">6) &quot;7&quot;</span><br><span class="line">7) &quot;8&quot;</span><br><span class="line">8) &quot;9&quot;</span><br></pre></td></tr></table></figure><p>通过下标设置列表元素的值，下标从0开始：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lset list1 5 1000</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list1 0 -1</span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">6) &quot;1000&quot;</span><br><span class="line">7) &quot;8&quot;</span><br><span class="line">8) &quot;9&quot;</span><br></pre></td></tr></table></figure><p>通过下标获取列表中的元素：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LINDEX list1 5</span><br><span class="line">&quot;1000&quot;</span><br></pre></td></tr></table></figure><p>从队头开始移除 count 个值为 value 的列表元素：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LREM key count value</span><br></pre></td></tr></table></figure><p>对一个列表进行修剪（trim），即，只保留指定区间内的元素，其余元素将被删除：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LTRIM list1 2 5</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list1 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;1&quot;</span><br><span class="line">4) &quot;1000&quot;</span><br></pre></td></tr></table></figure><p>总结： redis 中的区间是左闭右闭的。</p><p>在列表的元素前插入元素：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; linsert list1 after 1 200</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;1&quot;</span><br><span class="line">4) &quot;200&quot;</span><br><span class="line">5) &quot;1000&quot;</span><br></pre></td></tr></table></figure><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>set 是 String 类型的无序集合。集合成员是唯一的，集合中不能出现重复的数据。</p><p>集合通过哈希表实现，增、删、查的复杂度为 O(1) .</p><p>增：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset1 1 3 5 7 8 3 5 1</span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure><p>查看个数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scard myset1</span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure><p>显示（此例有序系巧合）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;5&quot;</span><br><span class="line">4) &quot;7&quot;</span><br><span class="line">5) &quot;8&quot;</span><br></pre></td></tr></table></figure><p>其它命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 判断member元素是否是集合key的成员</span><br><span class="line">SISMEMBER key member</span><br><span class="line"></span><br><span class="line"># 将member元素从source集合移动到destination集合</span><br><span class="line">SMOVE source destination member</span><br><span class="line"></span><br><span class="line">SREM key value       # 删除集合中值为value的元素</span><br><span class="line"></span><br><span class="line">SRANDMEMBER key num  # 在集合中随机选出num个</span><br><span class="line"></span><br><span class="line"># 移除并返回集合中一个/num个随机元素</span><br><span class="line">SPOP key [num]</span><br><span class="line"></span><br><span class="line">SDIFF key1 key2      # 求差集，key1-key2</span><br><span class="line">SINTER key1 key2     # 求交集</span><br><span class="line">SUNION key1 key2     # 求并集</span><br></pre></td></tr></table></figure><h3 id="sorted-set（zset）"><a href="#sorted-set（zset）" class="headerlink" title="sorted set（zset）"></a>sorted set（zset）</h3><p>有序集合和集合一样也是 string 类型元素的集合。</p><p>不同的是每个元素都会关联一个<strong>double类型的分数</strong>。redis 通过分数来为集合中的成员从小到大排序。</p><p>有序集合的成员是唯一的，但分数可以重复。</p><p>增：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd zset1 10 hello 30 world 20 peking</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure><p>获取有序集合的成员数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zcard zset1</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure><p>计算在有序集合中指定分数区间的成员数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zcount zset1 10 100</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zcount zset1 10 15</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><p>查看按照权重排序后的下标对应的元素：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANGE zset1 0 1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;peking&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE zset1 0 1 withscores</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;10&quot;</span><br><span class="line">3) &quot;peking&quot;</span><br><span class="line">4) &quot;20&quot;</span><br></pre></td></tr></table></figure><p><del>通过字典区间返回有序集合的成员</del>（分数要一致）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd zset2 10 ohmyzsh 10 ohmygod 10 hello 10 world</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; zrangebylex zset2 [h [o</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebylex zset2 [h [ok</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;ohmygod&quot;</span><br><span class="line">3) &quot;ohmyzsh&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebylex zset2 [h [w</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;ohmygod&quot;</span><br><span class="line">3) &quot;ohmyzsh&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebylex zset2 [h [www</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;ohmygod&quot;</span><br><span class="line">3) &quot;ohmyzsh&quot;</span><br><span class="line">4) &quot;world&quot;</span><br></pre></td></tr></table></figure><p>容易发现上面的区间是左闭右开的。</p><p>其它：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 通过分数返回有序集合指定区间内的成员</span><br><span class="line">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] </span><br><span class="line"></span><br><span class="line">ZSCORE key member   # 返回有序集中，成员的分数值</span><br><span class="line"></span><br><span class="line"># 返回有序集中指定分数区间内的成员，分数从高到低排序</span><br><span class="line">ZREVRANGEBYSCORE key max min [WITHSCORES]</span><br></pre></td></tr></table></figure><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>hash 是一个 string 类型的 field（字段）和 value（值）的映射表，hash 特别适合用于存储对象。</p><p>Key-value 模式不变，但 value 是一个键值对。</p><p>Redis 中的 hash 并不是采用哈希实现的，而是类似于以下方式：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map&lt;key, map&lt;key1, value&gt;&gt;</span><br></pre></td></tr></table></figure><p><code>HSET key field value</code>将哈希表 key 中的字段 field 的值设为 value ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset people name Mizuho gender woman age 17</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure><p>获取给定字段的值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hget people name</span><br><span class="line">&quot;Mizuho&quot;</span><br><span class="line">127.0.0.1:6379&gt; hget people gender</span><br><span class="line">&quot;woman&quot;</span><br><span class="line">127.0.0.1:6379&gt; hget people age</span><br><span class="line">&quot;17&quot;</span><br></pre></td></tr></table></figure><p>获取字段和值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hkeys people</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;gender&quot;</span><br><span class="line">3) &quot;age&quot;</span><br><span class="line">127.0.0.1:6379&gt; hvals people</span><br><span class="line">1) &quot;Mizuho&quot;</span><br><span class="line">2) &quot;woman&quot;</span><br><span class="line">3) &quot;17&quot;</span><br></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h3 id="Units"><a href="#Units" class="headerlink" title="Units"></a>Units</h3><p><img src="https://bu.dusays.com/2024/02/02/65bc7bca2f40d.png" alt="65-2.png"></p><h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1      # 绑定的ip</span><br><span class="line">protected-mode yes  # 保护模式</span><br><span class="line">port  6379          # 端口</span><br></pre></td></tr></table></figure><h3 id="General"><a href="#General" class="headerlink" title="General"></a>General</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes     # 以守护进程方式运行</span><br><span class="line">loglevel  notice  # 日志级别</span><br><span class="line">database  16      # 数据库数量 </span><br></pre></td></tr></table></figure><h3 id="snapshoting"><a href="#snapshoting" class="headerlink" title="snapshoting"></a>snapshoting</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">save 900 1              </span><br><span class="line"># 900秒(15分钟)后，若至少有1个key发生变化，dump内存快照</span><br><span class="line"></span><br><span class="line">save 300 10            </span><br><span class="line"># 300秒(5分钟)后，若至少有10个key发生变化，dump内存快照</span><br><span class="line"></span><br><span class="line">save 60 10000       </span><br><span class="line"># 60秒(1分钟)后，若至少有10000个key发生变化，dump内存快照</span><br></pre></td></tr></table></figure><p>（以下信息可能过期）：</p><ul><li>快照文件名 <code>dbfilename dump.rdb</code></li><li>保存目录名 <code>/var/lib/redis/6379</code></li></ul><h3 id="APPEND-ONLY-MODE"><a href="#APPEND-ONLY-MODE" class="headerlink" title="APPEND ONLY MODE"></a>APPEND ONLY MODE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 是否使用AOF持久化方式。默认不使用</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># 持久化的AOF文件名</span><br><span class="line">appendfilename &quot;appendonly6381.aof&quot;</span><br><span class="line"></span><br><span class="line"># 在Redis的配置文件中存在三种AOF同步方式，分别是：</span><br><span class="line">appendfsync always     #每次有数据修改发生时都会写入AOF文件。</span><br><span class="line">appendfsync everysec   #每秒钟同步一次，该策略为AOF的缺省策略。</span><br><span class="line">appendfsync no         #从不同步。高效但是数据不会被持久化。</span><br></pre></td></tr></table></figure><h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><h3 id="分类、概述"><a href="#分类、概述" class="headerlink" title="分类、概述"></a>分类、概述</h3><p>Redis 持久化分为 RDB 持久化和 AOF 持久化：前者将当前数据保存到硬盘（原理是将 Reids 在内存中的数据库记录定时 dump 到磁盘上的 RDB 持久化），后者则是将每次执行的写命令保存到硬盘（原理是将 Reids 的操作日志以追加的方式写入文件，类似于 MySQL 的 binlog）；由于 AOF 持久化的实时性更好，即当进程意外退出时丢失的数据更少，因此 AOF 是目前主流的持久化方式，不过 RDB 持久化仍然有其用武之地。</p><p>RDB 持久化方式在指定的时间间隔内对数据进行快照存储。</p><p>AOF 持久化方式记录每次写操作，服务器重启时会重新执行这些命令以恢复原始数据，AOF 命令以 redis 协议追加。Redis 还能对 AOF 文件进行后台重写，使得 AOF 文件的体积不至于过大。</p><p>可以同时开启两种持久化方式。这种情况下，redis 重启时会优先载入 AOF 文件来恢复原始的数据。</p><h3 id="RDB-方式"><a href="#RDB-方式" class="headerlink" title="RDB 方式"></a>RDB 方式</h3><p>触发 RDB 快照：</p><ol><li><strong>在指定的时间间隔内，执行指定次数的写操作</strong></li><li>执行<code>save</code>（阻塞， 只管保存快照，其他的等待） 或者 bgsave （异步）命令</li><li>执行 flushall 命令，清空数据库所有数据</li><li>执行 shutdown 命令，保证服务器正常关闭且不丢失任何数据</li></ol><p>RDB 方式的优点：</p><ol><li>适合大规模的数据恢复，与 AOF 相比,在恢复大的数据集时，RDB 方式更快。</li><li>若业务对数据完整性和一致性要求不高，RDB 是很好的选择。</li></ol><p>RDB方式的缺点：</p><ol><li>数据的完整性和一致性不高，因为 RDB 可能在最后一次备份时宕机了。</li><li><strong>备份时占用内存</strong>，因为 Redis 在备份时会 fork 一个子进程，将数据写入一个临时文件（此时内存中的数据是原来的两倍），最后再将临时文件替换之前的备份文件。<br><img src="https://bu.dusays.com/2024/02/02/65bc8c7b21612.jpeg" alt="65-3.jpeg"></li></ol><h3 id="AOF-方式"><a href="#AOF-方式" class="headerlink" title="AOF 方式"></a>AOF 方式</h3><p>默认不开启 AOF 持久化方式，需要修改配置打开。</p><p>默认的 AOF 持久化策略是每秒钟 fsync 一次（把缓存中的写指令记录到磁盘中），因为在这种情况下，redis 仍可以保持高性能，而即使故障，也只会丢失最近 1 秒的数据。</p><p>重写（rewrite）：<br>AOF 的运作方式是不断地将命令追加到文件末尾，随着写入命令的增加， AOF 文件也会越来越大。例如，若对一个计数器调用 100 次<code>INCR</code>，那么仅为了保存这个计数器的当前值，AOF 文件就需要使用 100 条记录（entry）。而实际上，只用一条<code>SET</code>命令就足够了。<br>为此，Redis 支持一种特性，可以在不打断服务客户端的情况下，对 AOF 文件进行重建（rebuild）。</p><p>执行<code>BGREWRITEAOF</code>命令， Redis 将生成一个新的 AOF 文件，包含重建当前数据集所需的最少命令。Redis 2.2 需要手动执行<code>BGREWRITEAOF</code>命令；Redis 2.4 则可以自动触发 AOF 重写。</p><p>Redis 会记录上次重写时的 AOF 大小，默认配置是当 AOF 文件大小是上次 rewrite 后大小的一倍且文件大于64M时触发：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure><p>优点：</p><ul><li>保证数据的完整性和一致性</li><li>AOF 文件有序地保存了对数据库执行的所有写入操作， 这些写入操作以 Redis 协议的格式保存， 因此 AOF 文件易读性好，对文件进行分析（parse）也很轻松。导出（export）AOF 文件也非常简单：例如，若不小心执行了<code>FLUSHALL</code>命令，但只要<code>AOF</code>文件未被重写，那么只要停止服务器，移除 AOF 文件末尾的<code>FLUSHALL</code>命令，并重启 Redis，就可以将数据集恢复到<code>FLUSHALL</code>执行前的状态。</li></ul><p>缺点：</p><ul><li>大量数据恢复的时候，执行时间长</li><li>对于相同的数据集来说，AOF 文件的体积通常大于 RDB 文件的体积</li></ul><p>若只有 aof 持久化的方式，且 aof 文件损坏，则 redis 服务器无法启动。</p><p>损坏的 aof 文件修复，可尝试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo redis-check-aof --fix 文件名</span><br></pre></td></tr></table></figure><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 开启事务</span><br><span class="line">multi</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line">exec</span><br></pre></td></tr></table></figure><p>Redis 事务可以一次执行多个命令，本质是一组命令的集合。一个事务中的所有命令都会序列化，<strong>按顺序地串行化执行</strong>，而不会被其他命令插入，不许加塞。</p><p>Redis 事务有以下三个重要的保证：</p><ol><li>批量操作在发送 EXEC 命令前被放入队列缓存。</li><li>收到 EXEC 命令后进入事务执行，<strong>事务中任意命令执行失败，其余的命令依然被执行</strong>。</li><li>在事务执行过程，其他客户端提交的命令请求不会插入到事务执行命令序列中。</li></ol><p>一个事务从开始到执行会经历以下三个阶段：</p><ol><li>开始事务</li><li>命令入队</li><li>执行事务</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k2 hello</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k3 300</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) &quot;300&quot;</span><br><span class="line">3) (integer) 101</span><br></pre></td></tr></table></figure><p>redis 的事务不具有原子性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incr k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k4 400</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) (error) ERR value is not an integer or out of range</span><br><span class="line">2) OK</span><br><span class="line">3) &quot;400&quot;</span><br><span class="line">4) (integer) 102</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;102&quot;</span><br></pre></td></tr></table></figure><p>EXECABORT Transaction discarded because of previous errors :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; flushall</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line">127.0.0.1:6379&gt; set k1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k2 hello </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incr k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k3</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;set&#x27; command</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k4 400</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></table></figure><p>取消事务，放弃执行事务块内的所有命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DISCARD</span><br></pre></td></tr></table></figure><p><code>WATCH key [key ...]</code>，监视一个（多个）key ，如果在事务执行之前这个（这些）key 被其他命令改动，那么事务将被打断。</p><p><code>UNWATCH</code>取消<code>WATCH</code>命令对所有 key 的监视。</p><center><p style="color: red";>- - - - - “监视” 演示 - - - - -</p></center><p>开始：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">2) &quot;k3&quot;</span><br><span class="line">3) &quot;k1&quot;</span><br></pre></td></tr></table></figure><p>terminal 1 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; watch k3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k3 400</span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure><p>terminal 2 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k3 500</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;500&quot;</span><br></pre></td></tr></table></figure><p>terminal 1 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">&quot;500&quot;</span><br></pre></td></tr></table></figure><center><p style="color: red";>- - - - - “监视” 演示 END - - - - -</p></center><p>一旦执行<code>EXEC</code>，<code>WATCH</code>监控会被取消。</p><h2 id="乐观锁、悲观锁"><a href="#乐观锁、悲观锁" class="headerlink" title="乐观锁、悲观锁"></a>乐观锁、悲观锁</h2><p>悲观锁：<br><strong>每次拿数据时都会先上锁</strong>。其他线程想要访问时，都需要阻塞挂起。传统的关系型数据库里用到了很多这种锁机制，如行锁、表锁、读锁、写锁等，都是在操作之前先上锁。</p><p>乐观锁（Optimistic Lock）【冲突检测和数据更新】：<br><strong>每次拿数据时不上锁</strong>。但更新时会使用版本号等机制，判断此期间内该数据是否被更新。乐观锁<strong>适用于多读</strong>的应用类型，可以提高吞吐量。数据库若提供类似于 write_condition 机制的其实都是乐观锁。</p><p>乐观锁策略：提交版本必须大于记录当前版本才能执行更新，一般会使用<strong>版本号机制</strong>或<strong>CAS操作</strong>实现。</p><p>version方式：<br>一般是在数据表中加上一个数据版本号 version 字段，表示数据被修改的次数，当数据被修改时，version 值加一。当线程 A 要更新数据值时，在读取数据的同时也会读取 version 值，提交更新时，若刚才读取到的 version 值和当前数据库中的 version 值相等时才真正执行更新，否则重试更新操作，直到更新成功。</p><p>CAS（Compare And Swap）操作方式：<br>CAS 是乐观锁技术，涉及到三个操作数，数据所在的内存值V，预期值A，新值B。当需要更新时，判断当前内存值V与之前取到的值A是否相等，若相等，则用新值更新，若失败则重试。一般情况下是一个自旋操作，即不断的重试。</p><h2 id="主从复制、哨兵模式"><a href="#主从复制、哨兵模式" class="headerlink" title="主从复制、哨兵模式"></a>主从复制、哨兵模式</h2><p>持久化侧重解决的是 Redis 数据的单机备份问题（从内存到硬盘的备份）；而主从复制则侧重解决数据的多机热备。此外，主从复制还可以实现负载均衡和故障恢复。</p><p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点（master），后者称为从节点（slave）；数据的复制是<strong>单向</strong>的，只能由主节点到从节点。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="https://www.youtube-nocookie.com/embed/M8RwlLZhtOI?si=clISeZjsqLiaNs6I" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position:absolute; height: 100%; width: 100%;"> </iframe></div><p><br></p><p>本节课的 PDF 笔记：</p><div class="row"><iframe src="https://drive.google.com/file/d/1AerFNG6KZ3hRKiEOYGkbOJrv_1Zbk5Y5/preview" style="width:100%; height:550px"></iframe></div><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h3><p>一般而言，热点数据会去做缓存，缓存由定时任务刷新，但定时刷新会产生一个问题：当缓存服务器重启或者大量缓存集中在某一个时间段失效时，此时相当于没有缓存，所有对数据的请求直接走到数据库，带来很大压力。</p><p><img src="https://bu.dusays.com/2024/02/05/65c0ec28a43c9.png" alt="65-4.png"></p><p>解决方法：</p><ul><li><strong>将缓存失效时间分散开</strong>。比如可以在原有的失效时间基础上加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，很难引发集体失效的事件。</li><li><strong>不设置缓存的过期时间</strong>。有更新操作时就把热点的缓存全部更新，比如首页上的商品，当首页更新时，就把对应的数据替换掉。</li></ul><h3 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h3><p>缓存击穿指一个 key 可能会在某些时间点被超高并发地访问，属于“热点”数据，不停地扛着大量并发的访问，当这个热点数据在缓存中过期失效的时候，大量的并发访问就会穿破缓存，转移到数据库上面。</p><p>解决方法：</p><ul><li>延长热点 key 的过期时间或者设置永不过期，如排行榜、首页等。</li><li>利用互斥锁保证同一时刻只有一个客户端可以查询底层数据库的这个数据，一旦查到数据就缓存至 Redis 内，避免其他大量请求同时穿过 Redis 访问底层数据库。</li></ul><h3 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h3><p>要查询的数据不存在，缓存无法命中所以需要查询完数据库，但是数据是不存在的，此时数据库肯定会返回空，也就不会记录到缓存中，这样每次对该数据的查询都会穿过缓存去查询一次数据库。</p><p>解决方法：</p><ul><li>查询时做一些校验和过滤（权限校验，参数校验等等），判断这是一次正常的查询，还是异常的查询或是攻击，如果是不合法的参数或者查询，直接返回。</li><li>缓存空对象，如果数据库中不存在这个数据，也在缓存中保存这个 key，只是把 val 值记录为“不存在”、“空”这样的数据，下次再访问这个 key 时，就不会到数据库中做无用的查找了。</li><li>可以预先将数据库里面所有的 key 全部存到一个大的 map 里面，然后在过滤器中过滤掉那些不存在的 key. 但是需要考虑数据库的 key 是会更新的，此时需要考虑数据库 —&gt; map 的更新频率问题。类似于位图。</li></ul><h2 id="hiredis"><a href="#hiredis" class="headerlink" title="hiredis"></a>hiredis</h2><h3 id="安装与使用"><a href="#安装与使用" class="headerlink" title="安装与使用"></a>安装与使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/redis/hiredis.git</span><br></pre></td></tr></table></figure><p>进行解压与安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf hiredis.tar.gz</span><br><span class="line"><span class="built_in">cd</span> hiredis</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>更新动态库配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure><p>按照上面步骤安装之后，hiredis 的头文件会存在 /usr/local/include 下面，hiredis 的库文件存在 /usr/local/lib 下面。</p><p>编译方式：<br><code>g++ xxx.cc -o xxx -I /usr/local/include/hiredis -lhiredis</code>或者直接<code>g++ xxx.cc -lhiredis</code> 需要链接hiredis的库文件。</p><p>后续在代码中引用 hiredis 的头文件，可以直接使用：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;hiredis/hiredis.h&gt;</span></span></span><br></pre></td></tr></table></figure><div class="row"><iframe src="https://drive.google.com/file/d/1asACieQELf93yK5e0SpIvgqAdUt-cLHC/preview" style="width:100%; height:550px"></iframe></div><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// myRedis.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MYREDIS_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MYREDIS_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;hiredis/hiredis.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRedis</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyRedis</span>();</span><br><span class="line">    ~<span class="built_in">MyRedis</span>();</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect</span><span class="params">(<span class="type">const</span> string&amp; host, <span class="type">int</span> port)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(string key, string value)</span></span>;</span><br><span class="line">    <span class="function">string <span class="title">get</span><span class="params">(string key)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    redisContext* _pConnect;</span><br><span class="line">    redisReply* _pReply;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyRedis.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myRedis.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">MyRedis::<span class="built_in">MyRedis</span>():_pConnect(<span class="literal">nullptr</span>), _pReply(<span class="literal">nullptr</span>)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;MyRedis()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyRedis::~<span class="built_in">MyRedis</span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;~MyRedis()&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(_pConnect)&#123;</span><br><span class="line">        <span class="built_in">redisFree</span>(_pConnect);</span><br><span class="line">        _pConnect = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(_pReply)&#123;</span><br><span class="line">        <span class="built_in">freeReplyObject</span>(_pReply);</span><br><span class="line">        _pReply = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MyRedis::connect</span><span class="params">(<span class="type">const</span> string&amp; host, <span class="type">int</span> port)</span></span>&#123;</span><br><span class="line">    _pConnect = <span class="built_in">redisConnect</span>(host.<span class="built_in">c_str</span>(), port);</span><br><span class="line">    <span class="keyword">if</span>(_pConnect == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(_pConnect != <span class="literal">nullptr</span> &amp;&amp; _pConnect-&gt;err)&#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;connect error : &quot;</span> &lt;&lt; _pConnect-&gt;errstr &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// 连接成功</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyRedis::set</span><span class="params">(string key, string value)</span></span>&#123;</span><br><span class="line">    _pReply = (redisReply*) <span class="built_in">redisCommand</span>(_pConnect, <span class="string">&quot;SET %s %s&quot;</span>, key.<span class="built_in">c_str</span>(), value.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(_pReply)&#123;</span><br><span class="line">        <span class="built_in">freeReplyObject</span>(_pReply);</span><br><span class="line">        _pReply = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">MyRedis::get</span><span class="params">(string key)</span></span>&#123;</span><br><span class="line">    _pReply = (redisReply*) <span class="built_in">redisCommand</span>(_pConnect, <span class="string">&quot;GET %s&quot;</span>, key.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(_pReply)&#123;</span><br><span class="line">        <span class="keyword">if</span>(_pReply-&gt;type == REDIS_REPLY_STRING)&#123;</span><br><span class="line">            string str = _pReply-&gt;str;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">freeReplyObject</span>(_pReply);</span><br><span class="line">            _pReply = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testredis.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myRedis.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::unique_ptr;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">unique_ptr&lt;MyRedis&gt; <span class="title">pRedis</span><span class="params">(<span class="keyword">new</span> MyRedis())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!pRedis-&gt;<span class="built_in">connect</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>))&#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;connect error ! &quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pRedis-&gt;<span class="built_in">set</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lili&quot;</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Get the name is &quot;</span> &lt;&lt; pRedis-&gt;<span class="built_in">get</span>(<span class="string">&quot;name&quot;</span>) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode/example_reids$ <span class="built_in">ls</span></span><br><span class="line">MyRedis.cc  myRedis.h  testredis.cc</span><br><span class="line">wanko@wanko:~/mycode/example_reids$ g++ *.cc -lhiredis</span><br><span class="line">wanko@wanko:~/mycode/example_reids$ ./a.out</span><br><span class="line">MyRedis()</span><br><span class="line">Get the name is lili</span><br><span class="line">~MyRedis()</span><br></pre></td></tr></table></figure><p>此时回到数据库中查看：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">127.0.0.1:6379&gt; type name</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;lili&quot;</span><br></pre></td></tr></table></figure><p>更进一步的拓展：<br><a href="https://github.com/sewenew/redis-plus-plus">https://github.com/sewenew/redis-plus-plus</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;NoSQL-和-Redis-概述&quot;&gt;&lt;a href=&quot;#NoSQL-和-Redis-概述&quot; class=&quot;headerlink&quot; title=&quot;NoSQL 和 Redis 概述&quot;&gt;&lt;/a&gt;NoSQL 和 Redis 概述&lt;/h2&gt;&lt;p&gt;在日常的开发中，无不都是使用</summary>
      
    
    
    
    <category term="计算机" scheme="https://loveofpeach.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    
    <category term="Redis" scheme="https://loveofpeach.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>线性代数笔记</title>
    <link href="https://loveofpeach.github.io/posts/35508c6a.html"/>
    <id>https://loveofpeach.github.io/posts/35508c6a.html</id>
    <published>2024-01-28T18:38:46.000Z</published>
    <updated>2024-01-28T18:57:17.037Z</updated>
    
    <content type="html"><![CDATA[<p>存档一下以前的知识，也许以后会进一步学习。</p><h2 id="行列式"><a href="#行列式" class="headerlink" title="行列式"></a>行列式</h2><div class="row"><iframe src="https://drive.google.com/file/d/1LVjZF-HDF6qXgoqa1j1OMri7_IiksgRp/preview" style="width:100%; height:550px"></iframe></div><h2 id="矩阵"><a href="#矩阵" class="headerlink" title="矩阵"></a>矩阵</h2><div class="row"><iframe src="https://drive.google.com/file/d/1i-Bww3jJlxzrXSRKQtuEwv00SX0zfOsu/preview" style="width:100%; height:550px"></iframe></div><h2 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h2><div class="row"><iframe src="https://drive.google.com/file/d/1Qz6qLOdS_FqzW1R3EfVwRAdysfF4IfuZ/preview" style="width:100%; height:550px"></iframe></div><h2 id="线性方程组"><a href="#线性方程组" class="headerlink" title="线性方程组"></a>线性方程组</h2><div class="row"><iframe src="https://drive.google.com/file/d/1jRrgEsx2XkIo9wEXdM-WaHe3APzSKEDj/preview" style="width:100%; height:550px"></iframe></div><h2 id="特征值和特征向量"><a href="#特征值和特征向量" class="headerlink" title="特征值和特征向量"></a>特征值和特征向量</h2><div class="row"><iframe src="https://drive.google.com/file/d/1cw6wr2XMo3HUDybu4SbzTd7dJxNq8Fd6/preview" style="width:100%; height:550px"></iframe></div><h2 id="二次型"><a href="#二次型" class="headerlink" title="二次型"></a>二次型</h2><div class="row"><iframe src="https://drive.google.com/file/d/1RLOwPGNd9T1KuMkKKqLFT9iek3-8jiDb/preview" style="width:100%; height:550px"></iframe></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;存档一下以前的知识，也许以后会进一步学习。&lt;/p&gt;
&lt;h2 id=&quot;行列式&quot;&gt;&lt;a href=&quot;#行列式&quot; class=&quot;headerlink&quot; title=&quot;行列式&quot;&gt;&lt;/a&gt;行列式&lt;/h2&gt;

	&lt;div class=&quot;row&quot;&gt;
		&lt;iframe src=&quot;http</summary>
      
    
    
    
    <category term="数学" scheme="https://loveofpeach.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="线性代数" scheme="https://loveofpeach.github.io/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>以前的事（序）</title>
    <link href="https://loveofpeach.github.io/posts/2098d023.html"/>
    <id>https://loveofpeach.github.io/posts/2098d023.html</id>
    <published>2024-01-19T20:30:53.000Z</published>
    <updated>2024-01-21T16:52:56.578Z</updated>
    
    <content type="html"><![CDATA[<p>一些古早的记忆。</p><p>红色气球的爆炸。</p><p>幼儿园，似乎是某个活动或者节日，园里挂了一排排的三角形彩旗，操场上有滑梯等娱乐设施。</p><p>出早操，老师在某次早操之后打了所有小朋友的手心。早餐 M 买了蛋饼，但我没有吃完，于是挂在班级的椅子上，放了很久。</p><p>第二年转学，坐在我前面的是一个扎着马尾的女孩。我非常好奇，不假思索地从头绳捋到发梢，女孩非常生气地转过身瞪了我一眼，似乎马上就要将双手拍在我的桌上：“不！许！摸！” </p><p>第二年或是第三年的冬天，上楼梯脚底一滑，头磕到了楼梯尖，开了一个口子。一个陌生的老爷爷把我带到班级，后来学校找了一辆面包车——大概是五菱宏光，送我去医院，缝了针。没有拆线的记忆。</p><p>有过“一二三，木头人”的游戏。</p><p>厕所不分男女，老师们定时让小朋友们按性别分开上。同班有一个怪人，有时会捡垃圾桶的东西吃。夏天有过集体定冷饮的事。学过英语，但只记得一个单词，“pencil”，课本上有一个巨大的铅笔。有考试，老师们让我们直接抄一个女孩的试卷。有补餐，基本上是白粥，中国移动有送一种小本子，我和同学会撕下一张垫碗。用菜梗做过印章。</p><p>有过表演活动，似乎和戏剧元素有关，有集体照，L 君也在上面，如此想来，真是和 L 同学过相当多年。</p><hr><p>高中的我，会怀念初中小学的日子。</p><p>我对此怀疑——它们真如我想的那般甘甜？</p><p>一个历时数年的实验：高中的时候，我问自己，我过的快乐吗？答，不算快乐。然后，我在心里记下这个答案。</p><p>大学，每当我怀念起高中，我就会想，哎，高中的时候怎么怎么好，老师是怎样优秀（排除个别人），相比其他县城高中，我的学校也还算有人文关怀，同学又个个都是人才，即便男女分桌还和一个扎着马尾的漂亮女孩同桌过一阵子（我坐在教室中间单独的一列，不参与左右轮换，只前后轮换。虽然是单独的一列其实还是挨着的，因此每次换座位我都换同桌），那我的高中生活一定很快乐吧？这个时候，我在高中埋下的回答就会探出脑袋告诉我，其实我的高中生活还挺糟糕，经历了严重的抑郁情绪，也一度陷入虚无主义中。</p><p>那么为什么大学的我会觉得高中生活很好呢？一定是因为我大学生活过的更不如意，想要有选择地反刍一些回忆，藉以安慰疲惫的精神罢。</p><p>如此看来，回忆确实倾向于美化自己，掩盖一些伤痛和不堪。</p><p>但还是要试着去把握它们。</p><hr><p>总的来说，这个系列的文章会大概讲讲创建这个 blog 之前的我的故事，可能会属于不那么有趣的那种。</p><p>一个人的回忆总是近于无限多的，按时间顺序去梳理个人的“编年史”是痴心妄想。</p><p>正如一些贺岁歌曲会让人想起过年时超市里的散装糖那样，记忆总是在意想不到的时刻像咕咚咕咚的泉水般涌出来。</p><p>因此我大抵是想到哪写到哪，思绪漫游之处，不过一场穷途之哭。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;一些古早的记忆。&lt;/p&gt;
&lt;p&gt;红色气球的爆炸。&lt;/p&gt;
&lt;p&gt;幼儿园，似乎是某个活动或者节日，园里挂了一排排的三角形彩旗，操场上有滑梯等娱乐设施。&lt;/p&gt;
&lt;p&gt;出早操，老师在某次早操之后打了所有小朋友的手心。早餐 M 买了蛋饼，但我没有吃完，于是挂在班级的椅子上，放了很</summary>
      
    
    
    
    <category term="生活" scheme="https://loveofpeach.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>CppNote2</title>
    <link href="https://loveofpeach.github.io/posts/2249c81f.html"/>
    <id>https://loveofpeach.github.io/posts/2249c81f.html</id>
    <published>2024-01-09T12:59:53.000Z</published>
    <updated>2024-01-19T19:40:26.684Z</updated>
    
    <content type="html"><![CDATA[<p>前情提要： <a href="https://loveofpeach.github.io/posts/54b4d7a2.html">CppNote</a></p><h2 id="在代码之前"><a href="#在代码之前" class="headerlink" title="在代码之前"></a>在代码之前</h2><h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><p>可以使用参数<code>-E</code>生成预处理之后的文件，以<code>i</code>结尾，生成之后的文件还是一个文本文件（代码）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -E helloworld.cpp -o helloworld.i</span><br></pre></td></tr></table></figure><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>进行语法分析、词法分析、语义分析。</p><p>可以使用<code>-S</code>选项，生成汇编代码，以 s 结尾。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ g++ -S helloworld.i -o helloworld.s</span><br><span class="line">wanko@wanko:~/mycode$ file helloworld.s</span><br><span class="line">helloworld.s: assembler source, ASCII text</span><br></pre></td></tr></table></figure><p>注意：linux 不以后缀名区分文件，上面仅仅是习惯。</p><h3 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h3><p>使用汇编器将汇编代码生成为目标代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as helloworld.s -o helloworld.o</span><br></pre></td></tr></table></figure><p>查看生成了什么：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ ll</span><br><span class="line">total 816</span><br><span class="line">drwxrwxr-x  2 wanko wanko   4096  1月 10 22:26 ./</span><br><span class="line">drwxr-x--- 23 wanko wanko   4096  1月 10 22:22 ../</span><br><span class="line">-rwxrwxr-x  1 wanko wanko  16528  1月  8 01:48 a.out*</span><br><span class="line">-rw-rw-r--  1 wanko wanko     64  1月 10 22:24 cppnote2tmp.md</span><br><span class="line">-rw-rw-r--  1 wanko wanko   5769 12月 29 21:36 guoba.py</span><br><span class="line">-rw-rw-r--  1 wanko wanko     87  1月  8 01:47 helloworld.cpp</span><br><span class="line">-rw-rw-r--  1 wanko wanko 778417  1月  8 02:11 helloworld.i</span><br><span class="line">-rw-rw-r--  1 wanko wanko   2752  1月 10 22:26 helloworld.o</span><br><span class="line">-rw-rw-r--  1 wanko wanko   2254  1月  8 02:30 helloworld.s</span><br><span class="line">wanko@wanko:~/mycode$ file helloworld.o</span><br><span class="line">helloworld.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped</span><br></pre></td></tr></table></figure><p>生成了二进制文件。使用<code>nm</code>命令查看：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ nm helloworld.o</span><br><span class="line">                 U __cxa_atexit</span><br><span class="line">                 U __dso_handle</span><br><span class="line">                 U _GLOBAL_OFFSET_TABLE_</span><br><span class="line">0000000000000090 t _GLOBAL__sub_I_main</span><br><span class="line">0000000000000000 T main</span><br><span class="line">000000000000003a t _Z41__static_initialization_and_destruction_0ii</span><br><span class="line">                 U _ZNSolsEPFRSoS_E</span><br><span class="line">                 U _ZNSt8ios_base4InitC1Ev</span><br><span class="line">                 U _ZNSt8ios_base4InitD1Ev</span><br><span class="line">                 U _ZSt4cout</span><br><span class="line">                 U _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_</span><br><span class="line">0000000000000000 b _ZStL8__ioinit</span><br><span class="line">                 U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc</span><br></pre></td></tr></table></figure><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p>将上一步生成的二进制文件与其他文件合在一起，生成可执行程序。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ g++ helloworld.o -o helloworld</span><br><span class="line">wanko@wanko:~/mycode$ ls</span><br><span class="line">a.out           guoba.py    helloworld.cpp  helloworld.o</span><br><span class="line">cppnote2tmp.md  helloworld  helloworld.i    helloworld.s</span><br><span class="line">wanko@wanko:~/mycode$ ll</span><br><span class="line">total 836</span><br><span class="line">drwxrwxr-x  2 wanko wanko   4096  1月 10 22:40 ./</span><br><span class="line">drwxr-x--- 23 wanko wanko   4096  1月 10 22:31 ../</span><br><span class="line">-rwxrwxr-x  1 wanko wanko  16528  1月  8 01:48 a.out*</span><br><span class="line">-rw-rw-r--  1 wanko wanko   1501  1月 10 22:36 cppnote2tmp.md</span><br><span class="line">-rw-rw-r--  1 wanko wanko   5769 12月 29 21:36 guoba.py</span><br><span class="line">-rwxrwxr-x  1 wanko wanko  16528  1月 10 22:40 helloworld*</span><br><span class="line">-rw-rw-r--  1 wanko wanko     87  1月  8 01:47 helloworld.cpp</span><br><span class="line">-rw-rw-r--  1 wanko wanko 778417  1月  8 02:11 helloworld.i</span><br><span class="line">-rw-rw-r--  1 wanko wanko   2752  1月 10 22:26 helloworld.o</span><br><span class="line">-rw-rw-r--  1 wanko wanko   2254  1月  8 02:30 helloworld.s</span><br></pre></td></tr></table></figure><p>执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ ./helloworld </span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p>查看文件的信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ file helloworld</span><br><span class="line">helloworld: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=c372c07e5b06ebb28508a24d3eca177989deee49, for GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure><p>使用<code>nm</code>命令查看：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ nm helloworld</span><br><span class="line">000000000000038c r __abi_tag</span><br><span class="line">0000000000004010 B __bss_start</span><br><span class="line">0000000000004150 b completed.0</span><br><span class="line">                 U __cxa_atexit@GLIBC_2.2.5</span><br><span class="line">                 w __cxa_finalize@GLIBC_2.2.5</span><br><span class="line">0000000000004000 D __data_start</span><br><span class="line">0000000000004000 W data_start</span><br><span class="line">00000000000010f0 t deregister_tm_clones</span><br><span class="line">0000000000001160 t __do_global_dtors_aux</span><br><span class="line">0000000000003d88 d __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000004008 D __dso_handle</span><br><span class="line">0000000000003d90 d _DYNAMIC</span><br><span class="line">0000000000004010 D _edata</span><br><span class="line">0000000000004158 B _end</span><br><span class="line">0000000000001254 T _fini</span><br><span class="line">00000000000011a0 t frame_dummy</span><br><span class="line">0000000000003d78 d __frame_dummy_init_array_entry</span><br><span class="line">0000000000002140 r __FRAME_END__</span><br><span class="line">0000000000003f90 d _GLOBAL_OFFSET_TABLE_</span><br><span class="line">0000000000001239 t _GLOBAL__sub_I_main</span><br><span class="line">                 w __gmon_start__</span><br><span class="line">0000000000002010 r __GNU_EH_FRAME_HDR</span><br><span class="line">0000000000001000 T _init</span><br><span class="line">0000000000002000 R _IO_stdin_used</span><br><span class="line">                 w _ITM_deregisterTMCloneTable</span><br><span class="line">                 w _ITM_registerTMCloneTable</span><br><span class="line">                 U __libc_start_main@GLIBC_2.34</span><br><span class="line">00000000000011a9 T main</span><br><span class="line">0000000000001120 t register_tm_clones</span><br><span class="line">00000000000010c0 T _start</span><br><span class="line">0000000000004010 D __TMC_END__</span><br><span class="line">00000000000011e3 t _Z41__static_initialization_and_destruction_0ii</span><br><span class="line">                 U _ZNSolsEPFRSoS_E@GLIBCXX_3.4</span><br><span class="line">                 U _ZNSt8ios_base4InitC1Ev@GLIBCXX_3.4</span><br><span class="line">                 U _ZNSt8ios_base4InitD1Ev@GLIBCXX_3.4</span><br><span class="line">0000000000004040 B _ZSt4cout@GLIBCXX_3.4</span><br><span class="line">                 U _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_@GLIBCXX_3.4</span><br><span class="line">0000000000004151 b _ZStL8__ioinit</span><br><span class="line">                 U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@GLIBCXX_3.4</span><br></pre></td></tr></table></figure><p>注意：<code>main</code>的位置发生了变化。</p><center><p style="color: red;">- - - - - 说明 - - - - -</p></center><p>平时使用不需要上面这么复杂。</p><p>若不指定文件名，则会生成<code>a.out</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ helloworld.cpp</span><br></pre></td></tr></table></figure><p>指定文件名的做法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ helloworld.cpp -o nahida</span><br></pre></td></tr></table></figure><p>则会生存可执行文件<code>nahida</code>，执行方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nahida</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/11/659ec2363dcbe.png" alt="62-1.png"></p><center><p style="color: red;">- - - - - END - - - - -</p></center><h2 id="静态库、动态库"><a href="#静态库、动态库" class="headerlink" title="静态库、动态库"></a>静态库、动态库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ ls</span><br><span class="line">add.c  main.c</span><br><span class="line">wanko@wanko:~/demo$ cat add.c</span><br><span class="line"></span><br><span class="line">int add(int x, int y)&#123;</span><br><span class="line">    return x+y;</span><br><span class="line">&#125;</span><br><span class="line">wanko@wanko:~/demo$ cat main.c</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int add(int,int);</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv)&#123;</span><br><span class="line">    printf(&quot;add(3,4)=%d\n&quot;,add(3,4));</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ gcc main.c</span><br><span class="line">/usr/bin/ld: /tmp/ccehSUXd.o: in function `main&#x27;:</span><br><span class="line">main.c:(.text+0x1e): undefined reference to `add&#x27;</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br></pre></td></tr></table></figure><p>正确的编译方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ gcc main.c add.c -o main</span><br><span class="line">wanko@wanko:~/demo$ ./main</span><br><span class="line">add(3,4)=7</span><br></pre></td></tr></table></figure><p style="color: red;">现在我们尝试将 add.c 制作为一个静态库。</p><p>静态库特点：在链接时拷贝库文件，打包进可执行程序（在编译的时候进行打包）。</p><p>文件名形式：<code>**.a</code>，一般以<code>lib</code>开头。eg:<code>libadd.a</code></p><p>编译源码得到目标文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c add.c -o add.o</span><br></pre></td></tr></table></figure><p><code>ar</code>命令打包成库文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ gcc -c add.c -o add.o</span><br><span class="line">wanko@wanko:~/demo$ ar crsv libadd.a add.o</span><br><span class="line">a - add.o</span><br><span class="line">wanko@wanko:~/demo$ ll</span><br><span class="line">total 24</span><br><span class="line">drwxrwxr-x  2 wanko wanko 4096  1月 11 00:21 ./</span><br><span class="line">drwxr-x--- 24 wanko wanko 4096  1月 11 00:13 ../</span><br><span class="line">-rw-rw-r--  1 wanko wanko   39  1月 10 23:56 add.c</span><br><span class="line">-rw-rw-r--  1 wanko wanko 1232  1月 11 00:16 add.o</span><br><span class="line">-rw-rw-r--  1 wanko wanko 1372  1月 11 00:21 libadd.a</span><br><span class="line">-rw-rw-r--  1 wanko wanko  119  1月 10 23:59 main.c</span><br></pre></td></tr></table></figure><p>放入系统库文件路径：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ sudo cp libadd.a /usr/lib</span><br></pre></td></tr></table></figure><p>在对应目录下可以找到如下文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ cd /usr/lib</span><br><span class="line">wanko@wanko:/usr/lib$ ll lib*.a</span><br><span class="line">-rw-r--r-- 1 root root 1372  1月 11 00:24 libadd.a</span><br></pre></td></tr></table></figure><p>为消除 demo 目录下的 libadd.a 的影响，改个名字：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ ls</span><br><span class="line">add.c  add.o  libadd.a  main.c</span><br><span class="line">wanko@wanko:~/demo$ mv libadd.a libadd2.a</span><br><span class="line">wanko@wanko:~/demo$ ll</span><br><span class="line">total 24</span><br><span class="line">drwxrwxr-x  2 wanko wanko 4096  1月 11 00:29 ./</span><br><span class="line">drwxr-x--- 24 wanko wanko 4096  1月 11 00:13 ../</span><br><span class="line">-rw-rw-r--  1 wanko wanko   39  1月 10 23:56 add.c</span><br><span class="line">-rw-rw-r--  1 wanko wanko 1232  1月 11 00:16 add.o</span><br><span class="line">-rw-rw-r--  1 wanko wanko 1372  1月 11 00:21 libadd2.a</span><br><span class="line">-rw-rw-r--  1 wanko wanko  119  1月 10 23:59 main.c</span><br></pre></td></tr></table></figure><p>链接的选项：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.c -o main -ladd</span><br></pre></td></tr></table></figure><p>即：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/demo$ gcc main.c -o main -ladd</span><br><span class="line">wanko@wanko:~/demo$ ll</span><br><span class="line">total 40</span><br><span class="line">drwxrwxr-x  2 wanko wanko  4096  1月 11 00:32 ./</span><br><span class="line">drwxr-x--- 24 wanko wanko  4096  1月 11 00:13 ../</span><br><span class="line">-rw-rw-r--  1 wanko wanko    39  1月 10 23:56 add.c</span><br><span class="line">-rw-rw-r--  1 wanko wanko  1232  1月 11 00:16 add.o</span><br><span class="line">-rw-rw-r--  1 wanko wanko  1372  1月 11 00:21 libadd2.a</span><br><span class="line">-rwxrwxr-x  1 wanko wanko 16016  1月 11 00:32 main*</span><br><span class="line">-rw-rw-r--  1 wanko wanko   119  1月 10 23:59 main.c</span><br><span class="line">wanko@wanko:~/demo$ ./main</span><br><span class="line">add(3,4)=7</span><br></pre></td></tr></table></figure><p>现在将这个库删除：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm libadd.a</span><br></pre></td></tr></table></figure><p>此时 main 仍然可以执行。</p><p style="color: red;">现在我们尝试制作一个动态库。</p><p>动态库特点：在链接时，定位了库文件的位置，运行时加载。</p><p>文件名形式：<code>**.so</code>，一般以<code>lib</code>开头。eg:<code>libadd.so</code></p><p>编译时加上<code>-fpic</code>选项，生成<strong>位置无关</strong>的目标代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c add.c -o add.o -fpic</span><br></pre></td></tr></table></figure><p>使用 gcc 生成动态库/共享库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -o libadd.so add.o</span><br></pre></td></tr></table></figure><p>将动态库放入<code>/usr/lib</code>下面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp libadd.so /usr/lib</span><br></pre></td></tr></table></figure><p>链接时加上选项<code>-ladd</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.c -o main -ladd</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/dynamic$ ls</span><br><span class="line">add.c  add.o  libadd2.so  main.c</span><br><span class="line">wanko@wanko:~/dynamic$ gcc main.c -o main -ladd</span><br><span class="line">wanko@wanko:~/dynamic$ ./main</span><br><span class="line">add(3,4)=7</span><br></pre></td></tr></table></figure><p>可以使用<code>ldd</code>命令查看依赖文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/dynamic$ ldd main</span><br><span class="line">    linux-vdso.so.1 (0x00007ffff85df000)</span><br><span class="line">    libadd.so =&gt; /lib/libadd.so (0x00007fba42625000)</span><br><span class="line">    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fba42200000)</span><br><span class="line">    /lib64/ld-linux-x86-64.so.2 (0x00007fba4263f000)</span><br></pre></td></tr></table></figure><p>若删除<code>libadd.so</code>，再执行就会报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/dynamic$ ./main</span><br><span class="line">./main: error while loading shared libraries: libadd.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure><p style="color: red;">静态库与动态库的比较：</p><ul><li>动态库只在执行时才被链接使用，不是直接编译为可执行文件，并且一个动态库可以被多个程序使用，故可称为共享库</li><li>静态库将会整合到程序中，在程序执行时不用加载静态库。</li><li>因此，静态库会使你的程序臃肿并且难以升级，但比较容易部署。而动态库会使你的程序轻便易于升级但难以部署。</li></ul><h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><p>看一个例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> number = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> wd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//在命名空间中可以定义变量、函数、结构体、类，</span></span><br><span class="line">    <span class="comment">//统称为 实体</span></span><br><span class="line">    <span class="type">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;void print()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">// end of namespace wd</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;outer number=&quot;</span> &lt;&lt; number &lt;&lt;std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;inner number=&quot;</span> &lt;&lt; wd::number &lt;&lt;std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">wanko@wanko:~$ cd &quot;/home/wanko/mycode/&quot; &amp;&amp; g++ tmptst.cpp -o tmptst &amp;&amp; &quot;/home/wanko/mycode/&quot;tmptst</span></span><br><span class="line"><span class="comment">outer number=10</span></span><br><span class="line"><span class="comment">inner number=1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>带命名空间的函数声明、命名空间是可以拓展的：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带命名空间的函数声明</span></span><br><span class="line"><span class="keyword">namespace</span> wd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> wh</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> number = <span class="number">30</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;void wh::show&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">        wd::<span class="built_in">print</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">// namespace wh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> wd</span><br><span class="line">&#123; <span class="comment">// 命名空间是可以拓展的</span></span><br><span class="line">    <span class="type">int</span> number = <span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;void print()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        wh::<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// namespace wd</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    wh::<span class="built_in">display</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 运行结果</span></span><br><span class="line"><span class="comment">wanko@wanko:~$ cd &quot;/home/wanko/mycode/&quot; &amp;&amp; g++ tmptst.cpp -o tmptst &amp;&amp; &quot;/home/wanko/mycode/&quot;tmptst</span></span><br><span class="line"><span class="comment">void print()</span></span><br><span class="line"><span class="comment">void wh::show</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>甚至 std 也可以拓展：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Mystruct</span>&#123;</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        <span class="type">int</span> b;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; <span class="comment">// namespace std</span></span><br></pre></td></tr></table></figure><p>但是，尽量不要去拓展 std ，因为自己定义的实体有可能已经在 std 中，导致冲突。</p><p>命名空间可以嵌套：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命名空间可以嵌套</span></span><br><span class="line"><span class="keyword">namespace</span> wh&#123;</span><br><span class="line">    <span class="type">int</span> number = <span class="number">40</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">namespace</span> hb</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> number = <span class="number">1234</span>;</span><br><span class="line">    &#125; <span class="comment">// namespace hb</span></span><br><span class="line">&#125; <span class="comment">// namespace wh</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; wh::hb::number &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">1234</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="new、delete"><a href="#new、delete" class="headerlink" title="new、delete"></a>new、delete</h2><p>与<code>malloc</code>、<code>free</code>类似，用来申请、释放堆空间。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span>* p = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="built_in">memset</span>(p, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="type">int</span>)); <span class="comment">//初始化、清零</span></span><br><span class="line">    *p = <span class="number">70</span>;</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 申请堆空间，初始化，并赋值</span></span><br><span class="line">    <span class="type">int</span>* p = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;*p = &quot;</span> &lt;&lt; *p &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">*p = 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>申请数组：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">10</span>]; <span class="comment">// 在栈上</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 申请堆空间数组</span></span><br><span class="line">    <span class="type">int</span>* pArray = (<span class="type">int</span>*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>)*<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">memset</span>(pArray, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="type">int</span>)*<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    pArray[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    pArray[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,pArray[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">free</span>(pArray);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">0 1 0 0 0 0 0 0 0 0 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* pAarry = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">10</span>](); <span class="comment">//小括号有初始化的含义</span></span><br><span class="line">    pAarry[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    pAarry[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    pAarry[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">        std::cout &lt;&lt; pAarry[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> [] pAarry;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">0 1 2 0 0 0 0 0 0 0 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong><code>malloc</code>申请的堆空间是原始的、未初始化的，而<code>new</code>申请的是已初始化的。</strong></p><p>解决内存泄露的例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span>&amp; <span class="title">getHeapData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* pInt = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">200</span>);</span><br><span class="line">    <span class="keyword">return</span> *pInt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">5</span>;</span><br><span class="line">    <span class="type">int</span> c = a + <span class="built_in">getHeapData</span>() + b; <span class="comment">//内存泄露</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;c = &quot;</span> &lt;&lt; c &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>&amp; ref = <span class="built_in">getHeapData</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ref = &quot;</span> &lt;&lt; ref &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">delete</span> &amp;ref; <span class="comment">//解决内存泄露</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>防止野指针：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* pInt = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>*&gt;(<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">int</span>)));</span><br><span class="line">    <span class="built_in">memset</span>(pInt, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">    <span class="built_in">free</span>(pInt);</span><br><span class="line">    pInt = <span class="literal">nullptr</span>; <span class="comment">//否则会产生野指针</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数重载"><a href="#函数重载" class="headerlink" title="函数重载"></a>函数重载</h2><p>函数重载的原理：使用同名函数的时候，根据形参类型、个数、顺序对函数名字进行改编，即“名字改编”。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode$ cat tsttmp.cpp</span><br><span class="line">int add(int x,int y)&#123;</span><br><span class="line">    return x+y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int add(int x,double y)&#123;</span><br><span class="line">    return x+y;</span><br><span class="line">&#125;</span><br><span class="line">wanko@wanko:~/mycode$ nm tsttmp.o</span><br><span class="line">0000000000000018 T _Z3addid</span><br><span class="line">0000000000000000 T _Z3addii</span><br></pre></td></tr></table></figure><p>注意： C 不支持函数重载。C++ 兼容 C ，会将 C 的函数按照 C 的方式编译，不会进行名字改编。</p><p>可以在 C++ 代码中将函数按照 C 的方式编译：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus <span class="comment">// C++ 内置宏</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// some code</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;<span class="comment">// extern &quot;C&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h2><p>内联函数不能分成头文件与实现文件的形式（不能将声明与定义分开）。</p><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>简单例子：</p><p><img src="https://bu.dusays.com/2024/01/15/65a501de7b574.png" alt="62-2.png"></p><h2 id="内存分配方式"><a href="#内存分配方式" class="headerlink" title="内存分配方式"></a>内存分配方式</h2><p>相关知识和图片见： <a href="https://loveofpeach.github.io/posts/64934ad2.html">OS 强化</a> 存储管理知识梳理</p><p>以 32 位机器为例。</p><p>0-3G：用户态的空间<br>3G-4G：内核态的空间</p><p>用户态空间：栈、堆、全局变量、静态变量、程序代码区、文字常量区。</p><p><strong>栈区</strong>：存放的是局部变量、函数的参数。由操作系统负责。</p><p><strong>堆区</strong>：即堆空间，<code>malloc</code>/<code>calloc</code>/<code>new</code>申请的都是堆空间，必须由程序员手动释放（<code>free</code>/<code>delete</code>）。</p><p><strong>读写段</strong>：<br>全局变量<br>静态变量：<code>static int c = 10;</code></p><p><strong>只读段</strong>：<br>文字常量区：如字符串常量，”hello,world”<br>程序代码区：存放二进制代码</p><p>函数名是函数的入口地址：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;main = %p\n&quot;</span>, &amp;main);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main = %p\n&quot;</span>, main);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">&amp;main = 0x564630caf189</span></span><br><span class="line"><span class="comment">main = 0x564630caf189</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h2><p>销毁对象的时候，需要清理数据成员。使用析构函数完成此任务。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">point</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">point</span>(<span class="type">int</span> x=<span class="number">0</span>, <span class="type">int</span> y=<span class="number">0</span>):<span class="built_in">ix</span>(x),<span class="built_in">iy</span>(y)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; ix &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; iy &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">point</span>()&#123; <span class="comment">//析构函数</span></span><br><span class="line">    <span class="comment">// destructor cannot have any parameters</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> ix;</span><br><span class="line">    <span class="type">int</span> iy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    point tmp;</span><br><span class="line">    tmp.<span class="built_in">print</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">0 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>在上面的例子中，析构函数没有做任何事，因为该例中对象位于栈上，由操作系统负责回收。</p><p>对象在销毁的时候，会自动调用析构函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">point</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">point</span>(<span class="type">int</span> x=<span class="number">0</span>, <span class="type">int</span> y=<span class="number">0</span>):<span class="built_in">ix</span>(x),<span class="built_in">iy</span>(y)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; ix &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; iy &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">point</span>()&#123; <span class="comment">//析构函数</span></span><br><span class="line">    <span class="comment">// destructor cannot have any parameters</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;aha&quot;</span> &lt;&lt; std::endl; <span class="comment">// for test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> ix;</span><br><span class="line">    <span class="type">int</span> iy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    point tmp;</span><br><span class="line">    tmp.<span class="built_in">print</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">0 0</span></span><br><span class="line"><span class="comment">aha</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>默认情况下，编译器会自动生成析构函数。</p><p>析构函数可以显式调用（不建议这么做）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp.~<span class="built_in">point</span>();</span><br></pre></td></tr></table></figure><p>构造函数调用的时候会创建对象：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">point</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">point</span>(<span class="type">int</span> x=<span class="number">0</span>, <span class="type">int</span> y=<span class="number">0</span>):<span class="built_in">ix</span>(x),<span class="built_in">iy</span>(y)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; ix &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; iy &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">point</span>()&#123; <span class="comment">//析构函数</span></span><br><span class="line">    <span class="comment">// destructor cannot have any parameters</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;aha&quot;</span> &lt;&lt; std::endl; <span class="comment">// for test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> ix;</span><br><span class="line">    <span class="type">int</span> iy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    point tmp;</span><br><span class="line">    tmp.<span class="built_in">print</span>();</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">point</span>().<span class="built_in">print</span>();</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">0 0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">0 0</span></span><br><span class="line"><span class="comment">aha</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">aha</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>有点小问题的代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Computer.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _Computer_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _Computer_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setBrand</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* name)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPrice</span><span class="params">(<span class="type">float</span> price)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    ~<span class="built_in">Computer</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _name;</span><br><span class="line">    <span class="type">float</span> _price;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Computer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line">Computer::<span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price)</span><br><span class="line">                  :_name(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(name)+<span class="number">1</span>]()),_price(price)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Computer(const char*, float)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::setBrand</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* name)</span></span>&#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::setPrice</span><span class="params">(<span class="type">float</span> price)</span></span>&#123;</span><br><span class="line">    _price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;name = &quot;</span> &lt;&lt; _name &lt;&lt; endl</span><br><span class="line">         &lt;&lt; <span class="string">&quot;price = &quot;</span> &lt;&lt; _price &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Computer::~<span class="built_in">Computer</span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;~Computer()&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testComputer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Computer <span class="title">com</span><span class="params">(<span class="string">&quot;lenovo&quot;</span>, <span class="number">5300</span>)</span></span>;</span><br><span class="line">    com.<span class="built_in">print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">wanko@wanko:~/mycode$ g++ *.cc</span></span><br><span class="line"><span class="comment">wanko@wanko:~/mycode$ ./a.out</span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">name = lenovo</span></span><br><span class="line"><span class="comment">price = 5300</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>上面的代码没有<code>delete</code>，文件<code>Computer.cc</code>应该改为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Computer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line">Computer::<span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price)</span><br><span class="line">                  :_name(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(name)+<span class="number">1</span>]()),_price(price)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Computer(const char*, float)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::setBrand</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* name)</span></span>&#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::setPrice</span><span class="params">(<span class="type">float</span> price)</span></span>&#123;</span><br><span class="line">    _price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;name = &quot;</span> &lt;&lt; _name &lt;&lt; endl</span><br><span class="line">         &lt;&lt; <span class="string">&quot;price = &quot;</span> &lt;&lt; _price &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Computer::~<span class="built_in">Computer</span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;~Computer()&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span>(_name)&#123; <span class="comment">// 等价于 if(_name != nullptr)</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;1111&quot;</span> &lt;&lt; endl; <span class="comment">// for presentation</span></span><br><span class="line">        <span class="keyword">delete</span> [] _name;</span><br><span class="line">        _name = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新编译运行得到输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Computer(const char*, float)</span><br><span class="line">name = lenovo</span><br><span class="line">price = 5300</span><br><span class="line">~Computer()</span><br><span class="line">1111</span><br></pre></td></tr></table></figure><p>个人理解：在上面的代码中，<code>Computer</code>类型的对象包含两个数据成员：<code>_name</code>和<code>_price</code>，一个是指针类型，一个是浮点类型。创建对象时调用构造函数，指针<code>_name</code>指向堆上的空间。<code>Computer</code>对象在栈上，生命周期结束后由操作系统回收；<code>_name</code>指向的堆上空间需由析构函数释放。</p><p>下面给出两种情况的对比：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testComputer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function">Computer <span class="title">gcom</span><span class="params">(<span class="string">&quot;xiaomi&quot;</span>, <span class="number">7000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    gcom.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">Computer <span class="title">com</span><span class="params">(<span class="string">&quot;lenovo&quot;</span>, <span class="number">5300</span>)</span></span>;</span><br><span class="line">    com.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Computer* pc = <span class="keyword">new</span> <span class="built_in">Computer</span>(<span class="string">&quot;huawei&quot;</span>, <span class="number">100000</span>);</span><br><span class="line">    pc-&gt;<span class="built_in">print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;enter main...&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">enter main...</span></span><br><span class="line"><span class="comment">name = xiaomi</span></span><br><span class="line"><span class="comment">price = 7000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">name = lenovo</span></span><br><span class="line"><span class="comment">price = 5300</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">name = huawei</span></span><br><span class="line"><span class="comment">price = 100000</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testComputer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function">Computer <span class="title">gcom</span><span class="params">(<span class="string">&quot;xiaomi&quot;</span>, <span class="number">7000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    gcom.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">Computer <span class="title">com</span><span class="params">(<span class="string">&quot;lenovo&quot;</span>, <span class="number">5300</span>)</span></span>;</span><br><span class="line">    com.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Computer* pc = <span class="keyword">new</span> <span class="built_in">Computer</span>(<span class="string">&quot;huawei&quot;</span>, <span class="number">100000</span>);</span><br><span class="line">    pc-&gt;<span class="built_in">print</span>();</span><br><span class="line">    <span class="keyword">delete</span> pc;</span><br><span class="line">    pc = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;enter main...&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">enter main...</span></span><br><span class="line"><span class="comment">name = xiaomi</span></span><br><span class="line"><span class="comment">price = 7000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">name = lenovo</span></span><br><span class="line"><span class="comment">price = 5300</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">name = huawei</span></span><br><span class="line"><span class="comment">price = 100000</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="拷贝构造函数"><a href="#拷贝构造函数" class="headerlink" title="拷贝构造函数"></a>拷贝构造函数</h2><p>默认情况下，编译器会自动生成拷贝构造函数。</p><p>来看下面的例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testComputer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Computer <span class="title">com</span><span class="params">(<span class="string">&quot;lenovo&quot;</span>, <span class="number">5300</span>)</span></span>;</span><br><span class="line">    com.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Computer com2 = com;</span><br><span class="line">    com2.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Computer(const char*, float)</span></span><br><span class="line"><span class="comment">name = lenovo</span></span><br><span class="line"><span class="comment">price = 5300</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">name = lenovo</span></span><br><span class="line"><span class="comment">price = 5300</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">~Computer()</span></span><br><span class="line"><span class="comment">1111</span></span><br><span class="line"><span class="comment">free(): double free detected in tcache 2</span></span><br><span class="line"><span class="comment">Aborted (core dumped)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>在语句<code>Computer com2 = com;</code>中，调用了拷贝构造函数。程序报错的原因等会再讲。</p><p>拷贝构造函数的逻辑（以某个具体的类为例）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Point</span>(<span class="type">const</span> Point&amp; rhs):_ix(rhs._ix),_iy(rhs._iy)&#123;&#125;</span><br></pre></td></tr></table></figure><p>而上面的程序出错点在于：数据成员是指针类型，拷贝过来的指针指向了同一地址，因此销毁的时候对同一地址 free 了两次。</p><p><code>Computer.h</code>文件部分代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setBrand</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* name)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPrice</span><span class="params">(<span class="type">float</span> price)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    ~<span class="built_in">Computer</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _name;</span><br><span class="line">    <span class="type">float</span> _price;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>Computer.cc</code>文件部分代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Computer::<span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price)</span><br><span class="line">                  :_name(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(name)+<span class="number">1</span>]()),_price(price)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Computer(const char*, float)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Computer::~<span class="built_in">Computer</span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;~Computer()&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span>(_name)&#123; <span class="comment">// 等价于 if(_name != nullptr)</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;1111&quot;</span> &lt;&lt; endl; <span class="comment">// for presentation</span></span><br><span class="line">        <span class="keyword">delete</span> [] _name;</span><br><span class="line">        _name = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以改为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Computer.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _Computer_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _Computer_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setBrand</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* name)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPrice</span><span class="params">(<span class="type">float</span> price)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    ~<span class="built_in">Computer</span>();</span><br><span class="line">    <span class="built_in">Computer</span>(<span class="type">const</span> Computer&amp; rhs);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _name;</span><br><span class="line">    <span class="type">float</span> _price;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Computer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line">Computer::<span class="built_in">Computer</span>(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">float</span> price)</span><br><span class="line">                  :_name(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(name)+<span class="number">1</span>]()),_price(price)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Computer(const char*, float)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::setBrand</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* name)</span></span>&#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::setPrice</span><span class="params">(<span class="type">float</span> price)</span></span>&#123;</span><br><span class="line">    _price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Computer::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;name = &quot;</span> &lt;&lt; _name &lt;&lt; endl</span><br><span class="line">         &lt;&lt; <span class="string">&quot;price = &quot;</span> &lt;&lt; _price &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Computer::<span class="built_in">Computer</span>(<span class="type">const</span> Computer&amp; rhs)</span><br><span class="line">                   :_name(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(rhs._name)+<span class="number">1</span>]()), _price(rhs._price)&#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(_name, rhs._name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Computer::~<span class="built_in">Computer</span>()&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;~Computer()&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span>(_name)&#123; <span class="comment">// 等价于 if(_name != nullptr)</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;1111&quot;</span> &lt;&lt; endl; <span class="comment">// for presentation</span></span><br><span class="line">        <span class="keyword">delete</span> [] _name;</span><br><span class="line">        _name = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testComputer.cc</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Computer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Computer <span class="title">com</span><span class="params">(<span class="string">&quot;lenovo&quot;</span>, <span class="number">5300</span>)</span></span>;</span><br><span class="line">    com.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Computer com2 = com;</span><br><span class="line">    com2.<span class="built_in">print</span>();</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Computer(const char*, float)</span><br><span class="line">name = lenovo</span><br><span class="line">price = 5300</span><br><span class="line"></span><br><span class="line">name = lenovo</span><br><span class="line">price = 5300</span><br><span class="line"></span><br><span class="line">~Computer()</span><br><span class="line">1111</span><br><span class="line">~Computer()</span><br><span class="line">1111</span><br></pre></td></tr></table></figure><p>注意：上面的代码不仅修改了实现文件，同时也修改了头文件。可能会遇到的问题的相关讨论：<a href="https://stackoverflow.com/questions/47092536/c-error-definition-of-implicitly-declared">C++ error: definition of implicitly-declared</a></p><p><strong>拷贝构造函数的调用时机</strong>：</p><ul><li>用一个已存在的（类的）对象初始化另一个新对象时，会调用拷贝构造函数。</li><li>当实参和形参都是对象，进行实参和形参的结合时，会调用拷贝构造函数。</li><li>函数的返回值是对象，函数调用完成返回时，会调用拷贝构造函数。<a href="#bib1" id="bib1ref"><sup>[注1]</sup></a></li><li><strong>总结</strong>：（即发生拷贝的时候。。。）</li></ul><p><a id="bib1" href="#bib1ref"><sup>[注1]</sup></a> 编译器会自动做一个优化，会屏蔽一些过程：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">point</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">point</span><span class="params">(<span class="type">int</span> x=<span class="number">0</span>, <span class="type">int</span> y=<span class="number">0</span>)</span>:ix(x),iy(y)&#123;</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;构造函数调用&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; ix &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; iy &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">point</span>()&#123; <span class="comment">//析构函数</span></span><br><span class="line">    <span class="comment">// destructor cannot have any parameters</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;~point()&quot;</span> &lt;&lt; std::endl; <span class="comment">// for test</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">point</span>(<span class="type">const</span> point&amp; rhs):<span class="built_in">ix</span>(rhs.ix), <span class="built_in">iy</span>(rhs.iy)&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;拷贝构造函数&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> ix;</span><br><span class="line">    <span class="type">int</span> iy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">point <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">point <span class="title">pt</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt = &quot;</span>;</span><br><span class="line">    pt.<span class="built_in">print</span>();</span><br><span class="line">    <span class="keyword">return</span> pt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    point pt2 = <span class="built_in">func</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt2 = &quot;</span>;</span><br><span class="line">    pt2.<span class="built_in">print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">构造函数调用</span></span><br><span class="line"><span class="comment">pt = 1 2</span></span><br><span class="line"><span class="comment">pt2 = 1 2</span></span><br><span class="line"><span class="comment">~point()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>为查看完整过程，使用命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ tsttmp.cpp -fno-elide-constructors</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">point</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">point</span><span class="params">(<span class="type">int</span> x=<span class="number">0</span>, <span class="type">int</span> y=<span class="number">0</span>)</span>:ix(x),iy(y)&#123;</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;构造函数调用&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; ix &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; iy &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">point</span>()&#123; <span class="comment">//析构函数</span></span><br><span class="line">    <span class="comment">// destructor cannot have any parameters</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;~point()&quot;</span> &lt;&lt; std::endl; <span class="comment">// for test</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">point</span>(<span class="type">const</span> point&amp; rhs):<span class="built_in">ix</span>(rhs.ix), <span class="built_in">iy</span>(rhs.iy)&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;拷贝构造函数&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> ix;</span><br><span class="line">    <span class="type">int</span> iy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">point <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">point <span class="title">pt</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt = &quot;</span>;</span><br><span class="line">    pt.<span class="built_in">print</span>();</span><br><span class="line">    <span class="keyword">return</span> pt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    point pt2 = <span class="built_in">func</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt2 = &quot;</span>;</span><br><span class="line">    pt2.<span class="built_in">print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">构造函数调用</span></span><br><span class="line"><span class="comment">pt = 1 2</span></span><br><span class="line"><span class="comment">拷贝构造函数</span></span><br><span class="line"><span class="comment">~point()</span></span><br><span class="line"><span class="comment">pt2 = 1 2</span></span><br><span class="line"><span class="comment">~point()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>拷贝构造函数参数中的引用符号<strong>不能</strong>去掉。原因比较显然：若去掉则传参方式为拷贝，而此时拷贝行为尚未定义。</p><p>那么 const 能否去掉？</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抱歉，不能</span></span><br><span class="line"><span class="built_in">point</span>(point&amp; rhs):<span class="built_in">ix</span>(rhs.ix), <span class="built_in">iy</span>(rhs.iy)&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;拷贝构造函数&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原因：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 看一个更简单的例子</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>&amp; kkk = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 报错：</span></span><br><span class="line">    <span class="comment">// initial value of reference to non-const must be an lvalue</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// cannot bind non-const lvalue reference of type ‘int&amp;’ to an rvalue of type ‘int’</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更改为这样可以编译运行：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span>&amp; kkk = <span class="number">3</span>;</span><br><span class="line">    cout &lt;&lt; kkk &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="赋值运算符函数"><a href="#赋值运算符函数" class="headerlink" title="赋值运算符函数"></a>赋值运算符函数</h2><p>可由编译器自动生成。</p><p>例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">point</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">point</span><span class="params">(<span class="type">int</span> x=<span class="number">0</span>, <span class="type">int</span> y=<span class="number">0</span>)</span>:ix(x),iy(y)&#123;</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;构造函数调用&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        std::cout &lt;&lt; ix &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; iy &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">point</span>()&#123; <span class="comment">//析构函数</span></span><br><span class="line">    <span class="comment">// destructor cannot have any parameters</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;~point()&quot;</span> &lt;&lt; std::endl; <span class="comment">// for test</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">point</span>(<span class="type">const</span> point&amp; rhs):<span class="built_in">ix</span>(rhs.ix), <span class="built_in">iy</span>(rhs.iy)&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;拷贝构造函数&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> ix;</span><br><span class="line">    <span class="type">int</span> iy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">point <span class="title">pt</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt = &quot;</span>;</span><br><span class="line">    pt.<span class="built_in">print</span>();</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    point pt2 = pt;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt2 = &quot;</span>;</span><br><span class="line">    pt2.<span class="built_in">print</span>();</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">point <span class="title">pt3</span><span class="params">(<span class="number">3</span>,<span class="number">4</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt3 = &quot;</span>;</span><br><span class="line">    pt3.<span class="built_in">print</span>();</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    pt2.<span class="keyword">operator</span>=(pt3); <span class="comment">// 赋值运算符函数</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pt2_2 = &quot;</span>;</span><br><span class="line">    pt2.<span class="built_in">print</span>();</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">构造函数调用</span></span><br><span class="line"><span class="comment">pt = 1 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">拷贝构造函数</span></span><br><span class="line"><span class="comment">pt2 = 1 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">构造函数调用</span></span><br><span class="line"><span class="comment">pt3 = 3 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">pt2_2 = 3 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">~point()</span></span><br><span class="line"><span class="comment">~point()</span></span><br><span class="line"><span class="comment">~point()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>以上面代码为例，试写出逻辑：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">point&amp; <span class="keyword">operator</span>=(<span class="type">const</span> point&amp; rhs)&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;ix = rhs.ix;</span><br><span class="line">    <span class="keyword">this</span>-&gt;iy = rhs.iy;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>涉及到指针的情形时，（编译器合成的版本）会遇到和拷贝构造函数类似的问题，需要注意，可考虑修改为：</p><p><img src="https://bu.dusays.com/2024/01/17/65a7f6874fef1.png" alt="62-3.png"></p><p>赋值运算符函数参数与返回值问题：</p><p><img src="https://bu.dusays.com/2024/01/18/65a8fbe20b4ce.png" alt="62-4.png"></p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>空类为了区分不同的对象，会分配一个字节大小的空间：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span>&#123;</span><br><span class="line">    <span class="comment">// 默认生成如下函数：</span></span><br><span class="line">    <span class="comment">// 合成的默认构造函数（synthesized default constructor）</span></span><br><span class="line">    <span class="comment">// 拷贝构造函数</span></span><br><span class="line">    <span class="comment">// 赋值运算符函数</span></span><br><span class="line">    <span class="comment">// 析构函数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;sizeof(Empty) = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(Empty) &lt;&lt; endl;</span><br><span class="line">    Empty e1;</span><br><span class="line">    Empty e2;</span><br><span class="line">    Empty e3;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;e1 = %p\n&quot;</span>,&amp;e1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;e2 = %p\n&quot;</span>,&amp;e2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;e3 = %p\n&quot;</span>,&amp;e3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">sizeof(Empty) = 1</span></span><br><span class="line"><span class="comment">&amp;e1 = 0x7ffdb0bc2cc5</span></span><br><span class="line"><span class="comment">&amp;e2 = 0x7ffdb0bc2cc6</span></span><br><span class="line"><span class="comment">&amp;e3 = 0x7ffdb0bc2cc7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>对于类的静态数据成员，若采用头文件与实现文件分开的形式，应将静态数据成员在头文件中声明，实现文件中初始化。否则可能出现多次定义的问题。</p><p>逗号表达式，以最后一个逗号后面的值为准。</p><p><code>delete</code>会调用析构函数。</p><h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>单例模式是 23 种 GoF 模式中最简单的设计模式之一。这个设计模式主要目的是想在整个系统中只能出现类的一个实例，即一个类只有一个对象。</p><p>其实现步骤大致有如下三步:</p><ol><li>将构造函数私有化</li><li>在类中定义一个静态的指向本类型的指针变量</li><li>定义一个返回值为类指针的静态成员函数</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例模式</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> A* <span class="title">myCreateObj</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_ptmp == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            _ptmp = <span class="keyword">new</span> <span class="built_in">A</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _ptmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_ptmp == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">delete</span> _ptmp;</span><br><span class="line">        _ptmp = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    ~<span class="built_in">A</span>()&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;这里是析构函数&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">A</span>()&#123; <span class="comment">// 构造函数</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;这里是构造函数&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">static</span> A* _ptmp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A* A::_ptmp = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    A* ps1 = A::<span class="built_in">myCreateObj</span>();</span><br><span class="line">    A* ps2 = A::<span class="built_in">myCreateObj</span>(); <span class="comment">// just for test</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ps1 = &quot;</span> &lt;&lt; ps1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ps2 = &quot;</span> &lt;&lt; ps2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    ps1-&gt;<span class="built_in">destroy</span>();</span><br><span class="line">    <span class="comment">/*------just for test------*/</span></span><br><span class="line">    ps2-&gt;<span class="built_in">destroy</span>();</span><br><span class="line">    ps1-&gt;<span class="built_in">destroy</span>();</span><br><span class="line"></span><br><span class="line">    A::<span class="built_in">destroy</span>();</span><br><span class="line">    <span class="comment">/*-------------------------*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 该代码尚有其他问题，但目前不再讨论范围之内</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这里是构造函数</span></span><br><span class="line"><span class="comment">ps1 = 0x55f3f6288eb0</span></span><br><span class="line"><span class="comment">ps2 = 0x55f3f6288eb0</span></span><br><span class="line"><span class="comment">这里是析构函数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>用途：全局唯一的对象，如字典库、词典库、日志记录器等。</p><h2 id="内存对齐"><a href="#内存对齐" class="headerlink" title="内存对齐"></a>内存对齐</h2><p>引入例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">mytst</span>&#123;</span><br><span class="line">    <span class="type">char</span>* _name;   <span class="comment">// 8 个字节</span></span><br><span class="line">    <span class="type">float</span> _price;  <span class="comment">// 4 个字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;sizeof(mytst) = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(mytst) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 结果</span></span><br><span class="line"><span class="comment">sizeof(mytst) = 16</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><div class="row"><iframe src="https://drive.google.com/file/d/1ko1BOz9kOUs5VL4CKTKz60JxTV0W0TzA/preview" style="width:100%; height:550px"></iframe></div><p>上面的 PDF 似乎非常抽象，看一个例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">x</span></span><br><span class="line">&#123;             <span class="comment">// byte</span></span><br><span class="line">    <span class="type">char</span> a;   <span class="comment">//  1</span></span><br><span class="line">    <span class="type">int</span> b;    <span class="comment">//  4</span></span><br><span class="line">    <span class="type">short</span> c;  <span class="comment">//  2</span></span><br><span class="line">    <span class="type">char</span> d;   <span class="comment">//  1</span></span><br><span class="line">&#125;MyStructX;   <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">y</span></span><br><span class="line">&#123;             <span class="comment">// byte</span></span><br><span class="line">    <span class="type">int</span> b;    <span class="comment">//   4</span></span><br><span class="line">    <span class="type">char</span> a;   <span class="comment">//   1</span></span><br><span class="line">    <span class="type">char</span> d;   <span class="comment">//   1</span></span><br><span class="line">    <span class="type">short</span> c;  <span class="comment">//   2</span></span><br><span class="line">&#125;MyStructY;   <span class="comment">//   8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SS</span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="type">char</span> b;</span><br><span class="line">    <span class="type">short</span> c;</span><br><span class="line">    <span class="type">int</span> d;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">FF</span>&#123;</span><br><span class="line">        <span class="type">int</span> a1;</span><br><span class="line">        <span class="type">char</span> b1;</span><br><span class="line">        <span class="type">short</span> c1;</span><br><span class="line">        <span class="type">char</span> d1;</span><br><span class="line">    &#125;MyStructFF;</span><br><span class="line">    <span class="type">int</span> e;</span><br><span class="line">    <span class="type">double</span> ww;</span><br><span class="line">&#125;MyStructSS;   <span class="comment">//  40</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SS2</span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="type">char</span> b;</span><br><span class="line">    <span class="type">short</span> c;</span><br><span class="line">    <span class="type">int</span> d;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">FF</span>&#123;</span><br><span class="line">        <span class="type">int</span> a1;</span><br><span class="line">        <span class="type">char</span> b1;</span><br><span class="line">        <span class="type">short</span> c1;</span><br><span class="line">        <span class="type">char</span> d1;</span><br><span class="line">    &#125;MyStructFF;</span><br><span class="line">    <span class="type">char</span> e;</span><br><span class="line">&#125;MyStructSS2;  <span class="comment">//  28</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(MyStructSS2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">28</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>解释：</p><p><img src="https://bu.dusays.com/2024/01/19/65aa686a32d0e.jpg" alt="62-5.jpg"></p><p>对于<code>MyStructSS2</code>：</p><p><img src="https://bu.dusays.com/2024/01/19/65aa69e88168e.png" alt="62-6.png"></p><p>总结：</p><ul><li>数据成员要对齐。</li><li>结构体要对齐，结构体的大小是其最大数据成员的整数倍。</li><li>结构体里还有结构体时，里结构体要对齐（按照最大数据成员的整数倍对齐）。</li></ul><p>可使用如下方式进行某些调整，不细述：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(4)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;前情提要： &lt;a href=&quot;https://loveofpeach.github.io/posts/54b4d7a2.html&quot;&gt;CppNote&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;在代码之前&quot;&gt;&lt;a href=&quot;#在代码之前&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="编程" scheme="https://loveofpeach.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="C++" scheme="https://loveofpeach.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 笔记</title>
    <link href="https://loveofpeach.github.io/posts/aaba1da3.html"/>
    <id>https://loveofpeach.github.io/posts/aaba1da3.html</id>
    <published>2024-01-01T12:00:26.000Z</published>
    <updated>2024-01-31T14:55:15.202Z</updated>
    
    <content type="html"><![CDATA[<p>数据库学习笔记。</p><h2 id="数据库的概念、分类"><a href="#数据库的概念、分类" class="headerlink" title="数据库的概念、分类"></a>数据库的概念、分类</h2><p>数据库的引入：<br>存储数据的结构或方式</p><ul><li>数组、链表：基于内存，短暂存储</li><li>文件：永久性存储，但是不利于查找</li><li>数据库：可以永久存储，并且可以更好的查找</li></ul><p>数据库的定义：存储结构化数据的仓库。<br>结构化数据一般指存储在数据库中，具有一定逻辑结构和物理结构的数据。</p><p>数据库的分类：</p><ul><li>关系型数据库<ul><li>通过外键关联来建立表与表之间的关系</li><li>例如：Oracle、MySQL、DB2、Informix、SQL Server、SQLite</li><li>关系型数据库把复杂的数据结构归结为简单的二元关系，在存储数据时实际就是采用的一张二维表（和Word和excell里表格几乎一样）</li><li>市场占有量较大的是MySQL和oracle数据库，而互联网场景最常用的是MySQL数据库</li><li>它通过SQL结构化查询语言来存取、管理关系型数据库的数据</li></ul></li><li>非关系型数据库<ul><li>数据以对象的形式存储在数据库中，而对象之间的关系通过每个对象自身的属性来决定</li><li>不是对关系型数据库的否定，而是补充，主要针对大数据</li><li>种类<ul><li>键值对（key-value）：Redis、Memcached</li><li>按列存储：Hbase、Scylla、Cassandra</li><li>面向文档：MongoDB、CouchDB</li><li>图形存储：Neo4J</li></ul></li></ul></li></ul><p>数据库管理软件（DBMS）<br>数据库管理员（DBA）</p><p>数据库服务器、数据库和表的关系：</p><p><img src="https://bu.dusays.com/2024/01/01/6592be1d25bd0.png" alt="61-1.png"></p><p>数据在数据库中的存储方式：</p><p><img src="https://bu.dusays.com/2024/01/01/6592bfa307acc.png" alt="61-2.png"></p><p>SQL（Structured Query Language）：结构化查询语言</p><ul><li>是一种定义、操作、管理关系型数据库的句法。大多数关系型数据库都支持</li><li>结构化查询语言的工业标准由ANSI（美国国家标准学会，ISO的成员之一）维护</li><li>组成：<ul><li>DQL：数据查询语言</li><li>DML（Data Manipulation Language）：数据操作语言</li><li>DDL：数据定义语言</li><li>DCL：数据控制语言</li><li>TPL：事务处理语言</li><li>CCL：指针控制语言</li></ul></li></ul><p>mysql 的安装： <a href="https://www.bilibili.com/video/BV12q4y1U7sZ">https://www.bilibili.com/video/BV12q4y1U7sZ</a></p><p>数据库大小写不敏感。</p><h2 id="创建、显示、删除"><a href="#创建、显示、删除" class="headerlink" title="创建、显示、删除"></a>创建、显示、删除</h2><p>DDL（Data Definition Language）数据定义语言</p><ul><li>作用：用于描述数据库中要存储的现实世界实体的语言。即<strong>创建数据库和表的结构</strong>。</li><li>常用关键字：<ul><li><code>CREATE</code>：创建</li><li><code>ALTER</code>：修改</li><li><code>DROP</code>：删除</li><li><code>TRUNCATE</code>：截断</li></ul></li></ul><p>进入 sql ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -u root -p</span><br></pre></td></tr></table></figure><p>看到 mysql 的提示符，说明连接成功。</p><p>输入 <code>show schemas;</code> 查询自带的数据库。</p><p><img src="https://bu.dusays.com/2024/01/02/659423c467080.png" alt="61-3.png"></p><p>或者 <code>show databases;</code> ：</p><p><img src="https://bu.dusays.com/2024/01/02/6594256b6299b.png" alt="61-4.png"></p><p>information_schema（元数据）<br>mysql（核心库）<br>performance_schema（性能相关）<br>sys（对DBA有好处）</p><p>注释记号：<code>#</code>、<code>--</code>、<code>/**/</code></p><p>创建数据库 <code>create database akashi;</code> ：</p><p><img src="https://bu.dusays.com/2024/01/02/659429989faba.png" alt="61-5.png"></p><p>使用数据库：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> use akashi;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure><p>显示表格（目前为空）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一个另外的例子：</p><p><img src="https://bu.dusays.com/2024/01/02/65942b5cb0f1b.png" alt="61-6.png" title="下略"></p><p>删除一个库：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">drop</span> database akashi;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/02/65942c4a092d2.png" alt="61-7.png" title="后来又建回来了QAQ"></p><p>创建表：</p><p><img src="https://bu.dusays.com/2024/01/02/6594301c6db3c.png" alt="61-8.png"></p><p>MySQL 常用数据类型：</p><p><img src="https://bu.dusays.com/2024/01/02/659431ad47258.png" alt="61-9.png"></p><p>创建表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">member</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> (id <span class="type">int</span>, name <span class="type">char</span>(<span class="number">20</span>), age <span class="type">int</span>, math <span class="type">float</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/659435af32350.png" alt="61-10.png"></p><p>显示表的结构 <code>show create table member;</code> ：</p><p><img src="https://bu.dusays.com/2024/01/03/659436dd80bfb.png" alt="61-11.png"></p><p>显示表的结构（第二种方法）<code>desc member;</code> ：</p><p><img src="https://bu.dusays.com/2024/01/03/659437a381f8c.png" alt="61-12.png"></p><p>查看当前所属数据库：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> database();</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span> database() <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span> akashi     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>参看数据库版本：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> version();</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> version()               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">8.0</span><span class="number">.35</span><span class="number">-0</span>ubuntu0<span class="number">.22</span><span class="number">.04</span><span class="number">.1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p>修改表，增加字段，add：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在 <span class="keyword">member</span> 表中增加一个英语成绩，类型为 <span class="type">float</span> ，默认值为 <span class="number">60</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">member</span> <span class="keyword">add</span> english <span class="type">float</span> <span class="keyword">default</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/659439c8c34d4.png" alt="61-13.png"></p><p>修改表，修改字段类型：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">member</span> modify name <span class="type">varchar</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65943b81a382f.png" alt="61-14.png"></p><p>改字段名字：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">member</span> change name mname <span class="type">varchar</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65943c96b4403.png" alt="61-15.png" title="然后又改回去了，不提"></p><p>删除字段：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">member</span> <span class="keyword">drop</span> english;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65943e41955c5.png" alt="61-16.png"></p><p>删除表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> test1;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65943fbb7bac4.png" alt="61-17.png"></p><p>指定位置添加：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">member</span> <span class="keyword">add</span> english <span class="type">float</span> <span class="keyword">first</span>;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/659440d9bab43.png" alt="61-18.png"></p><p>指定相对位置添加：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">member</span> <span class="keyword">add</span> xxx <span class="type">float</span> after id;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65944279d82ee.png" alt="61-19.png"></p><p>修改表结构：</p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/R-nPuXn6q3jDcq" alt="61-20"></p><h2 id="INSERT、UPDATE、DELETE"><a href="#INSERT、UPDATE、DELETE" class="headerlink" title="INSERT、UPDATE、DELETE"></a>INSERT、UPDATE、DELETE</h2><p>DML（Data Manipulation Language）数据操纵语言</p><ul><li>作用：用于向数据库表中插入、删除、修改数据</li><li>常用关键字：<code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code></li></ul><p>字符串使用单引号。</p><p>插入一条记录并查看：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span> (id,name,age,math) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;xiaoshuai&#x27;</span>,<span class="number">30</span>,<span class="number">59</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65951dd78c979.png" alt="61-21.png"></p><p>插入一条记录，部分为默认值：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span> (id,name) <span class="keyword">values</span> (<span class="number">2</span>,<span class="string">&#x27;xiaoai&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65951f43b2a1c.png" alt="61-22.png"></p><p>插入多条记录：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span> <span class="keyword">values</span> (<span class="number">3</span>,<span class="string">&#x27;xiaomei&#x27;</span>,<span class="number">20</span>,<span class="number">100</span>),(<span class="number">4</span>,<span class="string">&#x27;lumine&#x27;</span>,<span class="number">17</span>,<span class="number">61</span>),(<span class="number">8</span>,<span class="string">&#x27;xiao&#x27;</span>,<span class="number">18</span>,<span class="number">85</span>);</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/YoQQDvFN2g3adR" alt="61-23"></p><p>修改一条记录：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> age<span class="operator">=</span><span class="number">24</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/6595247bbaadb.png" alt="61-24.png"></p><p>修改一张表的全部记录（修改值相同）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> e_date<span class="operator">=</span><span class="string">&#x27;1999-10-10 10:10:10&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/fiG2taOrig2lIL" alt="61-25"></p><p>删除记录：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">8</span>;</span><br></pre></td></tr></table></figure><p>插入空值：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name) <span class="keyword">values</span>(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/659528bd889dc.png" alt="61-26.png"></p><p><strong>同<code>insert</code>和<code>update</code>一样，从一个表中删除记录将引起其它表的参照完整性问题，在修改数据库数据时，头脑中应该始终不要忘记这个潜在的问题。</strong></p><p>Tip: mysql中文乱码</p><ul><li>mysql有六处使用了字符集，分别为：client 、connection、database、results、server 、system</li><li>client是客户端使用的字符集</li><li>connection是连接数据库的字符集设置类型，如果程序没有指明连接数据库使用的字符集类型就按照服务器端默认的字符集设置</li><li>database是数据库服务器中某个库使用的字符集设定，如果建库时没有指明，将使用服务器安装时指定的字符集设置</li><li>results是数据库给客户端返回时使用的字符集设定，如果没有指明，使用服务器默认的字符集</li><li>server是服务器安装时指定的默认字符集设定</li><li>system是数据库系统使用的字符集设定</li></ul><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p>DQL（Data Query Language）数据查询语言</p><ul><li>作用：查询数据</li><li>常用关键字：<code>SELECT</code></li></ul><p>查看 member 表中数据的条数：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><p>或者（效果一样）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><p>基本select语句：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT [DISTINCT] [*] |&#123;column1, column2, column3..&#125; FROM table [where];</span><br></pre></td></tr></table></figure><p>基本select语句</p><ul><li><code>Select</code>指定查询哪些列的数据</li><li><code>column</code>指定列名</li><li><code>*</code>号代表查询所有列</li><li><code>From</code>指定查询哪张表</li><li><code>DISTINCT</code>可选，指显示结果时，是否剔除重复数据</li></ul><p>选择指定列：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/7VHLGFI5Id0KgR" alt="61-27"></p><p>加入限制条件：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 会同时过滤不满足条件的和 <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">select</span> id,name <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/01/03/65953018d49f2.png" alt="61-28.png"></p><p>去重查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">distinct</span> e_date <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+</span></span><br><span class="line"><span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>在select语句中可使用表达式对查询的列进行运算：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT *|&#123;column1｜expression, column2｜expression，..&#125; FROM     table;</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age,age<span class="operator">+</span><span class="number">10</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span> age<span class="operator">+</span><span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>     <span class="number">40</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>     <span class="number">34</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>     <span class="number">27</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>在select语句中可使用as语句<code>SELECT column as 别名 from 表名;</code> ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age,age<span class="operator">+</span><span class="number">10</span><span class="operator">*</span><span class="number">100</span><span class="operator">+</span>math<span class="operator">*</span><span class="number">1000</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------------------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span> age<span class="operator">+</span><span class="number">10</span><span class="operator">*</span><span class="number">100</span><span class="operator">+</span>math<span class="operator">*</span><span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>                <span class="number">60030</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>                 <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>               <span class="number">101020</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>                <span class="number">62017</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>                 <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age,age<span class="operator">+</span><span class="number">10</span><span class="operator">*</span><span class="number">100</span><span class="operator">+</span>math<span class="operator">*</span><span class="number">1000</span> <span class="keyword">as</span> total <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span> total  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>  <span class="number">60030</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> <span class="number">101020</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">62017</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>在<code>where</code>子句中常用的运算符：</p><p><img src="https://bu.dusays.com/2024/01/03/6595421561e06.png" alt="61-29.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age <span class="keyword">between</span> <span class="number">20</span> <span class="keyword">and</span> <span class="number">25</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age <span class="keyword">in</span> (<span class="number">17</span>,<span class="number">30</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age <span class="keyword">in</span> (<span class="number">17</span>,<span class="number">60</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age <span class="keyword">in</span> (<span class="number">17</span>,<span class="number">60</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>模糊查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%i&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%i__&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><code>is NULL</code>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="keyword">is</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>错误用法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><code>order by</code>排序：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>调整升降序：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>使用<code>limit</code>限制显示行数：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span> limit <span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span> limit <span class="number">3</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><code>offset</code>选项，偏移量：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span> limit <span class="number">3</span> <span class="keyword">offset</span> <span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai  <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+---------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h2 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h2><p>数据完整性是为了保证插入到数据库中的数据是正确的，它防止了用户可能的输入错误。</p><p>数据完整性主要分为以下三类：</p><ul><li>实体完整性：规定表的一行（即每一条记录）在表中是唯一的实体。实体完整性通过表的主键来实现。</li><li>域完整性：指数据库表的列（即字段）必须符合某种特定的数据类型或约束。比如NOT NULL。</li><li>参照完整性：<ul><li>保证一个表的外键和另一个表的主键对应。</li><li>参照的完整性要求关系中不允许引用不存在的实体。与实体完整性是关系模型必须满足的完整性约束条件，目的是保证数据的一致性。</li></ul></li></ul><p>定义表的约束</p><ul><li>定义主键约束<ul><li>primary key:不允许为空，不允许重复</li><li>可以区分两条记录的唯一性</li><li>删除主键：<code>alter table tablename drop primary key;</code> </li></ul></li><li>定义主键自动增长<ul><li>auto_increment</li></ul></li><li>定义唯一约束<ul><li>unique</li></ul></li><li>定义非空约束<ul><li>not null</li></ul></li><li>定义外键约束<ul><li>constraint ordersid_FK foreign key(ordersid) references orders(id)</li></ul></li></ul><h2 id="多表设计、查询进阶"><a href="#多表设计、查询进阶" class="headerlink" title="多表设计、查询进阶"></a>多表设计、查询进阶</h2><p>多表设计：一对多、多对多、一对一。（避免数据的冗余）</p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/plm1uS5SjFJSNa" alt="61-30"></p><p><img src="https://bu.dusays.com/2024/01/06/65996c38becd4.png" alt="61-31.png"></p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/9hU_UtDsVsooy-" alt="61-32"></p><p>再设计一个表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> customer(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> id <span class="type">int</span> auto_increment,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> name <span class="type">varchar</span>(<span class="number">30</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> age <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">primary</span> key(id));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure><p>过程略。结果：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>    <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> customer <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `customer` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>再设计一个表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> order_table(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> order_id <span class="type">int</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> price <span class="type">float</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> user_id <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">foreign</span> key(user_id) <span class="keyword">references</span> customer(id));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> customer         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> order_table;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field    <span class="operator">|</span> Type     <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> order_id <span class="operator">|</span> <span class="type">int</span>      <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name     <span class="operator">|</span> <span class="type">char</span>(<span class="number">20</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> price    <span class="operator">|</span> <span class="type">float</span>    <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> user_id  <span class="operator">|</span> <span class="type">int</span>      <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>插入相关联的记录：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_table;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> order_table <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">&#x27;shanzi&#x27;</span>,<span class="number">520</span>,<span class="number">3</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_table;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> order_id <span class="operator">|</span> name   <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------+-------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> order_table <span class="keyword">values</span>(<span class="number">12</span>,<span class="string">&#x27;Alcohol Pads&#x27;</span>,<span class="number">5</span>,<span class="number">4</span>);</span><br><span class="line">ERROR <span class="number">1452</span> (<span class="number">23000</span>): Cannot <span class="keyword">add</span> <span class="keyword">or</span> <span class="keyword">update</span> a child <span class="type">row</span>: a <span class="keyword">foreign</span> key <span class="keyword">constraint</span> fails (`akashi`.`order_table`, <span class="keyword">CONSTRAINT</span> `order_table_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`user_id`) <span class="keyword">REFERENCES</span> `customer` (`id`))</span><br></pre></td></tr></table></figure><p>此时，不能删除 ayaka ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">delete</span> <span class="keyword">from</span> customer <span class="keyword">where</span> id<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line">ERROR <span class="number">1451</span> (<span class="number">23000</span>): Cannot <span class="keyword">delete</span> <span class="keyword">or</span> <span class="keyword">update</span> a parent <span class="type">row</span>: a <span class="keyword">foreign</span> key <span class="keyword">constraint</span> fails (`akashi`.`order_table`, <span class="keyword">CONSTRAINT</span> `order_table_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`user_id`) <span class="keyword">REFERENCES</span> `customer` (`id`))</span><br></pre></td></tr></table></figure><p><strong>DQL数据查询语言</strong></p><ul><li>连接查询：交叉连接、内连接、外连接</li><li>联合查询</li><li>报表查询</li></ul><p>连接查询的 from 子句的连接语法格式为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Select *</span><br><span class="line">from TABLE1 join_type TABLE2  [on (join_condition)]</span><br><span class="line">                              [where (query_condition)]</span><br></pre></td></tr></table></figure><p>其中，TABLE1 和 TABLE2 表示参与连接操作的表，TABLE1 为左表，TABLE2 为右表。on 子句设定连接条件，where 子句设定查询条件，join_type 表示连接类型。</p><p>交叉连接（cross join），不带on子句，返回连接表中所有数据行的笛卡尔积：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_table;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">cross</span> <span class="keyword">join</span> order_table;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>内连接（inner join），返回连接表中符合连接条件及查询条件的数据行。</p><p>内连接查询：</p><ul><li>显式内连接：使用<code>inner join</code>关键字，在<code>on</code>子句中设定连接条件。</li><li>隐式内连接：不包含<code>inner join</code>关键字和<code>on</code>关键字，在<code>where</code>子句中设定连接条件。</li></ul><p>显式内连接：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">inner</span> <span class="keyword">join</span> order_table <span class="keyword">on</span> customer.id<span class="operator">=</span>order_table.user_id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">as</span> c <span class="keyword">inner</span> <span class="keyword">join</span> order_table <span class="keyword">as</span> o <span class="keyword">on</span> c.id<span class="operator">=</span>o.user_id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>隐式内连接：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer,order_table <span class="keyword">where</span> customer.id<span class="operator">=</span>order_table.user_id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>复制一个 table（包含数据）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> customer_tmp <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer;</span><br><span class="line">Query OK, <span class="number">4</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line">Records: <span class="number">4</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> customer_tmp;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer_tmp;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>复制一个 table（不包含数据）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> customer_tmp_like <span class="keyword">like</span> customer;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> customer_tmp_like;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer_tmp_like;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>为（已有的）customer_tmp 添加主键：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> customer_tmp modify id <span class="type">int</span> <span class="keyword">primary</span> key;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.07</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> customer_tmp;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>现有表如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp_like <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> order_table_tmp;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>           <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_table_tmp` (</span><br><span class="line">  `order_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `price` <span class="type">float</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `user_id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`order_id`),</span><br><span class="line">  KEY `user_id` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> order_table_tmp;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field    <span class="operator">|</span> Type     <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> order_id <span class="operator">|</span> <span class="type">int</span>      <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name     <span class="operator">|</span> <span class="type">char</span>(<span class="number">20</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> price    <span class="operator">|</span> <span class="type">float</span>    <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> user_id  <span class="operator">|</span> <span class="type">int</span>      <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>对 order_table_tmp 作外键约束：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> order_table_tmp <span class="keyword">add</span> <span class="keyword">foreign</span> key(user_id) <span class="keyword">references</span> customer_tmp(id);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.07</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> order_table_tmp;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span>           <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_table_tmp` (</span><br><span class="line">  `order_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `price` <span class="type">float</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `user_id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`order_id`),</span><br><span class="line">  KEY `user_id` (`user_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `order_table_tmp_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`user_id`) <span class="keyword">REFERENCES</span> `customer_tmp` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>（？）如果想修改外键名字，可以先删除外键约束，然后再新建。</p><p>外连接：分为左外连接（left outer join）、右外连接（right outer join）。与内连接不同的是，外连接不仅返回连接表中符合连接条件及查询条件的数据行，也返回左表（左外连接时）或右表（右外连接时）中仅符合查询条件但不符合连接条件的数据行。</p><p>左外连接（left outer join）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_table;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">as</span> c <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> order_table <span class="keyword">as</span> o <span class="keyword">on</span> c.id<span class="operator">=</span>o.user_id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>         <span class="operator">|</span>  <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>         <span class="operator">|</span>  <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>外连接的时候，必须要加上连接条件 on .</p><p>追加限制：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">as</span> c <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> order_table <span class="keyword">as</span> o <span class="keyword">on</span> c.id<span class="operator">=</span>o.user_id <span class="keyword">where</span> o.order_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>右外连接：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">as</span> c <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> order_table <span class="keyword">as</span> o</span><br><span class="line"><span class="keyword">on</span> c.id<span class="operator">=</span>o.user_id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> order_id <span class="operator">|</span> name         <span class="operator">|</span> price <span class="operator">|</span> user_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span> shanzi       <span class="operator">|</span>   <span class="number">520</span> <span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> duojiaoyutou <span class="operator">|</span>    <span class="number">50</span> <span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+----------+--------------+-------+---------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>这种查询并不要求左表和右表有外键约束：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> nilou   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">as</span> c <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> <span class="keyword">member</span> <span class="keyword">as</span> m <span class="keyword">on</span> c.id<span class="operator">=</span>m.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Lumine  <span class="operator">|</span>  <span class="number">500</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> yoimiya <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> ayaka   <span class="operator">|</span>   <span class="number">16</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field  <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id     <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name   <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> math   <span class="operator">|</span> <span class="type">float</span>       <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> e_date <span class="operator">|</span> datetime    <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> customer;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p><strong>子查询</strong>：也叫“嵌套查询”，是指在where子句或from子句中又嵌入select查询语句（一般写在where子句）。</p><p>【练习】查询“郭靖”的所有订单信息：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id<span class="operator">=</span>(<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> customer <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%郭靖%&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>联合查询</strong>：合并两条查询语句的查询结果，去掉其中的重复数据行，然后返回没有重复数据行的查询结果。联合查询使用<code>union</code>关键字。例子：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> price<span class="operator">&gt;</span><span class="number">100</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(id,name,age,math) <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;huohuo&#x27;</span>,<span class="number">14</span>,<span class="number">71</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age<span class="operator">&gt;</span><span class="number">19</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> math<span class="operator">&gt;</span><span class="number">60</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name    <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo  <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+------+------+---------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age<span class="operator">&gt;</span><span class="number">19</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> math<span class="operator">&gt;</span><span class="number">60</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>其效果等价于：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age<span class="operator">&gt;</span><span class="number">19</span> <span class="keyword">or</span> math<span class="operator">&gt;</span><span class="number">60</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>加<code>all</code>，不去重：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> age<span class="operator">&gt;</span><span class="number">19</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> math<span class="operator">&gt;</span><span class="number">60</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>报表查询</strong>，对数据行进行分组统计，其语法格式为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>… <span class="keyword">from</span>… [<span class="keyword">where</span>…] [<span class="keyword">group</span> <span class="keyword">by</span>… [<span class="keyword">having</span>… ]] [<span class="keyword">order</span> <span class="keyword">by</span>… ] </span><br></pre></td></tr></table></figure><p>其中<code>group by</code>子句指定按照哪些字段分组，<code>having</code>子句设定分组查询条件。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai        <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi  <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi     <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">group</span> <span class="keyword">by</span> age;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>在报表查询中可以使用SQL函数</p><ul><li><code>count()</code> 计数 </li><li><code>sum()</code> 求和  </li><li><code>avg()</code> 求平均值</li><li><code>max()</code> 最大值</li><li><code>min()</code> 最小值</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(age),age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">group</span> <span class="keyword">by</span> age;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">count</span>(age) <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">min</span>(math) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">min</span>(math) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">59</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">sum</span>(age),<span class="built_in">min</span>(math) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">sum</span>(age) <span class="operator">|</span> <span class="built_in">min</span>(math) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">320</span> <span class="operator">|</span>        <span class="number">59</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><code>having</code>用法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(age),age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">group</span> <span class="keyword">by</span> age <span class="keyword">having</span> age<span class="operator">&lt;</span><span class="number">22</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">count</span>(age) <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(age),age <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">group</span> <span class="keyword">by</span> age <span class="keyword">having</span> <span class="built_in">count</span>(age)<span class="operator">&gt;</span><span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">count</span>(age) <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h2 id="数据的备份与恢复"><a href="#数据的备份与恢复" class="headerlink" title="数据的备份与恢复"></a>数据的备份与恢复</h2><p>在此之前： <a href="https://stackoverflow.com/questions/39281594/error-1698-28000-access-denied-for-user-rootlocalhost">https://stackoverflow.com/questions/39281594/error-1698-28000-access-denied-for-user-rootlocalhost</a></p><p><strong>备份</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p akashi&gt;akashi.sql</span><br></pre></td></tr></table></figure><p>备份得到的文件<code>akashi.sql</code>可以用vim打开查看。</p><p>目前为止的备份文件：<a href="https://drive.google.com/file/d/1oXosO_shXMNEs2S1Ey1fi8aQHkkWbgfh/view?usp=drive_link">Google Drive文件分享</a></p><p><strong>恢复</strong>：</p><p>在此之前，akashi 库已被删除：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> akashi             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">drop</span> database akashi;</span><br><span class="line">Query OK, <span class="number">6</span> <span class="keyword">rows</span> affected (<span class="number">0.06</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>为了恢复 akashi 库，需要先进行如下准备：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> database akashi;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> akashi             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> use akashi;</span><br><span class="line">Database changed</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>然后在命令行中执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p akashi&lt;akashi.sql</span><br></pre></td></tr></table></figure><p>即可恢复 akashi 库：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp_like <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>备份原理：insert</p><ul><li>通过协议连接到 MySQL数据库，将需要备份的数据查询出来并转换成对应的insert语句，当我们需要还原这些数据时，只要执行这些 insert 语句，即可将对应的数据还原</li></ul><h2 id="数据库编程"><a href="#数据库编程" class="headerlink" title="数据库编程"></a>数据库编程</h2><p>文档资料：</p><ul><li><a href="https://dev.mysql.com/doc/">https://dev.mysql.com/doc/</a></li><li><a href="https://downloads.mysql.com/docs/c-api-8.2-en.a4.pdf">https://downloads.mysql.com/docs/c-api-8.2-en.a4.pdf</a></li></ul><p>查看 port ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ cd /etc/mysql</span><br><span class="line">wanko@wanko:/etc/mysql$ ll</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x   4 root root  4096  1月  1 22:05 ./</span><br><span class="line">drwxr-xr-x 129 root root 12288  1月  9 17:15 ../</span><br><span class="line">drwxr-xr-x   2 root root  4096  1月  1 22:05 conf.d/</span><br><span class="line">-rw-------   1 root root   317  1月  1 22:05 debian.cnf</span><br><span class="line">-rwxr-xr-x   1 root root   120 10月 26 01:34 debian-start*</span><br><span class="line">lrwxrwxrwx   1 root root    24  1月  1 22:05 my.cnf -&gt; /etc/alternatives/my.cnf</span><br><span class="line">-rw-r--r--   1 root root   839 10月 20  2020 my.cnf.fallback</span><br><span class="line">-rw-r--r--   1 root root   682  6月 15  2023 mysql.cnf</span><br><span class="line">drwxr-xr-x   2 root root  4096  1月  1 22:05 mysql.conf.d/</span><br><span class="line">wanko@wanko:/etc/mysql$ cd mysql.conf.d/</span><br><span class="line">wanko@wanko:/etc/mysql/mysql.conf.d$ ll</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x 2 root root 4096  1月  1 22:05 ./</span><br><span class="line">drwxr-xr-x 4 root root 4096  1月  1 22:05 ../</span><br><span class="line">-rw-r--r-- 1 root root  132  6月 15  2023 mysql.cnf</span><br><span class="line">-rw-r--r-- 1 root root 2220  6月 15  2023 mysqld.cnf</span><br><span class="line">wanko@wanko:/etc/mysql/mysql.conf.d$ sudo vim mysqld.cnf</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/qGu0SDZW-pkAcr" alt="61-33"></p><p>初学关注：</p><ul><li><code>mysql_real_connect()</code></li><li><code>mysql_query()</code></li><li><code>mysql_store_result()</code></li><li><code>mysql_num_rows()</code></li></ul><p>安装 libmysqlclient-dev ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libmysqlclient-dev</span><br></pre></td></tr></table></figure><p>（在某些情况下 linux 真的比 Windows 方便许多，令人感叹）</p><p>写一段用于查询的 C 程序：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error args\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MYSQL* conn;</span><br><span class="line">    MYSQL_RES* res;</span><br><span class="line">    MYSQL_ROW row;</span><br><span class="line">    <span class="type">char</span>* server = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="type">char</span>* user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="type">char</span>* password = <span class="string">&quot;&quot;</span>; <span class="comment">// input passwd, use &quot;&quot; if there isn&#x27;t a password</span></span><br><span class="line">    <span class="type">char</span>* database = <span class="string">&quot;akashi&quot;</span>; <span class="comment">// name of the database to access</span></span><br><span class="line">    <span class="type">char</span> query[<span class="number">300</span>] = <span class="string">&quot;select * from member where name = &#x27;&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> queryRet;</span><br><span class="line">    <span class="built_in">sprintf</span>(query, <span class="string">&quot;%s%s%s&quot;</span>, query, argv[<span class="number">1</span>], <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="comment">/* strcpy(query, &quot;select * from www&quot;); */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Print the query statement before output */</span></span><br><span class="line">    <span class="built_in">puts</span>(query);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    conn = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(!conn)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MySQL init failed.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Connect to the database, continue if successful */</span></span><br><span class="line">    <span class="keyword">if</span>(!mysql_real_connect(conn, server, user, password, database, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error connecting to database: %s\n&quot;</span>, mysql_error(conn));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MySQL Connected.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Passing SQL Statements to MySQL</span></span><br><span class="line">    queryRet = mysql_query(conn, query);</span><br><span class="line">    <span class="keyword">if</span>(queryRet)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error making query: %s\n&quot;</span>, mysql_error(conn));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res = mysql_store_result(conn);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;mysql_store_result = %lu\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">long</span>)mysql_num_rows(res));</span><br><span class="line">        <span class="comment">/* alternative way of the two lines above */</span></span><br><span class="line">        <span class="comment">/* res = mysql_use_result(conn); */</span></span><br><span class="line"></span><br><span class="line">        row = mysql_fetch_row(res);</span><br><span class="line">        <span class="keyword">if</span>(row == <span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;No data found.\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">do</span>&#123;</span><br><span class="line">                <span class="comment">// print an entire line of content every single loop</span></span><br><span class="line">                <span class="keyword">for</span>(queryRet = <span class="number">0</span>; queryRet &lt; mysql_num_fields(res); queryRet++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%8s &quot;</span>, row[queryRet]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">while</span>((row = mysql_fetch_row(res)) != <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mysql_free_result(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close(conn);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译（可能会跳一些 warning 不过不影响大局）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc query.c -lmysqlclient</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode/example_mysql$ ./a.out lumine</span><br><span class="line">select * from member where name = &#x27;lumine&#x27;</span><br><span class="line">MySQL Connected.</span><br><span class="line">mysql_store_result = 1</span><br><span class="line">       4   lumine       17       61 1999-10-10 10:10:10</span><br></pre></td></tr></table></figure><p>来看一下是否和 akashi 库中的表 member 数据吻合：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai        <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi  <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi     <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>写一个用来插入的程序：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">    MYSQL *conn;</span><br><span class="line">    <span class="type">char</span>* server = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="type">char</span>* user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="type">char</span>* password = <span class="string">&quot;&quot;</span>; <span class="comment">// input passwd, use &quot;&quot; if there isn&#x27;t a password</span></span><br><span class="line">    <span class="type">char</span>* database = <span class="string">&quot;akashi&quot;</span>; <span class="comment">// name of the database to access</span></span><br><span class="line">    <span class="type">char</span> query[<span class="number">300</span>] = <span class="string">&quot;insert into member (id, name, age, math) values (8,&#x27;Kafka&#x27;,28,99)&quot;</span>;</span><br><span class="line">    <span class="type">int</span> queryResult;</span><br><span class="line"></span><br><span class="line">    conn = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!mysql_real_connect(conn, server, user, password, database, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error connecting to database: %s\n&quot;</span>, mysql_error(conn));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MySQL Connected.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    queryResult = mysql_query(conn, query);</span><br><span class="line">    <span class="keyword">if</span>(queryResult)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error making querry: %s\n&quot;</span>, mysql_error(conn));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;insert succeed.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close(conn);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行上面的代码之后：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> xiaoshuai <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai    <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei   <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine    <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo    <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai        <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi  <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi     <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka     <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>写一个用来 update 的程序：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error args\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MYSQL* conn;</span><br><span class="line">    MYSQL_RES* res;</span><br><span class="line">    MYSQL_ROW row;</span><br><span class="line">    <span class="type">char</span>* server = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="type">char</span>* user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="type">char</span>* password = <span class="string">&quot;&quot;</span>; <span class="comment">// input passwd, use &quot;&quot; if there isn&#x27;t a password</span></span><br><span class="line">    <span class="type">char</span>* database = <span class="string">&quot;akashi&quot;</span>; <span class="comment">// name of the database to access</span></span><br><span class="line">    <span class="type">char</span> query[<span class="number">300</span>] = <span class="string">&quot;update member set name = &#x27;&quot;</span>;</span><br><span class="line">    <span class="built_in">sprintf</span>(query, <span class="string">&quot;%s%s%s&quot;</span>, query, argv[<span class="number">1</span>], <span class="string">&quot;&#x27; where id = 1&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(query);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> queryResult;</span><br><span class="line">    conn = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!mysql_real_connect(conn, server, user, password, database, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error connecting to database: %s\n&quot;</span>, mysql_error(conn));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MySQL Connected.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    queryResult = mysql_query(conn, query);</span><br><span class="line">    <span class="keyword">if</span>(queryResult)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error making query: %s\n&quot;</span>, mysql_error(conn));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> ret = mysql_affected_rows(conn);</span><br><span class="line">        <span class="keyword">if</span>(ret)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;update succeed.\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;update failed, mysql_affected_rows: %d\n&quot;</span>, ret);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close(conn);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~/mycode/example_mysql$ ./a.out Natasha</span><br><span class="line">update member set name = &#x27;Natasha&#x27; where id = 1</span><br><span class="line">MySQL Connected.</span><br><span class="line">update succeed.</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h2 id="事务（transaction）"><a href="#事务（transaction）" class="headerlink" title="事务（transaction）"></a>事务（transaction）</h2><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>考虑一个常见操作，转账。</p><p>现在 A 要给 B 转账 1000 元。这个过程可分两步：</p><ol><li>A 的账户减去 1000 元</li><li>B 的账户增加 1000 元</li><li>以上两步都完成时，“转账”才算完成</li></ol><p>但是，现实世界有各种突发情况。若 A 的账户减去 1000 元后，由于某些故障，如系统崩坏、网络故障等，转账操作未完成。此时，A 账户少了 1000 元，但 B 账户的余额没变——即 A 平白无故少了 1000 元。</p><p>因此要求，这些操作要么全发生，要么由于故障而全不发生。</p><p>构成单一逻辑工作单元的操作集合，称为<strong>事务（transaction）</strong>。事务是一组原子性的 SQL 查询，或者说一个独立的工作单元。</p><p>即使有故障，数据库系统也必须保证事务的正确执行——要么执行整个事务，要么属于该事务的操作一个也不执行。</p><h3 id="性质——ACID"><a href="#性质——ACID" class="headerlink" title="性质——ACID"></a>性质——ACID</h3><p>原子性（Atomicity）。</p><p>一致性（Consistency）：当一个事务开始执行时，系统处于一种合法的状态，而当事务成功提交后，系统将转移到另一个合法的状态。具体来说，一致性要求事务在执行过程中必须遵循预定义的规则和约束，以保持数据的完整性。</p><p>隔离性（Isolation）：尽管多个事务可能并发执行，但系统保证，对于任何一对事务 i 和 j ，在 i 看来，j 要么在 i 开始之前已经完成，要么在 i 完成之后才开始执行。因此，每个事务都感觉不到系统中有其他事务在并发地执行。即：一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的。<br>做不到 100% 隔离，与隔离级别有关。</p><p>持久性（Durability）：一个事务成功完成后，对数据库中数据的修改将被永久保存，即使发生系统故障或崩溃，数据也不会丢失。</p><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><p>开启一个事务，标记事务的起点：<code>START TRANSACTION</code> / <code>BEGIN</code></p><p>提交事务，表示事务成功被执行：<code>COMMIT</code></p><p>回滚事务，回滚到初始状态或者回滚点：<code>ROLL BACK</code></p><p>回滚点：<code>SAVEPOINT</code></p><p>删除回滚点：<code>RELEASE SAVEPOINT</code></p><p>设置隔离级别：<code>SET  TRANSACTION</code></p><center><p style="color: red;">- - - - - 隔离性的体现 - - - - -</p></center><p>最开始的表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>在终端 1 操作：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>终端 2（与此同时，另一边 …）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>终端 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> age <span class="operator">=</span> <span class="number">17</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>然后在终端 2 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>我们发现，终端 2 中尚未同步终端 1 的修改，这是因为终端 1 的事务尚未提交。体现了隔离性。</p><center><p style="color: red;">- - - - - 隔离性的体现 END - - - - -</p></center><p>终端 1 ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>终端 2 ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>此时在终端 1 查看数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>在终端 2 查看数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>两个查看结果相同了。</p><center><p style="color: red;">- - - - - rollback - - - - -</p></center><p>终端 1 ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> age <span class="operator">=</span> <span class="number">15</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">rollback</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>huohuo 的 age 又回退到事务开始之前的状态。</p><p>此时再 commit ，查看数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><center><p style="color: red;">- - - - - rollback _ END - - - - -</p></center><p><img src="https://upload-bbs.miyoushe.com/upload/2024/01/19/391084249/5f6c075ffef47029c023996043ffe120_5272792836660250826.jpg" alt="61-34"></p><center><p style="color: red;">- - - - - 回滚点 - - - - -</p></center><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">14</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> age <span class="operator">=</span> <span class="number">15</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>设置回滚点：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">savepoint</span> sq1;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>再次修改 <del>（身材虽然欧巴桑，内心依旧纤细少女的霍霍）</del>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> age <span class="operator">=</span> <span class="number">51</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">51</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><del>（因为被尾巴大爷喂了好果子吃，所以要执行）</del> 回滚：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">rollback</span> <span class="keyword">to</span> sq1;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>commit 之后再看数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>可以发现回到了之前设置的回滚点处。</p><center><p style="color: red;">- - - - - 回滚点END - - - - -</p></center><p>注意事项：</p><ul><li><code>START TRANSACTION</code>标志事务的开始，在 MySQL 中可以用<code>set autocommit = 0</code>替代。</li><li>结束事务的情况只有两种：<ul><li><code>COMMIT</code>：表示事务成功被执行，结束事务。</li><li>发生故障：结束事务，不管有没有设置回滚点，都会回到事务开启前的状态。</li></ul></li><li><code>ROLLBACK</code>：不表示发生故障, 它也是一个数据库操作，属于事务的一部分。表示回滚事务，回滚到事务开启前的状态，或者中间的某个回滚点。要想<code>rollback</code>生效，必须要<code>commit</code>。</li></ul><h2 id="并发产生的问题"><a href="#并发产生的问题" class="headerlink" title="并发产生的问题"></a>并发产生的问题</h2><p>一、脏写</p><p>脏写是指当多个事务并发写同一数据时，先执行的事务所写的数据会被后写的数据覆盖。</p><p><img src="https://bu.dusays.com/2024/01/21/65ac05bd6844f.png" alt="61-35.png"></p><p>脏写会导致更新丢失。就好像先提交的事务根本没有执行一样。</p><p>二、脏读</p><p>若事务A向数据库写数据，但 A 还没提交或终止，另一个事务 B 就读到了事务A写入数据库的数据，这个现象称为脏读。</p><p><img src="https://bu.dusays.com/2024/01/21/65aceb08b60f0.png" alt="61-36.png"></p><center><p style="color: red;">- - - - - AIGC - - - - -</p></center><p><strong>问：</strong><br>什么是数据库的 “脏读“ 现象？请举例</p><p><strong>答：</strong><br>“脏读” 是数据库中一种并发控制的问题，指的是一个事务读取了另一个事务尚未提交的数据。当一个事务读取了另一事务的未提交数据，而后者最终回滚，导致读取的数据是无效的，这就是脏读。</p><p>举个例子：</p><p>假设有两个事务 A 和 B。</p><ol><li>事务 A 开始，读取某一行数据。</li><li>事务 B 修改了这一行数据，但尚未提交。</li><li>事务 A 继续读取同一行数据，此时它读取到了事务 B 修改但未提交的数据，即脏数据。</li><li>事务 B 回滚，因为某种原因导致事务 B 的修改被撤销。</li><li>事务 A 最终得到的数据是基于已经回滚的事务 B 的修改，而这个修改实际上是无效的。</li></ol><p>这就是脏读的典型情况，因为事务 A 读取了未提交的、后来被回滚的数据。脏读可能导致不一致的查询结果，因为读取到的数据可能并不代表数据库的真实状态。为了避免脏读，通常使用事务隔离级别来控制事务之间的可见性。</p><p><strong>问：</strong><br>事务B 的修改不应该被隔离吗？为什么 A 会读到 B 未提交的数据？</p><p><strong>答：</strong><br>对于事务的隔离级别有不同的设定，而脏读的发生与事务隔离级别有关。在数据库中，有四种标准的事务隔离级别，从低到高分别是：读未提交（Read Uncommitted）、读提交（Read Committed）、可重复读（Repeatable Read）和串行化（Serializable）。</p><ol><li>读未提交（Read Uncommitted）：允许事务读取其他事务尚未提交的数据，因此可能发生脏读。</li><li>读提交（Read Committed）：保证一个事务提交后才能被其他事务读取，避免了脏读。但在并发环境下，仍可能发生不可重复读和幻读。</li><li>可重复读（Repeatable Read）：保证一个事务在执行期间多次读取同一行数据时，能够得到一致的结果。防止了脏读和不可重复读，但仍可能发生幻读。</li><li>串行化（Serializable）：最高的隔离级别，通过完全锁定读取的数据，确保事务的完全隔离。避免了脏读、不可重复读和幻读，但也降低了并发性能。</li></ol><p>在读未提交的隔离级别下，事务 A 可以读取事务 B 尚未提交的数据，导致脏读。在实际应用中，通常会选择适当的隔离级别，权衡事务的隔离和性能需求。</p><center><p style="color: red;">- - - - - AIGC END - - - - -</p></center><p>三、不可重复读</p><p>一个事务有对同一个数据项的多次读取，但是在某前后两次读取之间，另一个事务更新该数据项，并且<strong>提交了</strong>。在后一次读取时，感知到了提交的更新。称为不可重复读。</p><p><img src="https://bu.dusays.com/2024/01/21/65acf29ee577b.png" alt="61-37.png"></p><center><p style="color: red;">- - - - - AIGC - - - - -</p></center><p><strong>问：</strong><br>什么是数据库的 不可重复读？</p><p><strong>答：</strong><br>不可重复读是数据库中的一种并发控制问题，它指的是在同一个事务内，由于其他事务的修改，导致事务中多次读取同一行数据时，得到的结果不一致。</p><p>举个例子：</p><p>假设有两个事务 A 和 B。</p><ol><li>事务 A 开始，读取某一行数据。</li><li>事务 B 修改了这一行数据，并提交。</li><li>事务 A 再次读取同一行数据，此时它得到的结果与第一次读取时不一样，因为在两次读取之间，事务 B 进行了修改。</li></ol><p>这种情况就是不可重复读，因为同一个事务内的两次读取操作得到的数据不一致。不可重复读可能导致事务中的操作基于不一致的数据，从而产生意料之外的结果。</p><p>为了解决不可重复读的问题，数据库系统通常提供不同的事务隔离级别。在可重复读（Repeatable Read）隔离级别下，数据库系统会确保在同一个事务内多次读取同一行数据时，得到的结果保持一致，不受其他事务的影响。</p><center><p style="color: red;">- - - - - AIGC END - - - - -</p></center><p>四、幻读</p><p>一个事务需要进行前后两次统计，在这两次统计期间，另一个事务插入了新的符合统计条件的记录，并且提交了。导致前后两次统计的数据不一致。这种现象，我们称之为幻读。</p><p><img src="https://bu.dusays.com/2024/01/21/65acf96252fed.png" alt="61-38.png"></p><center><p style="color: red;">- - - - - AIGC - - - - -</p></center><p><strong>问：</strong><br>什么是数据库的 幻读？</p><p><strong>答：</strong><br>幻读是数据库中的一种并发控制问题，它指的是在同一个事务中，由于其他事务的插入或删除操作，导致事务中的查询结果集合发生变化，产生了额外的行，就像出现了幻觉一样。</p><p>举个例子：</p><p>假设有两个事务 A 和 B。</p><ol><li>事务 A 开始，执行一个范围查询，得到一定的结果集合。</li><li>事务 B 在此期间插入了新的数据，符合事务 A 的查询条件。</li><li>事务 A 再次执行相同的范围查询，但这次得到的结果集合比第一次查询时更大，因为事务 B 插入的新数据导致了额外的行出现。</li></ol><p>为了解决幻读的问题，数据库系统通常提供不同的事务隔离级别。在串行化（Serializable）隔离级别下，数据库系统会确保一个事务中的查询结果是一致的，不受其他事务的插入或删除操作的影响。然而，串行化隔离级别也可能降低并发性能。在实际应用中，选择适当的隔离级别需要权衡一致性和性能的需求。</p><center><p style="color: red;">- - - - - AIGC END - - - - -</p></center><h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><p>SQL 标准规定了四种隔离级别，分别为（隔离性依次增高）：</p><ul><li><strong>读未提交（read uncommitted）</strong>：允许读取未提交的数据。</li><li><strong>读已提交（read committed）</strong>：只允许读取已提交的数据，但不要求可重复读。比如，在事务两次读取一个数据项期间，另一个事务更新了该数据项并提交。</li><li><strong>可重复读（repeatable read）</strong>：只允许读取已提交的数据，且在一个事务两次读取一个数据项期间，其他事务不得更新该数据。但该事务不要求与其他事务可串行化。比如，在两次统计查询中，另一个事务可以插入一些记录，这些记录若有符合查询条件的，就会导致幻读。</li><li><strong>可串行化（serializable）</strong>：看起来事务就好像是串行执行的一样。一个事务结束后，另一个事务才开始执行。</li></ul><table>  <tbody>    <tr>      <td></td>      <td>脏写</td>      <td>脏读</td>      <td>不可重复读</td>      <td>幻读</td>    </tr>    <tr>      <td>读未提交</td>      <td>×</td>      <td>√</td>      <td>√</td>      <td>√</td>    </tr>    <tr>      <td>读已提交</td>      <td>×</td>      <td>×</td>      <td>√<br></td>      <td>√</td>    </tr>    <tr>      <td>可重复读<br></td>      <td>×</td>      <td>×</td>      <td>×</td>      <td>√</td>    </tr>    <tr>      <td>可串行化</td>      <td>×</td>      <td>×</td>      <td>×</td>      <td>×</td>    </tr>  </tbody>  <colgroup>    <col>    <col>    <col>    <col>    <col>  </colgroup></table><p><strong>以上所有隔离级别都不允许脏写（dirty write）</strong>，即：若一个数据项正在被一个尚未提交或中止的事务执行写操作，则其他事务不能对该数据项执行写操作。</p><p>查看当前隔离级别：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>设置当前隔离级别为读未提交：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> session transaction isolation level read uncommitted;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>UNCOMMITTED                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>设置当前隔离级别为读已提交：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> session transaction isolation level read committed;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>COMMITTED                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>设置当前隔离级别为可重复读：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> session transaction isolation level repeatable read;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>设置当前隔离级别为可串行化：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> session transaction isolation level serializable;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> SERIALIZABLE                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><center><p style="color: red";>- - - - - Presentation - - - - -</p></center><p>在 REPEATABLE-READ 下<strong>演示幻读现象</strong>：</p><p>terminal 1:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">11</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 2:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">11</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 1:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span> (id, name, age) <span class="keyword">values</span>(<span class="number">10</span>, &quot;po&quot;, <span class="number">3</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>此时在 terminal 2 中，按道理应该是能读到 id 为 10 的记录，但是 terminal 2 显示如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">11</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>体现幻读的现象，terminal 2：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span> (id, name, age) <span class="keyword">values</span>(<span class="number">10</span>, &quot;po&quot;, <span class="number">3</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field  <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id     <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name   <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> math   <span class="operator">|</span> <span class="type">float</span>       <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> e_date <span class="operator">|</span> datetime    <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">13</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 1 之前插入的数据已经在了，只是刚才没有显式地显示出来。<br>另一种体现方式：如果 id 被设为主键，则在 terminal 2 中会无法插入。</p><center><p style="color: red";>- - - - - Presentation END - - - - -</p></center><p>下面简单展示一下可串行化。</p><p>terminal 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> SERIALIZABLE                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">13</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 2 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@session</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@session</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="operator">|</span> SERIALIZABLE                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name        <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha     <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai      <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei     <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine      <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>        <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo      <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai          <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi       <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka       <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">9</span> <span class="operator">|</span> kongfupanda <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span> po          <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------------+------+------+---------------------+</span></span><br><span class="line"><span class="number">13</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> <span class="keyword">member</span> <span class="keyword">set</span> age <span class="operator">=</span> <span class="number">4</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">ERROR <span class="number">1205</span> (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：<br>MySQL 支持 4 种隔离级别，默认为 RR（repeatable read），MySQL 的 RR 隔离级别，在一定程度上避免了幻读问题。<br>Oracle 只支持 read committed 和 serializable 两种隔离级别，默认为 read committed.</p><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="引入-1"><a href="#引入-1" class="headerlink" title="引入"></a>引入</h3><p>索引（Index）是帮助 MySQL 高效获取数据的数据结构。</p><p>示例（查找的快慢）：</p><p><img src="https://bu.dusays.com/2024/01/24/65b0f61a3423f.png" alt="61-39.png" title="id 是索引"></p><p>数据结构选择的参考维度：空间的连续性、时间复杂度、磁盘 IO 的次数、范围查找。</p><ul><li>顺序查找：遍历操作，时间复杂度是 O(N)，需要大块连续的空间。</li><li>二分查找：时间复杂度 O(logN)，需要大块连续的空间。</li><li>二叉树：时间复杂度 O(logN)，不需要连续的空间。但如果数据量比较大（如：百万级别），二叉树的高度会非常高，导致磁盘 IO 次数随之变多，而磁盘 IO 很慢。</li><li>哈希：时间复杂度 O(1). 哈希会有哈希冲突，会影响查找速度。哈希意味着无序。在 SQL 里常进行范围查找，而哈希是没有顺序的，故数据量大的时不能用哈希。</li><li>B树和B+树：见数据结构笔记。</li></ul><p>查看节点大小：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_page_size&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> innodb_page_size <span class="operator">|</span> <span class="number">16384</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>索引的分类：</p><ul><li>主键索引：以主键创建的索引</li><li>非主键索引（辅助索引）：普通索引、唯一索引、全文索引、组合索引</li></ul><h3 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h3><p>创建主键索引（创建表的时候，创建主键）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test1(id <span class="type">int</span>, age <span class="type">int</span>, <span class="keyword">primary</span> key(id));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>创建主键索引（表创建完之后，再创建主键）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test2;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> test2 <span class="keyword">add</span> <span class="keyword">primary</span> key(id);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test2;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>主键特点：非空、唯一。</p><h3 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h3><p>普通索引的创建（创建表的时候，创建普通索引）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test3(id <span class="type">int</span>, age <span class="type">int</span>, index idx_age(age));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test3;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>普通索引的创建（创建表之后，再创建普通索引）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test4(id <span class="type">int</span>, age <span class="type">int</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test4;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> test4 <span class="keyword">add</span> index idx_age(age);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test4;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>在创建表之后，使用 create index 创建索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> index idx_id <span class="keyword">on</span> test4(id);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test4;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>唯一索引（创建方法和普通索引大同小异）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test3(id <span class="type">int</span>, age <span class="type">int</span>, <span class="keyword">unique</span> index idx_age(age));</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test4 <span class="keyword">add</span> <span class="keyword">unique</span> index idx_age(age);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index idx_id <span class="keyword">on</span> test4(id);</span><br></pre></td></tr></table></figure><h3 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h3><p>组合索引是由多个列一起组成的。</p><p>创建表之后再创建组合索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test5(id <span class="type">int</span>, age <span class="type">int</span>, name <span class="type">varchar</span>(<span class="number">20</span>), math <span class="type">int</span>, eng <span class="type">int</span>, <span class="keyword">primary</span> key(id));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test5;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> math  <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> eng   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> test5 <span class="keyword">add</span> index idx_name_math_eng(name, math, eng);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test5;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> math  <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> eng   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> test5;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span> <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> test5 <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test5` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `math` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `eng` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_name_math_eng` (`name`,`math`,`eng`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>也可以：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name_math_eng <span class="keyword">on</span> test5(name, math, eng);</span><br></pre></td></tr></table></figure><p>显示表的索引情况：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> index <span class="keyword">from</span> test5;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span> <span class="operator">|</span> Non_unique <span class="operator">|</span> Key_name          <span class="operator">|</span> Seq_in_index <span class="operator">|</span> Column_name <span class="operator">|</span> <span class="keyword">Collation</span> <span class="operator">|</span> <span class="keyword">Cardinality</span> <span class="operator">|</span> Sub_part <span class="operator">|</span> Packed <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Index_type <span class="operator">|</span> Comment <span class="operator">|</span> Index_comment <span class="operator">|</span> Visible <span class="operator">|</span> Expression <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> test5 <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span> <span class="keyword">PRIMARY</span>           <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> id          <span class="operator">|</span> A         <span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> test5 <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_name_math_eng <span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span> name        <span class="operator">|</span> A         <span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> test5 <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_name_math_eng <span class="operator">|</span>            <span class="number">2</span> <span class="operator">|</span> math        <span class="operator">|</span> A         <span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> test5 <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> idx_name_math_eng <span class="operator">|</span>            <span class="number">3</span> <span class="operator">|</span> eng         <span class="operator">|</span> A         <span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span>     <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span> YES  <span class="operator">|</span> BTREE      <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span> YES     <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>换一种打印方式（竖着看）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> index <span class="keyword">from</span> test5\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">        <span class="keyword">Table</span>: test5</span><br><span class="line">   Non_unique: <span class="number">0</span></span><br><span class="line">     Key_name: <span class="keyword">PRIMARY</span></span><br><span class="line"> Seq_in_index: <span class="number">1</span></span><br><span class="line">  Column_name: id</span><br><span class="line">    <span class="keyword">Collation</span>: A</span><br><span class="line">  <span class="keyword">Cardinality</span>: <span class="number">0</span></span><br><span class="line">     Sub_part: <span class="keyword">NULL</span></span><br><span class="line">       Packed: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">Null</span>: </span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">        <span class="keyword">Table</span>: test5</span><br><span class="line">   Non_unique: <span class="number">1</span></span><br><span class="line">     Key_name: idx_name_math_eng</span><br><span class="line"> Seq_in_index: <span class="number">1</span></span><br><span class="line">  Column_name: name</span><br><span class="line">    <span class="keyword">Collation</span>: A</span><br><span class="line">  <span class="keyword">Cardinality</span>: <span class="number">0</span></span><br><span class="line">     Sub_part: <span class="keyword">NULL</span></span><br><span class="line">       Packed: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">Null</span>: YES</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">        <span class="keyword">Table</span>: test5</span><br><span class="line">   Non_unique: <span class="number">1</span></span><br><span class="line">     Key_name: idx_name_math_eng</span><br><span class="line"> Seq_in_index: <span class="number">2</span></span><br><span class="line">  Column_name: math</span><br><span class="line">    <span class="keyword">Collation</span>: A</span><br><span class="line">  <span class="keyword">Cardinality</span>: <span class="number">0</span></span><br><span class="line">     Sub_part: <span class="keyword">NULL</span></span><br><span class="line">       Packed: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">Null</span>: YES</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: <span class="keyword">NULL</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">4.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">        <span class="keyword">Table</span>: test5</span><br><span class="line">   Non_unique: <span class="number">1</span></span><br><span class="line">     Key_name: idx_name_math_eng</span><br><span class="line"> Seq_in_index: <span class="number">3</span></span><br><span class="line">  Column_name: eng</span><br><span class="line">    <span class="keyword">Collation</span>: A</span><br><span class="line">  <span class="keyword">Cardinality</span>: <span class="number">0</span></span><br><span class="line">     Sub_part: <span class="keyword">NULL</span></span><br><span class="line">       Packed: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">Null</span>: YES</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: <span class="keyword">NULL</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h3 id="索引的删除"><a href="#索引的删除" class="headerlink" title="索引的删除"></a>索引的删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name DROP INDEX index_name;</span><br><span class="line">DORP INDEX IndexName ON TableName;</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test5;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> math  <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> eng   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> test5 <span class="keyword">drop</span> index idx_name_math_eng;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test5;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> math  <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> eng   <span class="operator">|</span> <span class="type">int</span>         <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test4;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">drop</span> index idx_id <span class="keyword">on</span> test4;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line">Records: <span class="number">0</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> test4;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field <span class="operator">|</span> Type <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> id    <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> age   <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span> YES  <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h3 id="索引的好处和坏处"><a href="#索引的好处和坏处" class="headerlink" title="索引的好处和坏处"></a>索引的好处和坏处</h3><p>好处：<br>提高数据检索效率，降低数据库 IO 成本。</p><ol><li>查找</li><li>排序</li><li>分组</li><li>表的连接</li></ol><p>坏处</p><ol><li>额外占用空间。有时候索引占用的空间甚至比数据占用的空间还多。</li><li>降低更新表的速度。因为数据库不仅要更新数据，还要更新对应的索引信息。</li></ol><h3 id="组合索引的最左前缀"><a href="#组合索引的最左前缀" class="headerlink" title="组合索引的最左前缀"></a>组合索引的最左前缀</h3><p>大概理解一下，这个图示不是很好：</p><p><img src="https://bu.dusays.com/2024/01/25/65b1bce99c548.png" alt="61-40.png"></p><p>简单理解，其实就和结构体排序差不多。例如洛谷 P9472 ：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> LL = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">LL n,m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">mnode</span>&#123;</span><br><span class="line">    LL mcontent;</span><br><span class="line">    LL mindex;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> mnode&amp; v)<span class="type">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mcontent != v.mcontent)</span><br><span class="line">            <span class="keyword">return</span> mcontent &lt; v.mcontent;</span><br><span class="line">        <span class="keyword">else</span>    </span><br><span class="line">            <span class="keyword">if</span>(mcontent &gt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> mindex &lt; v.mindex;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">return</span> mindex &gt; v.mindex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;marray[<span class="number">100010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(LL i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        LL x; </span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;x);</span><br><span class="line">        marray[i].mcontent = x;</span><br><span class="line">        marray[i].mindex = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(marray+<span class="number">1</span>, marray+<span class="number">1</span>+n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(LL i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>,marray[i].mindex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="MySQL-逻辑架构"><a href="#MySQL-逻辑架构" class="headerlink" title="MySQL 逻辑架构"></a>MySQL 逻辑架构</h2><p><img src="https://bu.dusays.com/2024/01/25/65b1c5360f6a2.png" alt="61-41.png"></p><p>Cache : 侧重读<br>Buffer : 侧重写</p><p><img src="https://s2.loli.net/2024/01/25/OPb3sD8hHC1TGXw.png" alt="61-42.png"></p><p>大体来说，MySQL 分为 Server 层和存储引擎层。</p><p>Server 层包括连接器、查询缓存、解析器、优化器和执行器等，涵盖了 MySQL 大多数核心服务功能。</p><p><strong>存储引擎层负责数据的存储和提取</strong>。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。</p><p>MySQL 是如何工作的？</p><ol><li><strong>连接器</strong><br>当你在客户端输入<code>mysql –u $user –p $pwd</code>连接 mysql 的时候，接待你的就是连接器。连接器的作用就是和客户端建立连接、获取权限、维持和管理连接。</li><li><strong>查询缓存</strong><br>建立连接后，就可以执行<code>select</code>语句了。首先 MySQL 会去查看查询缓存，看下之前是否已经执行过这条查询语句。如果命中缓存，就直接返回。否则就扔给解析器。</li><li><strong>解析器</strong><br>MySQL 需要知道你想做什么，因此我们就来到了解析器。解析器会做词法分析和语法分析。词法分析主要是分析每个词的含义，语法分析会判断你写的 SQL 语句是否满足 SQL 语法。</li><li><strong>优化器</strong><br>经过解析器，MySQL 就知道你想做什么了。但是在开始执行之前，还需要经过优化器的处理。优化器会优化你的 SQL 语句。生成最终的执行方案（execution plan）。然后进入执行器阶段。</li><li><strong>执行器</strong><br>执行器首先会判断你对这张表有没有相应的权限。如果没有，就报错。如果有，就调用相应的存储引擎接口，执行语句。然后将结果集返回给客户端。</li></ol><h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>数据的存储和提取是由存储引擎负责的，它负责和文件系统打交道。</p><p>MySQL 的存储引擎是<strong>插件式</strong>的。不同的存储引擎支持不同的特性。</p><p>查看 MySQL 支持哪些存储引擎：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> ENGINES;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"><span class="operator">|</span> Engine             <span class="operator">|</span> Support <span class="operator">|</span> Comment                                                        <span class="operator">|</span> Transactions <span class="operator">|</span> XA   <span class="operator">|</span> Savepoints <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"><span class="operator">|</span> ARCHIVE            <span class="operator">|</span> YES     <span class="operator">|</span> Archive storage engine                                         <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BLACKHOLE          <span class="operator">|</span> YES     <span class="operator">|</span> <span class="operator">/</span>dev<span class="operator">/</span><span class="keyword">null</span> storage engine (anything you write <span class="keyword">to</span> it disappears) <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MRG_MYISAM         <span class="operator">|</span> YES     <span class="operator">|</span> Collection <span class="keyword">of</span> identical MyISAM tables                          <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> FEDERATED          <span class="operator">|</span> <span class="keyword">NO</span>      <span class="operator">|</span> Federated MySQL storage engine                                 <span class="operator">|</span> <span class="keyword">NULL</span>         <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MyISAM             <span class="operator">|</span> YES     <span class="operator">|</span> MyISAM storage engine                                          <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> PERFORMANCE_SCHEMA <span class="operator">|</span> YES     <span class="operator">|</span> Performance Schema                                             <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> InnoDB             <span class="operator">|</span> <span class="keyword">DEFAULT</span> <span class="operator">|</span> Supports transactions, <span class="type">row</span><span class="operator">-</span>level locking, <span class="keyword">and</span> <span class="keyword">foreign</span> keys     <span class="operator">|</span> YES          <span class="operator">|</span> YES  <span class="operator">|</span> YES        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MEMORY             <span class="operator">|</span> YES     <span class="operator">|</span> Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary tables      <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CSV                <span class="operator">|</span> YES     <span class="operator">|</span> CSV storage engine                                             <span class="operator">|</span> <span class="keyword">NO</span>           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> <span class="keyword">NO</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>查看默认存储引擎：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%storage_engine%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> default_storage_engine          <span class="operator">|</span> InnoDB    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> default_tmp_storage_engine      <span class="operator">|</span> InnoDB    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> disabled_storage_engines        <span class="operator">|</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> internal_tmp_mem_storage_engine <span class="operator">|</span> TempTable <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+-----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><p>MyISAM（MySQL5.5 之前的默认存储引擎）：</p><ul><li><strong>支持表锁</strong></li><li>支持全文索引（正排索引、倒排索引）</li><li><strong>不支持事务</strong></li></ul><p>使用 MyISAM 存储表，会生成三个文件：</p><ol><li><code>.frm</code> 存储表结构，是任何存储引擎都有的</li><li><code>.myd</code> 存放数据</li><li><code>.myi</code> 存放索引</li></ol><p>索引和数据分开存放，这样的索引叫<strong>非聚集索引</strong>。</p><p>InnoDB（MySQL5.5 及之后版本默认的存储引擎。没有特殊应用，推荐使用 InnoDB 引擎）：</p><ol><li><strong>支持事务</strong></li><li>支持<strong>行锁和表锁</strong>（默认支持行锁）</li><li>支持 MVCC（多版本并发控制），原理类似于事务的编号</li><li>支持崩溃恢复</li><li>支持外键一致性约束</li></ol><p>使用 InnoDB 存储表，会生成两个文件：</p><ol><li><code>.frm</code> 存储表结构，是任何存储引擎都有的</li><li><code>.ibd</code> 存放数据和索引</li></ol><p>索引和数据存放在一起，这样的索引叫<strong>聚集索引</strong>。</p><p>看看：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ sudo -i</span><br><span class="line">[sudo] password <span class="keyword">for</span> wanko: </span><br><span class="line">root@wanko:~<span class="comment"># cd /var/lib/mysql/</span></span><br><span class="line">root@wanko:/var/lib/mysql<span class="comment"># ls -a</span></span><br><span class="line"> .               binlog.000024   binlog.000051   binlog.000078</span><br><span class="line"> ..              binlog.000025   binlog.000052   binlog.000079</span><br><span class="line"> akashi          binlog.000026   binlog.000053   binlog.index</span><br><span class="line"> auto.cnf        binlog.000027   binlog.000054   ca-key.pem</span><br><span class="line"> binlog.000001   binlog.000028   binlog.000055   ca.pem</span><br><span class="line"> binlog.000002   binlog.000029   binlog.000056   client-cert.pem</span><br><span class="line"> binlog.000003   binlog.000030   binlog.000057   client-key.pem</span><br><span class="line"> binlog.000004   binlog.000031   binlog.000058   debian-5.7.flag</span><br><span class="line"> binlog.000005   binlog.000032   binlog.000059  <span class="string">&#x27;#ib_16384_0.dblwr&#x27;</span></span><br><span class="line"> binlog.000006   binlog.000033   binlog.000060  <span class="string">&#x27;#ib_16384_1.dblwr&#x27;</span></span><br><span class="line"> binlog.000007   binlog.000034   binlog.000061   ib_buffer_pool</span><br><span class="line"> binlog.000008   binlog.000035   binlog.000062   ibdata1</span><br><span class="line"> binlog.000009   binlog.000036   binlog.000063   ibtmp1</span><br><span class="line"> binlog.000010   binlog.000037   binlog.000064  <span class="string">&#x27;#innodb_redo&#x27;</span></span><br><span class="line"> binlog.000011   binlog.000038   binlog.000065  <span class="string">&#x27;#innodb_temp&#x27;</span></span><br><span class="line"> binlog.000012   binlog.000039   binlog.000066   mysql</span><br><span class="line"> binlog.000013   binlog.000040   binlog.000067   mysql.ibd</span><br><span class="line"> binlog.000014   binlog.000041   binlog.000068   performance_schema</span><br><span class="line"> binlog.000015   binlog.000042   binlog.000069   private_key.pem</span><br><span class="line"> binlog.000016   binlog.000043   binlog.000070   public_key.pem</span><br><span class="line"> binlog.000017   binlog.000044   binlog.000071   server-cert.pem</span><br><span class="line"> binlog.000018   binlog.000045   binlog.000072   server-key.pem</span><br><span class="line"> binlog.000019   binlog.000046   binlog.000073   sys</span><br><span class="line"> binlog.000020   binlog.000047   binlog.000074   undo_001</span><br><span class="line"> binlog.000021   binlog.000048   binlog.000075   undo_002</span><br><span class="line"> binlog.000022   binlog.000049   binlog.000076   wanko.pid</span><br><span class="line"> binlog.000023   binlog.000050   binlog.000077</span><br><span class="line">root@wanko:/var/lib/mysql<span class="comment"># cd akashi</span></span><br><span class="line">root@wanko:/var/lib/mysql/akashi<span class="comment"># ls -a</span></span><br><span class="line">.             customer_tmp.ibd       order_table.ibd      test2.ibd  test5.ibd</span><br><span class="line">..            customer_tmp_like.ibd  order_table_tmp.ibd  test3.ibd</span><br><span class="line">customer.ibd  member.ibd             test1.ibd            test4.ibd</span><br><span class="line">root@wanko:/var/lib/mysql/akashi<span class="comment"># file test1.ibd </span></span><br><span class="line">test1.ibd: OpenPGP Secret Key</span><br><span class="line">root@wanko:/var/lib/mysql/akashi<span class="comment"># file member.ibd </span></span><br><span class="line">member.ibd: data</span><br></pre></td></tr></table></figure><p>Memory 引擎特点：</p><ol><li>数据都存放在<strong>内存</strong>中，因此数据库重启后会丢失</li><li>支持表锁</li><li>支持 Hash 和 BTree 索引</li><li>不支持 Blob（大的二进制）和 Text（大的文本）字段</li></ol><p>Memory 引擎数据都放在内存中，支持 Hash 索引，因此它的查询速度最快。</p><p>一般使用 Memory 存放临时表。</p><p>临时表：在单个连接中可见，当连接断开时，临时表也将不复存在。</p><p><strong>临时表</strong>的创建：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp_like <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> temporary <span class="keyword">table</span> test1(id <span class="type">int</span>, age <span class="type">int</span>, name <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp_like <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span> <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> test1 <span class="operator">|</span> <span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> `test1` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>临时表创建完成后，默认的引擎还是 InnoDB ，但是<code>show tables</code>看不到表的名字。还可以进行插入、更新、删除、查找：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> test1 <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">20</span>, <span class="string">&#x27;hajimi&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> age  <span class="operator">|</span> name   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> hajimi <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>创建<strong>存储引擎是 memory</strong> 的表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test3(id <span class="type">int</span>, age <span class="type">int</span>, name <span class="type">varchar</span>(<span class="number">20</span>)) ENGINE <span class="operator">=</span> memory;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp_like <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> test3             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> test3;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Table</span> <span class="operator">|</span> <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> test3 <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test3` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>MEMORY <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>存储引擎是 memory 的表创建之后，可以进行正常的 SQL 语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> test3 <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">20</span>, <span class="string">&#x27;newbrush&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test3;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> age  <span class="operator">|</span> name     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">20</span> <span class="operator">|</span> newbrush <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>现在，直接关闭 terminal. 然后重启：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_akashi  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_tmp_like <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">member</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_table_tmp   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> test3             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1;</span><br><span class="line">ERROR <span class="number">1146</span> (<span class="number">42</span>S02): <span class="keyword">Table</span> <span class="string">&#x27;akashi.test1&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; show create table test3;</span></span><br><span class="line"><span class="string">+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="string">| Table | Create Table                                                                                                                                                                   |</span></span><br><span class="line"><span class="string">+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="string">| test3 | CREATE TABLE `test3` (</span></span><br><span class="line"><span class="string">  `id` int DEFAULT NULL,</span></span><br><span class="line"><span class="string">  `age` int DEFAULT NULL,</span></span><br><span class="line"><span class="string">  `name` varchar(20) DEFAULT NULL</span></span><br><span class="line"><span class="string">) ENGINE=MEMORY DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |</span></span><br><span class="line"><span class="string">+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="string">1 row in set (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select * from test3;</span></span><br><span class="line"><span class="string">+------+------+----------+</span></span><br><span class="line"><span class="string">| id   | age  | name     |</span></span><br><span class="line"><span class="string">+------+------+----------+</span></span><br><span class="line"><span class="string">|    1 |   20 | newbrush |</span></span><br><span class="line"><span class="string">+------+------+----------+</span></span><br><span class="line"><span class="string">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure><p>即：将会话关闭，存储引擎是 memory 的表，表及数据不会消失；但断电重启之后，表的结构还在，内容消失。</p><h2 id="MySQL-锁机制"><a href="#MySQL-锁机制" class="headerlink" title="MySQL 锁机制"></a>MySQL 锁机制</h2><p>原理可参考操作系统笔记中的 PV 操作。</p><h3 id="锁的分类"><a href="#锁的分类" class="headerlink" title="锁的分类"></a>锁的分类</h3><p>锁是计算机协调多个进程或线程并发访问某一资源的机制。</p><p>MySQL 中不同的存储引擎支持不同的锁机制：</p><ul><li>MyISAM 和 MEMORY 存储引擎采用表级锁（table-level locking）</li><li>BDB 存储引擎采用页面锁（page-level locking），但也支持表级锁</li><li>InnoDB 存储引擎既支持行级锁（row-level locking），也支持表级锁。默认采用行级锁</li></ul><p>锁的分类，从对数据操作的粒度划分：</p><ul><li>表级锁：加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。</li><li>行级锁：加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。</li></ul><p>锁的分类，从对数据操作的类型划分：</p><ul><li>读锁（共享锁）：同一份数据，多个读操作可以同时进行而互不影响。</li><li>写锁（排它锁）：当前操作没有完成之前，它会阻断其他读锁和写锁。</li></ul><h3 id="MyISAM-的表锁"><a href="#MyISAM-的表锁" class="headerlink" title="MyISAM 的表锁"></a>MyISAM 的表锁</h3><p>加锁：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lock <span class="keyword">table</span> 表名 read;   # 加读锁</span><br><span class="line"></span><br><span class="line">lock <span class="keyword">table</span> 表名 write;  # 加写锁</span><br></pre></td></tr></table></figure><p>MyISAM 在执行查询语句<code>SELECT</code>前，会自动给涉及的所有表加读锁；在执行更新操作<code>UPDATE</code>、<code>DELETE</code>、<code>INSERT</code>等前，会自动给涉及的表加写锁。这个过程不需要用户干预，因此，用户一般不需要直接用<code>LOCK TABLE</code>命令给 MyISAM 表显式加锁。</p><p>解锁：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure><p>查看加锁的表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">open</span> tables;</span><br></pre></td></tr></table></figure><p>MyISAM 的表锁分为读锁（共享锁）和写锁（独占锁）。</p><p>给表加上读锁（写锁）有什么效果？</p><p>读锁（共享锁）：</p><ol><li>加了读锁的进程可以读加读锁的表，但不能读其他表。</li><li>加读锁的进程不能对这张表做写操作    。</li><li>其他进程可以读加读锁的表（因为是共享锁），也可以读其他表。</li><li>其他进程<code>update</code>加读锁的表会一直处于等待锁的状态，直到锁被释放后才会<code>update</code>成功。</li></ol><p>写锁（独占锁）：</p><ol><li>加锁进程可以对加锁的表做任何操作。</li><li>其他进程不能查询加锁的表，需等待锁释放。</li></ol><p>总结：<br>读锁阻塞写，但不堵塞读。写锁阻塞读和写。</p><h3 id="InnoDB-的行锁"><a href="#InnoDB-的行锁" class="headerlink" title="InnoDB 的行锁"></a>InnoDB 的行锁</h3><p>行级锁在 Mysql 中锁定粒度最细，能大大减少数据库的操作冲突。</p><p>用法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;  # 读锁</span><br></pre></td></tr></table></figure><p>在查询语句后加<code>LOCK IN SHARE MODE</code>，Mysql 会对查询结果中的每行都加共享锁，当没有其他线程对查询结果集中的任何一行使用排他锁时，成功申请共享锁，否则被阻塞。其他线程可以读上了共享锁的表，且这些线程读的数据为同一版本。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;         # 写锁</span><br></pre></td></tr></table></figure><p>在查询语句后加<code>FOR UPDATE</code>，Mysql 会对查询结果中的每行都加排他锁，当没有其他线程对查询结果集中的任何一行使用排他锁时，成功申请排他锁，否则被阻塞。</p><center><p style="color: red";>- - - - - 演示 - - - - - </p></center><p>演示的时候，需使用事务。</p><p>terminal 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 2 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span> lock <span class="keyword">in</span> share mode;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 2 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>后略。</p><center><p style="color: red";>- - - - - 演示 END - - - - -</p></center><h3 id="InnoDB-的表锁"><a href="#InnoDB-的表锁" class="headerlink" title="InnoDB 的表锁"></a>InnoDB 的表锁</h3><p>InnoDB 还有两个表锁：</p><ul><li>意向共享锁（IS）：表示事务准备给数据行上共享锁，即一个数据行上共享锁前必须先取得该表的 IS锁。</li><li>意向排他锁（IX）：表示事务准备给数据行上排他锁，即一个数据行上排他锁前必须先取得该表的 IX锁。</li></ul><p>意向锁由 InnoDB 自动添加，不需用户干预。</p><h3 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h3><p>terminal 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Natasha  <span class="operator">|</span>   <span class="number">30</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> xiaoai   <span class="operator">|</span>   <span class="number">24</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> xiaomei  <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine   <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo   <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai       <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> zhuangzi <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> laozi    <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span>  <span class="number">120</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">8</span> <span class="operator">|</span> Kafka    <span class="operator">|</span>   <span class="number">28</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------+------+---------------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 2 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 1 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">4</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">8</span> lock <span class="keyword">in</span> share mode;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> huohuo <span class="operator">|</span>   <span class="number">15</span> <span class="operator">|</span>   <span class="number">71</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7</span> <span class="operator">|</span> ai     <span class="operator">|</span>   <span class="number">40</span> <span class="operator">|</span>   <span class="number">99</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+--------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>terminal 2 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(id, name, age, math) <span class="keyword">values</span>(<span class="number">6</span>, <span class="string">&#x27;silverwolf&#x27;</span>, <span class="number">16</span>, <span class="number">100</span>); </span><br><span class="line">ERROR <span class="number">1205</span> (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure><h2 id="业务设计"><a href="#业务设计" class="headerlink" title="业务设计"></a>业务设计</h2><p>逻辑设计： 范式设计、反范式设计</p><p>物理设计： 命名规范、存储引擎选择、数据类型选择</p><h3 id="范式设计"><a href="#范式设计" class="headerlink" title="范式设计"></a>范式设计</h3><p>为建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。在关系型数据库中这种<strong>规则</strong>就称为范式。要想设计一个结构合理的关系型数据库，必须满足一定的范式。</p><p>第一范式：</p><p><img src="https://bu.dusays.com/2024/01/26/65b3c0b0a0168.png" alt="61-43.png"></p><p>第二范式：</p><p><img src="https://bu.dusays.com/2024/01/26/65b3c23c6974e.jpeg" alt="61-44.jpeg"></p><p>第三范式：</p><p><img src="https://bu.dusays.com/2024/01/26/65b3c25d57721.jpeg" alt="61-45.jpeg"></p><p>范式化设计的优缺点：</p><ul><li>优点：<ol><li>可以尽量减少数据冗余</li><li>范式化的表通常比反范式化的表更小</li><li>范式化的数据库更新起来更快</li></ol></li><li>缺点：<ol><li>范式化的表，在查询的时候经常需要很多<code>join</code>关联,增加查询的代价。</li><li>更难进行索引优化 </li></ol></li></ul><p>完全符合范式化的设计有时并不能得到良好的 SQL 查询性能。</p><h3 id="反范式化设计"><a href="#反范式化设计" class="headerlink" title="反范式化设计"></a>反范式化设计</h3><p>反范式化设计，是出于性能的考虑，适当地违反范式设计的要求。</p><p>反范式化设计允许存在少量冗余，用空间换时间。</p><p>反范式化设计的优缺点：</p><ul><li>优点：<ol><li>可以减少表的关联</li><li>可以更好的进行索引优化</li></ol></li><li>缺点：<ol><li>存在数据冗余及数据维护异常</li><li>修改数据的成本更高</li></ol></li></ul><h3 id="物理设计"><a href="#物理设计" class="headerlink" title="物理设计"></a>物理设计</h3><p>不同的存储引擎有各自的特点，以适应不同的需求。如下图所示：</p><p><img src="https://bu.dusays.com/2024/01/26/65b3c9937a9da.png" alt="61-46.png"></p><p>为表中的字段选择合适的数据类型：</p><ul><li><strong>更小的通常更好</strong></li><li><strong>简单就好</strong><ul><li>简单数据类型的操作通常需要更少的 CPU 周期。比如：整形比字符操作代价更低。</li><li>用 MySQL 内建的类型而不是字符串来存储日期和时间。</li></ul></li><li><strong>尽量避免 NULL</strong><ul><li>可以为 <code>NULL</code> 是列的默认属性，通常情况下最好指定列为<code>NOT NULL</code>，除非真的需要存储 NULL 值。</li><li>如果查询中包含可为 NULL 的列，对 MySQL 来说更难优化，因为可以为 NULL 的列使得索引和值比较都更为复杂。</li><li>可为 NULL 的列会使用更多存储空间，在 MySQL 里需要特殊处理。</li></ul></li></ul><h2 id="索引再探"><a href="#索引再探" class="headerlink" title="索引再探"></a>索引再探</h2><center><p style="color: red";>- - - - - InnoDB - - - - -</p></center><p>InnoDB 以 主键/非主键 创建索引的一些细节：</p><p><img src="https://bu.dusays.com/2024/01/26/65b3d31e8b542.png" alt="61-47.png"></p><p><img src="https://bu.dusays.com/2024/01/26/65b3d31675ca4.png" alt="61-48.png"></p><p>回表：使用辅助索引查询时，若查询的列在辅助索引树上没有，那么就需要通过该条信息对应的主键，在主键索引树上继续查找。即在两个索引树上进行查找，磁盘 IO 增多，查询速度变慢。（尽量避免回表）</p><p>思考下面 SQL 语句的执行过程：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> citizen <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>不需要回表，该数据直接可以找到</span><br><span class="line"><span class="keyword">select</span> id_card <span class="keyword">from</span> citizen <span class="keyword">where</span> id_card <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> citizen <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> citizen <span class="keyword">where</span> id_card <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>; <span class="operator">/</span><span class="operator">/</span>回表</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> citizen <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> citizen <span class="keyword">where</span> id_card <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>; <span class="operator">/</span><span class="operator">/</span>回表</span><br></pre></td></tr></table></figure><p>索引覆盖：使用辅助索引查询时，查询的列在辅助索引树上命中。</p><center><p style="color: red";>- - - - - InnoDB END - - - - -</p></center><p><br></p><center><p style="color: red";>- - - - - MyISAM - - - - -</p></center><p>MyISAM 以 主键/非主键 创建的索引：</p><p><img src="https://bu.dusays.com/2024/01/27/65b3de790e4a9.png" alt="61-49.png"></p><p><img src="https://bu.dusays.com/2024/01/27/65b3de790a2a6.png" alt="61-50.png"></p><center><p style="color: red";>- - - - - MyISAM END - - - - -</p></center><h2 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h2><p>慢查询日志，记录了查询比较慢（执行时间长）的 SQL 语句。所有执行时间超过参数<code>long_query_time</code>的设定阈值的 SQL 语句，会被 mysql 记录。</p><p>优化数据库系统的性能，需要定位分析性能瓶颈。</p><p>慢查询日志有助于优化 SQL 语句。默认情况下，慢查询日志关闭，使用前须开启。若无调优需要，一般不建议启动，因为会带来性能上的影响。</p><p>查看慢查询日志是否启用：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">Show</span> variables <span class="keyword">like</span> &quot;%slow_query_log&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name  <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log <span class="operator">|</span> OFF   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>或者这样查看：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">Show</span> variables <span class="keyword">like</span> &quot;%slow%&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------+-------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name               <span class="operator">|</span> <span class="keyword">Value</span>                         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------+-------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_slow_admin_statements   <span class="operator">|</span> OFF                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_slow_extra              <span class="operator">|</span> OFF                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_slow_replica_statements <span class="operator">|</span> OFF                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_slow_slave_statements   <span class="operator">|</span> OFF                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_launch_time            <span class="operator">|</span> <span class="number">2</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log              <span class="operator">|</span> OFF                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file         <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>wanko<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------+-------------------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>上面的路径可以寻找文件位置。</p><p>启用慢查询日志（只是临时生效，如果要永久生效，必须修改配置文件）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">Set</span> <span class="keyword">global</span> slow_query_log <span class="operator">=</span> <span class="keyword">on</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>查看时间阈值：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%long_query%&quot;;  </span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> long_query_time <span class="operator">|</span> <span class="number">10.000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec) </span><br></pre></td></tr></table></figure><p>调整时间阈值：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">Set</span> <span class="keyword">global</span> long_query_time<span class="operator">=</span><span class="number">0.1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%long_query%&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> long_query_time <span class="operator">|</span> <span class="number">10.000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>发现<code>long_query_time</code>还没变，重启 mysql 再执行：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%long_query%&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> long_query_time <span class="operator">|</span> <span class="number">0.100000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%slow_query_log&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name  <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log <span class="operator">|</span> <span class="keyword">ON</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>查看慢查询 SQL 记录数：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">Show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;%slow_queries&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Slow_queries  <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h2 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h2><h3 id="总揽"><a href="#总揽" class="headerlink" title="总揽"></a>总揽</h3><p><code>EXPLAIN</code>解释 SQL 语句的执行计划，即显示该 SQL 语句是怎么执行的。</p><p><code>DESC</code>命令也可以查看执行计划。</p><p>官方文档： <a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">https://dev.mysql.com/doc/refman/8.0/en/explain-output.html</a></p><p>用法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;explain | DESC | DESCRIBE&#125; + SQL</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> math <span class="operator">|</span> e_date              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> lumine <span class="operator">|</span>   <span class="number">17</span> <span class="operator">|</span>   <span class="number">61</span> <span class="operator">|</span> <span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+------+------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>  <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> <span class="keyword">member</span> <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">11</span> <span class="operator">|</span>    <span class="number">10.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>通过<code>EXPLAIN</code>，可以分析出以下结果：</p><ul><li>表的读取顺序</li><li>数据读取操作的操作类型</li><li>哪些索引可以使用</li><li>哪些索引被实际使用</li><li>表之间的引用</li><li>每张表有多少行被优化器查询</li></ul><p><code>Explain</code>执行计划的输出内容：</p><table>  <tbody>    <tr>      <td><strong>列</strong></td>      <td><strong>含义</strong></td>    </tr>    <tr>      <td>id</td>      <td>执行计划的 id 标志</td>    </tr>    <tr>      <td>select_type</td>      <td>SELECT 的类型</td>    </tr>    <tr>      <td>table</td>      <td>输出记录的表</td>    </tr>    <tr>      <td>partitions</td>      <td>匹配的分区</td>    </tr>    <tr>      <td>type</td>      <td>JOIN的类型</td>    </tr>    <tr>      <td>possible_keys</td>      <td>优化器可能选择的索引</td>    </tr>    <tr>      <td>key</td>      <td>优化器实际选择的索引</td>    </tr>    <tr>      <td>key_len</td>      <td>使用索引的字节长度</td>    </tr>    <tr>      <td>ref</td>      <td>进行比较的索引列</td>    </tr>    <tr>      <td>rows</td>      <td>优化器预估的记录数量</td>    </tr>    <tr>      <td>filtered</td>      <td>根据条件过滤得到的记录的百分比</td>    </tr>    <tr>      <td>extra</td>      <td>额外的显示选项</td>    </tr>  </tbody>  <colgroup>    <col>    <col>  </colgroup></table><h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><p><img src="https://bu.dusays.com/2024/01/28/65b53dad46658.png" alt="61-51.png"></p><p><img src="https://bu.dusays.com/2024/01/28/65b53dad33790.png" alt="61-52.png"></p><p><img src="https://bu.dusays.com/2024/01/28/65b53dad2eee3.png" alt="61-53.png"></p><h3 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h3><p>官方文档： <a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_select_type">https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_select_type</a></p><table>  <tbody>    <tr>      <td><strong>类型</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td>SIMPLE</td>      <td>简单的 select 查询，查询中不包含子查询或者 UNION</td>    </tr>    <tr>      <td>PRIMARY</td>      <td>查询中若包含任何复杂的子部分，最外层查询则被标记为 PRIMARY</td>    </tr>    <tr>      <td>SUBQUERY</td>      <td>在 SELECT 或 WHERE 列表中包含了子查询</td>    </tr>    <tr>      <td>DERIVED</td>      <td>在 FROM 列表中包含的子查询将被标记为 DERIVED，MySQL 会递归执行这些子查询，把结果放在临时表里。</td>    </tr>    <tr>      <td>UNION</td>      <td>若第二个 SELECT 出现在 UNION 之后，则被标记为 UNION；若 UNION 包含在 FROM 子句的子查询中，外层 SELECT 将被标记为 DERIVED</td>    </tr>    <tr>      <td>UNION RESULT</td>      <td>从 UNION 表获取结果的 SELECT</td>    </tr>  </tbody>  <colgroup>    <col>    <col>  </colgroup></table><p><img src="https://bu.dusays.com/2024/01/28/65b632f68bb15.png" alt="61-54.png"></p><p><img src="https://bu.dusays.com/2024/01/28/65b6333ec99e7.png" alt="61-55.png"></p><h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><div class="row"><iframe src="https://drive.google.com/file/d/1nW11NFAyRwTor8qzaa3zxyrz4HanoIX8/preview" style="width:100%; height:550px"></iframe></div><h3 id="possible-keys、key、key-len"><a href="#possible-keys、key、key-len" class="headerlink" title="possible_keys、key、key_len"></a>possible_keys、key、key_len</h3><p>possible_keys：表示查询过程中有可能用到的索引。</p><p>key：实际使用的索引，如果为 NULL ，则没有使用索引。</p><p>key_len：索引字段的最大可能长度。</p><p><img src="https://bu.dusays.com/2024/01/28/65b654d957ffd.png" alt="61-56.png"></p><p><img src="https://bu.dusays.com/2024/01/28/65b654d94ba34.png" alt="61-57.png"></p><p>与组合索引结合的情况：</p><p><img src="https://bu.dusays.com/2024/01/28/65b657e609a04.png" alt="61-58.png"></p><h3 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h3><p>包含不适合在其他列中显示但十分重要的额外信息。</p><table>  <tbody>    <tr>      <td><strong>值</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td>Using filesort（尽量避免）</td>      <td>mysql 会对数据使用一个外部的排序，而不是按照表内的索引顺序读取。MySQL 中无法利用索引完成的排序操作称为“文件排序”。</td>    </tr>    <tr>      <td>Using temporary（尽量避免）</td>      <td>使用临时表。常见于排序 order by 和分组查询 group by.</td>    </tr>    <tr>      <td>USING index（ok）</td>      <td>使用覆盖索引</td>    </tr>    <tr>      <td>Using where</td>      <td>使用 where 过滤</td>    </tr>    <tr>      <td>Using join buffer</td>      <td>使用连接缓存</td>    </tr>    <tr>      <td>Impossible where</td>      <td>where 子句的值总是 false，不能用来获取任何元组</td>    </tr>  </tbody>  <colgroup>    <col>    <col>  </colgroup></table><h2 id="索引失效"><a href="#索引失效" class="headerlink" title="索引失效"></a>索引失效</h2><p>有时虽然建立了索引，但优化器并不会选择索引去查找数据，而是进行全表扫描。</p><p>一，对索引列进行运算：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span>;    <span class="operator">/</span><span class="operator">/</span> ok</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> a <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span>; <span class="operator">/</span><span class="operator">/</span> 不 ok</span><br></pre></td></tr></table></figure><p>二，组合索引中的情况，见上一张图。</p><p>三，使用不等号，会使索引失效：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> c1 <span class="operator">&lt;&gt;</span> <span class="string">&#x27;wuhan&#x27;</span>;</span><br></pre></td></tr></table></figure><p>考虑等价写法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> c1 <span class="operator">&gt;</span> <span class="string">&#x27;wuhan&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> c1 <span class="operator">&lt;</span> <span class="string">&#x27;wuhan&#x27;</span>;</span><br></pre></td></tr></table></figure><p>四，字符串类型加引号，不加导致索引失效：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> citizen <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> citizen <span class="keyword">where</span> name <span class="operator">=</span> <span class="number">123</span>;</span><br></pre></td></tr></table></figure><p>五，其它。</p><h2 id="实践规范"><a href="#实践规范" class="headerlink" title="实践规范"></a>实践规范</h2><p><strong>尽量使用 InnoDB 存储引擎。</strong><br>解读：<br>支持事务、行级锁、并发性能更好、CPU及内存缓存页优化使得资源利用率更高。</p><p><strong>禁止存储大文件或者大照片。</strong><br>解读：<br>为何要让数据库做它不擅长的事情？大文件和照片存储在文件系统，数据库里存 URI 多好。</p><p><strong>控制单表数据量，单表记录控制在千万级。</strong></p><p><strong>平衡范式与冗余，为提高效率可以牺牲范式设计，冗余数据。</strong></p><p><strong>表必须有主键，例如自增主键，推荐使用 UNSIGNED 整数为主键。</strong><br>解读：</p><ul><li>主键递增，数据行写入可以提高插入性能，可以避免 page 分裂，减少表碎片，提升空间和内存的使用；</li><li>主键要选择较短的数据类型，InnoDB 引擎普通索引都会保存主键的值，较短的数据类型可以有效的减少索引的磁盘空间，提高索引的缓存效率。</li></ul><p><strong>必须把字段定义为<code>NOT NULL</code>并且提供默认值。</strong><br>解读：</p><ul><li>null 的列使索引/索引统计/值比较都更加复杂，对 MySQL 来说更难优化；</li><li>null 这种类型 MySQL 内部需要进行特殊处理，增加数据库处理记录的复杂性；同等条件下，表中有较多空字段的时候，数据库的处理性能会降低很多；</li><li>null 值需要更多的存储空，无论是表还是索引中每行中的 null 的列都需要额外的空间来标识；</li><li>对 null 的处理时候，只能采用 is null 或 is not null，而不能采用 =、in、&lt;、&lt;&gt;、!=、not in 这些操作符号。如：where name != ‘shenjian’，如果存在 name 为 null 值的记录，查询结果就不会包含 name 为 null 值的记录。</li></ul><p><strong>禁止使用<code>TEXT</code>、<code>BLOB</code>类型。</strong><br>解读：<br>会浪费更多的磁盘和内存空间，非必要的大量的大字段查询会淘汰掉热数据，导致内存命中率急剧降低，影响数据库性能。</p><p><strong>根据业务区分使用<code>char</code>/<code>varchar</code>。</strong><br>解读：</p><ul><li>字段长度固定，或者长度近似的业务场景，适合使用 char，能够减少碎片，查询性能高；</li><li>字段长度相差较大，或者更新较少的业务场景，适合使用 varchar，能够减少空间。</li></ul><p><strong>单表索引建议控制在 5 个以内。</strong><br>解读：</p><ul><li>互联网高并发业务，太多索引会影响写性能；</li><li>生成执行计划时，如果索引太多，会降低性能，并可能导致 MySQL 选择不到最优索引；</li><li>异常复杂的查询需求，可以选择 ES 等更为适合的方式存储。</li></ul><p><strong>禁止在更新十分频繁、区分度不高的属性上建立索引。</strong><br>解读：</p><ul><li>更新会变更B+树，更新频繁的字段建立索引会大大降低数据库性能；</li><li>【性别】这种区分度不大的属性，建立索引是没有什么意义的，不能有效过滤数据，性能与全表扫描类似。</li></ul><p><strong>建立组合索引，必须把区分度高的字段放在前面。</strong><br>解读：能够更加有效的过滤数据。</p><p><strong>理解组合索引最左前缀原则，避免重复建设索引，如果建立了(a,b,c)，相当于建立了(a), (a,b), (a,b,c) .</strong></p><p><strong>禁止使用<code>SELECT *</code>，只获取必要的字段，需要显示说明列属性。</strong><br>解读：</p><ul><li>读取不需要的列会增加 CPU、IO、内存、网络带宽消耗；</li><li>不能有效的利用覆盖索引；</li><li>使用 SELECT * 容易在增加或者删除字段后出现程序 BUG .</li></ul><p><strong>SQL<code>WHERE</code>条件的顺序不一定需要按照索引的顺序。</strong><br>解读：比如一个联合索引是 name, age，查询的时候 WHERE 条件可以写成 age=10 and name=’张三’。</p><p><img src="https://s2.loli.net/2024/01/29/lZd8UVxG19vXHnI.jpg"></p><p><img src="https://bu.dusays.com/2024/01/29/65b7ade073490.png" alt="61-59.png"></p><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><div class="row"><iframe src="https://drive.google.com/file/d/1SsTDWzQC8p8lnqkvTzLeqlLHD2jcJl6W/preview" style="width:100%; height:550px"></iframe></div><p>注：上面的 PDF 中 <strong>（四）多主一从</strong> 箭头画反了。</p><p>MySQL 主从复制配置流程：</p><div class="row"><iframe src="https://drive.google.com/file/d/1tvU7DJ8yZDycVRuHtVxvBk8pixB2E4xP/preview" style="width:100%; height:550px"></iframe></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;数据库学习笔记。&lt;/p&gt;
&lt;h2 id=&quot;数据库的概念、分类&quot;&gt;&lt;a href=&quot;#数据库的概念、分类&quot; class=&quot;headerlink&quot; title=&quot;数据库的概念、分类&quot;&gt;&lt;/a&gt;数据库的概念、分类&lt;/h2&gt;&lt;p&gt;数据库的引入：&lt;br&gt;存储数据的结构或方式&lt;/p&gt;
</summary>
      
    
    
    
    <category term="计算机" scheme="https://loveofpeach.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    
    <category term="MySQL" scheme="https://loveofpeach.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>linux 基础</title>
    <link href="https://loveofpeach.github.io/posts/2259c81e.html"/>
    <id>https://loveofpeach.github.io/posts/2259c81e.html</id>
    <published>2024-01-01T11:17:08.000Z</published>
    <updated>2024-01-08T09:43:23.240Z</updated>
    
    <content type="html"><![CDATA[<p>在旧电脑上安装了 Ubuntu ，把 Windows 和其他文件一整个扬了的那种，有一种毁天灭地的美。</p><h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><p>windows 有盘符的概念，如C盘，D盘，E盘等等，但是 Linux 没有盘符的概念。</p><p>Linux 的目录结构：所有的目录都是从根目录<code>/</code>开始。</p><p><img src="https://bu.dusays.com/2024/01/03/65955a1662cc1.png" alt="60-1.png"></p><h2 id="cd、pwd、cat"><a href="#cd、pwd、cat" class="headerlink" title="cd、pwd、cat"></a>cd、pwd、cat</h2><p>查看命令的方式，可以使用 <code>man  命令</code>。</p><p><code>pwd</code>命令：print name of current/working directory, 打印当前目录的名字。</p><p><code>.</code>代表当前目录，<code>..</code>代表上一级目录。</p><p>回到上一次的目录 <code>cd -</code></p><p><code>cat</code>命令：concatenate files and print on the standard output, 查看文件内容。<br>对于读小文件而言，是没有问题的，但是当文件的内容非常多的时候，cat起不到应有的作用。</p><h2 id="useradd、userdel"><a href="#useradd、userdel" class="headerlink" title="useradd、userdel"></a>useradd、userdel</h2><p><strong><code>useradd</code>命令</strong>：create a new user or update default new user information, 添加用户的命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd test3  //创建的用户属于三无产品，没有密码，在/home目录下面没有对应的文件夹，shell不一样</span><br><span class="line"></span><br><span class="line">sudo  useradd -m  test4  -s /bin/bash  //-m指定了在/home目录创建对应文件夹 -s指定shell类型</span><br><span class="line"></span><br><span class="line">//给test4创建密码</span><br><span class="line">sudo passwd test4</span><br><span class="line"></span><br><span class="line">//账号切换的命令</span><br><span class="line">su  test4  #su + 账号名字</span><br><span class="line"></span><br><span class="line">用户切换的时候，展现出来的就是一个栈结构，先进后出。</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/ibk055Ku4LIBxz" alt="60-2"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wangdao@wangdao:~$ cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">.....</span><br><span class="line">gdm:x:121:125:Gnome Display Manager:/var/lib/gdm3:/bin/false</span><br><span class="line">wangdao:x:1000:1000:wangdao,,,:/home/wangdao:/bin/bash</span><br><span class="line">sshd:x:122:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:123:127:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">test:x:1001:1001::/home/test:/bin/bash</span><br><span class="line">test2:x:1002:1002::/home/test2:/bin/sh</span><br><span class="line">test3:x:1003:1003::/home/test3:/bin/sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wangdao:x:1000:1000:wangdao,,,:/home/wangdao:/bin/bash</span><br><span class="line">test3:x:1003:1003::/home/test3:/bin/sh</span><br><span class="line"></span><br><span class="line">冒号是分隔符</span><br><span class="line">用户名  密码（x替代）  uid（用户id） gid（group id，组id）  用户对应的绝对路径  shell类型</span><br><span class="line">0  root    用户</span><br><span class="line">1~1000     系统用户</span><br><span class="line">1000之后    普通用户</span><br></pre></td></tr></table></figure><p><strong>注意：为了保证系统的安全性，不允许root用户直接进行登录。（root用户都是有的，因此知道账号）</strong></p><p><code>userdel</code>命令：delete a user account and related files, 删除用户以及用户所对应的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//-r选项可以删除用户以及用户对应的在/home下的文件夹，如果不加-r,就只会在/etc/passwd下面删除账号，不会删除/home的文件夹</span><br><span class="line">wangdao@wangdao:~$ sudo userdel test5 -r</span><br><span class="line">userdel: test5 mail spool (/var/mail/test5) not found</span><br></pre></td></tr></table></figure><h2 id="目录的创建与删除、tree"><a href="#目录的创建与删除、tree" class="headerlink" title="目录的创建与删除、tree"></a>目录的创建与删除、tree</h2><p><code>mkdir</code>命令：make directories, 创建文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir 20221230   //创建目录</span><br><span class="line">mkdir -p dir3/dir4/dir5 //创建多级目录可以加上-p,或者可以一级一级的创建</span><br></pre></td></tr></table></figure><p><code>rmdir</code>命令：remove empty directories, 删除空目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//如果目录不是空的，可以先进到内层目录，然后一级一级空目录的进行删除</span><br><span class="line">rmdir  dir1  //是空目录就可以直接删除</span><br><span class="line">rmdir dir1  //如果dir1里面还有目录就需要先进去，在一级一级删除</span><br></pre></td></tr></table></figure><p><code>tree</code>命令：打印目录的结构（安装与使用）：</p><p><img src="https://bu.dusays.com/2024/01/04/6596b357ca76a.png" alt="60-3.png"></p><h2 id="文件的创建"><a href="#文件的创建" class="headerlink" title="文件的创建"></a>文件的创建</h2><p>文件的创建命令：<code>touch</code>、<code>echo</code>、<code>cat</code>、<code>vi</code>/<code>vim</code></p><p><code>touch</code>：change file timestamps 改变时间戳（1970.1.1 0:0:0） ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch file   //可以创建空文件</span><br></pre></td></tr></table></figure><p><code>echo</code>: display a line of text 回音命令</p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/MNXtX4NQmRpA6b" alt="60-4"></p><p>创建空文件：</p><p><img src="https://bu.dusays.com/2024/01/04/6596b7e12daa9.png" alt="60-5.png"></p><p><code>cat</code>：使用 ctrl+d 进行正常退出，ctrl+c 异常退出（中断）。</p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/DBuJtpAiIH_Dfz" alt="60-6"></p><p><code>vi</code>/<code>vim</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim file4  //执行以下步骤，键盘左上角Esc，再按shift + :,再输入wq，再按enter</span><br></pre></td></tr></table></figure><h2 id="文件内容的查看"><a href="#文件内容的查看" class="headerlink" title="文件内容的查看"></a>文件内容的查看</h2><p><code>cat</code>、<code>head</code>、<code>tail</code>、<code>more</code>、<code>less</code></p><ul><li>head - output the first part of files 查看文件的前面一部分内容</li><li>tail - output the last part of files 查看文件的尾部内容</li><li>more - file perusal filter for crt viewing 查看文件里面的内容，可以一行行的查阅。</li><li>less - opposite of more</li></ul><h2 id="文件的拷贝、移动、删除"><a href="#文件的拷贝、移动、删除" class="headerlink" title="文件的拷贝、移动、删除"></a>文件的拷贝、移动、删除</h2><p><code>cp</code> - copy files and directories 拷贝文件或者文件夹（目录）</p><p>普通文件的拷贝：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp  srcFile  destFile  //cp  源文件   目的文件</span><br><span class="line">cp file1  file2   </span><br><span class="line"></span><br><span class="line">//源文件与目的文件都存在的时候，最好加上-i选项，</span><br><span class="line">//可以进行提示，以免误操作（安全性的问题）</span><br><span class="line">cp -i file1  file2</span><br></pre></td></tr></table></figure><p>普通文件拷贝给目录文件:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp  file  dir</span><br><span class="line"></span><br><span class="line">如果dir中有file文件，就会直接覆盖；</span><br><span class="line">如果dir中没有file文件，就会创建一个file文件；</span><br><span class="line">如果dir中的file与源文件file的内容不一样，最好还是继续加上-i选项。</span><br></pre></td></tr></table></figure><p>目录拷贝给目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp  -r  dir1  dir2  // -r 表明这个拷贝过程是递归的</span><br></pre></td></tr></table></figure><p><code>mv</code> - move (rename) files</p><p>可以移动普通文件，也可以移动目录文件。<br>“文件”是泛指。在 Linux 中，一切皆文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv  源文件  目的文件   </span><br><span class="line">// mv进行移动的时候，源文件会被删除</span><br><span class="line">// mv也有常用的 -i -f 选项</span><br></pre></td></tr></table></figure><p><code>rm</code> - remove files or directories</p><p>删除普通文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm  file</span><br></pre></td></tr></table></figure><p>删除目录文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm  -fr dir</span><br><span class="line">//-f 是强制的意思，-r 是递归的意思</span><br></pre></td></tr></table></figure><p>删除所有的文件（普通文件、目录文件）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -fr  *</span><br><span class="line">//*星号是一个通配符，代表的是所有类型的文件，包括普通文件、目录文件</span><br></pre></td></tr></table></figure><p><strong>注意：<code>rm</code>命令在使用的时候，最好加上<code>-i</code>，可以起提示作用。</strong></p><h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p><code>-a</code>选项，显示文件夹下面的所有文件，包括隐藏文件。在 Linux 中，以<code>.</code>开头的文件是隐藏文件。</p><p><code>-l</code>选项，显示文件夹下的文件的具体信息。</p><p><code>-h</code>选项，将文件大小换算成人类可读的。</p><p><img src="https://bu.dusays.com/2024/01/05/6596f0ef830c7.png" alt="60-7.png"></p><p><code>-i</code>选项，将文件对应的结点号展示出来。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drwxrwxr-x 3 wangdao wangdao 4.0K 12月 31 10:58 .</span><br><span class="line">drwxrwxr-x 4 wangdao wangdao 4.0K 12月 30 21:13 ..</span><br><span class="line">drwxrwxr-x 2 wangdao wangdao 4.0K 12月 31 10:54 dir1</span><br><span class="line">-rw-rw-r-- 1 wangdao wangdao   12 12月 31 09:00 file</span><br><span class="line">-rw-rw-r-- 1 wangdao wangdao   12 12月 31 11:05 file2</span><br><span class="line">-rw-rw-r-- 1 wangdao wangdao    0 12月 31 10:58 .file3</span><br><span class="line">-rw-rw-r-- 1 wangdao wangdao 4.2M 12月 30 21:17 The_Holy_Bible.txt</span><br><span class="line"></span><br><span class="line">/*----------------------</span><br><span class="line">d rwx rwx r-x</span><br><span class="line">- rw- rw- r--</span><br><span class="line">第一列代表的是文件类型  d目录文件  -普通文件 等等</span><br><span class="line">r  读</span><br><span class="line">w  写</span><br><span class="line">x  可执行</span><br><span class="line">本用户   组用户   其他用户</span><br><span class="line">-----------------------*/</span><br></pre></td></tr></table></figure><h2 id="硬链接与软链接"><a href="#硬链接与软链接" class="headerlink" title="硬链接与软链接"></a>硬链接与软链接</h2><p><code>ln</code> - make links between files</p><p>硬链接的创建：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln  源文件   目的文件</span><br><span class="line">//源文件是已经存在的文件，目的文件是新创建的</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/y_eIKVhcPZco3N" alt="60-8" title="注意file和file5的 inode 号"></p><p>创建硬链接之后，相当于多创建了一个指向文件的指针。硬链接文件的 inode 号是一样的。修改任何一个文件，都会导致文件的内容发生改变。</p><p>软链接的创建：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s  源文件  目的文件</span><br></pre></td></tr></table></figure><p>创建软链接之后，相当于对源文件创建了一个快捷方式，源文件与目的文件 inode 号不一样。删除源文件则快捷方式会失效，但删除软链接文件，源文件不受影响。</p><h2 id="chmod、umask"><a href="#chmod、umask" class="headerlink" title="chmod、umask"></a>chmod、umask</h2><p><code>chmod</code> - change file mode bits 改变文件的访问权限</p><p><img src="https://bu.dusays.com/2024/01/05/6597b7259ebac.png" alt="60-9.png"></p><p>文字设定法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u代表本用户   g代表组用户  o代表其他用户  a代表所有用户</span><br><span class="line">权限：r读权限   w写权限  x执行权限  -代表没有权限</span><br><span class="line">权限的增删  +代表增加权限   -代表去掉权限  =代表赋予某种权限</span><br><span class="line">chmod  u=r,g+r,o=x file7</span><br></pre></td></tr></table></figure><p>例子：</p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/1eiYdFfQ0lFSfW" alt="60-10"></p><p>数字设定法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 以下为注释</span><br><span class="line">rwx rwx r-x</span><br><span class="line">111 111 101</span><br><span class="line">7   7   5</span><br><span class="line">2^2 + 2^1 + 2^0 = 7</span><br><span class="line">r = 4</span><br><span class="line">w = 2</span><br><span class="line">x = 1</span><br><span class="line">- = 0</span><br><span class="line">普通文件的权限一般就是664 rw-rw-r--</span><br></pre></td></tr></table></figure><p>用法示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[asdf@www.masswerk.at:2]$ pwd</span><br><span class="line">/home/asdf</span><br><span class="line">[asdf@www.masswerk.at:2]$ echo &quot;hello&quot; &gt; file1</span><br><span class="line">[asdf@www.masswerk.at:2]$ ls</span><br><span class="line">file1</span><br><span class="line">[asdf@www.masswerk.at:2]$ cat file1</span><br><span class="line">hello</span><br><span class="line">[asdf@www.masswerk.at:2]$ ll file1</span><br><span class="line">-rw-r-----  1  asdf      users            5  2024/01/05 23:12:07  file1</span><br><span class="line">[asdf@www.masswerk.at:2]$ chmod 775 file1</span><br><span class="line">[asdf@www.masswerk.at:2]$ ll file1</span><br><span class="line">-rwxrwxr-x  1  asdf      users            5  2024/01/05 23:12:07  file1</span><br></pre></td></tr></table></figure><blockquote><p>以下关于 umask 的内容转载自 <a href="https://www.coorw.com/3210.html">https://www.coorw.com/3210.html</a></p></blockquote><p>在 linux 系统中，我们创建一个新的文件或者目录的时候，这些新的文件或目录都会有默认的访问权限，umask命令与文件和目录的默认访问权限有关。</p><p><code>umask</code>为 Shell 内建命令，用于设置创建文件时的权限掩码。权限掩码由 3 个八进制数字组成，将 777（八进制）减掉权限掩码后，即可得到新建文件的默认权限。</p><p>命令格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umask [-p] [-S] [MODE]</span><br></pre></td></tr></table></figure><p>后不跟任何选项与参数单独执行 <code>umask</code>，则以八进制格式显示当前权限掩码。</p><p>选项说明：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-p [MODE]</span><br><span class="line">// 以八进制数字形式显示或设置权限掩码。</span><br><span class="line">// 当 MODE 没有提供时，显示当前权限掩码，为默认选项</span><br><span class="line"></span><br><span class="line">-S [MODE]</span><br><span class="line">// 以字符形式显示或设置新建文件的默认权限。</span><br></pre></td></tr></table></figure><p><strong>注意：出于安全的考虑，文件的执行权限不能通过权限掩码来设置，必须手工修改。</strong></p><p>常用示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 设置权限掩码并查看</span><br><span class="line"></span><br><span class="line">#设置权限掩码</span><br><span class="line">umask 044</span><br><span class="line"></span><br><span class="line">#查看权限掩码</span><br><span class="line">umask</span><br><span class="line">044</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 以字符形式显示新建文件的默认权限</span><br><span class="line"></span><br><span class="line">umask -S</span><br><span class="line">u=rwx,g=rx,o=rx</span><br></pre></td></tr></table></figure><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p><code>find</code>命令：查找文件。</p><p><img src="https://bu.dusays.com/2024/01/06/65982ed6a564e.png" alt="60-11.png"></p><p>按照名字进行查找：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find  路径（绝对路径或相对路径） -name  &quot;文件名字&quot;</span><br><span class="line"></span><br><span class="line">文件名字可以使用通配符</span><br><span class="line">* 代表任意个字符</span><br><span class="line">? 代表任意一个字符</span><br><span class="line">[] 代表一个范围，中括号是数字或字母，也可结合使用</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/gly_CGKT07Ma7-" alt="60-12"></p><h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p>重定向输入<code>&lt;</code>，就是 stdin<br>重定向输出<code>&gt;</code>或<code>1&gt;</code>，就是 stdout<br>重定向的错误输出<code>2&gt;</code>，就是 stderr</p><p><img src="https://bu.dusays.com/2024/01/06/65983aa216bc8.png" alt="60-13.png"></p><p><strong>linux 一切皆文件</strong><br>文件句柄（门把手）<br>文件描述符 fd<br>可以将文件描述符看成是操作文件的指针</p><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/0X3oMLu-e6tnRi" alt="60-14"></p><p>追加模式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">标准输出的追加，在原有基础上继续追加。</span><br><span class="line">示例：</span><br><span class="line">echo &quot;Fischl&quot; &gt;&gt; file1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2&gt;&gt;</span><br><span class="line">标准错误的追加</span><br></pre></td></tr></table></figure><p>例外：</p><p><img src="https://bu.dusays.com/2024/01/06/65984077834f3.png" alt="60-15.png"></p><h2 id="grep、正则表达式"><a href="#grep、正则表达式" class="headerlink" title="grep、正则表达式"></a>grep、正则表达式</h2><p>例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ cat file1</span><br><span class="line">spider223man</span><br><span class="line">batman</span><br><span class="line">wanko@wanko:~$ cat file2</span><br><span class="line">super223man</span><br><span class="line">spider223man</span><br><span class="line">wanko@wanko:~$ grep -rn &quot;spider223man&quot; .</span><br><span class="line">./file2:2:spider223man</span><br><span class="line">./file1:1:spider223man</span><br></pre></td></tr></table></figure><p><code>-r</code>递归；<code>-n</code>显示行号。</p><p>正则表达式：</p><p><img src="https://bu.dusays.com/2024/01/07/659ab5e3bba37.png" alt="60-16.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ cat filetst</span><br><span class="line">grep</span><br><span class="line">Grep</span><br><span class="line">sleep</span><br><span class="line">how</span><br><span class="line">what</span><br><span class="line">how are you</span><br><span class="line"></span><br><span class="line">wanko@wanko:~$ grep -nE &quot;e&quot; filetst</span><br><span class="line">1:grep</span><br><span class="line">2:Grep</span><br><span class="line">3:sleep</span><br><span class="line">6:how are you</span><br><span class="line"></span><br><span class="line">wanko@wanko:~$ grep -nE &quot;ee&quot; filetst</span><br><span class="line">3:sleep</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ grep -nE &quot;e*&quot; filetst</span><br><span class="line">1:grep</span><br><span class="line">2:Grep</span><br><span class="line">3:sleep</span><br><span class="line">4:how</span><br><span class="line">5:what</span><br><span class="line">6:how are you</span><br><span class="line"></span><br><span class="line">wanko@wanko:~$ grep -nE &quot;ee*&quot; filetst</span><br><span class="line">1:grep</span><br><span class="line">2:Grep</span><br><span class="line">3:sleep</span><br><span class="line">6:how are you</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wanko@wanko:~$ grep -nE &quot;^s&quot; filetst</span><br><span class="line">3:sleep</span><br><span class="line">wanko@wanko:~$ grep -nE &quot;t$&quot; filetst</span><br><span class="line">5:what</span><br></pre></td></tr></table></figure><p><img src="https://sway.cloud.microsoft/s/jSZcrgReU4mecpIB/images/VxkAMR9Wc3msK0" alt="60-17"></p><h2 id="vim-的使用"><a href="#vim-的使用" class="headerlink" title="vim 的使用"></a>vim 的使用</h2><blockquote><p>参考： <a href="https://oi-wiki.org/tools/editor/vim/">https://oi-wiki.org/tools/editor/vim/</a></p></blockquote><h3 id="插入模式-insert"><a href="#插入模式-insert" class="headerlink" title="插入模式 (insert)"></a>插入模式 (insert)</h3><p>从普通模式进到编辑模式：</p><ul><li>小写<code>i</code>，光标前插入</li><li>小写<code>a</code>，光标后插入</li><li>大写<code>I</code>，行首插入</li><li>大写<code>A</code>，行尾插入</li><li>小写<code>o</code>，下一行插入</li><li>大写<code>O</code>，上一行插入</li></ul><h3 id="普通模式-normal"><a href="#普通模式-normal" class="headerlink" title="普通模式 (normal)"></a>普通模式 (normal)</h3><p><code>u</code>是撤销的快捷键，作用是撤销上一次对文本的更改。</p><p><code>x</code>用于删除光标后的一个字符。</p><p><code>dd</code>删除一行。</p><p><code>gg</code>跳转到文本首行。</p><p><code>G</code>跳转到文本尾行。</p><p><code>$</code>移动到行尾，<code>^</code>移动到行首。</p><p><code>yy</code>+<code>p</code>：<code>yy</code>复制光标当前所在行，<code>p</code>将内容粘贴到光标的下一行去。</p><p><code>6</code>+<code>G</code>，跳转到第 6 行。</p><p><code>3</code>+<code>j</code>，向下移动 3 行。</p><p><code>ndG</code>：（<code>n</code>是数字）删除第n行到当前行的内容，左闭右闭。</p><h3 id="命令行模式"><a href="#命令行模式" class="headerlink" title="命令行模式"></a>命令行模式</h3><p><code>/待查单词</code>：<code>n</code>下一个，<code>N</code>上一个。</p><p><code>set nu</code>：显示行号。</p><p><code>s/待查找项/替换项</code>：默认单行第一个匹配项。</p><p><code>s/待查找项/替换项/g</code>：替换一行里所有的匹配项。</p><p><code>num1,num2s/待查找项/替换项/g</code>：将num1到num2（包含）行的匹配项进行替换。</p><ul><li>例子：<code>2,4s/and/kkk/g</code></li></ul><p><code>%s/待查找项/替换项/g</code>：全文替换。</p><h3 id="可视模式-visual"><a href="#可视模式-visual" class="headerlink" title="可视模式 (visual)"></a>可视模式 (visual)</h3><p>按<code>v</code>进入可视模式，多用于选中区域。按 <code>V</code>进入行可视模式，用于选中行。</p><p>按<code>Ctrl</code>+<code>v</code> 或 <code>Ctrl</code>+<code>q</code>进入块可视模式 (visual block)。</p><p>进入块可视模式后，按<code>I</code>或<code>A</code>进入插入模式（相当于 i 和 a），退出插入模式后对本行所做的改动将被应用到选中的每一行同一位置。常用于批量添加注释。</p><h3 id="安装-vimplus"><a href="#安装-vimplus" class="headerlink" title="安装 vimplus"></a>安装 vimplus</h3><p>没什么好说的： <a href="https://github.com/chxuan/vimplus">https://github.com/chxuan/vimplus</a></p><p>字体下载链接： <a href="https://www.nerdfonts.com/font-downloads">https://www.nerdfonts.com/font-downloads</a></p><p>感觉不咋地，最后还是卸了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在旧电脑上安装了 Ubuntu ，把 Windows 和其他文件一整个扬了的那种，有一种毁天灭地的美。&lt;/p&gt;
&lt;h2 id=&quot;文件系统&quot;&gt;&lt;a href=&quot;#文件系统&quot; class=&quot;headerlink&quot; title=&quot;文件系统&quot;&gt;&lt;/a&gt;文件系统&lt;/h2&gt;&lt;p&gt;win</summary>
      
    
    
    
    <category term="计算机" scheme="https://loveofpeach.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    
    <category term="linux" scheme="https://loveofpeach.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>2023 总结</title>
    <link href="https://loveofpeach.github.io/posts/ccc2b0d8.html"/>
    <id>https://loveofpeach.github.io/posts/ccc2b0d8.html</id>
    <published>2023-12-26T05:37:52.000Z</published>
    <updated>2024-01-17T16:11:57.274Z</updated>
    
    <content type="html"><![CDATA[<p>写总结似乎是个人博客圈的时髦，正好考研告一段落，我也得闲回顾这一整年发生的事。记忆确实是重要的东西，因此想要在还能拂去灰尘，将它们擦拭干净的时候记录下来。</p><h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><center><i>你的人生一定会比别人活得麻烦</i></center><center><i>慵懒烦躁的无可救药</i></center><center><i>但那不是因为你有多优秀</i></center><center><i>而是因为你有多软弱</i></center><center><i>你这一辈子都要怀抱着这份软弱活下去</i></center><center><i>但愿你不要把这种麻烦</i></center><center><i>当作自己的生存价值</i></center><p><br></p><p>我还在北京瞎转的时候，总是要挤挤满了人的地铁。地铁上总是座无虚席，抓手也不剩几个，多数人站着只是因为他前后左右的人也是站着的而已。把人的躯干看成秆，脑袋便是穗。这黑色的麦田中，黄底黑字的抓手广告特别惹眼：</p><p><strong>BOSS 直聘 | 站着也能刷 BOSS 直聘了</strong></p><p>这些抓手会一排排地、有序地延伸下去，然后在连接的另一个车厢里拐个弯继续将整个列车串起来。这种景象十分有趣（amusing）：一根巨大的晾衣绳，将整个列车的人都晾了起来，列车起停，人们东倒西歪，就是一阵玄色的麦浪。</p><p>晚上洗完澡后，我一定会经过学校的快递站。这个时候一天的快递件差不多都被取走，员工们会把箱门打开准备明天的工作。</p><p>一排排、一列列、一箱箱的张开不同角度的门。</p><p>这些层层叠叠的形式将一丝诙谐蕴含其中，终于在大学生活快要结束的时候，为我带来了救赎。</p><blockquote><p>痛苦在一颗心中越积越多，就会在晴朗的一天像干草一样燃烧起来，放出一团无比欢乐的烈焰而统统燃尽。</p></blockquote><h2 id="祖母去世"><a href="#祖母去世" class="headerlink" title="祖母去世"></a>祖母去世</h2><p>祖母死了。</p><p>疫情放开后的年初，她在一个狂风大作的凌晨死了，我开车赶过去的时候，床头一个手机开着网易云音乐，已经在放般若波罗蜜多心经了（这玩意似乎不是死人的时候放的），一个有经验的约莫六十岁的男人扯掉她的造瘘袋，手忙脚乱地联系各种各样的人。</p><p>守夜那天晚上，人来之前，我和 F 及他的兄弟也没什么可说的。F 又扯到 M 的事上，当着祖母的面，最后得出结论：“你们要是跟和 M 在一块混的男的接触，就是认贼作父！”</p><p>丧事要到拂晓的时候才开始，在那之前，我睡在楼上的沙发上，试图回忆祖母这个概念。然而我并未与祖母生活过，以前的接触只能算是跟随 F 的探望，因此只能通过身边的人间接地了解。</p><p>M 和婆婆关系并不紧张，至少从我的视角来看是这样，这点似乎和很多家庭不一样。这位婆婆，也就是我的祖母，过的并不轻松。她嫁给了 G ，并给 G 生了三个儿子。G 是识字的，在 C 市尤其是农村，这个年纪的人识字就超过了很多人。有次我在看《水浒》，他凑过脑袋来把书合上看了眼封面，立即煞有介事地说：“少不看水浒…”。G 壮年时断断续续总有疾病缠身，因此很多事情都落在祖母的肩上。据说 G 曾靠着拼爹谋过一个好职位，看生产队的仓库，后来失了火，G 也就丢了这个工作。</p><p>当时 G 的家里穷，只能供一个上学，于是就让 F 去，最后读了个 C 市的二本师范，回到镇上教书。F 的青壮年时代，正是中国经济野蛮生长，遍地机会的时代。F 曾无数次和我吹嘘自己本来可以怎样：如果当初去了南京怎样，如果当时继续给镇上人家盖小二层怎样怎样。</p><p>F 的两个兄弟，其中一个老实巴交，因为不会用滴滴只能打上百块的出租车，最近的爱好是骂蓬佩奥，但幸运的是他的女儿比较厉害，初中的时候考过全县前几名，不过最近似乎厌学辍学中。F 的另一个兄弟 S 属于在深圳能当三和大神的水平，但是还要分出他两个哥哥的金钱和精力。最后 S 也离婚了，抛弃了自己的女儿，极少来往，后来又谈了两个，最近的一个自带女儿，他们的家庭教育也很崇尚威胁恐吓，甚至对外人也毫无自制，S 问 B 和我：“你们两个打一架，谁打的过谁？”，B 自谦地一笑：“那应该是我打的过”。这个没有血缘关系的小妹妹似乎很乐于见到我，喜欢往我身上扑，但是我对她的未来很悲观。某次年关，F 接到 S 的电话，立刻暴怒，厉声呵斥了一通，原来是 S 没钱过年，找 F 借点，挂掉电话后 F 又教训了我一番。</p><p>这些零碎的琐事，祖母都不是局外人。小学的时候，F 有一天晚上回来很晚（或者是没回来？记不清了），M 歇斯底里地怒了，将自己和 F 的照片一撕两半，大吵了一架，并且在电话里向婆婆哭诉。第二天我起来的时候，客厅桌上的玻璃碎了。</p><p>她在最后一年，还拉着我的手说：“去把你妈妈带回来好不好…你去求她，一定有用的…”，她落下泪来，一时没有主张。</p><p>是的，要失读者的望了，祖母并非一个可以向其寻求智慧的人，但情感上也无法苛求她做到更多。</p><p>疫情放开后，G 和祖母先后感染，G 痊愈后先回到家中，而祖母仍在医院。祖母回来之前，G 一直念叨，回来之后，就又回到之前的打骂状态——即使 G 是个瘫痪在床多年一直靠祖母照顾的人。</p><p>F 拒绝让 M 参加葬礼。</p><p>车队敲锣打鼓、惊天动地地出发，祖母的儿子们手执两个白色的纸棍，而孙辈则一红一白，这里的寓意似乎是，孙辈倒也不必过于悲伤，还须保留一点积极的心态。</p><p>火葬场业务繁忙，大概是由于无准备的疫情放开，死人太多的缘故，那阵子做白事的都赚翻了。</p><p>期间，只有两人因祖母的死难过，一个 G ，一个是 S ，怀念她的竟是两个最不肖的。G 瘫在楼上的床上大喊大叫要求见祖母一面，但是显然他的儿子们并不愿将他从二楼搬到一楼见一面祖母。</p><h2 id="最后的大学半年"><a href="#最后的大学半年" class="headerlink" title="最后的大学半年"></a>最后的大学半年</h2><p>新学期，和室友们去爬泰山。某个室友较胖被落在后面，但还是要坚持全程爬上山祈愿，我只好留在后面慢悠悠的走。</p><p>山顶很冷。</p><p>实习和毕业之前已经提过。</p><p>说实话，考研一战的时候我并无上岸的预期，因为当时能不能毕业都是问题。大三下学期，大家的选修课学分已经修满的时候，我大概只修了四五分，此外还有很多必修学分没有补上，另外大四一整年都在重修体育课。这实在是大学摆烂的恶果。</p><p>不过确有两个值得一提的课程，Python 和离散数学。Python 是选修课，离散数学是必修，因为当时有门必修课需要重修，但是课程改革后这门课被毙掉了，只能选一个外系的必修课替代，于是就选了离散数学。两门课的作业都被老师作为了优秀示范。Python 最后是优秀，离散数学最后拿了 80+/100 ，虽然没有预期的 90+ ，但对外系学生似乎也不错了：</p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/-luTUSJGESnTuX" alt="59-1"></p><p>这两门课让我捡起了一点信心，终于下定决心要准备考研了。虽然在之后被证明只是叶公好龙罢了。</p><h2 id="游戏戒退"><a href="#游戏戒退" class="headerlink" title="游戏戒退"></a>游戏戒退</h2><p>大学里摆烂的时候干什么了？主要是碎片化的信息和番剧游戏，另外读了可怜的十几本书大概。</p><p>碎片化信息和碎片化娱乐是注意力杀手，以至于到了后期我甚至无法看一个二十分钟的番剧视频——是的，哪怕是以娱乐为目的的视频，二十分钟集中注意力对我都是痛苦的。</p><p>我意识到需要改变，但必须“徐徐图之”，最后使用番剧和电影代替了碎片化信息的生态位。</p><p>按游玩时间排序，大概是王者荣耀，原神，Minecraft，和平精英，红警，以及和室友玩的战地之类的。王者是大学开始玩的，准备初试的时候还特地上王者号看了一眼邮件《再相见，真好！》，告诉我玩了 3300 个小时，并附 20 铭文碎片。</p><p>一战的时候游戏还没退，真就考研氛围组了，这次无论如何也要退了。</p><p>首先是王者荣耀，退这个坑应该是玩的腻了。虽然大学早期的时候我经常一个人单排，这个要是对匹配算法不服气的话是会上头的。但是后期基本都是和室友一块玩，一个人玩没意思，颇有点“年轻人的电子扑克”的意思，毕业之后自然退坑。</p><p>原神大概是今年四五月退的，退坑的方式比较奇怪。本想着退几天先，但在这没玩的几天里，我感觉自己与那边世界的联系愈发稀少，那里的时间变成一种与我无关的缓慢流动的黏稠物。但同时，主线和重要任务我还是随时可以体验，不去推进就永远在那里，世界好像被冻结封存起来。我就在这样一种破罐子破摔同时又有恃无恐的心态下弃游了。</p><p>Minecraft 的退坑就非常意外了，因为官方启动器出锅，我就退坑了。虽然了解到可以用第三方，例如 HMCL 之类的，但还是趁势退坑了。</p><p>枪战游戏苦手，没有室友带就不玩了，本身也没太大兴致。</p><p>崩铁甚至限时活动都没有，我就每个版本登录领一下十连抽。</p><p>另外还有一个崩坏三，这个主线差不多过了就退坑了。</p><p>如果硬要让我总结在游戏上的得失，其实也没有一个言之凿凿的结论，很难说没有游戏我就会变得更好或是更坏。游戏是转移注意力的方式，让我在思想上没有准备的时候对痛苦麻木一点。</p><h2 id="生日"><a href="#生日" class="headerlink" title="生日"></a>生日</h2><p>M 重组了自己的家庭，我也因此多了一个异父异母的亲妹妹。</p><p>我称她为“领域外的妹妹”，当然，只是我暗自这么称呼的，也许有机会可以征求她的意见。这么叫也许是为了将“异父异母的亲妹妹”这个名号简化的可爱一点。本博客的<a href="https://loveofpeach.github.io/posts/db1a1b2e.html"> 双曲线讲义 </a>其实就是领妹中考前给她写的讲义。</p><p>今年生日的时候，M 打电话让我和他们一家出去吃饭，打开车门的时候，领妹就坐在里面。</p><p>我们之前在我外婆家（可能现在也算是她外婆？）见过一面。她个子不高，留着齐肩短发，白色上衣，那时她正把床当桌子，蹲着写语文题。这就是一张很普通的现代床，中国很多家庭都有这种款式，只不过没有席梦思。外婆家是农村典型的三间两厨，几经装修，很多老物件都丢掉了。比如正屋进门就能看见的，拿着寿桃、额头硕大的寿星像，上面写着繁体的“福如东海水，寿比南山松”，另外其两侧八列（如果没记错的话）长幅挂画，上面大概是春夏秋冬，梅兰竹菊之类的。小时候正屋里面的长桌上还有一款古式的钟，每到正午就会 duang~ 地响几声，这个钟貌似还保存着。长桌的下面有一个小缸，以前每年外婆家都会做点豆瓣酱，我至今还记得自己掀开盖子闻豆瓣酱，回过头来发现外公半裸着上身，一手撑在草席上，一手摇着蒲扇看着我的神情。最后，还有一张中式的床，这张床现在仍在正屋西间使用，上面挂着偏粉色的红色的蚊帐，正对着长了两个角的老式电视机。不过，现在东间有了一个新的电视机。</p><p><img src="https://pic1.zhimg.com/80/v2-e25f3693f89ebf81c97cf1b994085be0_1440w.webp" alt="59-1dot5.webp" title="类似于这种"></p><p>领妹坐在车后座，前面是 M 和她的男人。</p><p>领妹还是留着一样的短发。这次见面，已是她中考结束之后，高中之前军训的日子。领妹是请假出来的，她披着一件雪白的外套，衬着里面墨绿的军训衣，车窗外的阳光照亮她的脖子，胸脯微微隆起形成好看的曲线，她的下身还穿着军训裤，我不记得她是否戴着眼镜。</p><p>沉默。</p><p>我把她放在车上的帽子往她那靠了靠。</p><p>“大学里就能攒一套房了吗？”领妹看了我一下，然后回过去稍微低下头，很认真地疑惑道。</p><p>“怎么可能。”</p><p>此时我并没有和 F 和 B 住在一起。我住在 C 市相对郊区的地方，F 和 B 住在 C 市的某个镇上。否则他们也不能正大光明地开着车来小区带我。</p><p>“那你房子哪来的呀？”</p><p>我稍加思索了一番，房子是 F 和 M 的，将来是留给 B 的，说 F 买的也不好（因为必然会加上称谓），说 M 买的也不好（考虑到领妹），说 F 和 M 一起买的也不合适（考虑到前面的司机）。就和领妹说，家里买的呗。</p><p>大一睡前扯淡的时候，当时还单身的室友表达了强烈的脱单欲望，于是我献计：大伙合起来到鹤岗买个超迷你的房子，然后在校园里找对象的时候就说自己已经买了房，没向家里要钱 balabala… </p><p>“嗯，我还以为大学里就能攒起一套房了呢。我觉得我应该攒不下来。”</p><p>我们还在到处溜达找吃饭的地的时候，M 和她的男人被一个热情的大姐拦下了，于是我们就去吃烤鱼。</p><p>四人桌，M 坐在我的左边，领妹坐在我的对面。我一般不在餐桌上找话题，于是这个艰巨的任务就交给两位社会人士了。</p><p>“你妹说以后人们可能会吃丸子，就沙发上一躺，吃着丸子。”</p><p>“毒品？”</p><p>“不是。就是把各种营养啊，各种味道的肉啊蔬菜之类的东西混在一起做成丸子。以后人们只要吃丸子就好了，很方便，也节省时间。”</p><p>“那不就是狗粮？”</p><p>“哈哈哈。。。确实嗷，那样就和狗粮差不多。”</p><p>我们吃的很慢，中途还因为水不断蒸发汤越来越咸加了几次汤。M 知道我喜欢吃鱼，但不知道唯独烤鱼除外——也许生鱼片也要排除，虽然我没吃过。总之，我们吃完就离开了。自动扶梯上，我和领妹间错一阶站在后面，我们现在一样高了。这时候，我就想，她一定要拿手比划过来，比划我们的身高了。她果然难掩笑意地把手伸过来，从自己的额头处水平地划到我的额头前方，露出小小的得意神情。</p><p>分别的时候，领妹坐在车里，探出视线来朝我摆手：“生日快乐。”</p><p>F 并未记得我的生日。</p><h2 id="二战的准备和失利"><a href="#二战的准备和失利" class="headerlink" title="二战的准备和失利"></a>二战的准备和失利</h2><p>一刻也没有为毕业多愁善感，接下来赶到战场的是——考研二战！</p><p>第一个月无论如何都睡不着，辗转反侧之后还是去医院开了艾司唑仑。这也为最后的失利埋下伏笔。</p><center><table>  <tbody>    <tr>      <td></td>      <td>态度</td>      <td>方法</td>      <td>信息差</td>      <td>知识</td>    </tr>    <tr>      <td>一战</td>      <td>敷衍</td>      <td>无</td>      <td>巨大</td>      <td>没学完</td>    </tr>    <tr>      <td>二战</td>      <td>勉强</td>      <td>有</td>      <td>仍有</td>      <td>充分</td>    </tr>  </tbody>  <colgroup>    <col style="width: 20%;">    <col style="width: 20%;">    <col style="width: 20%;">    <col style="width: 20%;">    <col style="width: 20%;">  </colgroup></table></center><p>自认知识准备还是充分的，李林模拟卷最后130，140的样子，张宇的，超越的卷子，做的结果也都在博客里了。</p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/G89VUf64Z0SQuk" alt="59-2"></p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/UKTo2Tqr5wcxL7" alt="59-3"></p><p>考数学的前一天晚上硬是睡不着觉，或许是几年前信息竞赛的时候被 F 打鼾弄得睡不着觉，留下了心理阴影，吃了 2.5 粒安眠药，平时只吃一颗。睡倒是睡着了，考试的时候晕晕乎乎，出现了很多 2^3=9 这类错误，平时能做出来的题都没有做出来。本来自己也是对自己千叮咛万嘱咐，第一问没做出来有时候不妨碍做第二问，但考场上就是没看。这样下来不知道能有几分。</p><p>专业课按 408 准备的，那么多功夫全白费了，到考前最后一天才发现咸鱼上有卖往年试题的。操作系统部分应该没什么，算法题我按自己的写法，不合题目要求也不知道能拿几分。这里确是输给信息差了。</p><p>政治没法估分，英语应该还是正常水平。</p><p>最后的结局恐怕能捞到一个非全就不错了。</p><p>去自习室的路上有一段路，路面上划了很多线，我骑着自行车路过的时候常常压着这些线玩，想象两边都是悬崖。</p><p>某夜十一点，等滴滴打车的时候，路灯下，十二月的雪洋洋洒洒：我竟从盛夏学到了大雪。</p><h2 id="第一台电脑"><a href="#第一台电脑" class="headerlink" title="第一台电脑"></a>第一台电脑</h2><p>是的，考研后买了我的第一台电脑。之前大学里都是用的 B 的二手电脑。</p><p>虽然不抱希望，还是要准备复试的。旧电脑开机都很卡顿了。</p><p>Redmibook，不到 5k.</p><h2 id="书，影视"><a href="#书，影视" class="headerlink" title="书，影视"></a>书，影视</h2><p>报菜名环节，只说一些能想起来的，不一定全。</p><p>书：</p><center><table>  <tbody>    <tr>      <td>书名</td>      <td>都柏林人</td>      <td>小径分岔的花园</td>      <td>对联趣谈</td>    </tr>  </tbody>  <colgroup>    <col style="width: 18.8889%;">    <col style="width: 23.6667%;">    <col style="width: 32.4444%;">    <col style="width: 25%;">  </colgroup></table></center><p>动漫：</p><center><table>  <tbody>    <tr>      <td>番名</td>      <td>备注</td>      <td>番名</td>      <td>备注</td>    </tr>    <tr>      <td>物语系列全部</td>      <td>按时间顺序二刷</td>      <td>龙与虎</td>      <td>二刷</td>    </tr>    <tr>      <td>名侦探柯南</td>      <td>主线部分</td>      <td>我推的孩子</td>      <td>有马佳奈谢谢</td>    </tr>    <tr>      <td>Spy Family</td>      <td>part2 中间弃之</td>      <td>灰色的果实</td>      <td></td>    </tr>    <tr>      <td>灰色的迷宫</td>      <td></td>      <td>灰色的乐园</td>      <td>打戏燃</td>    </tr>    <tr>      <td>药屋少女的呢喃</td>      <td>穿越到后宫的现代人</td>      <td>夏日重现</td>      <td>剧情节奏优秀</td>    </tr>    <tr>      <td>AI 电子基因</td>      <td>看4集弃了</td>      <td>变态王子与不笑猫</td>      <td>还行</td>    </tr>  </tbody>  <colgroup>    <col>    <col>    <col>    <col>  </colgroup></table></center><p>电影 &amp; 剧：</p><center><table>  <tbody>    <tr>      <td>电影名</td>      <td>备注</td>      <td>电影名</td>      <td>备注</td>    </tr>    <tr>      <td>壳中少女（压缩）</td>      <td>好看</td>      <td>壳中少女（燃烧）</td>      <td>好看</td>    </tr>    <tr>      <td>壳中少女（排气）</td>      <td>好看</td>      <td>末代皇帝</td>      <td>好看</td>    </tr>    <tr>      <td>唐红的恋歌</td>      <td>也就那样</td>      <td>零的执行人</td>      <td>也就那样</td>    </tr>    <tr>      <td>绯色的子弹</td>      <td>也就那样</td>      <td>万圣夜的新娘</td>      <td>也就那样</td>    </tr>    <tr>      <td>黑铁的鱼影</td>      <td>柯哀狂喜</td>      <td>流浪地球</td>      <td>（第二部）</td>    </tr>    <tr>      <td>利兹与青鸟</td>      <td>非常好看</td>      <td>想哭的我戴上<br>了猫的面具</td>      <td>至今已觉不新鲜</td>    </tr>    <tr>      <td>我不是药王</td>      <td>嗯</td>      <td>处女泉</td>      <td></td>    </tr>    <tr>      <td>犬王</td>      <td>银幕上的摇滚</td>      <td>铃芽之旅</td>      <td>一般</td>    </tr>    <tr>      <td>龙猫</td>      <td>挺好</td>      <td>魔女宅急便</td>      <td>好看</td>    </tr>    <tr>      <td>起风了</td>      <td></td>      <td>闪电侠一、二</td>      <td>垃圾</td>    </tr>    <tr>      <td>江户川柯南失踪事件～史上最糟糕的两天～</td>      <td>挺好</td>      <td>盗钥匙的方法</td>      <td>挺好</td>    </tr>    <tr>      <td>美国商业大亨传奇</td>      <td>挺好</td>      <td></td>      <td></td>    </tr>  </tbody>  <colgroup>    <col style="width: 22%;">    <col style="width: 28%;">    <col style="width: 22%;">    <col style="width: 28%;">  </colgroup></table></center><blockquote><p>战场原：阿良良木君还真在处理什么事情，而且这次看来还是相当棘手的。我虽然没有那个时候的经历，但从文字上看，这次应该超过了春假时的程度。<br>羽川翼：果然你也这么想？<br>战场原：嗯，但是呢，从特意发这种信息这一点来看还算有所长进。以前的他可是只会盯着眼前呢。<br>羽川翼：是啊。<br>战场原：不行，电话打不通。不过，他毕竟是男孩子，也不用那么担心。好吧，等他回来看我跟他炫耀和羽川同学一起洗澡的事。<br>羽川翼：这也谈不上有什么效果吧。<br>战场原：就说羽川同学的身体曲线是这样…这里又是这样…如何？<br>羽川翼：不许用手比比划划的！<br>战场原：但这么一来，你遇到的那只虎只能靠我们自己对付了。<br>羽川翼：虎？但是那只虎已经…<br>战场原：嗯，我也曾想过那老虎莫非就是火灾的原因。难道不是？火灾的原因已经调查清楚了么？<br>羽川翼：不，那个还不清楚…<br>战场原：是吗，那可能是我「抢跑」了。</p></blockquote><h2 id="2023-的结束"><a href="#2023-的结束" class="headerlink" title="2023 的结束"></a>2023 的结束</h2><p>高中同学 Z 早上微信发消息出去搓一顿，可惜我作息颠倒，回复时已是下午，此君明日还须上班。</p><p>月底，和领妹一家外去搓了一顿，而后去超市买东西。领妹推着购物车玩很像我之前，加速，再把整个人重心压在推车上。我实在也没什么可买的，最后拿了丹麦的曲奇饼和不二家的棒棒糖，回到住所后也不知道为啥要买这个棒棒糖。</p><p>Well, Let’s call it a year.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;写总结似乎是个人博客圈的时髦，正好考研告一段落，我也得闲回顾这一整年发生的事。记忆确实是重要的东西，因此想要在还能拂去灰尘，将它们擦拭干净的时候记录下来。&lt;/p&gt;
&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;</summary>
      
    
    
    
    <category term="生活" scheme="https://loveofpeach.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>一类问题的新解法</title>
    <link href="https://loveofpeach.github.io/posts/f06381e8.html"/>
    <id>https://loveofpeach.github.io/posts/f06381e8.html</id>
    <published>2023-12-09T15:13:01.000Z</published>
    <updated>2023-12-25T09:07:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>一种考研数学中某类题型的新解法，与其背后的几何意义有关。目前各平台的考研博主中均未见到此类解法。</p><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>若 $f(x)$ 在区间 $[a,b]$ 上连续，则积分上限的函数 $\Phi(x)=\int_{a}^{x} f(x)\, {\rm d}x$ 在 $[a,b]$ 上可导：</p><script type="math/tex; mode=display">\Phi'(x)=\frac{\rm d} { {\rm d}x}\int_a^x f(t){\rm d}t=f(x) \quad (x\in [a,b])</script><p>一般地，若 $f(t)$ 连续，$g(x)$ 和 $h(x)$ 可导，则：</p><script type="math/tex; mode=display">\frac{\rm d} { {\rm d}x}\int_{g(x)}^{h(x)}f(t){\rm d}t=f[h(x)]h'(x)-f[g(x)]g'(x)</script><p>上式可形成几何直观：</p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/_SlyQL8kzBX8PO" alt="58-1"></p><p>这里 $h$ 和 $g$ 可理解为从 $x\rightarrow t$ 的映射。积分变量为 $t$ ，不妨设 $g(x)&lt;h(x)$ ，对 $f(t)$ 从 $g(x)$ 到 $h(x)$ 积分，$\int_{g(x)}^{h(x)}f(t){\rm d}t$ 的几何意义即是上图中的阴影面积。那么 $\frac{ {\rm d} } { {\rm d}x}\int_{g(x)}^{h(x)}f(t){\rm d}t$即是阴影面积对 $x$ 的变化率。为此，我们考察当 $x$ 获得一个很小的增量 $\Delta x$ 时，阴影面积将如何变化：</p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/3uP9q5TP-67ltD" alt="58-2"></p><p>显然，阴影面积的变化为上图中紫色和绿色曲边梯形的面积变化（可正可负）之和。</p><p>当 $x$ 获得增量 $\Delta x$ 时，$h(x)$ 的增量为：</p><script type="math/tex; mode=display">\Delta y=h'(x)\Delta x+o(h'(x)\Delta x)</script><p>当 $\Delta y$ 很小时，绿色曲边梯形的高可用 $f[h(x)]$ 替代。</p><p>因此绿色面积为：</p><script type="math/tex; mode=display">f[h(x)][h'(x)\Delta x+o(h'(x)\Delta x)]</script><p>同理紫色面积为：</p><script type="math/tex; mode=display">f[g(x)][g'(x)\Delta x+o(g'(x)\Delta x)]</script><p>因为 $\int_{g(x)}^{h(x)}f(t){\rm d}t$ 是从 $g(x)$ 积到 $h(x)$ ，所以绿色面积<strong>贡献</strong>为正，紫色为负。当然，也可以从 N-L 公式的角度理解，记 $f(t)$ 原函数为 $F(t)$ ，则 $\int_{g(x)}^{h(x)}f(t){\rm d}t=[F(t)]_{g(x)}^{h(x)}$ ，由此可知紫色前应当加个负号：</p><script type="math/tex; mode=display">\begin{aligned}\Delta \int_{g(x)}^{h(x)}f(t){\rm d}t & = f[h(x)][h'(x)\Delta x+o(h'(x)\Delta x)] \\     & - f[g(x)][g'(x)\Delta x+o(g'(x)\Delta x)] \\\end{aligned}</script><p>对上式两边同除 $\Delta x$ ，再令 $\Delta x \rightarrow 0$ ，即得：</p><script type="math/tex; mode=display">\frac{ {\rm d} } { {\rm d}x}\int_{g(x)}^{h(x)}f(t){\rm d}t=f[h(x)]h'(x)-f[g(x)]g'(x)</script><h2 id="三维情形的拓展"><a href="#三维情形的拓展" class="headerlink" title="三维情形的拓展"></a>三维情形的拓展</h2><p>三维的情形其实我在 <a href="https://loveofpeach.github.io/posts/12839668.html">几何角度下的一个公式</a> 这篇文章中已经介绍了。</p><p>当时是我初学这块内容时，觉得同济书的证明过于吓人，试图从几何角度看看能不能建立直观，于是诞生了上面那篇文章。至于为什么是初学？因为大一疫情的时候在家摆烂，二重积分之后的高数一丁点没听。还好老师捞了一把没有挂高数。</p><h2 id="应试中的应用"><a href="#应试中的应用" class="headerlink" title="应试中的应用"></a>应试中的应用</h2><p>这类题目的特征是，它往往会要你对一个看起来不太能用求导做的积分做一些蜜汁操作。按照上面的思路，我们完全可以霸王硬求导 (′▽`〃)</p><p>是的，这里有一个 <a href="https://yanwenzi.fuhaoku.net/">颜文字网站</a> ，我并不会真的在心里默默地记了很多颜文字：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QAQ</span><br><span class="line">QwQ</span><br><span class="line">qwq</span><br><span class="line">qaq</span><br><span class="line">=_=</span><br><span class="line">:)</span><br></pre></td></tr></table></figure><h3 id="例一"><a href="#例一" class="headerlink" title="例一"></a>例一</h3><p>先来看一道典型例题。你可以在 <a href="https://loveofpeach.github.io/posts/55931ee1.html">数二强化</a> 下的<strong>超越模拟题23</strong> pdf 第四页找到它。</p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/9M8xf1ZlWt9Loz" alt="58-3"></p><p>看到这个形式，很容易想到洛必达：分母是 t 的函数，记为 $f(t)$ ，分子也是 t 的函数。现在的问题是如何对 $f(t)$ 求导：</p><p>让我们循着之前的思路，思考导函数最初的意义，即变化率。将题目中的积分区域画出来，其实就是要求阴影面积对 t 的变化率。</p><p>那么照着之前的推导，就是求被积函数在最外面的曲线上的积分。这提示我们使用曲线积分。</p><p>过程都在上面的图里面了。</p><h3 id="例二"><a href="#例二" class="headerlink" title="例二"></a>例二</h3><p>上面的题型足以应付多数情况了，但是有一种例外！在这种情况下，照搬例一做法会得到错误答案，这是因为例一的积分区域、要求关于哪个变量的变化率天然地满足了一个限制条件。若无此限制条件，做法上还需进行调整才是。</p><p>下面的例子也补充了例一推导中疏漏的一处：</p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/j4VCgle3qV4cr9" alt="58-4"></p><p><img src="https://sway.office.com/s/jSZcrgReU4mecpIB/images/1oe9wwnJ79lmqE" alt="58-5"></p><p>你可以在 <a href="https://loveofpeach.github.io/posts/55931ee1.html">数二强化</a> 下的<strong>李林六24</strong> pdf 第16、17页找到它。</p><p>分析都在图里面了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;一种考研数学中某类题型的新解法，与其背后的几何意义有关。目前各平台的考研博主中均未见到此类解法。&lt;/p&gt;
&lt;h2 id=&quot;引入&quot;&gt;&lt;a href=&quot;#引入&quot; class=&quot;headerlink&quot; title=&quot;引入&quot;&gt;&lt;/a&gt;引入&lt;/h2&gt;&lt;p&gt;若 $f(x)$ 在区间 $</summary>
      
    
    
    
    <category term="数学" scheme="https://loveofpeach.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="考研数学" scheme="https://loveofpeach.github.io/tags/%E8%80%83%E7%A0%94%E6%95%B0%E5%AD%A6/"/>
    
    <category term="高数" scheme="https://loveofpeach.github.io/tags/%E9%AB%98%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>硬盘学习资料</title>
    <link href="https://loveofpeach.github.io/posts/a72e3cc4.html"/>
    <id>https://loveofpeach.github.io/posts/a72e3cc4.html</id>
    <published>2023-11-18T03:45:05.000Z</published>
    <updated>2023-12-09T15:23:40.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>夫藏舟于壑，藏山于泽，谓之固矣，然而夜半有力者负之而走，昧者不知也。</p></blockquote><p>前一阵子，电脑的忽然死机让我有点担心数据的安全。于是买了一块硬盘备份数据，但思来想去，还是大厂商的云端硬盘更为安全。至于 blog 本身资料的备份，也可以设为不公开，保存在云上。</p><p>这里先放一些以前的旧资料，它们一开始是在一块看起来就非常不可靠的 32GB U盘上，现在保存在移动硬盘上。</p><p>虽然这些资料我大多都没看过，不过总会有需要的人吧。</p><p><a href="https://drive.google.com/file/d/1cH2VcvhQzRgvIb0mBKcUVpbXokWIAMDz/view?usp=drive_link">2016冬令营课件.zip</a> ，这里面的 ppt 导出 pdf 会丢失动画效果，因此就直接一整个压缩了：</p><p><img src="https://bu.dusays.com/2023/11/18/655844e283b26.png" alt="57-1（2016冬令营课件）"></p><p>树上 DP ：</p><div class="row"><iframe src="https://drive.google.com/file/d/1aCLi1pQKX97j-ZzU3JapP6E6OUYF56sb/preview" style="width:100%; height:550px"></iframe></div><p>数论选讲：</p><div class="row"><iframe src="https://drive.google.com/file/d/1YAAzJjKKbFpgv5aGyK8atn8OwAOGBJ3w/preview" style="width:100%; height:550px"></iframe></div>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;夫藏舟于壑，藏山于泽，谓之固矣，然而夜半有力者负之而走，昧者不知也。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;前一阵子，电脑的忽然死机让我有点担心数据的安全。于是买了一块硬盘备份数据，但思来想去，还是大厂商的云端硬盘更为安全。至于 blog 本身</summary>
      
    
    
    
    <category term="转载" scheme="https://loveofpeach.github.io/categories/%E8%BD%AC%E8%BD%BD/"/>
    
    
    <category term="动态规划" scheme="https://loveofpeach.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
    <category term="数论" scheme="https://loveofpeach.github.io/tags/%E6%95%B0%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>《龙与虎》短评</title>
    <link href="https://loveofpeach.github.io/posts/79ab37ca.html"/>
    <id>https://loveofpeach.github.io/posts/79ab37ca.html</id>
    <published>2023-10-15T12:17:21.000Z</published>
    <updated>2023-10-28T16:16:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>第一次看《龙与虎》，大约是几年前。最近二刷完，总想写点什么，然而我在写点什么之前又总想看看别人的评论，最后总是以 “我想写的别人都写到了，而且更深、更广” 这样的结局潦草作罢。</p><p>下面是目前我看到的最好的分析文章了：</p><blockquote><p><a href="https://www.zhihu.com/question/23648757/answer/2030795324">怎么评价《龙与虎》这部动画？ - 黑色耳机线的回答 - 知乎</a></p></blockquote><p>还是说点自己的感想吧。也许在 Songbirds 的伴奏下，读者还能勉强对付我用生硬文字拼凑出来的零星思考。</p><html><center><head>    <meta charset="utf-8">    <title></title></head><body>    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="https://music.163.com/outchain/player?type=2&id=554242361&auto=0&height=66"></iframe></body></center></html><p>说到底，情感这种东西最重要的是共同的经历。我们只能遗憾地承认，放眼人海，很难说两个人是天造地设的一对，非君不可，在不同的世界线里（假设），因缘际会，难免目及旁人。</p><p>那么，对彼此特殊的部分也就是两人共同的经历和回忆了，这是别人无法拥有、也无法夺走的优势。</p><p>这也是为什么异地恋难以善终、极具考验——因为你缺席（absent）了。开心无法分享，痛苦独自承担，情感的维系要么是一种自我感动式的催眠、沉溺于一种对另一半的抽象感觉，要么是出于维护在分开之前就已然积累的深厚的共同经历——这已经证明了共同经历的重要性。每天视频电话煲，放下手机的时刻，是否有种欣喜之后的空洞、重又陷入孤独的焦灼和无奈？这个时候如果别人在场，又会如何？遇到困难的时候 TA 会依靠别人吗？阔别许久，是否会有同一性的混乱？这次见面，你又变了一点，下次见面又会变成什么样呢？会变成我不认识的样子吗？明明以前在一起的时候，别人都说你变了，我却不以为然地笑着，你就是你呀。但是分别了这么久，我喜欢的是过去的你，还是现在的你呢？那么我又如何呢？我变了吗，变了很多吗？变到失去你曾经喜欢的我的那些特质了吗？如果是的话，我岂不是一个夺走名字，继承记忆的鸠占鹊巢的冒牌货？</p><p>但尚可安慰的是，从共同经历的重要性出发，我们也算是有一条明路可走：建构意义，创造回忆。必须指出，<em>寂寞无聊是一种由单调引起的东西，生活老是千篇一律，漫长的时间就会缩短做一团</em>，这种缩做一团的时间在计算共同经历的时候权值会显得非常可怜吧？</p><p>以上只是我观察别人的异地恋的一些胡思乱想，一个母胎 solo 的人竟然能乱七八糟、纸上谈兵似的想了这么多关于恋爱方面的事，我不禁哑然失笑。这种在玻璃上描摹他人的行为，并用自己的想象填充细节，多少有点滑稽。</p><p>但是我的理论在《龙与虎》里得到了很好的体现不是吗？<del>虽然用动画来印证显得有点可笑。</del>当高须和大河在教室里被逼着表态的时候，他们再也不能对两人建立起的深厚羁绊视而不见——因为对方已经占据了视线的全部。</p><p>这也是《小王子》想要告诉我们的：</p><blockquote><p>我那朵玫瑰，别人以为她和你们一样，但她单独一朵就胜过你们全部。因为她是我浇灌的。因为她是我放在花罩中的。因为她是我用屏风保护起来的。因为她身上的毛毛虫是我除掉的。因为我倾听过她的哀怨，她的吹噓，有时甚至是她的沉默。因为她是我的玫瑰。</p></blockquote><p>我们不能用一句总结性的话高度概括一部动画，或是一部小说，一个人，那是一种傲慢，并将抹煞全部的故事性。但在这里，还请允许我斗胆一句，大河是在扭曲的家庭中长大，最终得到救赎的孩子。这是很好的故事，但观看结束之后，我如同几年前一样，也如同网上所说的 “看完《龙与虎》之后，人均抑郁一周” 那样，陷入了一种郁郁寡欢的情绪，我知道这是我的软弱，也许我还会像以前那样写下诸如 “我的精神长久地处于今宵酒醒何处的混沌状态，只不过映入眼帘的既不是杨柳岸，也没有晓风和残月” 这种病恹恹到令人发笑的中二句子，但最近几年，我终于明白，无论是否有他人的帮助和陪伴，作出改变的首先必须是自己——至少这次，让这种无谓的情绪快点结束吧。</p><p>我定好明天的机械闹钟，如是想。</p><p>你未来到此处时，此花与吾同归于寂；你来到此处时，则此花颜色一时明白起来。</p><p>什么时候我也能遇到这样的人呢。</p><p><img src="https://ts1.cn.mm.bing.net/th/id/R-C.a322b2a206b49da0811aacf426758b05?rik=dAv0QHifXNRvyQ" alt="56-1"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;第一次看《龙与虎》，大约是几年前。最近二刷完，总想写点什么，然而我在写点什么之前又总想看看别人的评论，最后总是以 “我想写的别人都写到了，而且更深、更广” 这样的结局潦草作罢。&lt;/p&gt;
&lt;p&gt;下面是目前我看到的最好的分析文章了：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a</summary>
      
    
    
    
    <category term="闲文" scheme="https://loveofpeach.github.io/categories/%E9%97%B2%E6%96%87/"/>
    
    
    <category term="acg" scheme="https://loveofpeach.github.io/tags/acg/"/>
    
  </entry>
  
  <entry>
    <title>OUTSIDER：从毛利兰到有马佳奈</title>
    <link href="https://loveofpeach.github.io/posts/578147a1.html"/>
    <id>https://loveofpeach.github.io/posts/578147a1.html</id>
    <published>2023-09-28T15:55:24.000Z</published>
    <updated>2023-12-28T13:28:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>毛利兰、约儿·佛杰、有马佳奈，这一类角色，她们的生活都被排除在剧情主线之外，但又是剧中的重要人物。这种割裂和冲突，部分原因可以归结于作者有意制造的党争，或者人物塑造的失策，<psw>“青山的本意是好的，人设表现的时候歪了”</psw>。不过我倾向于分析人物时不把作者的意志搬进来，而总是从剧情人物本身寻找解释，这样比较有趣。</p><p>作为对比，还须观察两个角色：灰原哀、战场原黑仪。灰原深度参与了剧情冲突的主线，而战场原在脱离非日常后，成为阿良良木历在非日常和日常之间游走的桥梁，在朋友需要的时候亦有亮眼表现。灰原和战场原是两个塑造非常成功、很有魅力的角色，<del>很符合大家对“现代女性”的想象</del>，<psw>原神🙏</psw></p><div class="note info flat"><p>文章包含博主的主观臆测和过度解读，没有考据，也不会详细介绍剧情。只是自娱自乐，或者供恰好看过《名侦探柯南》《Spy Family》《推しの子》《物语系列》的人打发时间。</p></div><p>兰最大的设定，空手道高手，其实在人物表现上是立不住的。她并没有给人一种高武力值应有的沉稳和外溢的安全感，这点可以和京极真对比。早期的时候，兰更像是一个“柯南报警器”，作用是看到命案现场用尖叫把柯南叫过来。后期似乎脱敏了，但兰的空手道功夫也仅仅限于在大局已定的时候帮助柯南收尾，制服暴走的犯人，起到一个锦上添花的作用（这个生态位还经常被其他角色替代），很少推动剧情的发展。再如兰的怕鬼设定，就更加可疑了。</p><p>这种脱离具体细节塑造和行为逻辑支撑的设定，只能叫做纸片人的“萌点”。比方说，在现实中你不可能真的期待一个手如柔荑、肤如凝脂的娇小妹子拿一把 AK47 突突敌人，但在二维世界里就可以：</p><p><img src="https://bu.dusays.com/2023/12/27/658bad8c339aa.png" alt="55-1.png"></p><p><img src="https://bu.dusays.com/2023/12/28/658d5d8e513cd.gif" alt="55-2.gif" title="不好意思其实我们原神是 3D 游戏"></p><p>因此兰的空手道设定也只是没有支撑的“萌点”而已，不能作为其“强大”的佐证。当然，这里需要对“勇气”和“强大”做出区分，强大并不是勇气的必要条件。兰当然有可贵的勇气。遗憾的是，虽然勇气在现实世界是稀缺的品质，但在二次元里却是一种泛滥的通货，尤其是《名柯》里，凡正面角色就没有一个没有勇气的。</p><p>事实上，毛利兰不仅不是一部分人想象的“强大独立的现代女性”，相反是一个典型的大和抚子式角色，空手道高手的设定落在她身上，在二维世界与现实世界微妙差异的作用下，甚至加强了她的“大和抚子性”。</p><blockquote><p>大和抚子：类似于中国人口中的“贤妻良母”、“贤内助”。</p></blockquote><p>早期的某一集中，一位普通男高路人向兰表白，遭到拒绝后仍纠缠不清，兰直接一拳（还是一腿忘了）砸弯了旁边的电灯柱，吓跑男高路人，而柯南在旁边目睹了全过程。</p><p>其实这个细节在传统男性视角下会非常有意思。兰的空手道功夫使她即使在外力下也可以保全自己的贞洁，这卸下了男性保护女性的义务，使他们放心，但她竟完全没有借着空手道，建立自己内心的秩序，在心理上划出缓冲区，保持一定的独立性。她还是那个将新一的半句话奉为圭臬，还是那个为犯人拉上窗帘，阻止警方狙击的人美歌甜小姐姐，没有自己的思考，很多时候表现为新一的依附。这种不平衡，即外在的强大和内心的弱小，势必会使自己沦为被依附者的武器，发挥物的功用。这种不平衡同样也表现在，心理上处于与自身外在力量不相称的对男方的守势的女性，会让传统观念的男性感觉自己占了便宜。当然，这里并不指新一，而是银幕外的观众。我确信大部分人不会想这么多，反而会认为想这么多的人脑子有病，心理阴暗，但他们一定潜意识里对这个细节感到满意。</p><p>在这种视角下，毛利兰简直比大和抚子还要大和抚子，还要贤惠，还要让人放心。</p><div class="note warning flat"><p>Spy Family 博主只看到了 Part2 的中间部分，因此只讨论在这之前的剧情。</p></div><p>与之非常类似的是 Spy Family 的约儿·佛杰。</p><p><img src="https://bu.dusays.com/2023/12/27/658bb5146539d.png" alt="55-3.png" title="我有一个住在澳门的威尼斯朋友"></p><p>约儿·佛杰设定上是一个杀手，组成家庭的初衷也是为了更好地执行暗杀的任务，但其所服务的组织、暗杀任务，只在第一话登场的时候提到。之后就完全掉线，约儿·佛杰成为 aniya 的保镖，时不时表现出一点病娇的属性：左手一把沾满红色液体的刀，右手提着渗出红色液体的手提包站在公寓面前，表情阴暗，让观众角色以为刚刚进行了可怖的暗杀——但是镜头一转，原来那红色液体是番茄汁，约儿·佛杰正打算去向同事请教如何做饭。</p><p>这完全就是“萌点”了好吧，<del>虽然我没发现哪里萌了。</del></p><p>而柯哀受欢迎的很大原因，在我看来，是因为，现代人在精神上是孤独的，这种孤独使他们幻想一种亲密无间的关系。</p><p><img src="https://bu.dusays.com/2023/12/27/658bba369c804.png" alt="55-4.png"></p><p>小时候读《三国》或是《三侠五义》的时候，常常能看到一个人拉着一个人的手倾诉衷肠的情节，“啊贤弟，愚兄以为…”这种，这要放在现代人身上鸡皮疙瘩早掉一地了。现代人的日常交流丢弃了严肃性，只在鲜少的场合，只对鲜少的个人流露真情（或者没有？），因此他们是孤独的。本博客就是一例，博主在日常生活中就没什么表达欲，国内社交平台近两年几乎没有发言，评论都不参与的那种。把表达欲倾泻在这个博客里倒是很好的做法，现今的社会环境，谁也不知道自己什么时候会因言获罪。</p><p>于是，<del>我们</del>柯哀党发现，CA 之间在新兰关系的粉色泡泡之上，还有一种稀缺可贵的特质，即消解孤独的互相信任、互相理解。</p><p>但距离感也不是越小越好的。如果两个人对对方的一切过往都知根知底，一切想法都了然于心，任何一丁点的情绪波动都能量子纠缠似的立刻察觉，那么完全可以说其实这两个人是一个人，一份意识在两具肉体里的备份。举例来说，甲试图安慰受伤的乙，但是因为二人心有灵犀，甲的想法，包括安慰的逻辑，甲视角下的事件，这些在产生的瞬间，乙必然也了解了。换言之，甲根本不需要进行这个安慰。由于思维同步，二人的生活经验也是共享的。那么甲在不在乙的身边又有什么影响呢？乙不还是一个人吗？</p><p><img src="https://bu.dusays.com/2023/12/27/658bc6097a109.png" alt="55-5.png"></p><p>因此亲密关系中的爱只能由他者提供，这个他者必然是与自己有所不同的。上面只是一个距离为零的极端情况，现时中自然是绝无可能的。再看看距离很小很小的次极端情况：阿良良木历和忍野忍。由于二次元的事您少管的原因，忍野忍被束缚在历的影子里，物理距离几乎为零，总是一致行动，一方也能感受到另一方的心理动摇，实际上这个设定是十分危险的。在后期的动画中，小忍会吃历的醋，但是在那较久之前，历和战场原办事的时候，按照“一方能感受到另一方的心理动摇”的设定，其实是细思极恐的。只是由于二人性格上的原因，忍野忍渴求爱而历恰好是个撞到小忍的博爱者，才能达到一种和谐的亲密关系。<psw>忍：只要你爱我并且愿意为我而死就行。历：我爱你并且愿意为你而死的同时也爱着别人。</psw></p><p>而 CA 之间的距离则是比较合适的，他们既有一致行动的紧密，也有分工配合的默契。一如《物语系列》中战场原和羽川翼的对话：“真的不去吗？” “嗯，既然他没有邀请我们去，说明暂时还没有这个必要，而且我们也有我们这边的事情要处理吧。” （大概是这么说的，记不太清）</p><p>《推しの子》中的有马佳奈则是比较特殊了，她有着灰原哀的头脑但是毛利兰的命运，主角出于“保护她不受伤害”的心理动机，将她排除在主线之外。哎，写到这就不想写了，好像也蛮对不住人家的。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;毛利兰、约儿·佛杰、有马佳奈，这一类角色，她们的生活都被排除在剧情主线之外，但又是剧中的重要人物。这种割裂和冲突，部分原因可以归结于作者有意制造的党争，或者人物塑造的失策，&lt;psw&gt;“青山的本意是好的，人设表现的时候歪了”&lt;/psw&gt;。不过我倾向于分析人物时不把作者的意志搬</summary>
      
    
    
    
    <category term="闲文" scheme="https://loveofpeach.github.io/categories/%E9%97%B2%E6%96%87/"/>
    
    
    <category term="acg" scheme="https://loveofpeach.github.io/tags/acg/"/>
    
  </entry>
  
  <entry>
    <title>DS 强化</title>
    <link href="https://loveofpeach.github.io/posts/b161b9bb.html"/>
    <id>https://loveofpeach.github.io/posts/b161b9bb.html</id>
    <published>2023-09-26T03:18:48.000Z</published>
    <updated>2023-11-26T14:35:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="线性表"><a href="#线性表" class="headerlink" title="线性表"></a>线性表</h2><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/XARSSwlpuYvBRT" alt="54-1-1"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/GqgrAHwQHlbosT" alt="54-1-2"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/D_efmTaVAl-duO" alt="54-1-3"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/1QQpi9ysJ1Nv5c" alt="54-1-4"></p><h2 id="栈、队列、数组"><a href="#栈、队列、数组" class="headerlink" title="栈、队列、数组"></a>栈、队列、数组</h2><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/NrSkDGBxnjeYCV" alt="54-2-1"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/xILitM3Kx453zv" alt="54-2-2"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/JxdYxCt9AKvrM6" alt="54-2-3"></p><h2 id="树、二叉树"><a href="#树、二叉树" class="headerlink" title="树、二叉树"></a>树、二叉树</h2><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/RzR8jeFgUeYipb" alt="54-3-1"></p><p><img src="https://bu.dusays.com/2023/11/11/654f5806ef75e.jpg" alt="54-3-2.jpg"></p><p><img src="https://bu.dusays.com/2023/11/11/654f58066928c.jpg" alt="54-3-3.jpg"></p><p><img src="https://bu.dusays.com/2023/11/11/654f58051df1a.jpg" alt="54-3-4.jpg"></p><p><img src="https://bu.dusays.com/2023/11/11/654f58063ae3b.jpg" alt="54-3-5.jpg"></p><h2 id="图"><a href="#图" class="headerlink" title="图"></a>图</h2><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/KEIv6MGM5jy_mT" alt="54-4-1"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/5hprMCgLmVrw2G" alt="54-4-2"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/qNv7DAWXCywuCd" alt="54-4-3"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/dUxZT2sAUNn212" alt="54-4-4"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/DYyXamZAhp2Giw" alt="54-4-5"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/22ugockT4IRCqD" alt="54-4-6"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/gPXtK7Bis2cE5X" alt="54-4-7"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/dy0IS0V955L0AB" alt="54-4-8"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/JS_yqyvH_0u9Bj" alt="54-4-9"></p><p>因为王道的算法太麻烦了，不利于人脑模拟算法执行，所以针对 AOE，我给出一个基于 DAG 上动态规划的算法。</p><p>定义 $S_i$ 为顶点 i 到终点的最长路径长度，则：</p><script type="math/tex; mode=display">S_i= \begin{cases}\underset{(i,j)\in E}{\overset{}{\mathrm{MAX}}}(S_j+\mathrm{len}(i,j)) & i \ne \mathrm{end} \\0 &i=\mathrm{end}\end{cases}</script><p>显然这个算法的时间复杂度是 $O(|E|)$ 的，代码递归地写就可以。</p><p>那么找出关键路径就很方便了：</p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/0JPB2Pn2zQJ-aT" alt="54-4-9dot5"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/PsPTK3e4HJnh2T" alt="54-4-10"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/CX7B-2fwr6qhrx" alt="54-4-11"></p><h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/H91sedOcopFXM8" alt="54-5-1"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/vxuDjsATcmDc_o" alt="54-5-2"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/tnClkF0eEavuUC" alt="54-5-3"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/Lt_P3J6s3v2wFF" alt="54-5-4"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/sVKMLOLg6srvqt" alt="54-5-5"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/f_mAMTQPoqAHmz" alt="54-5-6"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/qwxBh2npMM69iw" alt="54-5-7"></p><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/jSO8eGujXq3doM" alt="54-6-1"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/XALx3u4WMch-zz" alt="54-6-2"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/pJSnHUqMVro-3m" alt="54-6-3"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/-NuOAU-Hme-KuF" alt="54-6-4"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/ncVQoXwLgBylw6" alt="54-6-5"></p><p><img src="https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/zrCDvln51cV1wI" alt="54-6-6"></p><p>运用快排的划分思想：</p><div class="row"><iframe src="https://drive.google.com/file/d/1XhE73Op43g3JI2i6B73Ii-CNNPLKprC6/preview" style="width:100%; height:550px"></iframe></div><h2 id="结课测试"><a href="#结课测试" class="headerlink" title="结课测试"></a>结课测试</h2><div class="row"><iframe src="https://drive.google.com/file/d/1sJKVhNZCxQVLIVRd7cP3jG2Qh51VrhqC/preview" style="width:100%; height:550px"></iframe></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;线性表&quot;&gt;&lt;a href=&quot;#线性表&quot; class=&quot;headerlink&quot; title=&quot;线性表&quot;&gt;&lt;/a&gt;线性表&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://sway.office.com/s/t7eV6eAN5Lyx8o8e/images/XARSSw</summary>
      
    
    
    
    <category term="算法" scheme="https://loveofpeach.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="数据结构" scheme="https://loveofpeach.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>物理复习讲义（一）</title>
    <link href="https://loveofpeach.github.io/posts/1f9ef124.html"/>
    <id>https://loveofpeach.github.io/posts/1f9ef124.html</id>
    <published>2023-09-22T04:52:35.000Z</published>
    <updated>2023-10-22T03:05:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>之前大学的某一年暑假，辅导了一个学生的高中物理。只有 10 天，每天 2 小时，基础不牢，让我从头开始，最后好像就把运动学的部分讲完了？印象最深的是硬杆弹簧一类的题目。</p><p>这是第一节课的讲义，后面的就没有用 markdown 写了，因而没有留存。我暂且把它挂在博客里。</p><hr><blockquote><p>配合小题狂做必修一使用</p></blockquote><h2 id="第一章-运动的描述"><a href="#第一章-运动的描述" class="headerlink" title="第一章 运动的描述"></a>第一章 运动的描述</h2><h3 id="知识点梳理"><a href="#知识点梳理" class="headerlink" title="知识点梳理"></a>知识点梳理</h3><p><strong>质点</strong>：理想模型，忽略大小形状，具有质量。</p><ul><li>具体问题具体分析</li></ul><p><strong>参考系</strong>：描述物体运动时选定的参考。</p><p><strong>位移</strong>：矢量，由起点指向终点，大小和方向。</p><p><strong>速度</strong>：位移与发生该位移的时间的比。 $v=\Delta x/\Delta t$</p><ul><li>$1m/s=3.6km/h$</li><li>$v-t$图像，与$x-t$图像的关系，几何意义</li></ul><p><strong>加速度</strong>：速度的变化率。 $a=\Delta v/\Delta t$</p><ul><li>加速度具有方向，在未声明正方向的题目中需自行声明。</li><li>$v-t$图像中的加速度。</li></ul><h3 id="典型例题"><a href="#典型例题" class="headerlink" title="典型例题"></a>典型例题</h3><p><strong>p5第4题，p5第7题，p18第11题</strong>：设未知量，最后相消得到答案</p><p><strong>p10第11题</strong>：$v-t$图像中的加速度。</p><h2 id="第二章-匀变速直线运动"><a href="#第二章-匀变速直线运动" class="headerlink" title="第二章 匀变速直线运动"></a>第二章 匀变速直线运动</h2><h3 id="知识点梳理-1"><a href="#知识点梳理-1" class="headerlink" title="知识点梳理"></a>知识点梳理</h3><p><strong>匀变速直线运动</strong>：加速度不变的直线运动。</p><ul><li>在辨析题中注意区分，例如圆周运动可以作为很多反例</li></ul><p><strong>通过$v-t$图像理解$x=\dfrac{1}{2}at^2+v_0t$的导出</strong></p><ul><li>并通过类似方法理解匀变速运动中中点时刻速度等于平均速度</li><li>平均速度的例题，p27第4题</li></ul><p><strong>联立$x=\dfrac{1}{2}at^2+v_0t$与$v=at+v_0$得到$v^2-v_0^2=2ax$</strong></p><p><strong>重要推论</strong>：$\Delta x=aT^2$</p><ul><li>含义：匀变速直线运动中，任意相等的连续时间间隔$(T)$内位移之差为定值$aT^2$</li><li><p>拓展(可忽略)：对于一个符合二次函数的数列，例如：</p><script type="math/tex; mode=display">1,4,9,16,25,... (1)</script><p>逐项作差：</p><script type="math/tex; mode=display">3,5,7,9,...(2)</script><p>对$(2)$继续作差：</p><script type="math/tex; mode=display">2,2,2,...(3)</script><p>将得到定值。其中数列(1)可理解为位移，数列(2)理解为速度。而数列(3)中的数与二次函数的二次项系数有关，在匀变速直线运动中与加速度有关。<strong>推论$\Delta x=aT^2$实质上与此类似，</strong> 在$x-t$图像（$x=\dfrac{1}{2}at^2+v_0t$为二次函数）上等距取点，算出函数值作差（第一次作差）得到等间隔内的位移,将此位移继续作差（第二次作差）得到定值。</p></li><li><p><strong>拓展(尽量掌握)</strong>：第$m$个时间$T$内与第$n$个时间$T$内的位移差$\Delta x=x_m-x_n=(m-n)aT^2$</p></li><li>例题： p40第9题</li></ul><p><strong>初速度为0的匀加速直线运动中几个重要的比例式：</strong></p><ul><li>时间等分：使用几何方法在$v-t$图像中理解</li><li>位移等分：通过前$x$，前$2x$，$…$,前$nx$位移时的速度之比为：<script type="math/tex; mode=display">v_1:v_2:v_3:...:v_n=1:\sqrt 2:\sqrt 3:...:\sqrt n</script>推导方法，由$v^2-v_0^2=2ax$导出</li><li>位移等分：通过第一个$x$,第二个$x$，$…$,第$n$个$x$所用时间之比：<script type="math/tex; mode=display">t_1:t_2:t_3:...:t_n=1:(\sqrt 2-1):(\sqrt 3-\sqrt 2):...:(\sqrt n-\sqrt{n-1})</script>推导过程及应用均由例题展示</li><li>例题： p29第7题，p36第10题</li></ul><p><strong>自由落体运动</strong>：匀变速直线运动的一种特例，$a=g$，$v_0=0$</p><script type="math/tex; mode=display">v=gt,x=\dfrac{1}{2}gt^2</script><p>例题，p37第6题，p38第8题</p><p><strong>竖直上抛运动</strong>：仍然是匀变速直线运动的一种</p><p><strong>实验 - 小车速度随时间的变化规律</strong>注意点:</p><ul><li>交流电频率$50Hz,$打点计时器打出的两点时间间隔为$0.02s$</li><li>小车释放位置：靠近打点计时器</li><li>先接通电源打点，后释放小车</li><li>改变钩码数量，重复实验</li><li><strong>实验方案创新</strong>，频闪照相，等效替代等，通过$v-t$图像理解剪下纸带的长度</li></ul><p>例题：p21第10题</p><h3 id="解题方法"><a href="#解题方法" class="headerlink" title="解题方法"></a>解题方法</h3><p><strong>利用$x-t$图像与$v-t$图像寻找解题思路</strong></p><ul><li>在选择题中减少计算量，例题：p25第5题，p27第7题，<strong>p39第4题</strong></li><li>典型分析，p34第11题，数学方法寻找思路。匀加速匀减速直线运动$(a\ne0)$在$x-t$图像中是二次函数<br>设曲线 <script type="math/tex">b:x=-t^2+v_0t+C</script> 在切点处 $b$ 与 $a$ 速度相等，即2m/s，又 $v_b=-2t+v_0$ ，得 $v_0=8$ .切点坐标 $(3,8)$ 代入曲线 $b$ 方程，得 $C=-7$ .<br>再根据$x-t$图像的几何意义答题。</li></ul><p><strong>利用匀变速直线运动的对称性逆向思考</strong></p><ul><li>例题，p26第10题，<strong>p39第7题</strong></li></ul><p><strong>公式$v^2-v_0^2=2ax$建立方程组</strong></p><ul><li>由该公式列出不同等式，并通过调整系数联立各等式的左边。例题p30第9题</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前大学的某一年暑假，辅导了一个学生的高中物理。只有 10 天，每天 2 小时，基础不牢，让我从头开始，最后好像就把运动学的部分讲完了？印象最深的是硬杆弹簧一类的题目。&lt;/p&gt;
&lt;p&gt;这是第一节课的讲义，后面的就没有用 markdown 写了，因而没有留存。我暂且把它挂在博</summary>
      
    
    
    
    <category term="杂项" scheme="https://loveofpeach.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="高中物理" scheme="https://loveofpeach.github.io/tags/%E9%AB%98%E4%B8%AD%E7%89%A9%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>妙联趣谈</title>
    <link href="https://loveofpeach.github.io/posts/10746325.html"/>
    <id>https://loveofpeach.github.io/posts/10746325.html</id>
    <published>2023-09-11T10:12:38.000Z</published>
    <updated>2023-09-26T03:45:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近淘得一本旧书，名《妙联趣谈》，安徽文艺出版社。</p><p>OCR 图片转文字，校对一次。转载部分内容：</p><p>一，一些有趣的对联。</p><p>二，网上搜不到内容或是背景故事的对联。只用了 Google 和必应，也许搜的不够全面。</p><p>除少数字的用法、过长的段落分段外，不作任何修改。如果需要看繁体字，右下设置有简繁切换，但是不能保证完全正确对应。</p><blockquote><p>修改一览：<br>丫环 -&gt; 丫鬟<br>单引号误作双引号</p></blockquote><p>其中部分对联在网上搜得诸多版本，各有不同；部分背景故事疑有杜撰成分。</p><h2 id="已有"><a href="#已有" class="headerlink" title="已有"></a>已有</h2><h3 id="东坡挽朝云"><a href="#东坡挽朝云" class="headerlink" title="东坡挽朝云"></a>东坡挽朝云</h3><blockquote><p>不合时宜，唯有朝云能识我；<br>独弹古调，每逢暮雨倍思卿。</p></blockquote><p>苏东城生活在内外矛盾日益尖锐的北宋年代。他政治思想比较保守，但有自己的独立见解。他反对过王安石新法在实施过程中所出现的流弊；也反对司马光那种对新法一概废弃的错误做法。在三十多年的仕途中，屡遭贬谪，怅恨不能自己。</p><p>东坡有两个丫鬟，名叫朝云、暮雨。有一次东坡扪着肚皮笑着问家人：“这里面装的是什么？” 大家都说是满腹经纶，只有朝云说：“我看是一肚子不合时宜的牢骚。” 颇得东坡赏识。不久，朝云病故，东坡便作此联哀挽她。这真是伯牙绝弦，更无知音了。</p><blockquote><p>陶之二评：<br>朝云吐槽犀利，东坡表现出自嘲精神。</p></blockquote><h3 id="哑联"><a href="#哑联" class="headerlink" title="哑联"></a>哑联</h3><blockquote><p>狗啃河上（和尚）骨； （东坡出）<br>水流东坡诗（尸）。   （佛印对）</p></blockquote><p>苏东坡被贬黄州后，游赤壁，访沙湖，赏心悦目，写下了“大江东去浪淘尽千古风流人物”的名句，倒也不乏兴味。有一天晚上，他邀好友佛印和尚泛舟长江之上，清风徐来，水波不兴，轻舟荡漾，临风把酒，好不痛快。酒过三巡，佛印向东坡索句。少顷，东坡用手向左岸一指，笑而不语。佛印循指望去，只见岸上农夫披星戴月，荷锄而归，不解东坡之意，待回首向东坡问时，只见东坡笑而不答，自斟自喝，非常得意。佛印好不气恼，再向河岸上远眺，才发现岸上有一条大黄狗正在狼吞虎咽地啃东西，才恍然大悟，原来苏东坡是借此情景来打趣取乐的。佛印也不甘示弱，急中生智，随即将手中题有苏东坡诗句的一把扇子拋入水中，然后从苏东坡手中夺过酒壶，也自斟自饮起来，苏东坡一见此举，心照不宣，抚掌大笑，这就是传之于后世的双关哑联。</p><blockquote><p>陶之二评：<br>雅。</p></blockquote><h3 id="姑嫂赛联"><a href="#姑嫂赛联" class="headerlink" title="姑嫂赛联"></a>姑嫂赛联</h3><blockquote><p>嫂嫂看书——心思“汉”；<br>姑姑追禽——手拉郎！</p></blockquote><p>据说苏小妹的嫂嫂——苏东坡的夫人正在看书。苏小妹蹑手蹑脚地走过去从嫂嫂手中将书抢过来一看，原来是《三国志平话》，并且正在看关云长“身在曹营心在汉”这一节。苏小妹素以聪明灵巧闻名，今天她要借嫂嫂看书来开她一个玩笑。</p><p>于是逗嫂嫂说：“好啊，你在偷看《杨太真外传》（当时禁止妇女看此书），我一定要对大哥讲。”嫂嫂知道小姑伶俐风趣，忙接过话题说：“我看太真是公开的，怕什么！你才真是在房里躲着看‘太真’呢！”小妹这一下弄得很难堪，忙以退为进地说：“好了，好了，你可真厉害，我不冤枉你，你看的是《三国志》中关羽‘身在曹营心汉’对吗？我赞你一句：嫂嫂看书——心思‘汉’。”（双关语，“汉”即男子汉），这一下小妹总算转败为胜了，她又反辱相讥地补充一句：“我说的完全是事实，没有冤枉你吧！”小妹以为这一下可以封住嫂嫂的嘴了，真是手舞足蹈，得意忘形。恰巧，这时一个小喜鹤飞过来了，苏小妹击败嫂嫂之后，和丫鬟们追逐小喜鹊玩去了。东坡夫人站在一旁干生气，想不出一个好词儿来回击这个能小姑。忽然她灵机一动：小妹己经许配给了秦少游，“禽”与“秦”同音。她忙跑去喊住小妹说：“我也回敬你一句：‘姑姑追禽——手拉郎！’ 好吗？巧吧！”小妹羞红了脸，撇娇逞强地说：“我不许你这样欺侮人。”一头撞到嫂嫂怀里，真真假假地哭闹了一番⋯⋯</p><blockquote><p>陶之二评：<br>苏小妹可爱。</p></blockquote><h3 id="华罗庚的妙对"><a href="#华罗庚的妙对" class="headerlink" title="华罗庚的妙对"></a>华罗庚的妙对</h3><blockquote><p>妙人儿，倪家少女；<br>搞长弓，张府高才。</p></blockquote><p>据说本世纪初，在北洋军阀统治时期，它的嫡系安徽督军倪嗣冲有一个女儿名叫倪妙。倪妙读了几句书，也懂得古诗与对联，妄自尊大，骄横不可一世。她要找一个才貌双全的女婿，经过许多人的介绍，都不合心意。于是她出了一个“求乘龙快婿”的上联，即“妙人儿，倪家少女！”声称：只要有个青年能对出下联，不论家世，均可作为配偶。此讯传出后，安庆以及全国各地不知有多少痴情人，煞费苦心，想对出下联，以便高攀名门小姐，荣耀一生。可是，尽管喧噪了一时，都没有人能对出。认为这是拆字对。“少女”联结为 “妙”，“人儿”合起为“倪”，所以无法对出。被人称为“安庆绝对”。</p><p>一九八一年四月，华老来肥讲学，住在稻香楼宾馆。一天，在宾馆客厅踱步时，遇见女服务员小倪。华老脱口而出，吟出此上联。恰好科技大学派来照料华老的张医生在他身旁。华老即隐喻“张”，接出下联。对得轻松酒脱，颇有雅俗共赏之趣，引得全场大笑。六十年前的“绝对”，被华老一语道破，当年未能对出的痴情儿郎，能在须眉 斑自之际，惊闻此讯，能不发出了却终生一宿愿之感叹吗？</p><blockquote><p><strong>注：</strong><br>此为千古绝对，下联颇多。书中背景故事疑有杜撰。 参考：<br><a href="https://tieba.baidu.com/p/693394314">唐河文化吧_妙人儿倪家少女</a><br><a href="https://tieba.baidu.com/p/1173092288">心中梦吧_妙人儿倪家少女:求下联</a><br><a href="https://zhidao.baidu.com/question/2059107661514273227.html">为什么说倪家少女是妙人儿？</a><br>陶之二评：<br>上联尽显倪家少女的聪慧自信。下联对的不是很好，虽然陶某也对不出。</p></blockquote><h3 id="寇准作联回辽"><a href="#寇准作联回辽" class="headerlink" title="寇准作联回辽"></a>寇准作联回辽</h3><blockquote><p>朝无相，营无将，你国中利害相将，将来必散；<br>天能度，地能量，我皇上宽宏度量，量也无妨。</p></blockquote><p>宋真宗时，当时北方大辽经常侵犯中原。他们深知宋朝武备不修，国内虚弱，因而拟出上联交使者带来，嘲笑并侮辱宋朝。并且试探宋朝有没有勇气敢于用强硬的态度回击他们。当时朝中文武百官看到此联，认为这是番邦下的战表，均惊慌失措，相对无言。唯有寇准镇定自若，义愤填膺地奋笔疾书，当即写出下联，狠狠回击了番邦。辽王接到此下联后，认为不能小视宋朝，还是以议和为好。</p><h3 id="昆明大观楼长联"><a href="#昆明大观楼长联" class="headerlink" title="昆明大观楼长联"></a>昆明大观楼长联</h3><blockquote><p>五百里滇池，奔来眼底，披襟岸帻，喜茫茫空阔无边。看东骧神骏，西翥灵仪，北走蜿蜒，南翔缟素。高人韵士，何妨选胜登临！趁蟹屿螺洲，梳裹就风鬟雾鬓；更蘋天苇地，点缀些翠玉丹霞，莫孤负四围香稻，万倾晴纱，九夏芙蓉，三春杨柳。<br>数千年往事，注到心头，把酒凌虚，叹滚滚英雄谁在！想汉习楼船，唐标铁柱，宋挥玉斧，元跨革囊，伟烈丰功，费尽移山心力。尽珠帘画栋，卷不及暮雨朝云；便断碣残碑，都付与苍烟落照。只赢得几杵疏钟，半江渔火，两行秋雁，一枕清霜。</p></blockquote><p>昆明大观楼是清代康熙二十九年（公元一六九〇年）经王继文建造的。咸丰七年 （公元一八五七年）被兵火所毁；同治五年 （公元一八六六年）又由马如龙重修。修复后的大观楼，殿阁耸峙，绿树成萌，湖光山色，相映成趣。有揽胜阁、涌月亭、观稼堂和“蓬莱别境”等胜景，是我国著名的游览胜地。大观楼上的长联系清代诗人孙髯所作。这是一副誉满中外的著名对联。上下联共一百八十字，世称天下第一长联。其中描写景物，陈述史实，反复低徊，一唱三叹，确实可以当作一篇优美的抒情诗。</p><p>就其内容来看，上联是“喜”，尽情领受眼前佳景。“喜”字是整个上联的意脉。作者一开始就抓住了滇池的特征，从寥廓的空间落墨，写眼前佳景，起势非凡，除暗点大观楼的地理位置，还透露出作者登临大观楼，饱览汪洋浩瀚的滇池时的喜悦。接着用一“看”字，作为四个排偶句的尖头领字。从东、南、西、北四个方面，对周围山峦的情态，用“骧、翥、走、翔，四个声调各异的动词，作了动态的刻画，把山峦描写得很灵动，很有生气，真可以说是写活了。</p><p>接着用 “高人韵士”一转，由景转到人。“何妨选胜登临”，紧紧承上而来，是说如此风景佳丽的名胜，值得登临一览，趁着这螺状蟹形的洲屿扮妆得象仕女那样，具有淡雅丰姿的美好时节，更加上水中青萍、滩头修苇，凌空翠鸟，照眼红霞的迷人最色，何不来此一游！最后，作者把思路推开一层，用不同季节而又富有地区特征的香稻，晴纱、芙蓉、杨柳，来渲染大观楼的迷人景色。满眼风光长画卷，整个上联描绘的这幅画面，层次分明，色彩绚丽，景物浓淡相宜，动静相生。艺木地再现了滇池风物，字里行间充满着诗人热爱祖国河山的美好感情。没有游览过昆明大观楼的人，读了这副上联，会感到这里的风光着实令人神往。</p><p>下联是“叹”，依次陈述历史沿革。 “叹”字成为整个下联的意脉。上联从广阔空间着墨，下联则从旷远的时间下笔。作者先用 “注到心头” 一句奠定怀古基调，又用 “叹”自然过渡到历史的追怀。接着用一“想” 字作为下面四句的尖头领字，统领 “汉” “唐” “宋” “元” 这四则与云南有关的历史典故，说明自汉唐以来，滇池就是一处青史著称的胜地。接着作者以“伟烈丰功，费尽移山心力”再总承一句表示对古代英雄的赞美。然后，笔锋陡转，指出：尽管帝王的基业一时繁华，也禁不住政治风云的变化，即使是昔日宣扬封建帝王的碑碣，也已折断或字迹模糊，笼罩在黄昏的烟霭之中，倒卧在残阳的斜照之下。诗人感叹风物虽好，却是人世沧桑，碑碣虽存，但为历史陈迹。从而呼应了前文的“叹滚滚英雄谁在”一句。最后以凄凉肃杀的秋景作结，烘托了浓重的凭吊气氛，表现出凄清苍凉的情调，预示着封建王朝不可避免的衰亡的命运，从中不难窥到作者因盛世的“繁华春去”而产生对现实严重不满与深切失望的心境。这种心境在当时正直爱国的文人中，是有广泛的代表性的。</p><p>就艺术上来看，全联基调很象北宋范仲淹的名篇《岳阳楼记》。写岳阳楼，离不开洞庭湖，因为洞庭湖是“巴陵胜状”，是岳阳楼的 “大观”。同样的道理，写昆明大观楼，势必要写滇池，才能见出此地的风光，可见此联构思的奇巧。</p><p>全联共一百八十字，没有一个重复的宇，这真是难得的。大观楼这副对联，以字数论还不是我国最长的对联，四川江津县临江城楼联共有一千六百一十二个字。然而，大观楼长联叙事抒情紧紧结合，对仗工整，字句典雅，情景交融，气势不凡，洵属对联中之杰作。</p><blockquote><p><strong>注：</strong><br>「蘋」有两个音「pín」和「píng」，对应两个义项，在简化过程中分别给了「⿱艹频」和「苹」。<br>参见：<a href="https://www.zhihu.com/question/410512837/answer/1369171883">「蘋」「苹」「⿱艹频」三字的关系是怎样的? - Kushim Jiang的回答 - 知乎</a><br>陶之二评：<br>评不了。</p></blockquote><h2 id="暂无"><a href="#暂无" class="headerlink" title="暂无"></a>暂无</h2><h3 id="对联之谜"><a href="#对联之谜" class="headerlink" title="对联之谜"></a>对联之谜</h3><blockquote><p>二三四五；<br>六七八九。</p></blockquote><p>添字联：</p><blockquote><p>二三四五添一；<br>六七八九加十。</p></blockquote><p>在“四人帮”横行的一九七五年春节，某地有一位叫做“三爷”的老红军，在自己的大门上贴出了“二三四五，六七八九” 的奇怪对联。当时好多人都解不开其中的迷，人们问到三爷，他只是笑笑，根本不讲。三爷的儿手是一位公务员，他于春节后的一天，特从城里赶回家向老人拜年。他一看此联，就知道它的谜底是：讽刺“四人帮”专横暴虐，弄得人民缺“一”（即衣）少“十”（即食）。他替老头子捏了一把汗，暗地里向他打个招呼，叫他想方设法将这副春联毁掉。可是老头子根本不理睬，只说：“有事我承担，你别管，我自有对策。”儿子只好摇摇头，很快就回公安局去了。</p><p>大约过了六七天，大队民兵营长找上门来，说是公社政法委员请三爷过去有事商量，三爷毫不犹豫地就去了。公社政法委员开诚布公地谈了这副春联在社会上引起了巨大的反响，要求三爷把它毁掉，免得惹事生非，自找麻烦。可是三爷反问：“你们是怎样解释这副春联的呢？我没有别的意思，我是在歌领我们通过无产阶级文化大革命，国家日新月异，步步高升呀！”</p><p>“那为什么不写‘一’呢？”政法委员反问道。</p><p>“这‘一’是代表封资修的。我们是在不要封资修的基础上创出无产阶级新世界来。”三爷答。</p><p>“那为什么又没有写‘十’呢？” 政法委员又问。</p><p>“现在不是在提倡继续革命吗？有了‘十’，就是到了顶；到了顶就不是继续革命论者，那还了得！” 三爷侃侃而谈。</p><p>三爷说得头头是道，公社政法委员无言以对，只好不欢而散。这场风波也就这样平息下来了。</p><p>五年后，一九八一年春节来到了，三爷在自家大门上贴上了：“二三四五添一；六七八九加十”的春联。人们一看就知道这是说明三中全会之后，党落实了农村经济政策，人民的生活正在好转。这副春联道出了人民的心声，歌颂了党的英明伟大。</p><blockquote><p>陶之二评：<br>我们走了一些弯路。</p></blockquote><h3 id="一联串姻缘"><a href="#一联串姻缘" class="headerlink" title="一联串姻缘"></a>一联串姻缘</h3><blockquote><p>黑壁墙下，黑面书生，黑巴巴，臭嗡嗡，呸，你且去，今生休想；<br>红花楼上，红粉佳人，红冬冬，香扑扑，喈，我就来，前世姻缘。</p></blockquote><p>传说过去有一个在相爷家陪伴公子读书的书童，由于不小心，将相爷最心爱的一对玉麒麟打碎了。书童知道这个祸事闯的不小，不被打死，也要掉一身皮。他抓住相爷尚未发觉的时机，立即溜出府门，跑到民问，拜一个乡间老太婆作母亲，靠捡粪打柴维持生活。这个书童有一天起得很早，出去捡粪，不知不觉溜进一位大官僚人家后花园里。他正在花园里捡粪，忽听得邻近花园的一座绣楼上，有读书的声音，他跑过去一听，原来还是一位少女正在聚精会神地读古文。这时，他已有很长时间没有读过书了。今天听到读书声，分外感到亲切有趣。直听到这位小姐不读为止，他才姗娜而去。</p><p>从此，他每天都要起早到这儿听小姐读书，因为他没有钱买书，只有通过听书来学习古文，以便将来能参加“乡试”。日久天长，书童听书的事被小姐发现了。开始，小姐抱着好奇心，只要有书童听，她就读得更起劲。小姐起劲地读，捡粪的书童听得就更入神了，常常情不自禁地随着小姐的诵读而眉飞色舞，欣然微笑。小姐一见这情景，就犯疑起来，莫非这捡粪的伢子真懂诗文？于是起身到窗前仔细瞧一瞧这小子是个什么样儿。那位捡粪的孩子忽然听不到读书声，立即抬起头来对绣楼上望一望，怡好两个人的目光对在一起，小姐将拾粪的伢子看清楚了，原来是个蓬头垢面的小青年。她一见听读书的人是这个模样，心里好笑，脱口说出了上联。那拾粪的伢子当场对出了下联，而且扔掉粪扒粪箕，绕过后园就要上楼来了。这一下可把小姐急坏了，忙命丫鬟在楼口守住，不准他上楼来。可这位捡粪的伢子很厉害，竟然和丫鬟闹了起来。那位大官僚刚刚起床，听家里有人吵闲，就打发家奴前去问个清楚明白。一会儿，家奴将捡粪的伢子拖到老爷面前。拾粪的伢子振振有词，理直气壮地说：“休得无礼，我是你家小姐请来的！不信有对联为证，你们竟敢这样？！”老爷将小姐找来一问，小姐承认了有此事，但不过是逗之以取乐而已。这位老爷毕竟很有眼力，一个拾粪的伢子居然能出口成章，这里面自有奥妙。他叫小姐回绣楼去，叫家奴将捡粪的伢子带到书房内，由老爷亲自过问。事后，经过多次的考察与鉴别，老爷认为这伢子很有才华，就将他收下，并亲自作主，将女儿许配给他。以后这书童考上了进士，这个姻缘可真是一联串起来的了。</p><blockquote><p>陶之二评：<br>旧文人意淫爽文。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近淘得一本旧书，名《妙联趣谈》，安徽文艺出版社。&lt;/p&gt;
&lt;p&gt;OCR 图片转文字，校对一次。转载部分内容：&lt;/p&gt;
&lt;p&gt;一，一些有趣的对联。&lt;/p&gt;
&lt;p&gt;二，网上搜不到内容或是背景故事的对联。只用了 Google 和必应，也许搜的不够全面。&lt;/p&gt;
&lt;p&gt;除少数字的</summary>
      
    
    
    
    <category term="转载" scheme="https://loveofpeach.github.io/categories/%E8%BD%AC%E8%BD%BD/"/>
    
    
    <category term="对联" scheme="https://loveofpeach.github.io/tags/%E5%AF%B9%E8%81%94/"/>
    
  </entry>
  
  <entry>
    <title>OS 强化</title>
    <link href="https://loveofpeach.github.io/posts/64934ad2.html"/>
    <id>https://loveofpeach.github.io/posts/64934ad2.html</id>
    <published>2023-09-03T12:35:13.000Z</published>
    <updated>2023-12-02T12:09:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PV-大题知识梳理"><a href="#PV-大题知识梳理" class="headerlink" title="PV 大题知识梳理"></a>PV 大题知识梳理</h2><p>pv理发师：</p><div class="row"><iframe src="https://drive.google.com/file/d/1yAXR9bhB1vJQkRlMUhff9PzWc6yAFShq/preview" style="width:100%; height:550px"></iframe></div><p>pv23年：</p><div class="row"><iframe src="https://drive.google.com/file/d/1GN7ntq6BFJeUV1I-KXRSk5JvOqlEY2Je/preview" style="width:100%; height:550px"></iframe></div><h2 id="存储管理知识梳理"><a href="#存储管理知识梳理" class="headerlink" title="存储管理知识梳理"></a>存储管理知识梳理</h2><p>1 s = 10^3 ms<br>1 ms = 10^3 μs<br>1 μs = 10^3 ns</p><p><img src="https://bu.dusays.com/2023/09/05/64f70bee6fcc2.jpg" alt="51-2-1.jpg"></p><p>32 位系统：一个进程的虚拟地址的合法范围：<code>0x00000000</code>~<code>0xFFFFFFFF</code>，即 $2^{32}$ 个，按字节寻址，即进程的虚拟地址空间为 4 GB .</p><p>现代计算机中，一个进程几乎不可能占用连续的物理内存空间，只可能占用连续的逻辑地址空间。</p><p>若一个逻辑地址页内偏移量有 12 位，即一个页面的逻辑地址号有 $2^{12}$ 个，因按字节寻址，每个地址号对应 1 个 B ，所以一个页面的大小为 $2^{12}B=4KB$ .</p><p><img src="https://bu.dusays.com/2023/09/06/64f7e26e51101.jpg" alt="51-2-2.jpg"></p><p>下面放点文物：</p><p><img src="https://bu.dusays.com/2023/09/06/64f7e43e75606.jpg" alt="存储管理手稿-1.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f7e43cca6e0.jpg" alt="存储管理手稿-2.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f7e43e7a220.jpg" alt="存储管理手稿-3.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f7e43c1cbac.jpg" alt="存储管理手稿-4.jpg"></p><p>下面放出清晰的 pdf 文件（需要科学）：</p><div class="row"><iframe src="https://drive.google.com/file/d/1CGKa-IydzLsyHfWU0N-Kwcrmu0YAHBqS/preview" style="width:100%; height:550px"></iframe></div><h2 id="文件系统知识梳理"><a href="#文件系统知识梳理" class="headerlink" title="文件系统知识梳理"></a>文件系统知识梳理</h2><p>“簇” 就是 “块” ：</p><ul><li>“簇” 是 Windows 的叫法</li><li>“块” 是 Linux 的叫法</li></ul><p><img src="https://bu.dusays.com/2023/09/11/64ff205b5df6d.jpg" alt="文件系统手稿-1.jpg"></p><p><img src="https://bu.dusays.com/2023/09/11/64ff205d505f1.jpg" alt="文件系统手稿-2.jpg"></p><p><img src="https://bu.dusays.com/2023/09/11/64ff205e3efa6.jpg" alt="文件系统手稿-3.jpg"></p><p><img src="https://bu.dusays.com/2023/09/11/64ff205f72a34.jpg" alt="文件系统手稿-4.jpg"></p><p><img src="https://bu.dusays.com/2023/09/11/64ff205ef32d2.jpg" alt="文件系统手稿-5.jpg"></p><p><img src="https://bu.dusays.com/2023/09/11/64ff205dbb5e2.jpg" alt="文件系统手稿-6.jpg"></p><p>下面放出清晰的 pdf 文件：</p><div class="row"><iframe src="https://drive.google.com/file/d/1wYfdvifgyMz2gqRsWuW6IyVeRzHm_qNI/preview" style="width:100%; height:550px"></iframe></div><h2 id="第一章题目"><a href="#第一章题目" class="headerlink" title="第一章题目"></a>第一章题目</h2><p><img src="https://bu.dusays.com/2023/09/15/6503d9c720cdd.jpg" alt="51_4_1.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c924f8e.jpg" alt="51_4_2.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c62e879.jpg" alt="51_4_3.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c922a0f.jpg" alt="51_4_4.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c80c93b.jpg" alt="51_4_5.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c8980b8.jpg" alt="51_4_6.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c6776d7.jpg" alt="51_4_7.jpg"></p><p><img src="https://bu.dusays.com/2023/09/15/6503d9c944f20.jpg" alt="51_4_8.jpg"></p><p><img src="https://bu.dusays.com/2023/09/20/6509c7427027e.jpg" alt="51_4_9.jpg"></p><p><img src="https://bu.dusays.com/2023/09/20/6509c741e6f08.jpg" alt="51_4_10.jpg"></p><p><img src="https://bu.dusays.com/2023/09/20/6509c742e82dc.jpg" alt="51_4_11.jpg"></p><p><img src="https://bu.dusays.com/2023/12/02/656b1e6882be9.jpg" alt="51_4_11dot5.jpg"></p><p><img src="https://bu.dusays.com/2023/09/20/6509c7ae38ca1.jpg" alt="51_4_12.jpg"></p><p><img src="https://bu.dusays.com/2023/09/20/6509c7ae730b1.jpg" alt="51_4_13.jpg"></p><h2 id="第二章题目"><a href="#第二章题目" class="headerlink" title="第二章题目"></a>第二章题目</h2><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/uXtIuTI6IBae0z" alt="51_5_1.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/-CdUJcXZCqI95h" alt="51_5_2.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/b-FbyYLlKV4yGa" alt="51_5_3.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/8MI6Rv5pq8Ac73" alt="51_5_4.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/Gnu5GbtTmsrMsc" alt="51_5_5.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/6oF4_ajD6OUueM" alt="51_5_6.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/IESvlE4nBDWVld" alt="51_5_7.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/gLB5CXZVlQawqh" alt="51_5_8.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/9G3nXCoYtDAYGU" alt="51_5_9.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/OnCsnViYEl5fLN" alt="51_5_10.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/fn59N2n6660j5S" alt="51_5_11.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/Gql6WLhuK08V-R" alt="51_5_12.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/Kkv4FZ1IJQmQiY" alt="51_5_13.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/ddR0QBZmZ4YyKc" alt="51_5_14.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/klqQKcHfPCcWXF" alt="51_5_15.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/R775UqM-slB_ev" alt="51_5_16.jpg"></p><h2 id="第三章题目"><a href="#第三章题目" class="headerlink" title="第三章题目"></a>第三章题目</h2><p>best fit（动态分区分配算法中的知识点）：优先用小的空闲区。</p><p><img src="https://bu.dusays.com/2023/09/24/650f171cbcb56.jpg" alt="51_6_1.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171ca0969.jpg" alt="51_6_2.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f17b975f55.jpg" alt="51_6_3.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171d1d731.jpg" alt="51_6_4.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171c8a17d.jpg" alt="51_6_5.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171d7a37c.jpg" alt="51_6_6.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171c7dc24.jpg" alt="51_6_7.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171cd716b.jpg" alt="51_6_8.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171d07733.jpg" alt="51_6_9.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f171d3d78d.jpg" alt="51_6_10.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f180c13de8.jpg" alt="51_6_11.jpg"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/T79bDJPoZBzuyj" alt="51_6_12"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/A3QPiplOvO_ZJS" alt="51_6_13"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/XZPvWKjQPVIokc" alt="51_6_14"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/SFTKa8IMrV4UQV" alt="51_6_15"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/For33_smdVnVXU" alt="51_6_16"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/u-goPXjaGqvV9I" alt="51_6_17"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/YUhz128N62Bki_" alt="51_6_18"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/dqTjKnUFL9DCZu" alt="51_6_19"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/ERn2yjQbkxfhLC" alt="51_6_20"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/HvMQ2Np3x-aN54" alt="51_6_21"></p><h2 id="第四章题目"><a href="#第四章题目" class="headerlink" title="第四章题目"></a>第四章题目</h2><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/nouk9ff56GYTox" alt="51-7-1"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/tTfvEy9PLcn_Bq" alt="51-7-2"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/tC_IUV-MZFC_sv" alt="51-7-3"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/97TJlNpzsirWGR" alt="51-7-4"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/rpPfd48oXEra9f" alt="51-7-5"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/FenZlM9zGiQp8o" alt="51-7-6"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/sq2tRq3AwKwUQL" alt="51-7-7"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/9zSbyUBouhSb8u" alt="51-7-8"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/ERyccl4ogzBiye" alt="51-7-9"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/X2i5ylygZqeJvq" alt="51-7-10"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/SyESeaOUFOQ5iZ" alt="51-7-11"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/kKZVtGInpZsRmH" alt="51-7-12"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/qZJC8odZKzVj4R" alt="51-7-13"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/F-lWLsd-_gQY01" alt="51-7-14"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/8PkPu3Z644pe1J" alt="51-7-15"></p><h2 id="第五章题目"><a href="#第五章题目" class="headerlink" title="第五章题目"></a>第五章题目</h2><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/h24b_V4Sbtou7M" alt="51-8-1"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/TsPaJfPoopoBw5" alt="51-8-2"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/bM3LBKqY60iQGF" alt="51-8-3"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/khtX55bFLUqMoz" alt="51-8-4"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/eWyklMvz69uOwV" alt="51-8-5"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/NKQbnIgNAYcLRI" alt="51-8-6"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/Z_oIgXy9sEKjBH" alt="51-8-7"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/t51puGdjSYbPeB" alt="51-8-8"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/kY-PBvctdIFc6s" alt="51-8-9"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/M0VV7bj8zWyjrz" alt="51-8-10"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/I3t7wymhhAfJAN" alt="51-8-11"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/ScFFgjzZrHAvfZ" alt="51-8-12"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/V6fak3uJHczj0r" alt="51-8-13"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/tfpAn6xyM0rqFj" alt="51-8-14"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/5d1sEQl7S21ai_" alt="51-8-15"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/LVR5L0EYYZ5ufc" alt="51-8-16"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/YxGCZIxYYpLOqw" alt="51-8-17"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/kenR5i5wcpNrFo" alt="51-8-18"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/EAk89k_E5By9h8" alt="51-8-19"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/U6Z3Omvc7iIJ_f" alt="51-8-20"></p><p><img src="https://sway.office.com/s/k8nD8clUxR34WHCL/images/30ho-ZD3sfUpi7" alt="51-8-21"></p><h2 id="操作系统强化课测试"><a href="#操作系统强化课测试" class="headerlink" title="操作系统强化课测试"></a>操作系统强化课测试</h2><div class="row"><iframe src="https://drive.google.com/file/d/1Cw9_kYzQ8SVe1kPwHMWtV6p1hZlQxqqS/preview" style="width:100%; height:550px"></iframe></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;PV-大题知识梳理&quot;&gt;&lt;a href=&quot;#PV-大题知识梳理&quot; class=&quot;headerlink&quot; title=&quot;PV 大题知识梳理&quot;&gt;&lt;/a&gt;PV 大题知识梳理&lt;/h2&gt;&lt;p&gt;pv理发师：&lt;/p&gt;


	&lt;div class=&quot;row&quot;&gt;
		&lt;iframe </summary>
      
    
    
    
    <category term="计算机" scheme="https://loveofpeach.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    
    <category term="OS" scheme="https://loveofpeach.github.io/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>数二强化</title>
    <link href="https://loveofpeach.github.io/posts/55931ee1.html"/>
    <id>https://loveofpeach.github.io/posts/55931ee1.html</id>
    <published>2023-08-22T03:37:17.000Z</published>
    <updated>2023-12-25T04:03:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>跨考一下，不想继续本科专业了，换个专业学学。</p><h2 id="记忆内容"><a href="#记忆内容" class="headerlink" title="记忆内容"></a>记忆内容</h2><p><img src="https://bu.dusays.com/2023/09/06/64f88cd045bbf.jpg" alt="记忆1.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88cd064caf.jpg" alt="记忆2.jpg"></p><p><img src="https://bu.dusays.com/2023/09/17/65070afdd6cd8.jpg" alt="记忆3.jpg"></p><p><img src="https://bu.dusays.com/2023/09/24/650f1c7fbfcf2.jpg" alt="记忆4.jpg"></p><p><img src="https://sway.office.com/s/HOet5N2yuCNtqogN/images/FeizLSpnG5xulD" alt="记忆5.jpg"></p><p><img src="https://sway.office.com/s/HOet5N2yuCNtqogN/images/38Wa6sEatXCjWb" alt="记忆6.jpg"></p><p><img src="https://sway.office.com/s/HOet5N2yuCNtqogN/images/eumUUaHM0iqN6n" alt="记忆7.jpg"></p><p><img src="https://bu.dusays.com/2023/11/11/654f55c727e33.jpg" alt="记忆-8.jpg"></p><p><img src="https://bu.dusays.com/2023/11/18/65582be41ad28.jpg" alt="记忆9.jpg"></p><p><img src="https://bu.dusays.com/2023/11/18/65582ef4e4632.png" alt="记忆10.png"></p><p><img src="https://bu.dusays.com/2023/12/02/656b20f31a2fc.jpg" alt="记忆11.jpg"></p><script type="math/tex; mode=display">1^2+2^2+3^2+ \cdots +n^2=\frac{1}{6}n(n+1)(2n+1)</script><script type="math/tex; mode=display">\int \csc x\, {\rm d}x=\ln |\csc x-\cot x|+C</script><p>一些积分的奇技淫巧：</p><script type="math/tex; mode=display">\int\frac{a\sin x+b\cos x}{c\sin x+d\cos x}\, {\rm d}x\stackrel{待定系数}{=}\int\frac{A(c\cos x-d\sin x)+B(c\sin x+d\cos x)}{c\sin x+d\cos x}\, {\rm d}x</script><script type="math/tex; mode=display">\int_{0}^{\pi} xf(\sin x)\, {\rm d}x=\frac{\pi}{2}\int_{0}^{\pi} f(\sin x)\, {\rm d}x</script><p>区间再现（或称 “区间不变”）：</p><script type="math/tex; mode=display">\int_{a}^{b} f(x)\, {\rm d}x\stackrel{x=a+b-t}{=}\int_{a}^{b} f(a+b-t)\, {\rm d}t</script><p>线性代数：</p><script type="math/tex; mode=display">r(A+B)\leqslant r(A)+r(B)</script><p>设直线 L 的方程为 Ax+By+C=0 ，点 P 的坐标为（x0,y0），则点 P 到直线 L 的距离就是：</p><script type="math/tex; mode=display">\frac{|Ax_0+By_0+C|}{\sqrt{A^2+B^2}}</script><h2 id="中值定理证明题"><a href="#中值定理证明题" class="headerlink" title="中值定理证明题"></a>中值定理证明题</h2><p><img src="https://bu.dusays.com/2023/08/22/64e42e6c6eb7c.jpg" alt="中值定理证明题-01.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6956c85.jpg" alt="中值定理证明题-02.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6be119f.jpg" alt="中值定理证明题-03.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6b10a5a.jpg" alt="中值定理证明题-04.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6b5e9f8.jpg" alt="中值定理证明题-05.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6c78073.jpg" alt="中值定理证明题-06.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6b8970f.jpg" alt="中值定理证明题-07.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6c364cc.jpg" alt="中值定理证明题-08.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e67b88a7.jpg" alt="中值定理证明题-09.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42e6c6e6eb.jpg" alt="中值定理证明题-10.jpg"></p><p><img src="https://bu.dusays.com/2023/08/22/64e42f18e326c.jpg" alt="中值定理证明题-11.jpg"></p><h2 id="严选题"><a href="#严选题" class="headerlink" title="严选题"></a>严选题</h2><p><img src="https://bu.dusays.com/2023/09/06/64f88d3ded921.jpg" alt="严选题-01.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d4399234.jpg" alt="严选题-02.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d42606a8.jpg" alt="严选题-03.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d4482cfc.jpg" alt="严选题-04.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d75678cd.jpg" alt="严选题-05.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d452eb52.jpg" alt="严选题-06.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d4219713.jpg" alt="严选题-07.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d4312ace.jpg" alt="严选题-08.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d40e8d39.jpg" alt="严选题-09.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88d421c329.jpg" alt="严选题-10.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88df4cca0b.jpg" alt="严选题-11.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc76569a.jpg" alt="严选题-12.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc932a17.jpg" alt="严选题-13.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc866846.jpg" alt="严选题-14.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc85d6e6.jpg" alt="严选题-15.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc8ba272.jpg" alt="严选题-16.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc6631c9.jpg" alt="严选题-17.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc664b9d.jpg" alt="严选题-18.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc89f5a4.jpg" alt="严选题-19.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88dc9089d1.jpg" alt="严选题-20.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e80cdb1a.jpg" alt="严选题-21.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e82b4d75.jpg" alt="严选题-22.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e8375f6f.jpg" alt="严选题-23.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e8399956.jpg" alt="严选题-24.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e83e864d.jpg" alt="严选题-25.jpg"></p><p><img src="https://sway.office.com/s/HOet5N2yuCNtqogN/images/iwslomIHO6qY1x" alt="严选题-26.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e8332b21.jpg" alt="严选题-27.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e843cd4d.jpg" alt="严选题-28.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e8454507.jpg" alt="严选题-29.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88e8a2a1ea.jpg" alt="严选题-30.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88fffce3a1.jpg" alt="严选题-31.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88ffdc5828.jpg" alt="严选题-32.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88ffef3f48.jpg" alt="严选题-33.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88ffd913dd.jpg" alt="严选题-34.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88fff1a2c5.jpg" alt="严选题-35.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88ffe7405f.jpg" alt="严选题-36.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88ffda45c5.jpg" alt="严选题-37.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890072db7a.jpg" alt="严选题-38.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88ffe183bb.jpg" alt="严选题-39.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f88fffc6e49.jpg" alt="严选题-40.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890d94e4fe.jpg" alt="严选题-41.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890dbeceb1.jpg" alt="严选题-42.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890dec33b3.jpg" alt="严选题-43.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890ddf2508.jpg" alt="严选题-44.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890e09d8a0.jpg" alt="严选题-45.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890e0dc3af.jpg" alt="严选题-46.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890de3d5d5.jpg" alt="严选题-47.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890e0c7677.jpg" alt="严选题-48.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890df9c40f.jpg" alt="严选题-49.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f890e01431c.jpg" alt="严选题-50.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f89152339d0.jpg" alt="严选题-51.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f89154b2ded.jpg" alt="严选题-52.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f8915442489.jpg" alt="严选题-53.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f89156d3afb.jpg" alt="严选题-54.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f89158104e1.jpg" alt="严选题-55.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f8918166099.jpg" alt="严选题-56.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f89157ad981.jpg" alt="严选题-57.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f89157aa7e0.jpg" alt="严选题-58.jpg"></p><p><img src="https://sway.office.com/s/HOet5N2yuCNtqogN/images/3wLJfG7hFVArDr" alt="严选题-59.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891574a7d1.jpg" alt="严选题-60.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891eba49d3.jpg" alt="严选题-61.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891ed16c88.jpg" alt="严选题-62.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891f0d41f4.jpg" alt="严选题-63.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891f3567aa.jpg" alt="严选题-64.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891f3a40e7.jpg" alt="严选题-65.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891f3eb296.jpg" alt="严选题-66.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891f3d8b3e.jpg" alt="严选题-67.jpg"></p><p><img src="https://bu.dusays.com/2023/09/06/64f891f41f0fb.jpg" alt="严选题-68.jpg"></p><h2 id="真题"><a href="#真题" class="headerlink" title="真题"></a>真题</h2><p>数学的真实（:</p><div class="row"><iframe src="https://drive.google.com/file/d/18s7qMJF6d8zeHbTSth0tZy9sNI90JIaF/preview" style="width:100%; height:550px"></iframe></div><h2 id="网课"><a href="#网课" class="headerlink" title="网课"></a>网课</h2><p>智慧的结晶（:</p><div class="row"><iframe src="https://drive.google.com/file/d/126vaWF2oBPKgwW83vsbcll7eyIRr9vES/preview" style="width:100%; height:550px"></iframe></div><h2 id="李林四-23"><a href="#李林四-23" class="headerlink" title="李林四 23"></a>李林四 23</h2><p>辛酸的挣扎（:</p><div class="row"><iframe src="https://drive.google.com/file/d/1VuVrmEuk568oMvcrS-gbOcl6ZO-WXTzT/preview" style="width:100%; height:550px"></iframe></div><h2 id="超越模拟题-23"><a href="#超越模拟题-23" class="headerlink" title="超越模拟题 23"></a>超越模拟题 23</h2><p>绝望的洒脱（:</p><div class="row"><iframe src="https://drive.google.com/file/d/1zQORNaoRJh9FapiIhTREMHl4xQWU8WGa/preview" style="width:100%; height:550px"></iframe></div><h2 id="张宇八卷-24"><a href="#张宇八卷-24" class="headerlink" title="张宇八卷 24"></a>张宇八卷 24</h2><p>苟延的残喘（:</p><div class="row"><iframe src="https://drive.google.com/file/d/11B7G1iCV0jWBpIOm2l-oZFFiK49VHZRM/preview" style="width:100%; height:550px"></iframe></div><h2 id="李林六-24"><a href="#李林六-24" class="headerlink" title="李林六 24"></a>李林六 24</h2><p>临终的关怀（:</p><div class="row"><iframe src="https://drive.google.com/file/d/1yuO5QXlG-Umqsi5RHCliGfu7_SbRHykG/preview" style="width:100%; height:550px"></iframe></div><h2 id="杂项试卷"><a href="#杂项试卷" class="headerlink" title="杂项试卷"></a>杂项试卷</h2><p>棺的回响（:</p><div class="row"><iframe src="https://drive.google.com/file/d/1AHHsrtnCSgppt7455gxIDkcxjz790hJz/preview" style="width:100%; height:550px"></iframe></div><h2 id="李林四-24"><a href="#李林四-24" class="headerlink" title="李林四 24"></a>李林四 24</h2><p>内心的宁静（:</p><div class="row"><iframe src="https://drive.google.com/file/d/16cD8NIFUEeNytv3PaZN6ZiuIC4HXiukT/preview" style="width:100%; height:550px"></iframe></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;跨考一下，不想继续本科专业了，换个专业学学。&lt;/p&gt;
&lt;h2 id=&quot;记忆内容&quot;&gt;&lt;a href=&quot;#记忆内容&quot; class=&quot;headerlink&quot; title=&quot;记忆内容&quot;&gt;&lt;/a&gt;记忆内容&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://bu.dusays.com/</summary>
      
    
    
    
    <category term="数学" scheme="https://loveofpeach.github.io/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
    <category term="考研数学" scheme="https://loveofpeach.github.io/tags/%E8%80%83%E7%A0%94%E6%95%B0%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>俄罗斯方块</title>
    <link href="https://loveofpeach.github.io/posts/41a3284b.html"/>
    <id>https://loveofpeach.github.io/posts/41a3284b.html</id>
    <published>2023-08-20T11:57:04.000Z</published>
    <updated>2023-12-02T13:48:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>咕咕咕。。。</p><p>在搞了在搞了。。。</p><p>真的没啥时间推进。。。</p><p>vscode 做项目有点不方便啊，再装 vs 有点麻烦。。。</p><p>真的拖了很久了。。。</p><p>很久很久以前，有一个小白励志用 C++ 做一个俄罗斯方块，后来他觉得没必要和自己过不去，不如用 Python 做，后来幽于名为“应试”的缧绁之中，然后就没有然后了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;咕咕咕。。。&lt;/p&gt;
&lt;p&gt;在搞了在搞了。。。&lt;/p&gt;
&lt;p&gt;真的没啥时间推进。。。&lt;/p&gt;
&lt;p&gt;vscode 做项目有点不方便啊，再装 vs 有点麻烦。。。&lt;/p&gt;
&lt;p&gt;真的拖了很久了。。。&lt;/p&gt;
&lt;p&gt;很久很久以前，有一个小白励志用 C++ 做一个俄罗斯方块，后来</summary>
      
    
    
    
    <category term="编程" scheme="https://loveofpeach.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="C++" scheme="https://loveofpeach.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>听《二泉》</title>
    <link href="https://loveofpeach.github.io/posts/bf733412.html"/>
    <id>https://loveofpeach.github.io/posts/bf733412.html</id>
    <published>2023-07-30T16:54:25.000Z</published>
    <updated>2024-01-28T18:19:04.720Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tse2-mm.cn.bing.net/th/id/OIP-C.4JgaeLzyr2oAt-IPnCV-fAHaE8" alt="48-1" title="来自网络"></p><p>无锡某处的阿炳雕像曾给我留下深刻的印象。乍看上去，他好像并非哪里的伟人，竟是和芸芸众生一样，受难之后低下自己的头颅，满不在乎地继续生活。但他谦卑地戴上帽子，架着圆形的墨镜，支起二胡，撑开右臂，彷佛将要用磅礴无尽的力量推出弓时——时间于此刻凝固。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="https://player.bilibili.com/player.html?bvid=BV1xb411a7hx&page=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position:absolute; height: 100%; width: 100%;"> </iframe></div><p><br></p><p>一些演奏会上的二泉映月，技巧高超，细节饱满丰富，还有很多其他乐器的伴奏，但是却不一定能像这个视频里的一样触动人心。</p><p>事实上，如果能“有幸”见到一个真正的靠着街头卖艺讨生活的人，你会更加深刻地认识到：人是被命运卷入其中的。</p><p>十几年前，C 市的路上还跑着数不清的人力三轮，市中心（现在已是旧城区）的街道边，或是唯一一家肯德基的门店前，常常能遇到这样的卖艺人。他们的技巧非常粗糙，甚至可以说是刚刚能把音发出来，有人的琴不知是不是自己做的，弦还打着结，一个非常简陋的，送别人都没人要的琴。然而就是这样的琴，拉出的二泉（也许还是和同行学的），却最能撬动人心设防的深处。因为那些演奏会上的二泉，太过从容，太过华丽，太过完美，也太过奢侈了。而这些街头的人，才构成了我们这个社会真实图景的一角。</p><p>这种感情是人类共通的，德富芦花曾写道：</p><blockquote><p>呜呼，我本东西南北人。我曾经夜泊于赤马关外，和着潮声而慷慨悲歌；我曾经客旅于北越，夜闻离别之曲而悲泣。我曾经于月明风清之夜，耳听着中国海上的欸乃之声；又曾经在一个雪天的清晨，行进于南萨的道上，听赶马人的歌唱。这些都打动了我的心扉。而那街头的一片市声，却不能使我肝肠寸断。</p></blockquote><p>中国宣布全面脱贫的夏天，我在上海见过皮肤黝黑、赤裸着上身流浪乞讨的男人。蜗居北京的日子里，也遇到不少在北京西站负一层躺下休息的男女、孩子，也许我的境遇也只比他们好一点。</p><p>德富芦花在听 <i>Still sad music of humanity</i> 时，感受到无数不可名状的苦恼，无数的鲜血，无数的眼泪。</p><p>这固然是深刻的体会。而我在《二泉》中感受到的情愫，与下面两句诗颇有相通之处：</p><blockquote><p>春风桃李花开日，秋雨梧桐叶落时。<br>西宫南苑多秋草，落叶满阶红不扫。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tse2-mm.cn.bing.net/th/id/OIP-C.4JgaeLzyr2oAt-IPnCV-fAHaE8&quot; alt=&quot;48-1&quot; title=&quot;来自网络&quot;&gt;&lt;/p&gt;
&lt;p&gt;无锡某处的阿炳雕像曾给我留下深刻的印象。乍看上去，他好</summary>
      
    
    
    
    <category term="闲文" scheme="https://loveofpeach.github.io/categories/%E9%97%B2%E6%96%87/"/>
    
    
    <category term="音乐" scheme="https://loveofpeach.github.io/tags/%E9%9F%B3%E4%B9%90/"/>
    
  </entry>
  
  <entry>
    <title>算法题集子</title>
    <link href="https://loveofpeach.github.io/posts/53401ab0.html"/>
    <id>https://loveofpeach.github.io/posts/53401ab0.html</id>
    <published>2023-07-12T15:15:24.000Z</published>
    <updated>2023-12-25T06:52:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>一道题开一篇文章实在浪费，于是决定以后零零散散做的题就放在这个集子里了。如果数量过多会考虑再开。</p><h2 id="JSOI2004-平衡点（模拟退火）"><a href="#JSOI2004-平衡点（模拟退火）" class="headerlink" title="JSOI2004 平衡点（模拟退火）"></a>JSOI2004 平衡点（模拟退火）</h2><p><strong>提交入口</strong></p><p><a href="https://www.luogu.com.cn/problem/P1337">https://www.luogu.com.cn/problem/P1337</a></p><p><strong>题目描述</strong></p><p>如图，有 $n$ 个重物，每个重物系在一条足够长的绳子上。</p><p>每条绳子自上而下穿过桌面上的洞，然后系在一起。图中 $x$ 处就是公共的绳结。假设绳子是完全弹性的（即不会造成能量损失），桌子足够高（重物不会垂到地上），且忽略所有的摩擦，求绳结 $x$ 最终平衡于何处。</p><p><strong>注意</strong>：桌面上的洞都比绳结 $x$ 小得多，所以即使某个重物特别重，绳结 $x$ 也不可能穿过桌面上的洞掉下来，最多是卡在某个洞口处。</p><p><img src="https://cdn.luogu.com.cn/upload/pic/148.png" alt="47-1"></p><p><strong>输入格式</strong></p><p>文件的第一行为一个正整数 $n$（$1\le n\le 1000$），表示重物和洞的数目。</p><p>接下来的 $n$ 行，每行是 $3$ 个整数 $x_i, y_i, w_i$，分别表示第 $i$ 个洞的坐标以及第 $i$ 个重物的重量。（$-10000\le x_i,y_i\le10000, 0&lt;w_i\le1000$）</p><p><strong>输出格式</strong></p><p>你的程序必须输出两个浮点数（保留小数点后三位），分别表示处于最终平衡状态时绳结 $x$ 的横坐标和纵坐标。两个数以一个空格隔开。</p><p><strong>样例输入 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">0 0 1</span><br><span class="line">0 2 1</span><br><span class="line">1 1 1</span><br></pre></td></tr></table></figure><p><strong>样例输出 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.577 1.000</span><br></pre></td></tr></table></figure><p><strong>分析</strong></p><p>待续。先贴代码。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN =<span class="number">1e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,g[MAXN];</span><br><span class="line"><span class="type">double</span> minlen=DBL_MAX;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    <span class="type">double</span> x, y;</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">double</span> a=<span class="number">0.0</span>, <span class="type">double</span> b=<span class="number">0.0</span>):<span class="built_in">x</span>(a),<span class="built_in">y</span>(b)&#123;&#125;</span><br><span class="line">&#125;P[MAXN];</span><br><span class="line">Point ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">Sqr</span><span class="params">(<span class="type">double</span> x)</span></span>&#123;<span class="keyword">return</span> x*x;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">Rand</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">double</span>(<span class="built_in">rand</span>())/<span class="built_in">double</span>(RAND_MAX);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">dis</span><span class="params">(Point a,Point b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">Sqr</span>(a.x-b.x)+<span class="built_in">Sqr</span>(a.y-b.y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">accept</span><span class="params">(<span class="type">double</span> delta,<span class="type">double</span> temp)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> delta&lt;<span class="number">0</span>||<span class="built_in">Rand</span>()&lt;<span class="built_in">exp</span>(-delta/temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">calc</span><span class="params">(Point origin)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> len=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        len+=<span class="built_in">dis</span>(origin,P[i])*g[i];</span><br><span class="line">    <span class="keyword">if</span>(len&lt;minlen)&#123;</span><br><span class="line">        ans=origin;</span><br><span class="line">        minlen=len;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SA</span><span class="params">(Point ans0,<span class="type">double</span> T0,<span class="type">double</span> dec,<span class="type">double</span> end)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> temp=T0;</span><br><span class="line">    Point nowpos=ans0;</span><br><span class="line">    <span class="type">double</span> nowlen=<span class="built_in">calc</span>(nowpos);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(temp&gt;end)&#123;</span><br><span class="line">        Point nextpos=<span class="built_in">Point</span>(nowpos.x+temp*(<span class="built_in">Rand</span>()*<span class="number">2</span><span class="number">-1</span>),nowpos.y+temp*(<span class="built_in">Rand</span>()*<span class="number">2</span><span class="number">-1</span>));</span><br><span class="line">        <span class="type">double</span> nlen=<span class="built_in">calc</span>(nextpos);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">accept</span>(nlen-nowlen,temp))&#123;</span><br><span class="line">            nowpos=nextpos;</span><br><span class="line">            nowlen=nlen;</span><br><span class="line">        &#125;</span><br><span class="line">        temp*=dec;   <span class="comment">//dec为退火系数 </span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++)&#123; <span class="comment">//精度维护</span></span><br><span class="line">        Point rnd=<span class="built_in">Point</span>(ans.x+temp*(<span class="built_in">Rand</span>()*<span class="number">2</span><span class="number">-1</span>),ans.y+temp*(<span class="built_in">Rand</span>()*<span class="number">2</span><span class="number">-1</span>));</span><br><span class="line">        <span class="built_in">calc</span>(rnd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    Point init;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%d&quot;</span>,&amp;P[i].x,&amp;P[i].y,&amp;g[i]);</span><br><span class="line">        init.x+=P[i].x;</span><br><span class="line">        init.y+=P[i].y;</span><br><span class="line">    &#125;</span><br><span class="line">    init.x/=n;</span><br><span class="line">    init.y/=n;</span><br><span class="line">    <span class="built_in">SA</span>(init,<span class="number">1e5</span>,<span class="number">1</span><span class="number">-1e-2</span>,<span class="number">1e-3</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.3f %.3f\n&quot;</span>,ans.x,ans.y);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="有机化学之神偶尔会做作弊（tarjan-lca）"><a href="#有机化学之神偶尔会做作弊（tarjan-lca）" class="headerlink" title="有机化学之神偶尔会做作弊（tarjan, lca）"></a>有机化学之神偶尔会做作弊（tarjan, lca）</h2><p><strong>提交入口</strong></p><p><a href="https://www.luogu.com.cn/problem/P2783">https://www.luogu.com.cn/problem/P2783</a></p><p><strong>题意简述</strong></p><p>给你一个 $n$ 个点，$m$ 条边的无向图。把图中所有的环变为一个点，求变化后某两个点之间有多少个点。</p><p><strong>输入格式</strong></p><p>第一行两个整数 $n$，$m$。表示有 $n$ 个点，$m$ 根键。</p><p>接下来 $m$ 行每行两个整数 $u$，$v$ 表示 $u$ 号碳和 $v$ 号碳有一根键。</p><p>接下来一个整数 $tot$ 表示询问次数。</p><p>接下来 $tot$ 行每行两个整数，$a$，$b$ 表示询问的两个碳的编号。</p><p><strong>输出格式</strong></p><p>共 $tot$ 行，每行一个二进制数，表示答案。</p><p><strong>样例输入 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3 2</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br><span class="line">2</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br></pre></td></tr></table></figure><p><strong>样例输出 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">10</span><br></pre></td></tr></table></figure><p><strong>提示</strong></p><p>两个碳不成环。</p><p><strong>数据范围及约定</strong></p><p>对于 $100\%$ 的数据，$1&lt;n\le10 ^ 4$，$1&lt;m\le5\times 10 ^ 4$。</p><p><strong>分析</strong></p><p>先给出一份超时代码，82 pts.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(a,b) ((a)&gt;(b)?(a):(b))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(a,b) ((a)&lt;(b)?(a):(b))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">1e4</span>+<span class="number">3</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxm=<span class="number">1e5</span>+<span class="number">3</span>;</span><br><span class="line"><span class="comment">// Edge_number in a general graph is twice that of a one-way graph</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;<span class="type">int</span> v,next;&#125;;</span><br><span class="line">Edge edge[maxm],edge2[maxm];</span><br><span class="line"><span class="type">int</span> head[maxn],dfn[maxn],low[maxn],stac[maxn],color[maxn];</span><br><span class="line"><span class="type">int</span> n,m,tot,num,top,cnt,tot_in_txt,lcafa[maxn][<span class="number">25</span>];</span><br><span class="line"><span class="type">int</span> head2[maxn],tot2,dep[maxn],max0;</span><br><span class="line"><span class="type">bool</span> ins[maxn];</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> topow[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">128</span>,<span class="number">256</span>,<span class="number">512</span>,<span class="number">1024</span>,<span class="number">2048</span>,<span class="number">4096</span>,<span class="number">8192</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rd</span><span class="params">(<span class="type">int</span> &amp;x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> w=x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||<span class="string">&#x27;9&#x27;</span>&lt;ch) w|=(ch==<span class="string">&#x27;-&#x27;</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(<span class="string">&#x27;0&#x27;</span>&lt;=ch&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="string">&#x27;0&#x27;</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    x=w?-x:x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    edge[++tot].v=y;</span><br><span class="line">    edge[tot].next=head[x];</span><br><span class="line">    head[x]=tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge2</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    edge2[++tot2].v=y;</span><br><span class="line">    edge2[tot2].next=head2[x];</span><br><span class="line">    head2[x]=tot2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> from)</span></span>&#123;</span><br><span class="line">    low[x]=dfn[x]=++num;</span><br><span class="line">    stac[++top]=x; ins[x]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="type">int</span> y=edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(y==from)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[y])&#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(y, x);</span><br><span class="line">            low[x]=<span class="built_in">MIN</span>(low[x],low[y]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ins[y])&#123;</span><br><span class="line">            low[x]=<span class="built_in">MIN</span>(low[x],dfn[y]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[x]==low[x])&#123;</span><br><span class="line">        ++cnt; <span class="type">int</span> y;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            y=stac[top--]; ins[y]=<span class="literal">false</span>;</span><br><span class="line">            color[y]=cnt;</span><br><span class="line">        &#125;<span class="keyword">while</span>(x!=y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lcainit</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=max0;i++)</span><br><span class="line">        <span class="keyword">if</span>(lcafa[x][i<span class="number">-1</span>])lcafa[x][i]=lcafa[lcafa[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head2[x];i;i=edge2[i].next)&#123;</span><br><span class="line">        <span class="type">int</span> y=edge2[i].v;</span><br><span class="line">        <span class="keyword">if</span>(y!=lcafa[x][<span class="number">0</span>])&#123;</span><br><span class="line">            lcafa[y][<span class="number">0</span>]=x;</span><br><span class="line">            dep[y]=dep[x]+<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">lcainit</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[u]&lt;dep[v])<span class="built_in">swap</span>(u,v);</span><br><span class="line">    <span class="type">int</span> delta=dep[u]-dep[v];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x=<span class="number">0</span>; x&lt;=max0; x++)</span><br><span class="line">        <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;x)&amp;delta)u=lcafa[u][x];</span><br><span class="line">    <span class="keyword">if</span>(u==v)<span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x=max0; ~x; x--)</span><br><span class="line">        <span class="keyword">if</span>(lcafa[u][x]!=lcafa[v][x])&#123;</span><br><span class="line">            u=lcafa[u][x];</span><br><span class="line">            v=lcafa[v][x];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> lcafa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">rd</span>(n); <span class="built_in">rd</span>(m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        <span class="built_in">rd</span>(x); <span class="built_in">rd</span>(y);</span><br><span class="line">        <span class="built_in">addedge</span>(x,y);</span><br><span class="line">        <span class="built_in">addedge</span>(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rd</span>(tot_in_txt);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[i])<span class="built_in">tarjan</span>(i, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x=<span class="number">1</span>;x&lt;=n;x++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="type">int</span> y=edge[i].v;</span><br><span class="line">            <span class="keyword">if</span>(color[x]!=color[y])&#123;</span><br><span class="line">                <span class="built_in">addedge2</span>(color[x], color[y]);</span><br><span class="line">                <span class="built_in">addedge2</span>(color[y], color[x]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    max0=(<span class="type">int</span>)(<span class="built_in">log</span>(cnt)/<span class="built_in">log</span>(<span class="number">2</span>))+<span class="number">3</span>;</span><br><span class="line">    <span class="built_in">lcainit</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(tot_in_txt--)&#123;</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        <span class="built_in">rd</span>(a); <span class="built_in">rd</span>(b);</span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">lca</span>(color[a], color[b]);</span><br><span class="line">        <span class="type">int</span> temp = dep[color[a]] + dep[color[b]] - (dep[k]&lt;&lt;<span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> ans[<span class="number">15</span>] = <span class="string">&quot;00000000000000&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">13</span>; ~i; i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(temp&gt;=topow[i])&#123;</span><br><span class="line">                ans[<span class="number">13</span>-i] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">                temp -= topow[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(ans[i]==<span class="string">&#x27;0&#x27;</span>) i++;</span><br><span class="line">        <span class="keyword">for</span>(; i&lt;=<span class="number">13</span>; i++)<span class="built_in">putchar</span>(ans[i]);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="yLOI2022-枕万梦（排序）"><a href="#yLOI2022-枕万梦（排序）" class="headerlink" title="yLOI2022 枕万梦（排序）"></a>yLOI2022 枕万梦（排序）</h2><p><strong>提交入口</strong></p><p><a href="https://www.luogu.com.cn/problem/P9472">https://www.luogu.com.cn/problem/P9472</a></p><p><strong>题目描述</strong></p><p>天亮了，扶苏不敌困意，早早地进入了梦乡。在失去引力的梦里，扶苏遇到了好多串漂浮着的数列，它们的长度都相等，而且都是美妙的等比数列！出于本能，扶苏想要把这些数列按照字典序排序，可是在梦里扶苏失去了思考的能力，请你来帮帮她！</p><p>具体地，有 $n$ 个编号从 $1$ 到 $n$ 的数列 $a_1, a_2, \dots a_n$，每个数列的长度均为 $m + 1$。第 $i$ 个数列 $a_i$ 满足递推式 $a_{i,j} = a_{i,j - 1} \times i$，其中 $1 \leq j \leq m$。而扶苏会告诉你每个序列的首项 $a_{i,0}$，你需要帮助她把这些数列按字典序排序。</p><p><strong>输入格式</strong></p><p>输入的第一行是两个整数，依次表示 $n$ 和 $m$。<br>接下来 $n$ 行，每行一个整数，第 $i$ 行的整数表示数列 $a_i$ 的首项 $a_{i,0}$。</p><p><strong>输出格式</strong></p><p>输出一行 $n$ 个整数，第 $i$ 个整数表示字典序第 $i$ 小的数列的<strong>编号</strong>。</p><p><strong>样例 #1</strong></p><p><strong>样例输入 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 2</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p><strong>样例输出 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br></pre></td></tr></table></figure><p><strong>样例 #2</strong></p><p><strong>样例输入 #2</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 3</span><br><span class="line">1</span><br><span class="line">-1</span><br></pre></td></tr></table></figure><p><strong>样例输出 #2</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 1</span><br></pre></td></tr></table></figure><p><strong>样例 #3</strong></p><p><strong>样例输入 #3</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 2</span><br><span class="line">1</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p><strong>样例输出 #3</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br></pre></td></tr></table></figure><p><strong>样例 #4</strong></p><p><strong>样例输入 #4</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">见附加文件中的 B4.in</span><br></pre></td></tr></table></figure><p><strong>样例输出 #4</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">见附加文件中的 B4.ans</span><br></pre></td></tr></table></figure><p><strong>提示</strong></p><p><strong>样例 1 解释</strong></p><p>共有两个数列，每个数列的长度均为 $2+1=3$。</p><p>对第一个数列 $a_1$：</p><ul><li>已知其首项 $a_{1,0} = 1$。</li><li>根据 $a_{i,j} = a_{i,j - 1} \times i$，取 $i=1,j = 1$ 可以得到 $a_{1,1} = a_{1,0} \times 1 = 1$。</li><li>根据 $a_{i,j} = a_{i,j - 1} \times i$，取 $i=1,j = 2$ 可以得到 $a_{1,2} = a_{1,1} \times 1= 1$。</li></ul><p>所以数列 $a_1$ 是 $1,1,1$。</p><p>对第二个数列 $a_2$：</p><ul><li>已知其首项 $a_{2,0} = 2$。</li><li>根据 $a_{i,j} = a_{i,j - 1} \times i$，取 $i=2,j = 1$ 可以得到 $a_{2,1} = a_{2,0} \times 2 = 2 \times 2 = 4$。</li><li>根据 $a_{i,j} = a_{i,j - 1} \times i$，取 $i=2,j = 2$ 可以得到 $a_{2,2} = a_{2,1} \times 2= 4 \times 2 = 8$。</li></ul><p>所以数列 $a_2$ 是 $2,4,8$。</p><p>比较字典序可得数列 $a_1$ 是字典序最小的数列。所以输出 $1$。</p><p><strong>样例 2 解释</strong></p><p>数列 $a_1$ 为 $1,1,1,1$，数列 $a_2$ 为 $-1, -2,-4,-8$。</p><p><strong>数据规模与约定</strong><br>本题共 $10$ 个测试点，各测试点信息如下表：</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/08wnuome.png" alt="47-2"></p><p>特殊约定 A：保证 $a_{i,0}$ 均相等。<br>特殊约定 B：保证 $a_{i,0}$ 互不相等。</p><p>对全部的测试点，保证 $1 \leq n \leq 10^5$，$1 \leq m \leq 10^9$，$1 \leq |a_{i,0}| \leq 10^9$。</p><p><strong>提示</strong></p><p>对两个数列 $a_i, a_j$，按如下方式比较其字典序：</p><p>找到<strong>最小的</strong>满足 $a_{i,p} \neq a_{j, p}$ 的下标 $p$，比较 $a_{i, p}$ 和 $a_{j, p}$ 的大小：</p><ul><li>如果 $a_{i,p} &lt; a_{j, p}$，则称 $a_i$ 的字典序比 $a_j$ 的小。</li><li>如果 $a_{i,p} &gt; a_{j, p}$，则称 $a_i$ 的字典序比 $a_j$ 的大。</li></ul><p>可以证明，在本题的限制下，这样的 $p$ 一定存在。</p><p><strong>分析</strong></p><p>要求根据字典序排序。若两个数列第一个元素就不等，便可比较大小；若两个数列第一个元素相等，由数列定义，第二个元素必然不等，于是可比较大小。对于首元素为零的数列，整个数列都是零。由此得到下述做法：</p><p>对于两个不等的 $a_{i,0}$ , 升序排序。对于两个相等的 $a_{i,0}$ , 分正负两种情况：若 $a_{i,0}&gt;0$ , 则行数越大，位序靠后；若 $a_{i,0}&lt;0$ , 则行数越大，位序靠前。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> LL = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">LL n,m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">mnode</span>&#123;</span><br><span class="line">    LL mcontent;</span><br><span class="line">    LL mindex;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> mnode&amp; v)<span class="type">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mcontent != v.mcontent)</span><br><span class="line">            <span class="keyword">return</span> mcontent &lt; v.mcontent;</span><br><span class="line">        <span class="keyword">else</span>    </span><br><span class="line">            <span class="keyword">if</span>(mcontent &gt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> mindex &lt; v.mindex;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">return</span> mindex &gt; v.mindex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;marray[<span class="number">100010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(LL i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        LL x; </span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;x);</span><br><span class="line">        marray[i].mcontent = x;</span><br><span class="line">        marray[i].mindex = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(marray+<span class="number">1</span>, marray+<span class="number">1</span>+n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(LL i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>,marray[i].mindex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="平衡二叉树"><a href="#平衡二叉树" class="headerlink" title="平衡二叉树"></a>平衡二叉树</h2><p>最近考研应试之余，尝试着用王道的思路手写了平衡二叉树的代码，但是没有完成，只是个半成品。如果之后还记得的话，也许我会完成它？</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(a,b) ((a)&gt;(b)?(a):(b))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rd</span><span class="params">(<span class="type">int</span> &amp;x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> w=x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||<span class="string">&#x27;9&#x27;</span>&lt;ch) w|=(ch==<span class="string">&#x27;-&#x27;</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(<span class="string">&#x27;0&#x27;</span>&lt;=ch&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="string">&#x27;0&#x27;</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    x=w?-x:x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">avlNode</span>&#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="type">int</span> cnt;</span><br><span class="line">    <span class="type">int</span> lsub_h;   <span class="comment">//left sub_tree&#x27;s height</span></span><br><span class="line">    <span class="type">int</span> rsub_h;</span><br><span class="line">    <span class="type">int</span> lsub_num; <span class="comment">//size of leftSubtree, excluding itself</span></span><br><span class="line">    <span class="type">int</span> rsub_num;</span><br><span class="line">    avlNode *lchild, *rchild, *fa;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">avlTree</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">avlTree</span>()&#123; T = <span class="literal">nullptr</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">getRoot</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> T; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insertX</span><span class="params">(avlNode*&amp; K, <span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        avlNode* p = <span class="built_in">bstInsert</span>(K, x, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">maintain_balance_insert</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deleteX</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;  <span class="comment">// assume there is x</span></span><br><span class="line">        avlNode* p = <span class="built_in">find_X_delete</span>(T, x);</span><br><span class="line">        p-&gt;cnt--;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;cnt&gt;=<span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(p-&gt;lchild==<span class="literal">nullptr</span>&amp;&amp;p-&gt;rchild==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p==p-&gt;fa-&gt;lchild)</span><br><span class="line">                p-&gt;fa-&gt;lchild = <span class="literal">nullptr</span>;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                p-&gt;fa-&gt;rchild = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p-&gt;lchild!=<span class="literal">nullptr</span>&amp;&amp;p-&gt;rchild==<span class="literal">nullptr</span>)&#123; <span class="comment">// !</span></span><br><span class="line">            <span class="keyword">if</span>(p==p-&gt;fa-&gt;lchild)</span><br><span class="line">                p-&gt;fa-&gt;lchild = p-&gt;lchild;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                p-&gt;fa-&gt;rchild = p-&gt;lchild;</span><br><span class="line">            p-&gt;lchild-&gt;fa = p-&gt;fa;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p-&gt;lchild==<span class="literal">nullptr</span>&amp;&amp;p-&gt;rchild!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p==p-&gt;fa-&gt;lchild)</span><br><span class="line">                p-&gt;fa-&gt;lchild = p-&gt;rchild;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                p-&gt;fa-&gt;rchild = p-&gt;rchild;</span><br><span class="line">            p-&gt;rchild-&gt;fa = p-&gt;fa;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            avlNode* qwq = <span class="built_in">maxValue_in_lsubtree</span>(p);</span><br><span class="line">            p-&gt;value = qwq-&gt;value;</span><br><span class="line">            p-&gt;cnt = qwq-&gt;cnt;</span><br><span class="line">            p = qwq;</span><br><span class="line">            <span class="keyword">if</span>(p==p-&gt;fa-&gt;lchild)</span><br><span class="line">                p-&gt;fa-&gt;lchild = p-&gt;lchild;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                p-&gt;fa-&gt;rchild = p-&gt;lchild;</span><br><span class="line">            p-&gt;lchild-&gt;fa = p-&gt;fa;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">maintain_balance_delete</span>(p);</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">index_X</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="comment">//find an avlNode whose value is x，return its index</span></span><br><span class="line">        <span class="comment">//at this point, the binary-tree is balanced</span></span><br><span class="line">        avlNode* p = <span class="built_in">find_X</span>(T, x);   <span class="comment">// O(logN)</span></span><br><span class="line">        <span class="type">int</span> ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p==p-&gt;fa-&gt;rchild)&#123;</span><br><span class="line">            avlNode* G = <span class="built_in">find_left_daddy</span>(p);</span><br><span class="line">            ans = G-&gt;lsub_num + G-&gt;rsub_num + G-&gt;cnt</span><br><span class="line">                  - p-&gt;rsub_num - p-&gt;cnt + <span class="number">1</span>;</span><br><span class="line">                  <span class="comment">//+1: the value-x avlNode goes the end</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p==p-&gt;fa-&gt;lchild)&#123;</span><br><span class="line">            avlNode* G = <span class="built_in">find_right_daddy</span>(p);</span><br><span class="line">            ans = G-&gt;fa-&gt;lsub_num + G-&gt;fa-&gt;cnt</span><br><span class="line">                  + p-&gt;lsub_num + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans==<span class="number">-1</span>) <span class="built_in">printf</span>(<span class="string">&quot;No such avlNode.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findIndex_X</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Query the avlNode whose index is x, return its value</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">preX</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">afterX</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">avlNode* <span class="title">find_X</span><span class="params">(avlNode* K, <span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(K!=<span class="literal">nullptr</span> &amp;&amp; x!=K-&gt;value)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;K-&gt;value) K=K-&gt;lchild;</span><br><span class="line">            <span class="keyword">else</span> K=K-&gt;rchild;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(K==<span class="literal">nullptr</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;function find_X() failed.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> K;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">find_X_delete</span><span class="params">(avlNode* K, <span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(K!=<span class="literal">nullptr</span> &amp;&amp; x!=K-&gt;value)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;K-&gt;value)&#123;</span><br><span class="line">                K-&gt;lsub_num--;</span><br><span class="line">                K=K-&gt;lchild;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                K-&gt;rsub_num--;</span><br><span class="line">                K=K-&gt;rchild;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(K==<span class="literal">nullptr</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;function find_X() failed.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> K;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">find_left_daddy</span><span class="params">(avlNode* p)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">find_right_daddy</span><span class="params">(avlNode* p)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lsubtree_height</span><span class="params">(avlNode* x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;lsub_h) <span class="keyword">return</span> x-&gt;lsub_h;</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;lchild==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            x-&gt;lsub_h = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> x-&gt;lsub_h;</span><br><span class="line">        &#125;</span><br><span class="line">        x-&gt;lsub_h = <span class="built_in">MAX</span>(<span class="built_in">lsubtree_height</span>(x-&gt;lchild), </span><br><span class="line">                        <span class="built_in">rsubtree_height</span>(x-&gt;lchild))+ <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> x-&gt;lsub_h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">rsubtree_height</span><span class="params">(avlNode* x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;rsub_h) <span class="keyword">return</span> x-&gt;rsub_h;</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;rchild==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            x-&gt;rsub_h = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> x-&gt;rsub_h;</span><br><span class="line">        &#125;</span><br><span class="line">        x-&gt;rsub_h = <span class="built_in">MAX</span>(<span class="built_in">lsubtree_height</span>(x-&gt;rchild), </span><br><span class="line">                        <span class="built_in">rsubtree_height</span>(x-&gt;rchild))+ <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> x-&gt;rsub_h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">find_Unbalanced_Node</span><span class="params">(avlNode* p)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> sub_balance = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(sub_balance&gt;=<span class="number">-1</span>&amp;&amp;sub_balance&lt;=<span class="number">1</span>)&#123; <span class="comment">//sub_balance = 0,1,-1</span></span><br><span class="line">            p = p-&gt;fa;</span><br><span class="line">            <span class="keyword">if</span>(p==<span class="literal">nullptr</span>) <span class="keyword">return</span> p;</span><br><span class="line">            p-&gt;lsub_h = p-&gt;rsub_h = <span class="number">0</span>; <span class="comment">// erase old data</span></span><br><span class="line">            <span class="type">int</span> lch = <span class="built_in">lsubtree_height</span>(p);</span><br><span class="line">            <span class="type">int</span> rch = <span class="built_in">rsubtree_height</span>(p);</span><br><span class="line">            sub_balance = lch-rch;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">bstInsert</span><span class="params">(avlNode* K, <span class="type">int</span> x, avlNode* myfa)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(K==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            K = <span class="keyword">new</span> avlNode;</span><br><span class="line">            K-&gt;value = x;</span><br><span class="line">            K-&gt;fa = myfa;</span><br><span class="line">            K-&gt;lchild = K-&gt;rchild = <span class="literal">nullptr</span>;</span><br><span class="line">            <span class="keyword">return</span> K;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x==K-&gt;value)&#123;</span><br><span class="line">            K-&gt;cnt++;</span><br><span class="line">            <span class="keyword">return</span> K;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x &lt; K-&gt;value)&#123;</span><br><span class="line">            K-&gt;lsub_num++;     <span class="comment">// nice code &lt;(ˉ^ˉ)&gt;</span></span><br><span class="line">            <span class="built_in">bstInsert</span>(K-&gt;lchild, x, K);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            K-&gt;rsub_num++;</span><br><span class="line">            <span class="built_in">bstInsert</span>(K-&gt;rchild, x, K);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">maintain_balance_insert</span><span class="params">(avlNode* p)</span></span>&#123;</span><br><span class="line">        avlNode* subroot = <span class="built_in">find_Unbalanced_Node</span>(p);</span><br><span class="line">        <span class="comment">// after find_Unbalanced_Node, lsub_h &amp; rsub_h is updated</span></span><br><span class="line">        <span class="keyword">if</span>(subroot-&gt;lchild-&gt;lsub_h==subroot-&gt;lchild-&gt;rsub_h+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">rightRotation</span>(subroot-&gt;lchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(subroot-&gt;rchild-&gt;lsub_h+<span class="number">1</span>==subroot-&gt;rchild-&gt;rsub_h)&#123;</span><br><span class="line">            <span class="built_in">leftRotation</span>(subroot-&gt;rchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(subroot-&gt;lchild-&gt;lsub_h+<span class="number">1</span>==subroot-&gt;lchild-&gt;rsub_h)&#123;</span><br><span class="line">            <span class="built_in">leftRotation</span>(subroot-&gt;lchild-&gt;rchild);</span><br><span class="line">            <span class="built_in">rightRotation</span>(subroot-&gt;lchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(subroot-&gt;rchild-&gt;lsub_h==subroot-&gt;rchild-&gt;rsub_h+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">rightRotation</span>(subroot-&gt;rchild-&gt;lchild);</span><br><span class="line">            <span class="built_in">leftRotation</span>(subroot-&gt;rchild);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">maintain_balance_delete</span><span class="params">(avlNode* p)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 删除的节点向上计算 balance</span></span><br><span class="line">        avlNode* subroot = <span class="built_in">find_Unbalanced_Node</span>(p);</span><br><span class="line">        <span class="keyword">if</span>(subroot==<span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// to do </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">leftRotation</span><span class="params">(avlNode* p)</span></span>&#123;</span><br><span class="line">        avlNode *f = p-&gt;fa, *gf = f-&gt;fa;</span><br><span class="line">        f-&gt;rchild = p-&gt;lchild;</span><br><span class="line">        f-&gt;rsub_num = p-&gt; lsub_num;</span><br><span class="line">        f-&gt;rchild-&gt;fa = f;</span><br><span class="line">        p-&gt;lchild = f;</span><br><span class="line">        p-&gt;lsub_num = f-&gt;lsub_num + f-&gt;rsub_num + <span class="number">1</span>;</span><br><span class="line">        f-&gt;fa = p;</span><br><span class="line">        <span class="keyword">if</span>(gf-&gt;lchild==f)&#123;</span><br><span class="line">            gf-&gt;lchild = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(gf-&gt;rchild==f)&#123;</span><br><span class="line">            gf-&gt;rchild = p;</span><br><span class="line">        &#125;</span><br><span class="line">        p-&gt;fa = gf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rightRotation</span><span class="params">(avlNode* p)</span></span>&#123;</span><br><span class="line">        avlNode *f = p-&gt;fa, *gf = f-&gt;fa;</span><br><span class="line">        f-&gt;lchild = p-&gt;rchild;</span><br><span class="line">        f-&gt;lsub_num = p-&gt; rsub_num;</span><br><span class="line">        f-&gt;lchild-&gt;fa = f;</span><br><span class="line">        p-&gt;rchild = f;</span><br><span class="line">        p-&gt;rsub_num = f-&gt;lsub_num + f-&gt;rsub_num + <span class="number">1</span>;</span><br><span class="line">        f-&gt;fa = p;</span><br><span class="line">        <span class="keyword">if</span>(gf-&gt;lchild==f)&#123;</span><br><span class="line">            gf-&gt;lchild = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(gf-&gt;rchild==f)&#123;</span><br><span class="line">            gf-&gt;rchild = p;</span><br><span class="line">        &#125;</span><br><span class="line">        p-&gt;fa = gf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">avlNode* <span class="title">maxValue_in_lsubtree</span><span class="params">(avlNode* p)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    avlNode* T;  <span class="comment">// root</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">avlTree P3369;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n; <span class="built_in">rd</span>(n);</span><br><span class="line">    avlNode* rooT = P3369.<span class="built_in">getRoot</span>();</span><br><span class="line">    <span class="keyword">while</span>(n--)&#123;</span><br><span class="line">        <span class="type">int</span> opt, x;</span><br><span class="line">        <span class="built_in">rd</span>(opt); <span class="built_in">rd</span>(x);</span><br><span class="line">        <span class="keyword">switch</span>(opt)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: P3369.<span class="built_in">insertX</span>(rooT, x); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: P3369.<span class="built_in">deleteX</span>(x); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, P3369.<span class="built_in">index_X</span>(x)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, P3369.<span class="built_in">findIndex_X</span>()); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, P3369.<span class="built_in">preX</span>()); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, P3369.<span class="built_in">afterX</span>()); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-倍经验日（背包）"><a href="#5-倍经验日（背包）" class="headerlink" title="5 倍经验日（背包）"></a>5 倍经验日（背包）</h2><p><strong>题目背景</strong></p><p>现在乐斗有活动了！每打一个人可以获得 5 倍经验！absi2011 却无奈的看着那一些比他等级高的好友，想着能否把他们干掉。干掉能拿不少经验的。</p><p><strong>题目描述</strong></p><p>现在 absi2011 拿出了 $x$ 个迷你装药物（嗑药打人可耻…），准备开始与那些人打了。</p><p>由于迷你装药物每个只能用一次，所以 absi2011 要谨慎的使用这些药。悲剧的是，用药量没达到最少打败该人所需的属性药药量，则打这个人必输。例如他用 $2$ 个药去打别人，别人却表明 $3$ 个药才能打过，那么相当于你输了并且这两个属性药浪费了。</p><p>现在有 $n$ 个好友，给定失败时可获得的经验、胜利时可获得的经验，打败他至少需要的药量。</p><p>要求求出最大经验 $s$，输出 $5s$。</p><p><strong>输入格式</strong></p><p>第一行两个数，$n$ 和 $x$。</p><p>后面 $n$ 行每行三个数，分别表示失败时获得的经验 $\mathit{lose}_i$，胜利时获得的经验 $\mathit{win}_i$ 和打过要至少使用的药数量 $\mathit{use}_i$。</p><p><strong>输出格式</strong></p><p>一个整数，最多获得的经验的五倍。</p><p><strong>样例 #1</strong></p><p><strong>样例输入 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">6 8</span><br><span class="line">21 52 1</span><br><span class="line">21 70 5</span><br><span class="line">21 48 2</span><br><span class="line">14 38 3</span><br><span class="line">14 36 1</span><br><span class="line">14 36 2</span><br></pre></td></tr></table></figure><p><strong>样例输出 #1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1060</span><br></pre></td></tr></table></figure><p><strong>提示</strong></p><p><strong>【Hint】</strong></p><p>五倍经验活动的时候，absi2011 总是吃体力药水而不是这种属性药。</p><p><strong>【数据范围】</strong></p><ul><li>对于 $10\%$ 的数据，保证 $x=0$。</li><li>对于 $30\%$ 的数据，保证 $0\le n\le 10$，$0\le x\le 20$。</li><li>对于 $60\%$ 的数据，保证 $0\le n,x\le 100$， $10&lt;lose_i,win_i\le 100$，$0\le use_i\le 5$。</li><li>对于 $100\%$ 的数据，保证 $0\le n,x\le 10^3$，$0&lt;lose_i\le win_i\le 10^6$，$0\le use_i\le 10^3$。</li></ul><p><strong>【题目来源】</strong></p><p>fight.pet.qq.com</p><p>absi2011 授权题目</p><p><strong>分析</strong></p><p>为防止学校自命题出 dp 埋伏一手，还是练两道为妙。</p><p>整体思路看起来比较显然，但是特判会有点麻烦。大佬们都是用数组的，我还是老老实实用记忆化搜索。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(a,b) ((a)&gt;(b)?(a):(b))</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e3</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> f[MAXN][MAXN],lose[MAXN],win[MAXN],use[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dp</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> w)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(f[n][w]) <span class="keyword">return</span> f[n][w];</span><br><span class="line">    <span class="keyword">if</span>(!use[n])&#123;</span><br><span class="line">        f[n][w] = <span class="built_in">dp</span>(n<span class="number">-1</span>,w) + win[n];</span><br><span class="line">        <span class="keyword">return</span> f[n][w];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!w)&#123;</span><br><span class="line">        f[n][w] = <span class="built_in">dp</span>(n<span class="number">-1</span>,<span class="number">0</span>) + lose[n];</span><br><span class="line">        <span class="keyword">return</span> f[n][w];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> temp1 = <span class="built_in">dp</span>(n<span class="number">-1</span>,w) + lose[n];</span><br><span class="line">    <span class="type">int</span> temp2 = (w-use[n]&gt;=<span class="number">0</span>)?(<span class="built_in">dp</span>(n<span class="number">-1</span>,w-use[n]) + win[n]):<span class="number">0</span>;</span><br><span class="line">    f[n][w] = <span class="built_in">MAX</span>(temp1, temp2);</span><br><span class="line">    <span class="keyword">return</span> f[n][w];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, x;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;x);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;lose[i],&amp;win[i],&amp;use[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,<span class="number">5ll</span>*<span class="built_in">dp</span>(n,x));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;一道题开一篇文章实在浪费，于是决定以后零零散散做的题就放在这个集子里了。如果数量过多会考虑再开。&lt;/p&gt;
&lt;h2 id=&quot;JSOI2004-平衡点（模拟退火）&quot;&gt;&lt;a href=&quot;#JSOI2004-平衡点（模拟退火）&quot; class=&quot;headerlink&quot; title=&quot;</summary>
      
    
    
    
    <category term="算法" scheme="https://loveofpeach.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="tarjan" scheme="https://loveofpeach.github.io/tags/tarjan/"/>
    
    <category term="lca" scheme="https://loveofpeach.github.io/tags/lca/"/>
    
    <category term="模拟退火" scheme="https://loveofpeach.github.io/tags/%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB/"/>
    
  </entry>
  
  <entry>
    <title>数据结构应试笔记</title>
    <link href="https://loveofpeach.github.io/posts/7ccfe718.html"/>
    <id>https://loveofpeach.github.io/posts/7ccfe718.html</id>
    <published>2023-07-05T04:39:12.000Z</published>
    <updated>2023-10-22T03:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>应试向的数据结构考试和实际写起代码来有很大区别。重复造轮子就不说了，更可怕的是，有时还需要应试者人脑模拟算法的执行过程。相对来说，对针对具体问题设计算法的考察较浅。</p><p>另外，有时王道书的代码风格奇特，我尽量改为了自己习惯的写法，这点需要特别注意。</p><p>本文中所有代码除非注明，均不保证能运行。</p><h2 id="线性表"><a href="#线性表" class="headerlink" title="线性表"></a>线性表</h2><p>线性表：</p><ul><li>顺序存储<ul><li>顺序表</li></ul></li><li>链式存储<ul><li>单链表（指针实现）</li><li>双链表（指针实现）</li><li>循环链表（指针实现）</li><li>静态链表（借助数组实现）</li></ul></li></ul><h3 id="顺序表"><a href="#顺序表" class="headerlink" title="顺序表"></a>顺序表</h3><p>线性表的顺序存储类型描述为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MaxSize = <span class="number">50</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SqList</span>&#123;</span><br><span class="line">  ElemType data[MaxSize];</span><br><span class="line">  <span class="type">int</span> length;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>动态分配：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> InitSize = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SeqList</span>&#123;</span><br><span class="line">  ElemType* data;</span><br><span class="line">  <span class="type">int</span> MaxSize, length;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>C++ 的初始动态分配语句为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L.data = <span class="keyword">new</span> ElemType[InitSize];</span><br></pre></td></tr></table></figure><p><strong>注意：动态分配并不是链式存储，它同样属于顺序存储结构，物理结构没有变化，依然是随机存取方式，只是分配的空间大小可以在运行时动态决定。</strong></p><blockquote><p>例：17 页第 11 题。<br>顺序表的插入算法中，当 n 个空间已满时，可再申请增加分配 m 个空间，若申请失败，则说明系统没有（<strong>n + m 个连续</strong>）可分配的存储空间。</p></blockquote><p>顺序表的操作：插入、删除、按值查找。这部分的代码自己实现就行。</p><h3 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h3><p>单链表的描述：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  LNode* next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>动态分配：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LNode* p = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br></pre></td></tr></table></figure><p>要表示一个单链表时，需要一个头指针<code>L</code>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LNode* L;</span><br></pre></td></tr></table></figure><p>带头节点的单链表：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  LNode* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitList</span><span class="params">(LNode*&amp; L)</span></span>&#123;</span><br><span class="line">  L = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));  <span class="comment">//分配一个头节点</span></span><br><span class="line">  <span class="keyword">if</span>(L==<span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">false</span>;    <span class="comment">//内存不足，分配失败</span></span><br><span class="line">  L-&gt;next = <span class="literal">NULL</span>;             <span class="comment">//头节点之后暂时还没有节点</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(LNode* L)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(L-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">  LNode* L;</span><br><span class="line">  <span class="built_in">InitList</span>(L);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按位序插入（带头节点）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//头节点编号为0，有数据的节点编号从1开始</span></span><br><span class="line"><span class="comment">//插入完成后新元素的位置为 i</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ListInsert</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i, ElemType e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* p;  <span class="comment">//指向当前扫描到的节点</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>; <span class="comment">//当前p指向的是第几个节点</span></span><br><span class="line">  p = L;  <span class="comment">//指向头节点</span></span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; j&lt;i<span class="number">-1</span>)&#123;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>) <span class="comment">//i值不合法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  s-&gt;data = e;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面代码中，若<code>i=1</code>，即是插在表头。</p><p>指定节点的后插操作：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertNextNode</span><span class="params">(LNode* p, ElemType e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  s-&gt;data = e;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时，发现<strong>按位序插入（带头节点）</strong>的代码可以通过复用<strong>指定节点的后插操作</strong>的代码来简化：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertNextNode</span><span class="params">(LNode* p, ElemType e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  s-&gt;data = e;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ListInsert</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i, ElemType e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* p;  <span class="comment">//指向当前扫描到的节点</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>; <span class="comment">//当前p指向的是第几个节点</span></span><br><span class="line">  p = L;  <span class="comment">//指向头节点</span></span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; j&lt;i<span class="number">-1</span>)&#123;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">InsertNextNode</span>(p, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>指定节点的前插操作：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//思路：使用后插，然后交换数据成员的内容</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertPreNode</span><span class="params">(LNode* p, ElemType e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  <span class="keyword">if</span>(s==<span class="literal">NULL</span>) <span class="comment">//内存分配失败，考试可以不写</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  s-&gt;data = p-&gt;data;</span><br><span class="line">  p-&gt;data = e;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按位序删除（带头节点）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ListDelete</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i, ElemType &amp;e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* p;  <span class="comment">//指向当前扫描到的节点</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>; <span class="comment">//当前p指向的是第几个节点</span></span><br><span class="line">  p = L;  <span class="comment">//指向头节点</span></span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; j&lt;i<span class="number">-1</span>)&#123; <span class="comment">//循环找到第 i-1 个节点</span></span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)  <span class="comment">// i 值不合法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;next==<span class="literal">NULL</span>) <span class="comment">//第i-1个节点之后已无其他节点</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* q = p-&gt;next; <span class="comment">//令q指向被删除节点</span></span><br><span class="line">  e = q-&gt;data; <span class="comment">//用e返回元素的值</span></span><br><span class="line">  p-&gt;next = q-&gt;next;</span><br><span class="line">  <span class="built_in">free</span>(q);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2023/07/10/64abd587e3be8.png" alt="46-1.png" title="上面代码的图示"></p><p>指定节点的删除：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除指定节点 p</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DeleteNode</span><span class="params">(LNode* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* q = p-&gt;next;</span><br><span class="line">  p-&gt;data = p-&gt;next-&gt;data;</span><br><span class="line">  p-&gt;next = q-&gt;next;</span><br><span class="line">  <span class="built_in">free</span>(q);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2023/07/10/64abdaced677a.png" alt="46-2.png"></p><p>注意上图中的代码有一个 bug，在边界情况（p 节点刚好是最后一个节点）下会产生错误。但是只是应试的话无所谓了，扣也最多一两分，甚至不扣。</p><p>单链表按位查找：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//按位查找，返回第i个元素的指针</span></span><br><span class="line"><span class="function">LNode* <span class="title">GetElem</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  LNode* p;  <span class="comment">//指向当前扫描到的节点</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>; <span class="comment">//当前p指向的是第几个节点</span></span><br><span class="line">  p = L;  <span class="comment">//指向头节点</span></span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; j&lt;i)&#123;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按值查找：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LNode* <span class="title">LocateElem</span><span class="params">(LNode*&amp; L, ElemType e)</span></span>&#123;</span><br><span class="line">  LNode* p = L-&gt;next;</span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; p-&gt;data!=e)</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：如果<code>ElemType</code>是一个<code>struct</code>，需要自己定义比较运算符。</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ElemType</span>&#123;</span><br><span class="line">  <span class="type">int</span> a;</span><br><span class="line">  <span class="type">int</span> b; <span class="comment">//仅作举例 int</span></span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span> != (<span class="type">const</span> ElemType&amp; rhs);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">bool</span> ElemType::<span class="keyword">operator</span> != (<span class="type">const</span> ElemType&amp; rhs)&#123;</span><br><span class="line">  <span class="built_in">return</span> (a!=rhs.a || b!=rhs.b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>求表的长度：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Length</span><span class="params">(LNode*&amp; L)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">  LNode* p = L;</span><br><span class="line">  <span class="keyword">while</span>(p-&gt;next!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    len++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>尾插法建立单链表：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LNode* <span class="title">List_TailInsert</span><span class="params">(LNode*&amp; L)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line">  L = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  LNode *s, *r=L;  <span class="comment">// r 指向最后一个元素</span></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  <span class="keyword">while</span>(x!=<span class="number">9999</span>)&#123; <span class="comment">// 9999是退出值</span></span><br><span class="line">    s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">    s-&gt;data = x;</span><br><span class="line">    r-&gt;next = s;</span><br><span class="line">    r = s;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  &#125;</span><br><span class="line">  r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>头插法建立单链表：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//王道书的代码无法忍受，我自己写了。</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">List_HeadInsert</span><span class="params">(LNode*&amp; L)</span></span>&#123;</span><br><span class="line">  <span class="built_in">InitList</span>(L);</span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  <span class="keyword">while</span>(x!=<span class="number">9999</span>)&#123; <span class="comment">//9999 为退出值，当然也可以while(scanf(&quot;%d&quot;,&amp;x))&#123;&#125; ，看具体情况</span></span><br><span class="line">    <span class="built_in">InsertNextNode</span>(L, x);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="总结：单链表的全部操作"><a href="#总结：单链表的全部操作" class="headerlink" title="总结：单链表的全部操作"></a>总结：单链表的全部操作</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  LNode* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitList</span><span class="params">(LNode*&amp; L)</span></span>&#123;</span><br><span class="line">  L = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));  <span class="comment">//分配一个头节点</span></span><br><span class="line">  <span class="keyword">if</span>(L==<span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">false</span>;    <span class="comment">//内存不足，分配失败</span></span><br><span class="line">  L-&gt;next = <span class="literal">NULL</span>;             <span class="comment">//头节点之后暂时还没有节点</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(LNode* L)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(L-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;  <span class="comment">//或者认为是 main() 函数也勉强可以</span></span><br><span class="line">  LNode* L;</span><br><span class="line">  <span class="built_in">InitList</span>(L);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertNextNode</span><span class="params">(LNode* p, ElemType e)</span></span>&#123; <span class="comment">//指定节点的后插操作</span></span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  s-&gt;data = e;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//思路：使用后插，然后交换数据成员的内容</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertPreNode</span><span class="params">(LNode* p, ElemType e)</span></span>&#123;  <span class="comment">//指定节点的前插操作</span></span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  <span class="keyword">if</span>(s==<span class="literal">NULL</span>) <span class="comment">//内存分配失败，考试可以不写</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  s-&gt;data = p-&gt;data;</span><br><span class="line">  p-&gt;data = e;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按位查找，返回第i个元素的指针</span></span><br><span class="line"><span class="function">LNode* <span class="title">GetElem</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  LNode* p;  <span class="comment">//指向当前扫描到的节点</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>; <span class="comment">//当前p指向的是第几个节点</span></span><br><span class="line">  p = L;  <span class="comment">//指向头节点</span></span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; j&lt;i)&#123;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LNode* <span class="title">LocateElem</span><span class="params">(LNode*&amp; L, ElemType e)</span></span>&#123; <span class="comment">//按值查找</span></span><br><span class="line">  LNode* p = L-&gt;next;</span><br><span class="line">  <span class="keyword">while</span>(p!=<span class="literal">NULL</span> &amp;&amp; p-&gt;data!=e)  <span class="comment">//注意细节，往上翻</span></span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入完成后新元素的位置为 i</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ListInsert</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i, ElemType e)</span></span>&#123; <span class="comment">//按位序插入</span></span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* p = <span class="built_in">GetElem</span>(L, i<span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">InsertNextNode</span>(p, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ListDelete</span><span class="params">(LNode*&amp; L, <span class="type">int</span> i, ElemType &amp;e)</span></span>&#123; <span class="comment">//按位序删除</span></span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* p = <span class="built_in">GetElem</span>(L, i<span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)  <span class="comment">// i 值不合法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;next==<span class="literal">NULL</span>) <span class="comment">//第i-1个节点之后已无其他节点</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* q = p-&gt;next; <span class="comment">//令q指向被删除节点</span></span><br><span class="line">  e = q-&gt;data; <span class="comment">//用e返回元素的值</span></span><br><span class="line">  p-&gt;next = q-&gt;next;</span><br><span class="line">  <span class="built_in">free</span>(q);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除指定节点 p</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DeleteNode</span><span class="params">(LNode* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  LNode* q = p-&gt;next;</span><br><span class="line">  p-&gt;data = p-&gt;next-&gt;data;</span><br><span class="line">  p-&gt;next = q-&gt;next;</span><br><span class="line">  <span class="built_in">free</span>(q);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Length</span><span class="params">(LNode*&amp; L)</span></span>&#123; <span class="comment">//求表的长度</span></span><br><span class="line">  <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">  LNode* p = L;</span><br><span class="line">  <span class="keyword">while</span>(p-&gt;next!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    len++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LNode* <span class="title">List_TailInsert</span><span class="params">(LNode*&amp; L)</span></span>&#123; <span class="comment">//尾插法建立单链表</span></span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line">  L = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">  LNode *s, *r=L;  <span class="comment">// r 指向最后一个元素</span></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  <span class="keyword">while</span>(x!=<span class="number">9999</span>)&#123; <span class="comment">// 9999是退出值</span></span><br><span class="line">    s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">    s-&gt;data = x;</span><br><span class="line">    r-&gt;next = s;</span><br><span class="line">    r = s;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  &#125;</span><br><span class="line">  r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">List_HeadInsert</span><span class="params">(LNode*&amp; L)</span></span>&#123; <span class="comment">//头插法建立单链表</span></span><br><span class="line">  <span class="built_in">InitList</span>(L);</span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  <span class="keyword">while</span>(x!=<span class="number">9999</span>)&#123; <span class="comment">//9999 为退出值，当然也可以while(scanf(&quot;%d&quot;,&amp;x))&#123;&#125; ，看具体情况</span></span><br><span class="line">    <span class="built_in">InsertNextNode</span>(L, x);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="双链表"><a href="#双链表" class="headerlink" title="双链表"></a>双链表</h3><p>双链表的描述：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  DNode *pre, *next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>初始化：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitDList</span><span class="params">(DNode*&amp; L)</span></span>&#123;</span><br><span class="line">  L = (DNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(DNode));</span><br><span class="line">  <span class="keyword">if</span>(L==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//内存不足，分配失败</span></span><br><span class="line">  L-&gt;pre = <span class="literal">NULL</span>;</span><br><span class="line">  L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(DNode* L)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(L-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">  DNode* L;</span><br><span class="line">  <span class="built_in">InitDList</span>(L);</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>双链表的插入：</p><p><img src="https://bu.dusays.com/2023/07/13/64af6d656cba5.png" alt="46-3.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 p 节点之后插入 s 节点</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertAfter</span><span class="params">(DNode* p, DNode* s)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span> || s==<span class="literal">NULL</span>) <span class="comment">//非法参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;next != <span class="literal">NULL</span>)</span><br><span class="line">    p-&gt;next-&gt;pre = s;</span><br><span class="line">  s-&gt;pre = p;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>双链表的删除和销毁：</p><p><img src="https://bu.dusays.com/2023/07/14/64b0ae3aa83d5.png" alt="46-4.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除 p 节点的后继节点</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DeleteAfter</span><span class="params">(DNode* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  DNode* q = p-&gt;next;</span><br><span class="line">  <span class="keyword">if</span>(q==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  p-&gt;next = q-&gt;next;</span><br><span class="line">  <span class="keyword">if</span>(q-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">    q-&gt;next-&gt;pre = p;</span><br><span class="line">  <span class="built_in">free</span>(q);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//销毁</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestoryList</span><span class="params">(DNode*&amp; L)</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>(L-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">    <span class="built_in">DeleteAfter</span>(L);</span><br><span class="line">  <span class="built_in">free</span>(L);</span><br><span class="line">  L = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>双链表的遍历：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后向遍历</span></span><br><span class="line"><span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">  <span class="comment">//do something on p</span></span><br><span class="line">  p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//前向遍历</span></span><br><span class="line"><span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">  <span class="comment">//do something on p</span></span><br><span class="line">  p = p-&gt;pre;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//前向遍历（不处理头节点）</span></span><br><span class="line"><span class="keyword">while</span>(p-&gt;pre!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">  <span class="comment">//do something on p</span></span><br><span class="line">  p = p-&gt;pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h3><p>循环单链表：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  LNode* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitList</span><span class="params">(LNode*&amp; L)</span></span>&#123;</span><br><span class="line">  L = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));  <span class="comment">//分配一个头节点</span></span><br><span class="line">  <span class="keyword">if</span>(L==<span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">false</span>;    <span class="comment">//内存不足，分配失败</span></span><br><span class="line">  L-&gt;next = L;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(LNode* L)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(L-&gt;next==L)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isTail</span><span class="params">(LNode* L, LNode* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;next==L)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2023/07/15/64b1f2544dc77.png" alt="46-5.png"></p><p>具体代码可以自己实现，不再赘述。</p><p>循环双链表：</p><p><img src="https://bu.dusays.com/2023/07/15/64b1f39faa21e.png" alt="46-6.png"></p><p><img src="https://bu.dusays.com/2023/07/15/64b1f5e3b81a1.png" alt="46-7.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  DNode *pre, *next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitDList</span><span class="params">(DNode*&amp; L)</span></span>&#123;</span><br><span class="line">  L = (DNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(DNode));</span><br><span class="line">  <span class="keyword">if</span>(L==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  L-&gt;pre = L;</span><br><span class="line">  L-&gt;next = L;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">  DNode* L;</span><br><span class="line">  <span class="built_in">InitDList</span>(L);</span><br><span class="line">  <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(DNode* L)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(L-&gt;next==L)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isTail</span><span class="params">(DNode* L, DNode* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;next==L)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后插操作：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 p 节点之后插入 s 节点</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertAfter</span><span class="params">(DNode* p, DNode* s)</span></span>&#123;</span><br><span class="line">  s-&gt;next = p-&gt;next;</span><br><span class="line">  p-&gt;next-&gt;pre = s;</span><br><span class="line">  s-&gt;pre = p;</span><br><span class="line">  p-&gt;next = s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除操作：</p><p><img src="https://bu.dusays.com/2023/07/15/64b1fbbd14de0.png" alt="46-8.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除 p 的后继节点 q</span></span><br><span class="line">p-&gt;next = q-&gt;next;</span><br><span class="line">q-&gt;next-&gt;pre = p;</span><br><span class="line"><span class="built_in">free</span>(q);</span><br></pre></td></tr></table></figure><h3 id="静态链表"><a href="#静态链表" class="headerlink" title="静态链表"></a>静态链表</h3><p><img src="https://bu.dusays.com/2023/07/15/64b205c5c3f47.png" alt="46-9.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> Maxsize = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  <span class="type">int</span> next;  <span class="comment">//下一个元素的数组下标</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Node a[Maxsize];</span><br><span class="line">  <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2023/07/15/64b20bb881ba7.png" alt="46-10.png"></p><h2 id="栈、队列、数组"><a href="#栈、队列、数组" class="headerlink" title="栈、队列、数组"></a>栈、队列、数组</h2><p><del>这 tm 还要学？</del></p><h3 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h3><p>顺序栈：代码自己实现。</p><p>共享栈：</p><p><img src="https://bu.dusays.com/2023/07/25/64bfeeb95d52e.jpg" alt="46-11.jpg"></p><p>链栈：通常采用<strong>不带头节点</strong>的单链表实现，所有操作在表头进行。</p><p><img src="https://bu.dusays.com/2023/07/25/64bff090644c8.png" alt="46-12.png" title="链栈"></p><p>队列：</p><p><img src="https://bu.dusays.com/2023/07/26/64bff2bc63399.jpg" alt="46-13.jpg"></p><p>循环队列：</p><p><img src="https://bu.dusays.com/2023/07/26/64c07a2fe98e8.jpg" alt="46-14.jpg"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MaxSize = <span class="number">50</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">myQueue</span>&#123;</span><br><span class="line">  ElemType data[MaxSize];</span><br><span class="line">  <span class="type">int</span> front, rear;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">InitQueue</span><span class="params">(myQueue&amp; qwq)</span></span>&#123; <span class="comment">//初始化</span></span><br><span class="line">  qwq.rear = qwq.front = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(myQueue qwq)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(qwq.rear==qwq.front) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">EnQueue</span><span class="params">(myQueue&amp; qwq, ElemType x)</span></span>&#123; <span class="comment">//入队</span></span><br><span class="line">  <span class="keyword">if</span>((qwq.rear+<span class="number">1</span>)%MaxSize==qwq.front)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;   <span class="comment">//队满则报错</span></span><br><span class="line">  qwq.data[qwq.rear] = x;</span><br><span class="line">  qwq.rear = (qwq.rear+<span class="number">1</span>) % MaxSize;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DeQueue</span><span class="params">(myQueue&amp; qwq, ElemType&amp; x)</span></span>&#123;  <span class="comment">//出队</span></span><br><span class="line">  <span class="keyword">if</span>(qwq.rear==qwq.front) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//队空则报错</span></span><br><span class="line">  x = qwq.data[qwq.front];</span><br><span class="line">  qwq.front = (qwq.front+<span class="number">1</span>) % MaxSize;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>队列的链式存储（左开右闭？）：</p><p>通常采用<strong>带头节点</strong>的单链表。</p><p><img src="https://bu.dusays.com/2023/07/26/64c083cc0a7ad.png" alt="46-15.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  LNode* next;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LinkQueue</span>&#123;</span><br><span class="line">  LNode* front;</span><br><span class="line">  LNode* rear;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">InitQueue</span><span class="params">(LinkQueue&amp; qwq)</span></span>&#123;</span><br><span class="line">  qwq.front = qwq.rear = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode)); <span class="comment">//建立头节点</span></span><br><span class="line">  qwq.front-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">  LinkQueue qwq;  <span class="comment">//声明一个队列</span></span><br><span class="line">  <span class="built_in">InitQueue</span>(qwq);</span><br><span class="line">  <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">(LinkQueue qwq)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(qwq.front==qwq.rear) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EnQueue</span><span class="params">(LinkQueue&amp; qwq, ElemType x)</span></span>&#123;  <span class="comment">//入队</span></span><br><span class="line">  LNode* s = (LNode*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNdoe));</span><br><span class="line">  s-&gt;data = x;</span><br><span class="line">  s-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">  qwq.rear-&gt;next = s;</span><br><span class="line">  qwq.rear = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DeQueue</span><span class="params">(LinkQueue&amp; qwq, ElemType&amp; x)</span></span>&#123; <span class="comment">//出队</span></span><br><span class="line">  <span class="keyword">if</span>(qwq.front==qwq.rear) <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">//空队，失败</span></span><br><span class="line">  LNode* p = qwq.front-&gt;next;</span><br><span class="line">  x = p-&gt;data;</span><br><span class="line">  qwq.front-&gt;next = p-&gt;next;</span><br><span class="line">  <span class="keyword">if</span>(qwq.rear==p) qwq.rear = qwq.front;</span><br><span class="line">  <span class="built_in">free</span>(p);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p><strong>栈在括号匹配中的应用：</strong></p><p><img src="https://bu.dusays.com/2023/07/26/64c093105a785.png" alt="46-16.png"></p><p><strong>栈在表达式求值中的应用：</strong></p><p>Reverse Polish notation（逆波兰表达式 = 后缀表达式）</p><p>Polish notation（波兰表达式 = 前缀表达式）</p><p><img src="https://bu.dusays.com/2023/07/27/64c1d1a988b93.png" alt="46-17.png"></p><p><img src="https://bu.dusays.com/2023/07/27/64c1d4b2c6635.png" alt="46-18.png"></p><p><img src="https://bu.dusays.com/2023/07/27/64c1d98cf28ec.png" alt="46-18dot5.png"></p><p><img src="https://bu.dusays.com/2023/07/27/64c1d68c05225.png" alt="46-19.png"></p><p><img src="https://bu.dusays.com/2023/07/27/64c1daafecb11.png" alt="46-20.png"></p><p><img src="https://bu.dusays.com/2023/07/27/64c1de0b5e5cd.png" alt="46-21.png"></p><p>将<strong>中缀转后缀</strong>和<strong>后缀表达式求值</strong>两个算法结合起来：</p><p><img src="https://bu.dusays.com/2023/07/27/64c1e7130be48.png" alt="46-22.png"></p><h2 id="树、二叉树"><a href="#树、二叉树" class="headerlink" title="树、二叉树"></a>树、二叉树</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>有序树和无序树：</p><p><img src="https://bu.dusays.com/2023/07/30/64c5cea0b77e0.png" alt="46-23.png"></p><p><strong>注意：此课程中<code>度</code>的概念和离散数学中不同。</strong>（万恶的图论名词差异）</p><p><img src="https://bu.dusays.com/2023/07/30/64c5da5e65dc1.png" alt="46-24.png"></p><p>树的一些性质：（注意这里的“度数”是歧义概念）</p><ol><li>树中的节点数等于所有节点的度数之和加 1 </li><li>度为 m 的树中第 i 层上至多有 $m^{i-1}$ 个节点（$i\geqslant 1$）</li><li>高度为 h 的 m 叉树至多有 $\frac{m^h-1}{m-1}$ 个节点</li><li>具有 n 个节点的 m 叉树最小高度为 $\left \lceil \log_m(n(m-1)+1) \right \rceil$</li></ol><p>结论 4 的推导：</p><p>假设高度为 $h$ , 由结论3 ：</p><script type="math/tex; mode=display">\frac{m^{h-1}-1}{m-1}< n \leqslant \frac{m^h-1}{m-1}</script><script type="math/tex; mode=display">m^{h-1}<n(m-1)+1\leqslant m^h</script><script type="math/tex; mode=display">h-1<\log_m(n(m-1)+1)\leqslant h</script><script type="math/tex; mode=display">h_{\min}=\left \lceil \log_m(n(m-1)+1) \right \rceil</script><p>满二叉树、完全二叉树的性质：</p><p><img src="https://bu.dusays.com/2023/08/03/64ca86a48e788.png" alt="46-25.png"></p><p>二叉排序树：</p><p><img src="https://bu.dusays.com/2023/08/03/64ca884b17442.png" alt="46-26.png"></p><p>平衡二叉树：</p><p><img src="https://bu.dusays.com/2023/08/03/64ca899918de1.png" alt="46-27.png"></p><h3 id="二叉树的性质"><a href="#二叉树的性质" class="headerlink" title="二叉树的性质"></a>二叉树的性质</h3><p>设非空二叉树中<code>度</code>（歧义概念）为 0、1、2 的节点个数分别为 n0、n1、n2 , 则 $n_0=n_2+1$ （叶子节点比二分枝节点多一个）。推导如下：</p><p>假设树中节点总数为 n , 则：</p><ul><li>$n = n_0 + n_1 + n_2$</li><li>$n = n_1 + 2n_2 + 1$</li></ul><p>具有 n 个（n&gt;0）节点的完全二叉树的高度 h 为 $\left \lceil \log_2(n+1) \right \rceil$ 或 $\left \lfloor \log_2n \right \rfloor +1$. （推导不难）</p><p>某个性质：</p><p><img src="https://bu.dusays.com/2023/08/03/64ca8fc557c02.png" alt="46-28.png"></p><h3 id="二叉树的存储"><a href="#二叉树的存储" class="headerlink" title="二叉树的存储"></a>二叉树的存储</h3><p>顺序存储（<strong>绝大多数情况下不会使用</strong>）：</p><p><img src="https://bu.dusays.com/2023/08/04/64cd1cbbed56f.png" alt="46-29.png"></p><p>完全二叉树的此种存储结构的操作：</p><p><img src="https://bu.dusays.com/2023/08/04/64cd1dc4cced1.png" alt="46-30.png"></p><p>对于非完全二叉树：</p><p><img src="https://bu.dusays.com/2023/08/04/64cd1f309b356.png" alt="46-31.png" title="丑陋的做法"></p><p>链式存储：</p><p><img src="https://bu.dusays.com/2023/08/04/64cd206123c45.png" alt="46-32.png"></p><p>代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ElemType</span>&#123;</span><br><span class="line">  <span class="type">int</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BinoTree</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  BinoTree* lchild;</span><br><span class="line">  BinoTree* rchild;</span><br><span class="line">  <span class="comment">//可以根据需要加上指向父节点的指针</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一棵空树</span></span><br><span class="line">BinoTree* root = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入根节点</span></span><br><span class="line">root = (BinoTree*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(BinoTree));</span><br><span class="line">root-&gt;data = &#123;<span class="number">1</span>&#125;;</span><br><span class="line">root-&gt;lchild = <span class="literal">NULL</span>;</span><br><span class="line">root-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入新节点（例子）</span></span><br><span class="line">BinoTree* p = (BinoTree*) <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(BinoTree));</span><br><span class="line">p-&gt;data = &#123;<span class="number">2</span>&#125;;</span><br><span class="line">p-&gt;lchild = <span class="literal">NULL</span>;</span><br><span class="line">p-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line">root-&gt;lchild = p;</span><br></pre></td></tr></table></figure><p>上面代码对应的图：</p><p><img src="https://bu.dusays.com/2023/08/05/64cd2344bffb8.png" alt="46-33.png"></p><h3 id="先、中、后序遍历"><a href="#先、中、后序遍历" class="headerlink" title="先、中、后序遍历"></a>先、中、后序遍历</h3><ul><li><strong>先</strong>序遍历：<strong>根</strong>、左、右（<strong>N</strong>LR）</li><li><strong>中</strong>序遍历：左、<strong>根</strong>、右（L<strong>N</strong>R）</li><li><strong>后</strong>序遍历：左、右、<strong>根</strong>（LR<strong>N</strong>）</li></ul><p>例子：</p><p><img src="https://bu.dusays.com/2023/08/05/64cd286999c76.png" alt="46-34.png"></p><p>和表达式的联系：</p><p><img src="https://bu.dusays.com/2023/08/05/64cd298d710cc.png" alt="46-35.png"></p><p>代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先序遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">preOrder</span><span class="params">(BinoTree* T)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">visit</span>(T);             <span class="comment">//访问根节点</span></span><br><span class="line">    <span class="built_in">preOrder</span>(T-&gt;lchild);  <span class="comment">//访问左孩子</span></span><br><span class="line">    <span class="built_in">preOrder</span>(T-&gt;rchild);  <span class="comment">//访问右孩子</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中序遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inOrder</span><span class="params">(BinoTree* T)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">inOrder</span>(T-&gt;lchild);  <span class="comment">//访问左孩子</span></span><br><span class="line">    <span class="built_in">visit</span>(T);            <span class="comment">//访问根节点</span></span><br><span class="line">    <span class="built_in">inOrder</span>(T-&gt;rchild);  <span class="comment">//访问右孩子</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//后序遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">postOrder</span><span class="params">(BinoTree* T)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">postOrder</span>(T-&gt;lchild);  <span class="comment">//访问左孩子</span></span><br><span class="line">    <span class="built_in">postOrder</span>(T-&gt;rchild);  <span class="comment">//访问右孩子</span></span><br><span class="line">    <span class="built_in">visit</span>(T);              <span class="comment">//访问根节点</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="层次遍历"><a href="#层次遍历" class="headerlink" title="层次遍历"></a>层次遍历</h3><p>其实就是 BFS 。</p><p><img src="https://bu.dusays.com/2023/08/07/64cff1caf36aa.png" alt="46-36.png"></p><p>执行算法：</p><ol><li>初始化一个辅助队列</li><li>根节点入队</li><li>若队列非空，弹队首，访问弹出的节点，并将其孩子（若有）入队</li><li>重复 3 直至队列为空</li></ol><p>伪代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意：我使用了自己习惯的写法</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">  queue&lt;node&gt; qwq;</span><br><span class="line">  node temp;</span><br><span class="line">  <span class="comment">//do something...</span></span><br><span class="line">  qwq.<span class="built_in">push</span>(temp);</span><br><span class="line">  <span class="keyword">while</span>(!qwq.<span class="built_in">empty</span>())&#123;</span><br><span class="line">    node head = qwq.<span class="built_in">front</span>(); <span class="comment">//取队首</span></span><br><span class="line">    qwq.<span class="built_in">pop</span>();               <span class="comment">//弹队首</span></span><br><span class="line">    <span class="comment">//do something...</span></span><br><span class="line">    qwq.<span class="built_in">push</span>((node)&#123;<span class="comment">/*...*/</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一个 BFS 剪枝的实例：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//https://www.luogu.com.cn/problem/P1126 </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,sx,sy,ex,ey;</span><br><span class="line"><span class="type">char</span> face; <span class="type">bool</span> ok=<span class="literal">true</span>;</span><br><span class="line"><span class="type">int</span> a[<span class="number">53</span>][<span class="number">53</span>],ans;</span><br><span class="line"><span class="type">int</span> fx[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line"><span class="type">bool</span> vis[<span class="number">53</span>][<span class="number">53</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">    <span class="type">int</span> x,y;</span><br><span class="line">    <span class="type">int</span> dir,step;</span><br><span class="line">    <span class="type">bool</span> chan;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">changedir</span><span class="params">(<span class="type">int</span> dirt,<span class="type">int</span> xia)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xia==<span class="number">0</span>)<span class="keyword">return</span> (dirt+<span class="number">1</span>)%<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(xia==<span class="number">233</span>)<span class="built_in">return</span> (dirt+<span class="number">2</span>)%<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">return</span> (dirt<span class="number">-1</span>+<span class="number">4</span>)%<span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">1</span>||x&gt;=n||y&lt;<span class="number">1</span>||y&gt;=m)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(a[x][y]||a[x+<span class="number">1</span>][y])<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(a[x][y+<span class="number">1</span>]||a[x+<span class="number">1</span>][y+<span class="number">1</span>])<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;node&gt; qwq;</span><br><span class="line">    node temp;</span><br><span class="line">    temp.x=sx;temp.y=sy;</span><br><span class="line">    <span class="keyword">if</span>(face==<span class="string">&#x27;E&#x27;</span>)temp.dir=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(face==<span class="string">&#x27;S&#x27;</span>)temp.dir=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(face==<span class="string">&#x27;W&#x27;</span>)temp.dir=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(face==<span class="string">&#x27;N&#x27;</span>)temp.dir=<span class="number">3</span>;</span><br><span class="line">    temp.step=<span class="number">0</span>; temp.chan=<span class="literal">false</span>;</span><br><span class="line">    qwq.<span class="built_in">push</span>(temp);</span><br><span class="line">    vis[temp.x][temp.y]=<span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(!qwq.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        node head=qwq.<span class="built_in">front</span>();</span><br><span class="line">        qwq.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">3</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> nx=head.x+fx[head.dir][<span class="number">0</span>]*i;</span><br><span class="line">            <span class="type">int</span> ny=head.y+fx[head.dir][<span class="number">1</span>]*i;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">check</span>(nx,ny))<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span>(vis[nx][ny])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(nx==ex&amp;&amp;ny==ey)</span><br><span class="line">            &#123;</span><br><span class="line">                ans=head.step+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            qwq.<span class="built_in">push</span>((node)&#123;nx,ny,head.dir,head.step+<span class="number">1</span>,<span class="literal">false</span>&#125;);</span><br><span class="line">            vis[nx][ny]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(head.chan)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> dirti=<span class="built_in">changedir</span>(head.dir,<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> dirti2=<span class="built_in">changedir</span>(head.dir,<span class="number">1</span>);</span><br><span class="line">        qwq.<span class="built_in">push</span>((node)&#123;head.x,head.y,dirti,head.step+<span class="number">1</span>,<span class="literal">true</span>&#125;);</span><br><span class="line">        qwq.<span class="built_in">push</span>((node)&#123;head.x,head.y,dirti2,head.step+<span class="number">1</span>,<span class="literal">true</span>&#125;);</span><br><span class="line">        <span class="keyword">if</span>(ok)</span><br><span class="line">        &#123;</span><br><span class="line">            ok=<span class="literal">false</span>;</span><br><span class="line">            <span class="type">int</span> dirti3=<span class="built_in">changedir</span>(head.dir,<span class="number">233</span>);</span><br><span class="line">            qwq.<span class="built_in">push</span>((node)&#123;head.x,head.y,dirti3,head.step+<span class="number">2</span>,<span class="literal">true</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++)</span><br><span class="line">    cin&gt;&gt;a[i][j];</span><br><span class="line">    cin&gt;&gt;sx&gt;&gt;sy&gt;&gt;ex&gt;&gt;ey&gt;&gt;face;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(sx==ex&amp;&amp;sy==ey)cout&lt;&lt;<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">bfs</span>())cout&lt;&lt;ans;</span><br><span class="line">    <span class="keyword">else</span> cout&lt;&lt;<span class="string">&quot;-1&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意在树或者图中需要在具体的数据结构上实现 BFS ，例如链式前向星。</p><p>有必要给出应试代码，以下代码只适合二叉树：</p><p><img src="https://bu.dusays.com/2023/08/07/64cffa921914e.png" alt="46-37.png"></p><h3 id="由遍历序列构造二叉树"><a href="#由遍历序列构造二叉树" class="headerlink" title="由遍历序列构造二叉树"></a>由遍历序列构造二叉树</h3><p><strong>若只给出一棵二叉树的 前/中/后/层 序遍历序列中的一种，不能唯一确定一棵二叉树。</strong></p><p>由二叉树的遍历序列构造二叉树，需已知以下三种信息中的任一种：</p><ul><li>前序+中序 遍历序列</li><li>后序+中序 遍历序列</li><li>层序+中序 遍历序列</li></ul><p>由前序+中序遍历序列确定二叉树：</p><p><img src="https://bu.dusays.com/2023/08/07/64d06d5f516a2.png" alt="46-38.png"></p><p>由后序+中序遍历序列确定二叉树：</p><p><img src="https://bu.dusays.com/2023/08/07/64d06f71eb257.png" alt="46-39.png"></p><p>由层序+中序遍历序列确定二叉树：</p><p><img src="https://bu.dusays.com/2023/08/07/64d07112e74a7.png" alt="46-40.png"></p><p>补充说明：</p><p><img src="https://bu.dusays.com/2023/08/07/64d072c56670f.png" alt="46-41.png"></p><h3 id="线索二叉树"><a href="#线索二叉树" class="headerlink" title="线索二叉树"></a>线索二叉树</h3><p>问题的引入：</p><p><img src="https://bu.dusays.com/2023/08/08/64d2555c0a6a8.png" alt="46-42.png"></p><p>线索二叉树的概念：</p><p><img src="https://bu.dusays.com/2023/08/08/64d25759b60ca.png" alt="46-43.png"></p><p>线索二叉树的存储结构：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ThreadNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  TreadNode* lchild;</span><br><span class="line">  TreadNode* rchild;</span><br><span class="line">  <span class="type">bool</span> ltag, rtag;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// tag==0 , 表示指针指向孩子</span></span><br><span class="line"><span class="comment">// tag==1 , 表示指针是“线索”</span></span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2023/08/08/64d259e53306c.png" alt="46-44.png"></p><p>先序线索二叉树：</p><p><img src="https://bu.dusays.com/2023/08/08/64d25b0b5f446.png" alt="46-45.png"></p><p>后序线索二叉树：</p><p><img src="https://bu.dusays.com/2023/08/08/64d25c19b03fd.png" alt="46-46.png"></p><p>中序线索化代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ThreadNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  TreadNode* lchild;</span><br><span class="line">  TreadNode* rchild;</span><br><span class="line">  <span class="type">bool</span> ltag, rtag;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ThreadNode* pre = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ThreadNode* q)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(q-&gt;lchild==<span class="literal">NULL</span>)&#123; <span class="comment">//左子树为空，建立前驱线索</span></span><br><span class="line">    q-&gt;lchild = pre;</span><br><span class="line">    q-&gt;ltag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(pre!=<span class="literal">NULL</span> &amp;&amp; pre-&gt;rchild==<span class="literal">NULL</span>)&#123;</span><br><span class="line">    pre-&gt;rchild = q;</span><br><span class="line">    pre-&gt;rtag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  pre = q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inThread</span><span class="params">(ThreadNode* T)</span></span>&#123; <span class="comment">//中序遍历二叉树，一边遍历一边线索化</span></span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">inThread</span>(T-&gt;lchild);  <span class="comment">//访问左孩子</span></span><br><span class="line">    <span class="built_in">visit</span>(T);             <span class="comment">//访问根节点</span></span><br><span class="line">    <span class="built_in">inThread</span>(T-&gt;rchild);  <span class="comment">//访问右孩子</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateInThread</span><span class="params">(ThreadNode* T)</span></span>&#123; <span class="comment">//最后调用这个函数即可</span></span><br><span class="line">  pre = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123; <span class="comment">//二叉树非空</span></span><br><span class="line">    <span class="built_in">inThread</span>(T);</span><br><span class="line">    <span class="keyword">if</span>(pre-&gt;rchild==<span class="literal">NULL</span>)&#123;</span><br><span class="line">      pre-&gt;rtag = <span class="number">1</span>; <span class="comment">//处理遍历的最后一个节点</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先序线索化代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ThreadNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  TreadNode* lchild;</span><br><span class="line">  TreadNode* rchild;</span><br><span class="line">  <span class="type">bool</span> ltag, rtag;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ThreadNode* pre = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ThreadNode* q)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(q-&gt;lchild==<span class="literal">NULL</span>)&#123; <span class="comment">//左子树为空，建立前驱线索</span></span><br><span class="line">    q-&gt;lchild = pre;</span><br><span class="line">    q-&gt;ltag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(pre!=<span class="literal">NULL</span> &amp;&amp; pre-&gt;rchild==<span class="literal">NULL</span>)&#123;</span><br><span class="line">    pre-&gt;rchild = q;</span><br><span class="line">    pre-&gt;rtag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  pre = q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">preThread</span><span class="params">(ThreadNode* T)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">visit</span>(T);</span><br><span class="line">    <span class="keyword">if</span>(T-&gt;ltag==<span class="number">0</span>)   <span class="comment">//防止原地转圈</span></span><br><span class="line">      <span class="built_in">preThread</span>(T-&gt;lchild);</span><br><span class="line">    <span class="built_in">preThread</span>(T-&gt;rchild);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreatePreThread</span><span class="params">(ThreadNode* T)</span></span>&#123;</span><br><span class="line">  pre = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">preThread</span>(T);</span><br><span class="line">    <span class="keyword">if</span>(pre-&gt;rchild==<span class="literal">NULL</span>)</span><br><span class="line">      pre-&gt;rtag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后序线索化代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ThreadNode</span>&#123;</span><br><span class="line">  ElemType data;</span><br><span class="line">  TreadNode* lchild;</span><br><span class="line">  TreadNode* rchild;</span><br><span class="line">  <span class="type">bool</span> ltag, rtag;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ThreadNode* pre = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ThreadNode* q)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(q-&gt;lchild==<span class="literal">NULL</span>)&#123; <span class="comment">//左子树为空，建立前驱线索</span></span><br><span class="line">    q-&gt;lchild = pre;</span><br><span class="line">    q-&gt;ltag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(pre!=<span class="literal">NULL</span> &amp;&amp; pre-&gt;rchild==<span class="literal">NULL</span>)&#123;</span><br><span class="line">    pre-&gt;rchild = q;</span><br><span class="line">    pre-&gt;rtag = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  pre = q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">postThread</span><span class="params">(ThreadNode* T)</span></span>&#123; <span class="comment">//中序遍历二叉树，一边遍历一边线索化</span></span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">postThread</span>(T-&gt;lchild);  <span class="comment">//访问左孩子</span></span><br><span class="line">    <span class="built_in">postThread</span>(T-&gt;rchild);  <span class="comment">//访问右孩子</span></span><br><span class="line">    <span class="built_in">visit</span>(T);               <span class="comment">//访问根节点</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreatePostThread</span><span class="params">(ThreadNode* T)</span></span>&#123; <span class="comment">//最后调用这个函数即可</span></span><br><span class="line">  pre = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123; <span class="comment">//二叉树非空</span></span><br><span class="line">    <span class="built_in">postThread</span>(T);</span><br><span class="line">    <span class="keyword">if</span>(pre-&gt;rchild==<span class="literal">NULL</span>)&#123;</span><br><span class="line">      pre-&gt;rtag = <span class="number">1</span>; <span class="comment">//处理遍历的最后一个节点</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>中序线索二叉树找中序后继：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ThreadNode* <span class="title">firstNode</span><span class="params">(ThreadNode* p)</span></span>&#123;</span><br><span class="line">  <span class="comment">//找到以p为根的子树中，第一个被中序遍历的节点</span></span><br><span class="line">  <span class="comment">//循环找到最左下节点（不一定是叶子节点）</span></span><br><span class="line">  <span class="keyword">while</span>(p-&gt;ltag==<span class="number">0</span>) p = p-&gt;lchild;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ThreadNode* <span class="title">nextNode</span><span class="params">(ThreadNode* p)</span></span>&#123;</span><br><span class="line">  <span class="comment">//在中序线索二叉树中找到节点p的后继节点</span></span><br><span class="line">  <span class="keyword">if</span>(p-&gt;rtag==<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">firstNode</span>(p-&gt;rchild);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> p-&gt;rchild;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inOrderScan</span><span class="params">(ThreadNode* T)</span></span>&#123;</span><br><span class="line">  <span class="comment">//对中序线索二叉树进行中序遍历</span></span><br><span class="line">  <span class="keyword">for</span>(ThreadNode* p=<span class="built_in">firstNode</span>(T); p!=<span class="literal">NULL</span>; p=<span class="built_in">nextNode</span>(p))&#123;</span><br><span class="line">    <span class="built_in">visit</span>(p);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>中序线索二叉树找中序前驱思路（上面找后继的思路类似，不回头补了）：</p><p><img src="https://bu.dusays.com/2023/08/11/64d5c35930c85.png" alt="46-47.png"></p><p>中序线索二叉树找中序前驱代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ThreadNode* <span class="title">lastNode</span><span class="params">(ThreadNode* p)</span></span>&#123;</span><br><span class="line">  <span class="comment">//找到以p为根的子树中，最后一个被中序遍历的节点</span></span><br><span class="line">  <span class="comment">//循环找到最右下节点（不一定是叶子节点）</span></span><br><span class="line">  <span class="keyword">while</span>(p-&gt;rtag==<span class="number">0</span>) p = p-&gt;rchild;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ThreadNode* <span class="title">preNode</span><span class="params">(ThreadNode* p)</span></span>&#123;</span><br><span class="line">  <span class="comment">//在中序线索二叉树中找到节点p的前驱节点</span></span><br><span class="line">  <span class="keyword">if</span>(p-&gt;ltag==<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">lastNode</span>(p-&gt;lchild);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> p-&gt;lchild;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">revInOrderScan</span><span class="params">(ThreadNode* T)</span></span>&#123;</span><br><span class="line">  <span class="comment">//对中序线索二叉树进行逆向中序遍历</span></span><br><span class="line">  <span class="keyword">for</span>(ThreadNode* p=<span class="built_in">lastNode</span>(T); p!=<span class="literal">NULL</span>; p=<span class="built_in">preNode</span>(p))&#123;</span><br><span class="line">    <span class="built_in">visit</span>(p);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先序线索二叉树找先序后继：</p><p><img src="https://bu.dusays.com/2023/08/12/64d77c960c0db.png" alt="46-48.png"></p><p>先序线索二叉树找先序前驱：</p><p><img src="https://bu.dusays.com/2023/08/12/64d77e38e02e9.png" alt="46-49.png"></p><p>可以发现，按照之前的思路无法实现。但是，<strong>如果每个节点增加指向其父节点的指针</strong>，则可以有如下思路：</p><p><img src="https://bu.dusays.com/2023/08/12/64d7814d613db.png" alt="46-50.png"></p><p>后序线索二叉树找后序前驱：</p><p><img src="https://bu.dusays.com/2023/08/12/64d7851a3c4b8.png" alt="46-51.png"></p><p>后序线索二叉树找后序后继：</p><p><img src="https://bu.dusays.com/2023/08/12/64d786f38d68b.png" alt="46-52.png"></p><p>可以发现，按照之前的思路无法实现。但是，<strong>如果每个节点增加指向其父节点的指针</strong>，则可以有如下思路：</p><p><img src="https://bu.dusays.com/2023/08/12/64d78920217db.png" alt="46-53.png"></p><p>总结：</p><p><img src="https://bu.dusays.com/2023/08/12/64d78b5668b06.png" alt="46-54.png"></p><h3 id="树、森林"><a href="#树、森林" class="headerlink" title="树、森林"></a>树、森林</h3><p>孩子兄弟表示法（很怪，感觉不实用）：</p><p><img src="https://bu.dusays.com/2023/08/17/64de166bd22ae.png" alt="46-55.png"></p><p>树和二叉树的转化：</p><p><img src="https://bu.dusays.com/2023/08/17/64de166bec18b.png" alt="46-56.png"></p><p>森林和二叉树的转换：</p><p><img src="https://bu.dusays.com/2023/08/17/64de192903f92.png" alt="46-57.png"></p><p>树的遍历：先根遍历、后根遍历、层序遍历。</p><p><img src="https://bu.dusays.com/2023/08/17/64de23c944173.png" alt="46-58.png"></p><p>森林的遍历：先序遍历、中序遍历。</p><p><img src="https://bu.dusays.com/2023/08/17/64de2c050f3ac.png" alt="46-59.png"></p><p><strong>特别提醒：</strong> 以上只是一个应试的可选补充，熟悉 OI 代码直接在纸上写 OI 代码即可。例如树的遍历，采用链式前向星：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;<span class="type">int</span> v,w,next;&#125;edge[MAXM];</span><br><span class="line"><span class="type">int</span> tot,head[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span></span>&#123;</span><br><span class="line">    edge[++tot].v=y;</span><br><span class="line">    edge[tot].w=z;</span><br><span class="line">    edge[tot].next=head[x];</span><br><span class="line">    head[x]=tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问所有与 x 相接的点</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=edge[i].next)&#123;</span><br><span class="line">    <span class="type">int</span> y=edge[i].v;</span><br><span class="line">    <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="树与二叉树的应用"><a href="#树与二叉树的应用" class="headerlink" title="树与二叉树的应用"></a>树与二叉树的应用</h3><p>Huffman树：<a href="https://loveofpeach.github.io/posts/9e22caea.html#Huffman%E6%A0%91">https://loveofpeach.github.io/posts/9e22caea.html#Huffman%E6%A0%91</a></p><p>性质：n 个叶子节点最终构成的 Huffman 树节点总数为 2n-1 .</p><p>Huffman 编码：</p><p><img src="https://bu.dusays.com/2023/08/22/64e418f094b72.png" alt="46-60.png"></p><p>并查集：<a href="https://loveofpeach.github.io/posts/9e22caea.html#%E5%B9%B6%E6%9F%A5%E9%9B%86">https://loveofpeach.github.io/posts/9e22caea.html#%E5%B9%B6%E6%9F%A5%E9%9B%86</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">10010</span>;</span><br><span class="line"><span class="type">int</span> uset[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeset</span><span class="params">(<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)uset[i]=i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x!=uset[x])uset[x]=<span class="built_in">find</span>(uset[x]);</span><br><span class="line">    <span class="keyword">return</span> uset[x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">unionset</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    x=<span class="built_in">find</span>(x);</span><br><span class="line">    y=<span class="built_in">find</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(x==y)<span class="keyword">return</span>;</span><br><span class="line">    uset[x]=y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m; cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="built_in">makeset</span>(n+<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> z,x,y;</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;z,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span>(z==<span class="number">1</span>)<span class="built_in">unionset</span>(x,y);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(z==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">find</span>(x)==<span class="built_in">find</span>(y))</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Y\n&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;N\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="图"><a href="#图" class="headerlink" title="图"></a>图</h2><h3 id="基本概念-1"><a href="#基本概念-1" class="headerlink" title="基本概念"></a>基本概念</h3><p>邻接矩阵的某个性质（建议配合离散数学食用）：</p><p><img src="https://bu.dusays.com/2023/08/22/64e421f6699fc.png" alt="46-61.png"></p><p>类似地，有：</p><p><img src="https://bu.dusays.com/2023/08/22/64e42bcc38418.png" alt="46-62.png"></p><p>邻接表法：</p><p><img src="https://bu.dusays.com/2023/08/24/64e6396f9356b.png" alt="46-63.png" title="丑陋的做法"></p><p>十字链表存储有向图，空间复杂度 $O(|V|+|E|)$</p><ul><li>只用于存储有向图</li><li>找到指定顶点的所有出边：顺着绿色线路找</li><li>找到指定顶点的所有入边：顺着橙色线路找</li></ul><p><img src="https://bu.dusays.com/2023/08/24/64e63bac84460.png" alt="46-64.png" title="非常丑陋的做法"></p><p>邻接多重表存储无向图，空间复杂度 $O(|V|+|E|)$</p><ul><li>只能用于存储无向图</li><li>删除边、删除节点等操作“很方便”</li></ul><p><img src="https://bu.dusays.com/2023/08/24/64e63eebc0175.png" alt="46-65.png" title="让人怀疑这个世界其实不算糟"></p><p><strong>我选择，链式前向星。希望阅卷老师能看懂。</strong></p><h3 id="图的基本操作"><a href="#图的基本操作" class="headerlink" title="图的基本操作"></a>图的基本操作</h3><p><code>Adjacent(G, x, y)</code> ：判断图 G 是否存在边<code>&lt;x,y&gt;</code>或<code>(x,y)</code></p><ul><li>无向图<ul><li>邻接矩阵时间复杂度 $O(1)$</li><li>邻接表时间复杂度 $O(1)\rightarrow O(|V|)$</li></ul></li><li>有向图<ul><li>邻接矩阵时间复杂度 $O(1)$</li><li>邻接表时间复杂度 $O(1)\rightarrow O(|V|)$</li></ul></li></ul><p><code>Neighbors(G, x)</code> ：列出图 G 中与节点 x 邻接的边</p><ul><li>无向图<ul><li>邻接矩阵时间复杂度 $O(|V|)$</li><li>邻接表时间复杂度 $O(1) \rightarrow O(|V|)$</li></ul></li><li>有向图<ul><li>邻接矩阵时间复杂度 $O(|V|)$</li><li>邻接表时间复杂度<ul><li>出边 $O(1) \rightarrow O(|V|)$</li><li>入边 $O(|E|)$</li></ul></li></ul></li></ul><p><code>InsertVertex(G, x)</code> ：在图 G 中插入顶点 x</p><ul><li>无向图和有向图时间复杂度相同<ul><li>邻接矩阵时间复杂度 $O(1)$</li><li>邻接表时间复杂度 $O(1)$</li></ul></li></ul><p><code>DeleteVertex(G, x)</code> ：从图 G 中删除顶点 x</p><ul><li>无向图<ul><li>邻接矩阵时间复杂度 $O(|V|)$</li><li>邻接表时间复杂度 $O(1) \rightarrow O(|E|)$</li></ul></li><li>有向图<ul><li>邻接矩阵时间复杂度 $O(|V|)$</li><li>邻接表时间复杂度<ul><li>删出边 $O(1) \rightarrow O(|V|)$</li><li>删入边 $O(|E|)$</li></ul></li></ul></li></ul><p><code>AddEdge(G, x, y)</code> ：加边</p><ul><li>无向图和有向图类似<ul><li>邻接矩阵 $O(1)$</li><li>邻接表 $O(1)$ （头插法）</li></ul></li></ul><p><code>FirstNeighbor(G, x)</code> ：求图 G 中顶点 x 的第一个邻接点，若有返回顶点号；若没有或者根本不存在 x ，返回 -1</p><ul><li>无向图<ul><li>邻接矩阵 $O(1) \rightarrow O(|V|)$</li><li>邻接表 $O(1)$</li></ul></li><li>有向图<ul><li>邻接矩阵 $O(1) \rightarrow O(|V|)$</li><li>邻接表<ul><li>找出边邻接点 $O(1)$</li><li>找入边邻接点 $O(1) \rightarrow O(|E|)$</li></ul></li></ul></li></ul><p><code>NextNeighbor(G, x, y)</code> ：假设图 G 中顶点 y 是顶点 x 的一个邻接点，返回除 y 外顶点 x 的下一个邻接点的顶点号，若 y 是 x 的最后一个邻接点，返回 -1</p><ul><li>无向图<ul><li>邻接矩阵 $O(1) \rightarrow O(|V|)$</li><li>邻接表 $O(1)$</li></ul></li><li>有向图类似</li></ul><p><code>Get_edge_value(G, x, y)</code> ：获取图 G 中边对应的权值。 $\quad$ <code>Set_edge_value(G, x, y, v)</code> ：设置图 G 中边对应的权值为 v</p><ul><li>与<code>Adjacent(G, x, y)</code>（判断是否存在边）雷同，核心在于找到边。因此时间复杂度为：<ul><li>邻接矩阵 $O(1)$</li><li>邻接表 $O(1) \rightarrow O(|V|)$</li></ul></li></ul><h3 id="图的遍历"><a href="#图的遍历" class="headerlink" title="图的遍历"></a>图的遍历</h3><p>一、BFS</p><p>对教科书代码留个印象：</p><p><img src="https://bu.dusays.com/2023/08/24/64e6d8e84767d.png" alt="46-66.png"></p><p>同一个图的邻接矩阵表示方式唯一，因此广度优先遍历序列唯一。同一个图的邻接表表示方式不唯一，因此广度优先遍历序列不唯一。</p><p>复杂度分析：</p><p><img src="https://bu.dusays.com/2023/08/24/64e6daaae2057.png" alt="46-67.png"></p><p>广度优先生成树：</p><p><img src="https://bu.dusays.com/2023/08/24/64e6dc2968673.png" alt="46-68.png"></p><p>广度优先生成森林：</p><p><img src="https://bu.dusays.com/2023/08/24/64e6dd5f89412.png" alt="46-69.png"></p><p>二、DFS</p><p>对教科书代码留个印象：</p><p><img src="https://bu.dusays.com/2023/08/26/64e8d5b469269.png" alt="46-70.png"></p><p>复杂度分析：</p><p><img src="https://bu.dusays.com/2023/08/26/64e8d5b438391.png" alt="46-71.png"></p><p>同一个图的邻接矩阵表示方式唯一，因此深度优先遍历序列唯一。同一个图的邻接表表示方式不唯一，因此深度优先遍历序列不唯一。</p><p>深度优先生成树、深度优先生成森林，与之前提到的类似，不再赘述。</p><h3 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h3><p>一睹芳容：</p><p><img src="https://bu.dusays.com/2023/08/26/64e967557ab2a.png" alt="46-72.png"></p><p>Prim 算法的实现思想：</p><p><img src="https://bu.dusays.com/2023/08/26/64e96a53a97ec.png" alt="46-73.png"></p><p>下面给出 kruscal 代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//kruscal</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">5000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">200000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;<span class="type">int</span> u,v,w;&#125;edge[MAXM];</span><br><span class="line"><span class="type">int</span> uset[MAXN],n,m,ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(uset[x]!=x)uset[x]=<span class="built_in">find</span>(uset[x]);</span><br><span class="line">    <span class="keyword">return</span> uset[x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">unionset</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    x=<span class="built_in">find</span>(x);</span><br><span class="line">    y=<span class="built_in">find</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(x==y)<span class="keyword">return</span>;</span><br><span class="line">    uset[x]=y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Edge x,Edge y)</span></span>&#123;<span class="keyword">return</span> x.w&lt;y.w;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x,y,z;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        edge[i].u=x;</span><br><span class="line">        edge[i].v=y;</span><br><span class="line">        edge[i].w=z;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">sort</span>(edge+<span class="number">1</span>,edge+<span class="number">1</span>+m,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n;i++)uset[i]=i;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=<span class="built_in">find</span>(edge[i].u);</span><br><span class="line">        <span class="type">int</span> y=<span class="built_in">find</span>(edge[i].v);</span><br><span class="line">        <span class="keyword">if</span>(x==y)<span class="keyword">continue</span>;</span><br><span class="line">        ans+=edge[i].w;</span><br><span class="line">        <span class="built_in">unionset</span>(x,y);</span><br><span class="line">        <span class="keyword">if</span>(++cnt==n<span class="number">-1</span>)<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(cnt&lt;n<span class="number">-1</span>)<span class="built_in">printf</span>(<span class="string">&quot;orz&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="最短路径问题"><a href="#最短路径问题" class="headerlink" title="最短路径问题"></a>最短路径问题</h3><p>SPFA 算法（用于求单源最短路径）：</p><ul><li>AKA, 队列优化的 Bellman-Ford 算法</li><li><strong>允许图中存在负权边</strong></li><li><strong>不可求负环</strong>，可判断负环</li><li>在稀疏图上效率较高，时间复杂度 $O(km)$ , k 为较小的常数</li><li>在稠密图或<strong>特殊构造的</strong>网格图上，算法可能退化为 $O(nm)$</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPFA</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXM 500010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXN 10010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,s,dis[MAXN];</span><br><span class="line"><span class="type">bool</span> inq[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;<span class="type">int</span> v,w,next;&#125;edge[MAXM];</span><br><span class="line"><span class="type">int</span> tot,head[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span></span>&#123;</span><br><span class="line">    edge[++tot].v=y;</span><br><span class="line">    edge[tot].w=z;</span><br><span class="line">    edge[tot].next=head[x];</span><br><span class="line">    head[x]=tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; qwq;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)dis[i]=INF;</span><br><span class="line">    </span><br><span class="line">    qwq.<span class="built_in">push</span>(s);</span><br><span class="line">    dis[s]=<span class="number">0</span>;inq[s]=<span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(!qwq.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=qwq.<span class="built_in">front</span>();</span><br><span class="line">        qwq.<span class="built_in">pop</span>(); inq[x]=<span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="type">int</span> y=edge[i].v;</span><br><span class="line">            <span class="keyword">if</span>(dis[y]&gt;dis[x]+edge[i].w)&#123;</span><br><span class="line">                dis[y]=dis[x]+edge[i].w;</span><br><span class="line">                <span class="keyword">if</span>(!inq[y])&#123;qwq.<span class="built_in">push</span>(y);inq[y]=<span class="literal">true</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;s);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="type">int</span> x,y,z;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        <span class="built_in">addedge</span>(x,y,z);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">spfa</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">     <span class="keyword">if</span>(s==i)<span class="built_in">printf</span>(<span class="string">&quot;0 &quot;</span>);</span><br><span class="line">     <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,dis[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dijkstra 算法（用于求单源最短路径）：</p><ul><li><strong>要求图的边权为正</strong></li><li>可以求环</li><li>时间复杂度：<ul><li>考试中可认为（也就是未优化的算法版本）复杂度是 $O(n^2)$</li><li>若用二叉堆（C++ STL <code>priority_queue</code>）维护 dist 数组，最终可以得到 $O((m+n)\log n)$ 的复杂度</li></ul></li></ul><p><img src="https://bu.dusays.com/2023/08/26/64e9769b23a1f.png" alt="46-74.png" title="Dijkstra算法执行流程"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dijkstra</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXM 200010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF =<span class="number">2147483647</span>;</span><br><span class="line"><span class="type">int</span> n,m,s,dis[MAXN];</span><br><span class="line"><span class="type">bool</span> done[MAXN];</span><br><span class="line"><span class="type">int</span> tot,head[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;<span class="type">int</span> v,w,next;&#125;edge[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    edge[++tot].v=y;</span><br><span class="line">    edge[tot].w=z;</span><br><span class="line">    edge[tot].next=head[x];</span><br><span class="line">    head[x]=tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">    <span class="type">int</span> u,dist;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node&amp; v)<span class="type">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dist&gt;v.dist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;node&gt; qwq;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)dis[i]=INF;</span><br><span class="line">    dis[s]=<span class="number">0</span>;</span><br><span class="line">    qwq.<span class="built_in">push</span>((node)&#123;s,<span class="number">0</span>&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(!qwq.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        node front=qwq.<span class="built_in">top</span>(); qwq.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> u=front.u,dist=front.dist;</span><br><span class="line">        <span class="keyword">if</span>(done[u])<span class="keyword">continue</span>;</span><br><span class="line">        done[u]=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=edge[i].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> y=edge[i].v,z=edge[i].w;</span><br><span class="line">            <span class="keyword">if</span>(dis[u]+z&lt;dis[y])</span><br><span class="line">            &#123;</span><br><span class="line">                dis[y]=dis[u]+z;</span><br><span class="line">                qwq.<span class="built_in">push</span>((node)&#123;y,dis[y]&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;s);</span><br><span class="line">    <span class="type">int</span> x,y,z;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        <span class="built_in">addedge</span>(x,y,z);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dijkstra</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,dis[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dijkstra 输出路径：</p><p><img src="https://bu.dusays.com/2023/08/26/64e9827b0392a.png" alt="46-75.png"></p><p>Floyd 算法：</p><ul><li><strong>允许图中存在负权边，不可求负环</strong></li><li>算法模板的提交入口：<a href="https://www.luogu.com.cn/problem/B3647">B3647 【模板】Floyd 算法</a></li><li>关于该算法及其相对深入点的情况，请参见：<a href="https://loveofpeach.github.io/posts/a050ca88.html">https://loveofpeach.github.io/posts/a050ca88.html</a></li></ul><p>喜闻乐见的人脑模拟算法执行：</p><p><img src="https://bu.dusays.com/2023/08/29/64ee0ac5517cd.png" alt="46-76.png"></p><p>找路径：</p><p><img src="https://bu.dusays.com/2023/08/29/64ee0abf6f76c.png" alt="46-77.png"></p><p>Floyd 代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(a,b) ((a)&lt;(b)?(a):(b))</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">103</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">4503</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = (<span class="number">0x7fffffff</span>&gt;&gt;<span class="number">1</span>)<span class="number">-10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dis[MAXN][MAXN],n,m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">            <span class="keyword">if</span>(i!=j)dis[i][j] = INF;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=m; i++)&#123;</span><br><span class="line">        <span class="type">int</span> x, y, z;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x, &amp;y, &amp;z);</span><br><span class="line">        dis[x][y] = dis[y][x] = z;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>; k&lt;=n; k++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>; j&lt;=n; j++)</span><br><span class="line">                dis[i][j]=dis[j][i]=<span class="built_in">MIN</span>(dis[i][j], dis[i][k]+dis[k][j]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>; j&lt;=n; j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,dis[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>小结：</p><p><img src="https://bu.dusays.com/2023/08/29/64ee0d8965a41.png" alt="46-78.png"></p><h3 id="有向无环图描述表达式"><a href="#有向无环图描述表达式" class="headerlink" title="有向无环图描述表达式"></a>有向无环图描述表达式</h3><p>知识里的你，再弱小也是真的：</p><p><img src="https://bu.dusays.com/2023/08/29/64ee14e239368.png" alt="46-79.png"></p><p>看一眼真题：</p><p><img src="https://bu.dusays.com/2023/08/29/64ee14e2520f4.png" alt="46-80.png"></p><p>此类题目的解题方法：</p><p><img src="https://bu.dusays.com/2023/08/30/64ee196c42ca2.png" alt="46-81.png"></p><p>最后看一个特例：</p><p><img src="https://bu.dusays.com/2023/08/30/64ee1b3603714.png" alt="46-82.png"></p><p>从上面的特例（左）可以发现，允许重边；另外，可以画出的图不唯一。</p><h3 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h3><p>一个概念，AOV 网：</p><p><img src="https://bu.dusays.com/2023/08/31/64eff6c053039.png" alt="46-83.png"></p><p>拓扑排序是对有向无环图的所有顶点，生成一个线性的序列，来表达这个图的顶点之间的先后关系：</p><p><img src="https://bu.dusays.com/2023/08/31/64eff9c8520d5.png" alt="46-84.png"></p><p>通常使用 BFS 实现拓扑排序，流程如下：</p><ul><li>首先建立空队列，把所有入度为 0 的节点加入队列</li><li>从队列中取出一个节点，将从其出发的所有边删除。在编程上，即将边所连到的点入度减一，判断该边通向的节点是否入度变为 0 ，若是，则加入队列</li><li>重复以上步骤，直至队列中不剩下任何节点为止</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">queue&lt;<span class="type">int</span>&gt; qwq;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">topoSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        <span class="keyword">if</span>(inDegree[i] == <span class="number">0</span>) qwq.<span class="built_in">push</span>(i);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">while</span>(!qwq.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> v = qwq.<span class="built_in">front</span>();</span><br><span class="line">        qwq.<span class="built_in">pop</span>();</span><br><span class="line">        cout &lt;&lt; v &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(list&lt;<span class="type">int</span>&gt;::iterator it = edge[v].<span class="built_in">begin</span>(); it != edges[v].<span class="built_in">end</span>(); it++) &#123;</span><br><span class="line">            inDegree[*it]--;</span><br><span class="line">            <span class="keyword">if</span>(!inDegree[*it]) qwq.<span class="built_in">push</span>(*it);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于稍复杂的情况或使用链式前向星数据结构的代码，请参考：<a href="https://loveofpeach.github.io/posts/9e22caea.html#%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F">https://loveofpeach.github.io/posts/9e22caea.html#%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F</a></p><p>拓扑排序是对有向无环图而言的。如果需要判断图中是否存在环，则可以统计是否所有的顶点都入过队列，若存在未入过队的节点，代表图中存在环。</p><p>如果你愿意看王道的代码的话也不是不行：</p><p><img src="https://bu.dusays.com/2023/08/31/64f003a8de3c0.png" alt="46-85.png"></p><p>以上代码的时间复杂度为 $O(|V|+|E|)$ ，若采用邻接矩阵，则为 $O(|V|^2)$ .</p><p>逆拓扑排序：</p><p><img src="https://bu.dusays.com/2023/08/31/64f0067dc0b0c.png" alt="46-86.png"></p><p>逆拓扑排序代码实现：</p><p><img src="https://bu.dusays.com/2023/08/31/64f0089789bb4.png" alt="46-87.png"></p><p>以上代码中，无论从哪一个顶点出发进行 DFS 都可以得到正确输出。</p><h3 id="关键路径"><a href="#关键路径" class="headerlink" title="关键路径"></a>关键路径</h3><p>概念，AOE 网：</p><p><img src="https://bu.dusays.com/2023/08/31/64f051252b951.png" alt="46-88.png"></p><p>AOE 网两个简单的性质：</p><ul><li>仅有一个入度为 0 的顶点，称为“开始顶点（源点）”，它表示整个工程的开始</li><li>仅有一个出度为 0 的顶点，称为“结束顶点（汇点）”，它表示整个工程的结束</li></ul><p>从源点到汇点的有向路径可能有多条，所有路径中，具有最大路径长度的路径称为<strong>关键路径</strong>，而把关键路径上的活动称为<strong>关键活动</strong>。完成整个工程的最短时间就是关键路径的长度，若关键活动不能按时完成，则整个工程的完成时间就会延长。</p><p>算法思路：</p><p><img src="https://bu.dusays.com/2023/08/31/64f058e7418bf.png" alt="46-89.png"></p><p>大致实现思路：</p><p><img src="https://bu.dusays.com/2023/08/31/64f060147a4b7.png" alt="46-90.png"></p><p><strong>若缩短关键活动的时间，可以缩短工期。但当缩短到一定程度时，关键活动可能会变成非关键活动。</strong></p><p><strong>可能有多条关键路径，只提高一条关键路径上的关键活动速度并不一定能缩短整个工程的工期。</strong> 只有加快那些包括在所有关键路径上的关键活动才能缩短工期。</p><p>最后，贴一个看起来像关键路径、但其实可以用拓扑排序的题目：<a href="https://www.luogu.com.cn/problem/P1113">P1113 杂务</a></p><h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><p>查找长度：在查找运算中，需要对比关键字的次数称为查找长度。</p><p>平均查找长度（ASL, Average Search Length）：所有查找过程中，进行关键字的比较次数的平均值。</p><script type="math/tex; mode=display">ASL=\sum_{i=1}^nP_iC_i</script><p>上式中，n 为数据元素个数；$P_i$ 为查找第 i 个元素的概率；$C_i$ 为查找第 i 个元素的查找长度。</p><p>一般来说，题目中若无特别说明，<strong>默认查找任何一个元素的概率都相同</strong>。</p><h3 id="顺序查找"><a href="#顺序查找" class="headerlink" title="顺序查找"></a>顺序查找</h3><p>某个小技巧：</p><p><img src="https://bu.dusays.com/2023/08/31/64f09b159e8c4.png" alt="46-91.png"></p><p>查找判定树：</p><p><img src="https://bu.dusays.com/2023/08/31/64f09db162fef.png" alt="46-92.png"></p><h3 id="折半查找"><a href="#折半查找" class="headerlink" title="折半查找"></a>折半查找</h3><p>二分查找的实现细节需要特别注意，在某些特殊的情况下，不正确的写法会导致死循环或是其他的错误。王道的代码就是错误的。</p><p>我们直接来看正确的做法：总是将查找区间设为左闭右开的。以题目<a href="https://www.luogu.com.cn/problem/P1824">P1824 进击的奶牛</a>为例，该题的做法是二分答案，给出代码如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a,b,p[<span class="number">1000010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>,pre=<span class="number">-1500000000</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=a;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(p[i]-pre&gt;=x)&#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            pre=p[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(cnt&gt;=b)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=a;i++)cin&gt;&gt;p[i];</span><br><span class="line">    <span class="built_in">sort</span>(p+<span class="number">1</span>,p+<span class="number">1</span>+a);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>,right=<span class="number">0x7fffffff</span>;</span><br><span class="line">    <span class="keyword">while</span>(right!=left+<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid=(left+right)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid))left=mid;</span><br><span class="line">        <span class="keyword">else</span> right=mid;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cout&lt;&lt;left;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查找效率分析：</p><p><img src="https://bu.dusays.com/2023/08/31/64f0ad4be6007.png" alt="46-93.png"></p><p>关于折半查找判定树：</p><ul><li>判定树节点关键字：左&lt;中&lt;右，满足二叉排序树的定义</li><li>失败节点：n+1 个（等于成功节点的空链域数量）</li></ul><p><img src="https://bu.dusays.com/2023/08/31/64f0b08c48a29.png" alt="46-94.png"></p><h3 id="分块查找"><a href="#分块查找" class="headerlink" title="分块查找"></a>分块查找</h3><p>特点：块内无序，块间有序。</p><p><img src="https://bu.dusays.com/2023/09/03/64f46e4111f9e.png" alt="46-95.png"></p><p><strong>分块查找</strong>，又称<strong>索引顺序查找</strong>，算法过程如下：</p><ul><li>在索引表中确定待查记录所属的分块（可顺序、可折半）</li><li>在块内顺序查找</li></ul><p>折半查找索引表的例子：</p><p><img src="https://bu.dusays.com/2023/09/03/64f473c641697.png" alt="46-96.png"></p><p><strong>以上是王道书的讲解，是丑陋并且有可能出错的。</strong> 但是为了应试，应当了解。如果采用我上面提到的折半查找的方式，查找索引表的方式会完全不同。</p><p>效率分析：</p><p><img src="https://bu.dusays.com/2023/09/03/64f479a1f0cc3.png" alt="46-97.png"></p><p>拓展思考：</p><p><img src="https://bu.dusays.com/2023/09/03/64f47c5b3d576.png" alt="46-98.png"></p><h3 id="二叉排序树（BST）"><a href="#二叉排序树（BST）" class="headerlink" title="二叉排序树（BST）"></a>二叉排序树（BST）</h3><p>定义：</p><p><img src="https://bu.dusays.com/2023/09/04/64f592d5bb9b2.png" alt="46-99.png"></p><p>查找：</p><p><img src="https://bu.dusays.com/2023/09/04/64f594ef62965.png" alt="46-100.png"></p><p>上面是非递归的实现，下面给出递归版本：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 王道的代码</span></span><br><span class="line"><span class="function">BSTNode* <span class="title">BSTsearch</span><span class="params">(BSTree T, <span class="type">int</span> key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(T==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;   <span class="comment">//查找失败</span></span><br><span class="line">  <span class="keyword">if</span>(key==T-&gt;key)</span><br><span class="line">    <span class="keyword">return</span> T;      <span class="comment">//查找成功</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (key &lt; T-&gt;key)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BSTsearch</span>(T-&gt;lchild, key);  <span class="comment">//在左子树中查找</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BSTsearch</span>(T-&gt;rchild, key);  <span class="comment">//在右子树中查找</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最坏空间复杂度为 O(h) ，h 为树的高度</span></span><br></pre></td></tr></table></figure><p>插入新节点：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5982c1e89f.png" alt="46-101.png"></p><p>构造：</p><p><img src="https://bu.dusays.com/2023/09/04/64f59a1b2d239.png" alt="46-102.png"></p><p>删除某一个节点：</p><ol><li>先找到目标节点</li><li>若被删除节点是叶子节点，则直接删除。不会破坏二叉排序树的性质。</li><li>若被删除节点只有一棵左子树或右子树，则让其子树替代之。依然可以保证二叉排序树的性质。</li><li>若被删除节点既有左子树，又有右子树。有两种方法：<ul><li>找到右子树中值最小的节点 p（即右子树中最左下的节点，该节点一定没有左子树），替代将被删除的节点。然后删除原来的节点 p（情况同第 3 步）.</li><li>找到左子树中值最大的节点 p（即左子树中最右下的节点，该节点一定没有右子树），替代将被删除的节点。然后删除原来的节点 p（情况同第 3 步）.</li></ul></li></ol><p>效率分析：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5a1523998f.png" alt="46-103.png"></p><h3 id="平衡二叉树（AVL）"><a href="#平衡二叉树（AVL）" class="headerlink" title="平衡二叉树（AVL）"></a>平衡二叉树（AVL）</h3><p>一些概念：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5a87785768.png" alt="46-104.png"></p><p>二叉排序树中插入新节点时如何保持平衡：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5a9b8ae563.png" alt="46-105.png"></p><p>调整最小不平衡子树：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5c7a563248.png" alt="46-106.png"></p><p>续图：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5cbee45a87.png" alt="46-107.png"></p><p><strong>总结：</strong></p><p><img src="https://bu.dusays.com/2023/09/04/64f5cd6a39610.png" alt="46-108.png"></p><p>一个小坑：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5cfd3759d3.png" alt="46-109.png"></p><p>练习题：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5d5ea4fd27.png" alt="46-110.png"></p><p>查找效率分析：</p><p><img src="https://bu.dusays.com/2023/09/04/64f5db0f505d4.png" alt="46-111.png"></p><h3 id="平衡二叉树的删除"><a href="#平衡二叉树的删除" class="headerlink" title="平衡二叉树的删除"></a>平衡二叉树的删除</h3><p>平衡二叉树的删除操作：</p><ul><li>删除节点后，要保持二叉排序树的性质不变（左 &lt; 中 &lt; 右）</li><li>若删除节点导致不平衡，则需要调整平衡</li></ul><p>平衡二叉树的删除操作的具体步骤：</p><ol><li>删除节点（方法同“二叉排序树”）</li><li>一路向上找到最小不平衡子树，若找不到则结束算法</li><li>找最小不平衡子树下，“个头”最高的儿子、孙子</li><li>根据孙子的位置，调整平衡（LL / RR / LR / RL）<ul><li>孙子在 LL: 儿子右单旋</li><li>孙子在 RR: 儿子左单旋</li><li>孙子在 LR: 孙子先左旋，再右旋</li><li>孙子再 RL: 孙子先右旋，再左旋</li></ul></li><li>如果不平衡向上传导，转到 2<ul><li>解释：对最小不平衡子树的旋转可能导致树变矮，从而导致上层祖先不平衡（不平衡向上传导）</li></ul></li></ol><p>在步骤 2 即结束算法的例子：</p><p><img src="https://bu.dusays.com/2023/09/06/64f7eaa8d47e6.png" alt="46-112.png"></p><p>执行到第 4 步算法结束的例子：</p><p><img src="https://bu.dusays.com/2023/09/06/64f7f6094573b.png" alt="46-113.png"></p><p>不平衡向上传导一次的例子：</p><p><img src="https://bu.dusays.com/2023/09/06/64f7f93443c2e.png" alt="46-114.png"></p><p>两种选择的例子，可以看到，无论挑选哪个作为“个头”最高的孙子，都可以达到目的：</p><p><img src="https://bu.dusays.com/2023/09/06/64f89b8abedab.png" alt="46-115.png"></p><p><strong>平衡二叉树的删除操作的时间复杂度是 $O(log_2n)$</strong> .</p><h3 id="红黑树的定义和性质"><a href="#红黑树的定义和性质" class="headerlink" title="红黑树的定义和性质"></a><font color="red">红</font>黑树的定义和性质</h3><table>  <tbody>    <tr>      <td></td>      <td>BST</td>      <td>AVL Tree</td>      <td><font color="red">Red</font>-Black Tree</td>    </tr>    <tr>      <td>生日</td>      <td>1960</td>      <td>1962</td>      <td>1972</td>    </tr>    <tr>      <td>查</td>      <td>O(n)</td>      <td>O(log_2^n)</td>      <td>O(log_2^n)</td>    </tr>    <tr>      <td>插</td>      <td>O(n)</td>      <td>O(log_2^n)</td>      <td>O(log_2^n)</td>    </tr>    <tr>      <td>删</td>      <td>O(n)</td>      <td>O(log_2^n)</td>      <td>O(log_2^n)</td>    </tr>  </tbody></table><p><font color="red">红</font>黑树的优势？</p><ul><li>平衡二叉树（AVL）的劣势：插入/删除 操作很容易破坏“平衡”特性，需要频繁调整树的形态。如：插入操作导致不平衡，则需要先计算平衡因子，找到最小不平衡子树（时间开销大），再进行 LL/RR/LR/RL 调整。</li><li>相比之下，<font color="red">红</font>黑树的优势：插入/删除 操作很多时候不会破坏“<font color="red">红</font>黑”特性，无须频繁调整树的形态。即便需要调整，一般都可以在常数时间内完成。</li><li>平衡二叉树，适用于以查找为主，很少插入、删除的场景（实际也很少使用了）。</li><li><font color="red">红</font>黑树，适用于频繁插入、删除的场景，实用性更强。</li></ul><p><font color="red">红</font>黑树的定义：</p><ul><li><font color="red">红</font>黑树是二叉排序树</li><li>每个节点或是<font color="red">红</font>色，或是黑色</li><li>根节点是黑色的</li><li>叶节点（外部节点、NULL节点、失败节点）都是黑色的<ul><li>在<font color="red">红</font>黑树中，当我们提到叶子节点的时候，通常是指失败节点（又称“NULL节点”、“外部节点”）</li></ul></li><li>不存在两个相邻的<font color="red">红</font>节点（即红节点的父节点和孩子节点都是黑色的）</li><li>对每个节点，从该节点到任一叶子节点的简单路径上，所含黑节点的数目相同</li></ul><p><img src="https://bu.dusays.com/2023/09/08/64fa9d6a20ba0.png" alt="46-116.png"></p><p>粗略地用一个结构体定义一下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">RBnode</span> &#123;</span><br><span class="line">  <span class="type">int</span> key;</span><br><span class="line">  RBnode* parent;</span><br><span class="line">  RBnode* lchild;</span><br><span class="line">  RBnode* rchild;</span><br><span class="line">  <span class="type">int</span> color;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>补充概念，“黑高”：</p><p><img src="https://bu.dusays.com/2023/09/08/64faa1e3b4e1c.png" alt="46-117.png"></p><p><font color="red">红</font>黑树的性质：</p><ol><li>从根节点到叶子节点的最长路径不大于最短路径的 2 倍</li><li>有 n 个内部节点（n 个关键字）的<font color="red">红</font>黑树高度 $h\leqslant 2 \log _2(n+1)$<ul><li>由此得到<font color="red">红</font>黑树的查找操作的时间复杂度为 $O(\log _2n)$</li></ul></li></ol><p><font color="red">红</font>黑树的查找：与 BST、AVL 相同，从根出发，左小右大，若查找到一个空叶子节点，则查找失败。</p><p>关于<font color="red">红</font>黑树的更多内容，由于考纲不考，时间有限，我就放过自己了，下面只给出一些链接：</p><ul><li><a href="https://www.bilibili.com/video/BV1b7411N798/?p=77">https://www.bilibili.com/video/BV1b7411N798/?p=77</a></li><li><a href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a></li><li><a href="https://www.luogu.com.cn/problem/P5566">https://www.luogu.com.cn/problem/P5566</a></li></ul><h3 id="B-树"><a href="#B-树" class="headerlink" title="B 树"></a>B 树</h3><p>一、引入</p><p>能否将二叉查找树（BST）拓展为 m 叉查找树？</p><p><img src="https://bu.dusays.com/2023/09/08/64fb1bbd14081.png" alt="46-118.png"></p><p>如何保证查找效率：</p><p><img src="https://bu.dusays.com/2023/09/08/64fb1fe250168.png" alt="46-119.png"></p><p>二、定义</p><p><img src="https://bu.dusays.com/2023/09/08/64fb272227905.png" alt="46-120.png"></p><p>三、高度</p><p><img src="https://bu.dusays.com/2023/09/08/64fb2b2fdd8ac.png" alt="46-121.png"></p><h3 id="B-树的插入、删除"><a href="#B-树的插入、删除" class="headerlink" title="B 树的插入、删除"></a>B 树的插入、删除</h3><p>一、插入</p><p><img src="https://bu.dusays.com/2023/09/08/64fb37fa3d255.png" alt="46-122.png"></p><p>二、删除</p><p><img src="https://bu.dusays.com/2023/09/08/64fb3ca165dba.png" alt="46-123.png"></p><p>续图：</p><p><img src="https://bu.dusays.com/2023/09/08/64fb418d540a0.png" alt="46-124.png"></p><h3 id="B-树-1"><a href="#B-树-1" class="headerlink" title="B+ 树"></a>B+ 树</h3><p>定义：</p><p><img src="https://bu.dusays.com/2023/09/09/64fb46bb53acd.png" alt="46-125.png"></p><p>查找：略。</p><p>注意点：在 B+ 树中，叶节点包含信息，所有非叶子节点仅起索引作用。</p><p>B+树 和 B树 的一点区别：</p><p><img src="https://bu.dusays.com/2023/09/09/64fb4b662421b.png" alt="46-126.png"></p><p>B+树的优点和应用场景：</p><p><img src="https://bu.dusays.com/2023/09/09/64fb4f85ec422.png" alt="46-127.png"></p><p>总结：</p><p><img src="https://bu.dusays.com/2023/09/09/64fb4f85eed0a.png" alt="46-128.png"></p><h3 id="散列查找"><a href="#散列查找" class="headerlink" title="散列查找"></a>散列查找</h3><p>一睹芳容：</p><p><img src="https://bu.dusays.com/2023/09/12/64ffce0ce084e.png" alt="46-129.png"></p><p>查找操作：略。</p><p>ASL 分析、装填因子：</p><p><img src="https://bu.dusays.com/2023/09/12/64ffd1b2d99a4.png" alt="46-130.png"></p><p>设计散列函数的方法（模质数）：</p><p><img src="https://bu.dusays.com/2023/09/12/64ffd935e65fe.png" alt="46-131.png"></p><p>其他方法：</p><p><img src="https://bu.dusays.com/2023/09/12/64ffdcf762208.png" alt="46-132.png"></p><p>处理冲突的另一种方法，开放定址法：</p><p><img src="https://bu.dusays.com/2023/09/13/65009ac99f4ff.png" alt="46-133.png"></p><p>线性探测法（实际没用，考试爱考）：</p><p><img src="https://bu.dusays.com/2023/09/13/65009acc50d1a.png" alt="46-134.png"></p><p>平方探测法：</p><p><img src="https://bu.dusays.com/2023/09/13/65009fe1e24b8.png" alt="46-135.png"></p><p>伪随机序列法：</p><p><img src="https://bu.dusays.com/2023/09/13/6500a1717e654.png" alt="46-136.png"></p><p>处理冲突的另另一种方法，再散列法（再哈希法）：<br>除了原始的散列函数 H(key) 之外，多准备几个散列函数。当散列函数冲突时，用下一个散列函数计算一个新地址，直到不冲突为止：</p><script type="math/tex; mode=display">H_i=RH_i(Key) \quad i=1,2,3, \cdots k</script><p>以上总结：</p><p><img src="https://bu.dusays.com/2023/09/13/6500a45c68c95.png" alt="46-137.png"></p><p>小优化：</p><p><img src="https://bu.dusays.com/2023/09/13/6500a51f7de37.png" alt="46-138.png"></p><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p><img src="https://bu.dusays.com/2023/09/13/65011e94778b2.png" alt="46-139.png"></p><h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><p>算法思想：每次将一个待排序的记录按其关键字大小插入到前面已排好序的子序列中，直到全部记录插入完成。</p><p><img src="https://bu.dusays.com/2023/09/13/65012177a2b76.png" alt="46-140.png"></p><p>代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接插入排序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insertSort</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> i, j, temp;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">1</span>; i&lt;n; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(A[i]&lt;A[i<span class="number">-1</span>])&#123;</span><br><span class="line">      temp = A[i];</span><br><span class="line">      <span class="keyword">for</span>(j=i<span class="number">-1</span>; j&gt;=<span class="number">0</span> &amp;&amp; A[j]&gt;temp; j--)&#123;</span><br><span class="line">        A[j+<span class="number">1</span>] = A[j];</span><br><span class="line">      &#125;</span><br><span class="line">      A[j+<span class="number">1</span>] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码实现（带哨兵）：</p><p><img src="https://bu.dusays.com/2023/09/13/650124921eccf.png" alt="46-141.png"></p><p>最好时间复杂度：$O(n)$<br>最坏时间复杂度：$O(n^2)$<br>平均时间复杂度：$O(n^2)$<br><strong>算法稳定性（这里指，排序稳定性）：稳定</strong></p><p>一个小优化：</p><p><img src="https://bu.dusays.com/2023/09/13/65012ed84c0ae.png" alt="46-142.png"></p><p><strong>注意：</strong> 上图中王道的代码是有 bug 的，实际中不能这么写。</p><p>补充——对链表进行插入排序：<br>移动元素的次数变少了，但是关键字对比的次数依然是 $O(n^2)$ 数量级，整体来看时间复杂度依然是 $O(n^2)$ .</p><h3 id="希尔排序（Shell-Sort）"><a href="#希尔排序（Shell-Sort）" class="headerlink" title="希尔排序（Shell Sort）"></a>希尔排序（Shell Sort）</h3><p>算法思想来源：</p><p><img src="https://bu.dusays.com/2023/09/13/6501ba2a79974.png" alt="46-143.png"></p><p>图示：</p><p><img src="https://bu.dusays.com/2023/09/13/6501c1bb306e9.png" alt="46-144.png"></p><p>代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 希尔排序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shellSort</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> d, i, j;</span><br><span class="line">  <span class="comment">// A[0] 只是暂存单元，不是哨兵。当 j&lt;=0 时，插入位置已到</span></span><br><span class="line">  <span class="keyword">for</span>(d=n/<span class="number">2</span>; d&gt;=<span class="number">1</span>; d=d/<span class="number">2</span>)  <span class="comment">// 步长变化</span></span><br><span class="line">    <span class="keyword">for</span>(i=d+<span class="number">1</span>; i&lt;=n; i++)</span><br><span class="line">      <span class="keyword">if</span>(A[i]&lt;A[i-d])&#123;</span><br><span class="line">        A[<span class="number">0</span>] = A[i];</span><br><span class="line">        <span class="keyword">for</span>(j=i-d; j&gt;<span class="number">0</span> &amp;&amp; A[<span class="number">0</span>]&lt;A[j]; j-=d)</span><br><span class="line">          A[j+d] = A[j];</span><br><span class="line">        A[j+d] = A[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意上面代码中，每次让<code>i++</code>，也就是轮流地切换着来处理不同的几个子表。下图选取几个关键时刻展示：</p><p><img src="https://bu.dusays.com/2023/09/13/6501c510583c6.png" alt="46-145.png"></p><p>空间复杂度：$O(1)$ .</p><p>时间复杂度：</p><ul><li>和增量序列 $d_1,d_2,d_3,\cdots $ 的选择有关</li><li><strong>目前</strong>无法用数学手段证明确切的时间复杂度</li><li>最坏时间复杂度为 $O(n^2)$ ，如该算法退化为插入排序时</li><li>当 n 在某个范围时，可达到 $O(n^{1.3})$ .</li></ul><p><strong>希尔排序仅适用于顺序表，不适用于链表。</strong></p><p>稳定性：</p><p><img src="https://bu.dusays.com/2023/09/13/6501cb74ec12c.png" alt="46-146.png"></p><h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><p>若某一趟排序没有发生“交换”，说明此时已经整体有序。</p><p><img src="https://bu.dusays.com/2023/09/13/6501d1cb49713.png" alt="46-147.png"></p><p><strong>冒泡排序适用于链表。</strong></p><h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><p>算法思想：</p><p><img src="https://bu.dusays.com/2023/09/15/6503c6cdde4ea.png" alt="46-148.png"></p><p>代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">quickSort</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> low, <span class="type">int</span> high)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(low&lt;high)&#123;</span><br><span class="line">    <span class="type">int</span> pivotPos = <span class="built_in">Partition</span>(A, low, high); <span class="comment">// 划分</span></span><br><span class="line">    <span class="built_in">quickSort</span>(A, low, pivotPos<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">quickSort</span>(A, pivotPos+<span class="number">1</span>, high);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Partition</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> low, <span class="type">int</span> high)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> pivot = A[low];  <span class="comment">// 第一个元素作为枢轴</span></span><br><span class="line">  <span class="keyword">while</span>(low&lt;high)&#123;</span><br><span class="line">    <span class="keyword">while</span>(low&lt;high &amp;&amp; A[high]&gt;=pivot) high--;</span><br><span class="line">    A[low] = A[high];</span><br><span class="line">    <span class="keyword">while</span>(low&lt;high &amp;&amp; A[low]&lt;=pivot) low++;</span><br><span class="line">    A[high] = A[low];</span><br><span class="line">  &#125;</span><br><span class="line">  A[low] = pivot;  <span class="comment">// 枢轴元素放到最终位置</span></span><br><span class="line">  <span class="keyword">return</span> low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>性能分析：</p><p><img src="https://bu.dusays.com/2023/09/15/6503d075b50fc.png" alt="46-149.png"></p><p><strong>快速排序不稳定。</strong></p><p>一个应试的小疑惑：</p><p><img src="https://bu.dusays.com/2023/09/15/6503d349c304a.png" alt="46-150.png"></p><h3 id="简单选择排序"><a href="#简单选择排序" class="headerlink" title="简单选择排序"></a>简单选择排序</h3><p><img src="https://bu.dusays.com/2023/09/15/650469589d376.png" alt="46-151.png"></p><p><strong>简单选择排序既可以用于顺序表，也可以用于链表。</strong></p><h3 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h3><p>前置知识：</p><p><img src="https://bu.dusays.com/2023/09/15/650472146278d.png" alt="46-152.png"></p><p>大根堆的建立：</p><p><img src="https://bu.dusays.com/2023/09/15/65047b7abdde6.png" alt="46-153.png"></p><p>建立大根堆的代码：<br>（此处代码的动画演示参见<a href="https://www.bilibili.com/video/BV1b7411N798?p=92">王道视频_大根堆的建立</a>）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立大根堆</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_maxHeap</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=len/<span class="number">2</span>; i&gt;<span class="number">0</span>; i--)</span><br><span class="line">    <span class="built_in">headAdjust</span>(A, i, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将以 k 为根的子树调整为大根堆</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">headAdjust</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> k, <span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">  A[<span class="number">0</span>] = A[k]; <span class="comment">// A[0] 暂存子树的根节点</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>*k; i&lt;=len; i*=<span class="number">2</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;len &amp;&amp; A[i]&lt;A[i+<span class="number">1</span>]) i++; <span class="comment">// 选取 key 较大的子节点的下标</span></span><br><span class="line">    <span class="keyword">if</span>(A[<span class="number">0</span>]&gt;=A[i]) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      A[k] = A[i];</span><br><span class="line">      k = i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  A[k] = A[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>基于大根堆进行排序：</p><p><img src="https://bu.dusays.com/2023/09/16/6504856460bda.png" alt="46-154.png"></p><p>基于大根堆进行排序（代码）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_maxHeap</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">headAdjust</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> k, <span class="type">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">heapSort</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">  <span class="built_in">build_maxHeap</span>(A, len);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=len; i&gt;<span class="number">1</span>; i--)&#123;</span><br><span class="line">    <span class="built_in">swap</span>(A[i], A[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">headAdjust</span>(A, <span class="number">1</span>, i<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效率分析：</p><p><img src="https://bu.dusays.com/2023/09/16/65048fc666dd0.png" alt="46-155.png"></p><h3 id="堆的插入、删除"><a href="#堆的插入、删除" class="headerlink" title="堆的插入、删除"></a>堆的插入、删除</h3><p><img src="https://bu.dusays.com/2023/09/18/6507b9a8cfd7c.png" alt="46-156.png"></p><h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><p><img src="https://bu.dusays.com/2023/09/18/6507bd80c6e3e.png" alt="46-157.png"></p><p>代码实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *B = (<span class="type">int</span>*) <span class="built_in">malloc</span>(n*<span class="built_in">sizeof</span>(<span class="type">int</span>)); <span class="comment">// 辅助数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A[low...mid] 和 A[mid+1...high] 各自有序，将两个部分归并</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> low, <span class="type">int</span> mid, <span class="type">int</span> high)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> i, j, k;</span><br><span class="line">  <span class="keyword">for</span>(k=low; k&lt;=high; k++)</span><br><span class="line">    B[k] = A[k];</span><br><span class="line">  <span class="keyword">for</span>(i=low,j=mid+<span class="number">1</span>,k=i; i&lt;=mid&amp;&amp;j&lt;=high; k++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(B[i]&lt;=B[j])  <span class="comment">// 保证了稳定性</span></span><br><span class="line">      A[k] = B[i++];</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">      A[k] = B[j++];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>(i&lt;=mid) A[k++] = B[i++];</span><br><span class="line">  <span class="keyword">while</span>(j&lt;=high) A[k++] = B[j++];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mergeSort</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> low, <span class="type">int</span> high)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(low&lt;high)&#123;</span><br><span class="line">    <span class="type">int</span> mid = (low+high)/<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">mergeSort</span>(A, low, mid);</span><br><span class="line">    <span class="built_in">mergeSort</span>(A, mid+<span class="number">1</span>, high);</span><br><span class="line">    <span class="built_in">merge</span>(A, low, mid, high);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>性能分析：</p><p><img src="https://bu.dusays.com/2023/09/18/6507c7ef4fe66.png" alt="46-158.png"></p><h3 id="基数排序（Radix-Sort）"><a href="#基数排序（Radix-Sort）" class="headerlink" title="基数排序（Radix Sort）"></a>基数排序（Radix Sort）</h3><p><img src="https://bu.dusays.com/2023/09/18/6507ce15b9025.png" alt="46-159.png"></p><p>效率分析：</p><p><img src="https://bu.dusays.com/2023/09/18/6507d11389b6f.png" alt="46-160.png"></p><p>应用：</p><p><img src="https://bu.dusays.com/2023/09/18/6507d3e0a43fc.png" alt="46-161.png"></p><h2 id="完结撒花"><a href="#完结撒花" class="headerlink" title="完结撒花"></a>完结撒花</h2><p>外部排序考试不要求掌握，前面的区域，以后再来探索吧：</p><p><a href="https://www.bilibili.com/video/BV1b7411N798/?p=96">https://www.bilibili.com/video/BV1b7411N798/?p=96</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;应试向的数据结构考试和实际写起代码来有很大区别。重复造轮子就不说了，更可怕的是，有时还需要应试者人脑模拟算法的执行过程。相对来说，对针对具体问题设计算法的考察较浅。&lt;/p&gt;
&lt;p&gt;另外，有时王道书的代码风格奇特，我尽量改为了自己习惯的写法，这点需要特别注意。&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="算法" scheme="https://loveofpeach.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="数据结构" scheme="https://loveofpeach.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
</feed>
